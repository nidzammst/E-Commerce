    <script type="text/javascript">
        var intPrevAdRefreshTST = (new Date()).getTime();
		var bolIsListViewForSpecificFile = Boolean(1);
    </script>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html id="adaptive_html" lang="LV">
<head>
    <meta charset="UTF-8">
		<meta name="globalsign-domain-verification" content="WVoCXGP9WWz7ZO3hqGZASmZCYQ2jhO7WxIRwsepEgV" />

<meta name="theme-color" content="#2b3d52">


<meta name="facebook-domain-verification" content="nikti9bu56gz5oi6d126k5bloj0772" />



<title>MJ1_720p</title>
<meta name="keywords" content="ftp file upload, file hosting, android, file cloud, cloud storage, file sharing, failu glabāšana, bilžu hostings, bilžu apmaiņa, failu apmaiņa, failu serveris, failu koplietošana, failu rezerves kopijas, failu backup, file hosting, file sharing, file exchange, file storage, image hosting, file upload, files, file share, web file hosting, internet file storage, image upload, free upload, photo sharing, online photo gallery, photos online, data backup, online backup" />
			

        <meta property="og:title"
              content="MJ1_720p"/>
        <meta property="og:description"
              content=" Apmeklē šo saiti, lai redzētu video:"/>
        <meta name="description"
              content=" Apmeklē šo saiti, lai redzētu video:"/>

        <meta property="og:image" content="https://fv2-4.failiem.lv/thumb_video_picture.php?i=5vwfkz7eg"/>
        <meta property="og:image:secure_url" content="https://fv2-4.failiem.lv/thumb_video_picture.php?i=5vwfkz7eg" />
        <meta name="twitter:card" content="summary_large_image"/>
        <meta name="twitter:image" content="https://fv2-4.failiem.lv/thumb_video_picture.php?i=5vwfkz7eg"  />
        <meta property="twitter:image" content="https://fv2-4.failiem.lv/thumb_video_picture.php?i=5vwfkz7eg"  />
        
        
        <meta property="og:url" content="https://failiem.lv/f/5vwfkz7eg"/>
        <meta property="og:type" content="website" />
        <meta property="og:site_name" content="Failiem.lv"/>
        <meta property="fb:app_id" content="449566538440301" />
<link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
<link rel="preconnect" href="https://files.fm" crossorigin>
<link rel="preconnect" href="https://www.google-analytics.com" crossorigin>
<link rel="preconnect" href="https://www.googleadservices.com" crossorigin>
<link rel="preconnect" href="https://googleads.g.doubleclick.net" crossorigin>
<link rel="preconnect" href="https://stats.g.doubleclick.net" crossorigin>
<link rel="preconnect" href="https://www.google.com" crossorigin>
<link rel="preconnect" href="https://www.google.lv" crossorigin>




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-1970559-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  
    
  gtag('js', new Date());
  
    gtag('config', 'UA-1970559-10');

    gtag('config', 'UA-1970559-6');
  
    
    gtag('config', 'AW-1043031755');
  
</script>

 <script src="/js/google_conversion.js?v=4"></script>

 




			<base href="https://fv2-4.failiem.lv/" />


			<meta name="verify-v1" content="4MHpv5CF+UNp34oMIZOxnVwoSslLpr+5GPkxFp94Wq8=" />

			<meta name="viewport" content="width=device-width, initial-scale=1" />



<link rel="stylesheet" type="text/css" media="all" href="/css/reset.css?v=1429376391" /><link rel="stylesheet" type="text/css" media="all" href="/css/global.css?v=1680683341" /><link rel="stylesheet" type="text/css" media="all" href="/css/header.css?v=1681284044" /><link rel="stylesheet" type="text/css" media="all" href="/css/messages/messages.css?v=1576094031" /><link rel="stylesheet" type="text/css" media="all" href="/ts/chat/dist/chat.css?v=1582713860" />
                <script src="/js/jquery-1.12.2.min.js?v=1458758350"></script>
                <script src="/js/jquery-migrate-1.3.0.js?v=1459008995"></script>
                <script src="/js/JSON/json2.js?v=1429376364"></script>
                <script src="/js/JSON/cycle.js?v=1429376364"></script>			<script src="/error_handler_client?v=4"></script>

			<link rel="icon" type="image/png" href="/images/cloud.png" />
			<script>

				var DOMAIN_NAME = 'failiem.lv';
				
				var HTTP_HOST = 'fv2-4.failiem.lv';
				var IS_DEV_SERVER = false;

				// capitalize first letter of domain
                DOMAIN_NAME = DOMAIN_NAME.charAt(0).toUpperCase() + DOMAIN_NAME.slice(1);

				var lang_code = 'LV';

				var DOCUMENT_IS_LOADED = false;

				var MMVD = false;
				var STDT = new Date().getTime();

				var WEB_ROOT_PATH = '';

				var FB_APP_ID = '449566538440301';

				var strTranslation_LinkCopied = 'Saite ir iekopēta atmiņā';

				var strSellFilesCurrency = 'EUR';

				$(function(){

					DOCUMENT_IS_LOADED=true

                    var intScrollTop = $('html').scrollTop();
					intScrollTop = Math.max(intScrollTop, $('body').scrollTop());
					
                    if ( intScrollTop > 0 )
                    {
                        $('body').addClass('scrolled');
                    }

                    
                    $(window).on('scroll', function (){
                        
                        var intScrollTop = $('html').scrollTop();
                        intScrollTop = Math.max(intScrollTop, $('body').scrollTop());
                        
                        if ( intScrollTop > 0 )
                        {
                            $('body').addClass('scrolled');
                        }
                        else
                        {
                            $('body').removeClass('scrolled');
                            checkMenuItems();
                        }
                    });

					$( document ).mousemove( function( event )
					{
						if ( ! MMVD )
						{
							if ( ( ( new Date().getTime() ) - STDT ) > 1000 )
							{
								MMVD = true;
							}
						}
					});
				});


				function changeLanguage(strLangCode, strTitle)
				{
					var strUrl = '';
					switch (strLangCode)
					{
						case 'lv':
                            strUrl = 'https://failiem.lv/f/5vwfkz7eg?start_p2p_download';
                            break;
						case 'en':
                            strUrl = 'https://files.fm/f/5vwfkz7eg?start_p2p_download';
                            break;
						case 'ru':
                            strUrl = 'https://ru.files.fm/f/5vwfkz7eg?start_p2p_download';
                            break;
						case 'ua':
                            strUrl = 'https://ua.files.fm/f/5vwfkz7eg?start_p2p_download';
                            break;                            
						case 'de':
                            strUrl = 'https://de.files.fm/f/5vwfkz7eg?start_p2p_download';
                            break;
						case 'fi':
                            strUrl = 'https://fi.files.fm/f/5vwfkz7eg?start_p2p_download';
                            break;
                        case 'es':
                            strUrl = 'https://es.files.fm/f/5vwfkz7eg?start_p2p_download';
                            break;
                        case 'ko':
                            strUrl = 'https://ko.files.fm/f/5vwfkz7eg?start_p2p_download';
                            break;
					}
                    gaev('HeaderClick', 'Lang_switch', strLangCode);
					window.location = strUrl + WEB_ROOT_PATH;// + '?lng='+strLangCode;
					$('.language_dropdown .activator SPAN').each(function (){
						var img = $('IMG', this).clone();
						$(this).html(strTitle + ' ').append(img);
					});
					hidePopups();
				}


				function gaev(strCategory, strAction, strLabel, strValue) {

					if (typeof gtag != 'undefined') {
						// old ga.js
						//_gaq.push(['_trackEvent', strCategory, strAction, strLabel]);
						
						// Send the event to the gtag.js Google Analytics property
						// with tracking ID GA_MEASUREMENT_ID.
						gtag('event', 'Events', {
						  'send_to': 'UA-1970559-10',
						  'event_category': strCategory,
						  'event_action': 	strAction,
						  'event_label': 	strLabel,
						  'value':			strValue
						});
						
						/*gtag('event', 'strEveryEventTest', {
						  'send_to': 'UA-1970559-10',
						  'event_category': 'EveryEvent',
						  'event_action': 	'TestAction',
						  'event_label': 	'TestLabel'
						});*/

					};
				}
				
				function logClick(strButton)
				{
										if (typeof gtag != 'undefined')
					{
						//_gaq.push(['_trackEvent', 'ActionLine', strButton, 'List']);

						gtag('event', 'Clicks', {
						  'send_to': 'UA-1970559-10',
						  'event_category': 'ActionLine',
						  'event_action': 	strButton,
						  'event_label': 	'List'
						});
					};
									}


				function printAdwordsConversion(strIframeName) {

					var  iframe = document.createElement('iframe');
					iframe.style.width = '0px';
					iframe.style.height = '0px';
					document.body.appendChild(iframe);

					iframe.src = 'https://fv2-4.failiem.lv/server_scripts/google_adwords/'+ strIframeName +'.php';
				}

			</script>
			<script>
				var IS_MOBILE = false;
			</script>

			<!-- IE less than 9 -->
			<!--[if lt IE 9]>
				<script type="text/javascript" src="./js/html5.js"></script>
				<script type="text/javascript" src="./js/css3-mediaqueries.js"></script>
			<![endif]-->
  <script>  	var tb_lang = new Object();  	tb_lang["close"] = "Aizvērt";  	tb_lang["or_esc_key"] = "vai spied Esc taustiņu";  </script>
			<script>

				Math._round = function(number, precision)
				{
					precision = Math.abs(parseInt(precision)) || 0;
					var coefficient = Math.pow(10, precision);
					return Math.round(number*coefficient)/coefficient;
				}

				function file_size_format (filesize, intPrecision) {
				    
				    if (typeof(intPrecision) == 'undefined' || intPrecision==null)
				        intPrecision = 2;
				    
					if (filesize >= 1073741824)
					{
						filesize = Math._round(filesize / 1073741824, 2).toFixed(intPrecision) + '&nbsp;GB';
					}
					else
					{
						if (filesize >= 1048576)
						{
							filesize = Math._round(filesize / 1048576, 2).toFixed(intPrecision) + '&nbsp;MB';
						}
						else
						{
							if (filesize >= 1024)
							{
								filesize = Math._round(filesize / 1024, 0).toFixed(intPrecision) + '&nbsp;KB';
							}
							else
							{
								filesize = filesize + '&nbsp;B';
							};
						};
					};
					return filesize;
				};

			</script>





			<script>
    /**
     * @param strEmails - one or more emails delimited with ","
     * @param bolIsSingleEmail - is strEmails only one email
     */
    function EmailValidator(strEmails, bolIsSingleEmail)
    {
        this.state = EmailValidator.states.READY;
        this.strSuggestedEmails = "";
        this.strEmails = strEmails.trim();
        this.strNoMxEmails = "";
        this.strInputID = "";
        this.bolIsSingleEmail = bolIsSingleEmail;

        // set default invalid cb
        this.setOnInvalidCB(function(){});
        this.strErrorClass = "has-error";
    }
    
    EmailValidator.regexTest = function(email) 
    {
        var re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        
        return re.test( email )
            // disallow single quotes
            && email.indexOf( "'" ) === -1;
    };
    
    //<editor-fold desc="Setters">
    /**
     * this.onValidCB and this.onInvalidCB and this.setOnSuggestionCB execution order:
     *  1. remove this.strErrorClass from this.strInputID
     *  2. show or hide modal - only for onInvalid and onValid
     *  3. run callback
     */
    EmailValidator.prototype.setOnValidCB = function (onValidCB)
    {
        this.onValidCB = applyTo(this, function ()
        {
            if (this.strModalID && $('#' + this.strModalID).css('opacity') == 0)
            {
                showModal(this.strModalID);
            }
            this.removeClassFromInput();
            onValidCB();
        });

        return this;
    };
    EmailValidator.prototype.setOnInvalidCB = function (onInvalidCB)
    {
        this.onInvalidCB = applyTo(this, function ( strInvalidEmails)
        {
            if( typeof strInvalidEmails === 'undefined' )
            {
                strInvalidEmails =  '';
            }
            
            if (this.strModalID && $('#' + this.strModalID).css('opacity') == 0)
            {
                showModal(this.strModalID);
            }
            this.addErrorClassToInput();
            onInvalidCB(strInvalidEmails);
        });

        return this;
    };
    EmailValidator.prototype.setOnSuggestionCB = function (onSuggestionCB)
    {
        this.revalidate = function ()
        {
            this.addErrorClassToInput();
            onSuggestionCB();
        };
        return this;
    };
    
    EmailValidator.prototype.setModalID = function (strModalID)
    {
        this.strModalID = strModalID;
        return this;
    };

    EmailValidator.prototype.setInputID = function (strInputID)
    {
        this.strInputID = strInputID;
        return this;
    };

    EmailValidator.prototype.setErrorClass = function (strErrorClass)
    {
        this.strErrorClass = strErrorClass;
        return this;
    };
    //</editor-fold>
    
    EmailValidator.prototype.onTooManyEmails = function () 
    {
        fError("Vienā reizē nav atļauts nosūtīt vairāk par 5 e-pastiem.", "", "OK", applyTo(this, this.onInvalidCB));
    };

    /**
     * adds this.strErrorClass to element with ID this.strInputID
     */
    EmailValidator.prototype.addErrorClassToInput = function ()
    {
        if (this.strInputID)
        {
            $("#" + this.strInputID).addClass(this.strErrorClass);
        }
    };

    /**
     * removes this.strErrorClass from element with ID this.strInputID
     */
    EmailValidator.prototype.removeClassFromInput = function ()
    {
        if (this.strInputID)
        {
            $("#" + this.strInputID).removeClass(this.strErrorClass);
        }
    };

    EmailValidator.prototype.run = function ()
    {
        if(this.strEmails === "") 
        {
            this.state = EmailValidator.states.INVALID;
            this.onInvalidCB();
            return;
        }
        
        // onValid, onInvalid and strEmails are necessary!
        if (!this.onValidCB || !this.onInvalidCB)
        {
            throw new Error("EmailValidator is missing essential data!");
        }
        
        var emails;

        // check if not over allowed email count
        if( !this.bolIsSingleEmail )
        {
            emails = this.strEmails.split(",");
            if( emails.length > 50 ) {
                this.state = EmailValidator.states.TOO_MANY_EMAILS;
                this.onTooManyEmails();
                return;
            }
        }
        else
        {
            emails = [ this.strEmails ];
        }

        // test emails against email regex before posting them
        for (var i in emails)
        {
            if ( emails.hasOwnProperty(i) && !EmailValidator.regexTest( emails[i].trim() ) )
            {
                this.state = EmailValidator.states.INVALID;
                this.onInvalidCB( emails[i].trim() );
                return;
            }
        }

        this.state = EmailValidator.states.RUNNING;

        $.post('/chkMail.php', {'q': this.strEmails}, applyTo(this, this.onResponse));
    };

    EmailValidator.prototype.onResponse = function (data)
    {
        var arrReturn = JSON.parse(data);

        if (arrReturn['result'] === 0)
        {
            this.state = EmailValidator.states.VALID;
            this.onValidCB(this);
        }
        else if(arrReturn['result'] === EmailValidator.states.INVALID) 
        {
            this.state = EmailValidator.states.INVALID;
            this.onInvalidCB();
        }
        else if (arrReturn['result'] === 2)
        {
            this.strSuggestedEmails = arrReturn['suggest'];

            if (arrReturn['no_mx'])
            {
                this.strNoMxEmails = arrReturn['no_mx'];
                this.state = EmailValidator.states.MISSING_MX_RECORDS;
            }
            else
            {
                this.state = EmailValidator.states.POSSIBLE_TYPO;
            }

            // this calls onSuggestionCB
            this.revalidate();
        }
        else if (arrReturn['result'] === 4)
        {
            this.state = EmailValidator.states.TOO_MANY_EMAILS;
            this.onTooManyEmails();
        }
    };

    EmailValidator.prototype.revalidate = function ()
    {
        // add typo suggestions and emails with no mx records to string
        var strMsg = '';
        if (this.strSuggestedEmails !== '')
        {
            strMsg += "Vai J\u016bs dom\u0101j\u0101t:";
            strMsg += " " + this.strSuggestedEmails + "?\n";
        }
        if (this.strNoMxEmails !== '')
        {
            if(this.bolIsSingleEmail)
            {
                strMsg += "Iesp\u0113jams, ka ievad\u012bt\u0101 e-pasta adrese nav pareiza:"            }
            else 
            {
                strMsg += "Iesp\u0113jams, \u0161\u012bs adreses nav pareizas:"            }
            
            strMsg += " " + this.strNoMxEmails + ".\n";
        }

        if(this.bolIsSingleEmail)
        {
            strMsg += "L\u016bdzu p\u0101rbaudiet ievad\u012bt\u0101 e-pasta pareiz\u012bbu! Ja ievad\u012btais e-pasts ir pareizs, spiediet OK.";
        }
        else 
        {
            strMsg += "L\u016bdzu p\u0101rbaudiet ievad\u012bto e-pastu pareiz\u012bbu! Ja visi ievad\u012btie e-pasti ir pareizi, spiediet OK.";
        }

        this.addErrorClassToInput();

        // hide the original modal to avoid overlapping
        if (this.strModalID && $('#'+this.strModalID).css('opacity') == 1)
        {
            hideModal(this.strModalID);
        }

        fConfirm(
            strMsg,
            "Iesp\u0113jama k\u013c\u016bda",
            "OK",
            "Atcelt",
            applyTo(this, function ( bolResult)
            {
                // execute onInvalid only if user declines
                if (bolResult === false)
                {
                    this.state = EmailValidator.states.INVALID;
                    this.onInvalidCB();
                }
            }),
            applyTo(this, function ()
            {
                this.state = EmailValidator.states.ACCEPTED_TYPO;
                this.onValidCB();
            }, this)
        );
    };

    EmailValidator.prototype.isSubmittable = function ()
    {
        return [EmailValidator.states.VALID, EmailValidator.states.ACCEPTED_TYPO].indexOf(this.state) !== -1;
    };

    EmailValidator.states = {
        READY: -2,              // initial state
        RUNNING: -1,            // request has started and server has not responded yet

        // => onValidCB
        VALID: 0,

        // => onInvalidCB
        INVALID: 1,

        // => revalidate => onSuggestionCB
        POSSIBLE_TYPO: 2,       // there are typos in the submitted emails
        MISSING_MX_RECORDS: 3,  // some emails have missing mx records
        TOO_MANY_EMAILS: 4,     // too many emails are submitted

        // => revalidate => onSuggestionCB (clicked OK) => onValid 
        ACCEPTED_TYPO: 5        // typo was spotted but user dismissed it
    };
    
    // the function is defined in functions.js, but because this script is included in bergafoto, lets check to make sure.
    if ( typeof applyTo !== 'function' )
    {
        /**
         * Magic function that makes vanilla JS objects usable
         *  - execute fn in the context of $this with passed parameters
         *  - you can also pass parameters to the fn that is returned, they will be added to the fn call
         * @param $this - Object scope
         * @param fn - Object method to execute
         * @param var1 - first parameter to be passed to fn
         * @returns {Function}
         */
        window.applyTo = function( $this, fn, var1 )
        {
            if ( !$this )
            {
                throw new Error( "Invalid usage of closure function, scope must be defined." );
            }
        
            if ( !fn )
            {
                throw new Error( "Invalid usage of closure function, fn must be defined." );
            }
        
            var finalArgs = [];
        
            // skip first 3 arguments (callee, $this, fn)
            for ( var i = 2; i < arguments.length; ++i )
            {
                // add to list of args
                finalArgs.push( arguments[ i ] );
            }
        
            return function ()
            {
                // add all arguments
                for ( var i = 0; i < arguments.length; ++i )
                {
                    finalArgs.push( arguments[ i ] );
                }
            
                // first arguments will be the ones passed to closure, then the ones passed to this function
                return fn.apply( $this, finalArgs );
            };
        }
    }
</script>
<link rel="stylesheet" type="text/css" media="all" href="/bootstrap/css/dropdown.css?v=1536455916" /><link rel="stylesheet" type="text/css" media="all" href="/css/global_facelift.css?v=1670411891" /><link rel="stylesheet" type="text/css" media="all" href="/css/inputs.css?v=1638266235" /><link rel="stylesheet" type="text/css" media="all" href="/js/jquery-ui-1.11.4.custom/jquery-ui.min.css?v=1458758345" /><link rel="stylesheet" type="text/css" media="all" href="/css/thickbox.css?v=1667307496" /><link rel="stylesheet" type="text/css" media="all" href="/css/modal.css?v=1571147423" /><link rel="stylesheet" type="text/css" media="all" href="/css/font-awesome-new/css/font-awesome.min.css?v=1563280607" /><link rel="stylesheet" type="text/css" media="all" href="/css/font-awesome-pro/css/light.min.css?v=1563280607" /><link rel="stylesheet" type="text/css" media="all" href="/css/font-awesome-pro/css/brands.min.css?v=1563280607" /><link rel="stylesheet" type="text/css" media="all" href="/css/font-awesome-pro/css/fontawesome.min.css?v=1563280607" /><link rel="stylesheet" type="text/css" media="all" href="/css/alert.css?v=1571153133" />
                <script src="/js/jquery.cookie.js?v=1429376362"></script>
                <script src="/js/jquery-ui-1.11.4.custom/jquery-ui.min.js?v=1458758349"></script>
                <script src="/js/global.js?v=1670498877"></script>
                <script src="/js/info_tooltips.js?v=1557302526"></script>
                <script src="/js/share_functions.js?v=1486841181"></script>
                <script src="/js/jquery-ui-1.11.4.custom/jquery-ui.min.js?v=1458758349"></script>
                <script src="/js/ajax2_norm.js?v=1429376364"></script>
                <script src="/js/dom_table.js?v=1429376366"></script>
                <script src="/js/event.js?v=1429376370"></script>
                <script src="/js/functions.js?v=1598421347"></script>
                <script src="/js/thickbox.js?v=1429376368"></script>
                <script src="/js/modal.js?v=1616084725"></script>
                <script src="/js/alert.js?v=1487078178"></script>
<link rel="stylesheet" type="text/css" media="all" href="css/list.v2/main.css?v=5037" />
<link rel="stylesheet" type="text/css" media="all" href="css/list.v2/horizontal_view.css?v=5" />
<link rel="stylesheet" type="text/css" media="all" href="css/list.v2/grid_view.css?v=5015" />
<link rel="stylesheet" type="text/css" media="all" href="css/list.v2/list_view.css?v=5015" />
<link rel="stylesheet" type="text/css" media="all" href="css/list.v2/vertical_view.css?v=2" />
<link rel="stylesheet" type="text/css" media="all" href="css/bootstrap/dropdowns_custom.css?v=103" />

<script type="text/javascript" src="js/jqote2/jquery.jqote2.min.js"></script>
<script type="text/javascript" src="js/timeago-en.js"></script>
<script type="text/javascript" src="js/list.v2.js?v=1035"></script>
<script type="text/javascript" src="js/long-press-event.min.js"></script>
<script type="text/javascript" src="js/jquery-lazyload/jquery.scrollstop.min.js"></script>
<script type="text/javascript" src="js/jquery-lazyload/jquery.lazyload.min.js"></script><link rel="stylesheet" type="text/css" media="all" href="/css/stripe_payment_form.css?v=1629989673" />
                <script src="/js/stripe_payment_form.js?v=1663831496"></script>
<script>

	var PHPSESSID = 'a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8';
	var STRIPE_PUBLIC_KEY = 'pk_live_qdaFEN4KBX40UvEYnwlKCIX8';
	var STRIPE_LOCALE = 'lv';

	var arrStripePaymentFormErrorMsg = {
		'FinishOrder' : 'Pasūtījuma apstrādes laikā notika kļūda. Lūdzu, sazinieties ar support@failiem.lv!' ,
		'Processing' : 'Maksājuma apstrādes laikā notika kļūda. Lūdzu, mēģiniet vēlreiz vai sazinieties ar support@failiem.lv!' ,
		'InvalidData' : 'Lūdzu, ievadiet derīgus maksājumu kartes datus!' ,
		'BankDeclined' : 'Maksājuma apstrādes laikā notika kļūda - Jūsu banka atteica maksājumu. Lūdzu, pārbaudiet, vai Jūsu bankas kontā ir pietiekami daudz līdzekļu; vai ar Jūsu maksājumu karti ir atļauts veikt maksājumus Internetā. Vai sazinieties ar savu banku, vai arī izmantojiet citu maksājumu karti.' ,
		'NotEnoughFunds' : 'Jūsu bankas kontā nav pietiekami daudz līdzekļu. Lūdzu, papildiniet kontu vai izmantojiet citu maksājumu karti!' ,
		'InvalidCVV' : 'Lūdzu, pārbaudiet un ievadiet derīgu maksājumu kartes CVV kodu!'
	};

</script>		</head>
				<body class="lang_lv use_vh full-width non-sticky" >

            <!-- Google Tag Manager (noscript) -->
            <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-N9HRMM7"
            height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
            <!-- End Google Tag Manager (noscript) -->
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5ZNTW54" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<script>
	$( window ).bind( 'load', function()
	{
		if	( window.location.search === '?coupon' || window.location.search === "?kupons" ) 
		{
			showCreateAccount();
            adaptFormForCoupon();
        }
	} );
</script>

			<div id="container" class="failiemlv">
			<noscript>
				<table class="alert_container alert_container_danger" style="display: block">
					<tr>
						<td>
							<i class="fa fa-exclamation-circle"></i>
						</td>
						<td>
							<div class="alert_main_text">
								Tava pārlūkprogramma neatbalsta JavaScript. Lai izmantotu šo lapu, ieslēdz JavaScript atbalstu vai arī izmanto citu pārlūkprogrammu.							</div>
						</td>
					</tr>
				</table>
			</noscript>


<header id="header" class="overflow-hidden  ">
    <nav>
        <!-- Flag -->
        <!-- UA flag
        <div id="header_flag">
            <div id="header_flag_1"></div>
            <div id="header_flag_2"></div>
        </div>
        -->

        <div id="header_flag">
            <div id="header_flag_3"></div>
            <div id="header_flag_4"></div>
            <div id="header_flag_5"></div>
        </div>

        <div class="container">
            
            <input type="checkbox" class="navbar-toggler" id="navbar-toggler-chb">
            <label  id="navbar-toggler"
                    class="navbar-toggler-stripes user-has-not-clicked-navbar-toggler" 
                    for="navbar-toggler-chb"
                    onclick="$( this ).toggleClass( 'clicked' ); navbarTogglerClicked(); gaev('HeaderClick', 'Hamburger-menu', '');"
                    onmouseover="navbarTogglerClicked()">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </label>

            <script type="text/javascript">
                function navbarTogglerClicked()
                {
                    $( '#navbar-toggler' ).removeClass( 'user-has-not-clicked-navbar-toggler' );
                    document.cookie = 'user-has-clicked-navbar-toggler=1; max-age=' + (365*24*60*60) + ' ; path=/ ; domain=failiem.lv';
                    document.cookie = 'user-has-clicked-navbar-toggler=1; max-age=' + (365*24*60*60) + ' ; path=/ ; domain=.failiem.lv';
                    document.cookie = 'user-has-clicked-navbar-toggler=1; max-age=' + (365*24*60*60) + ' ; path=/ ; domain=files.fm';
                    document.cookie = 'user-has-clicked-navbar-toggler=1; max-age=' + (365*24*60*60) + ' ; path=/ ; domain=.files.fm';
                }
            </script>

            <div class="nav-left">
            	                <a class="navbar-brand menu-link" onclick="gaev('HeaderClick', 'Logo', '');"  href="/">
                    <img class="logo" alt="Failiem.lv" src="/images/logo/failiem_logo_full.svg?v=4" />                </a>
                                
            </div>

            <div class="navbar" id="main-nav">
                <ul>

                                        <li data-priority="10" class="nav-button">
                        <div class="header_menu_wrap">
                            <div class="header_menu_label">Risinājumi</div>
                            <div class="header_menu_drawer">
                                <a class=" SyncShare withicon drawer-item" href="/sync-share" onclick="gaev('HeaderClick', 'Solutions-Storage', '');">
                                    Datu glabāšana                                    <div class="desc">Sinhronizēšana un koplietošana</div>
                                </a>
                                						
                                <a class=" Filebox withicon drawer-item" href="/upload-form" onclick="gaev('HeaderClick', 'Solutions-Filebox', '');">
                                    Integrējiet failu ielādi vai API                                    <div class="desc">Failu ielādes forma weblapām</div>
                                </a>								
														                            
                                <a class="PublicProfiles withicon drawer-item" href="/public-profiles" onclick="gaev('HeaderClick', 'Solutions-Publish', '');">
                                    Satura publicēšana                                    <div class="desc">Publisks foto, video un dokumentu katalogs</div>
                                </a>
								
                                <a class=" SportEvents withicon drawer-item" href="/events" onclick="gaev('HeaderClick', 'Solutions-SportEvents', '');">
                                    Sportam un pasākumiem                                    <div class="desc">Satura publicēšana no notikumiem</div>
                                </a>
								
								<a class=" SellFiles withicon drawer-item" href="/sell-files" onclick="gaev('HeaderClick', 'Solutions-SellFiles', '');">
                                    Satura pārdošana                                    <div class="desc">Pelni pārdodot saturu publiski vai privāti</div>
                                </a>
                                                                                  
									<a class=" ServerRental withicon drawer-item" href="/servers" onclick="gaev('HeaderClick', 'Solutions-Servers', '');">
										Virtuālo serveru noma										<!--<div class="desc">Windows/Linux virtuālie serveri</div>-->
									</a>         

									<a class="withicon drawer-item DVS" href="/DVS-demo" onclick="gaev('HeaderClick', 'Solutions-DVS', '');">
										Dokumentu vadības sistēma										<div class="drawer-item-new">Jaunums!</div>
									</a>
								                                <!--
                                <a class=" Backup withicon drawer-item" href="/backup" onclick="gaev('HeaderClick', 'Solutions-Backup', '');">
                                    Rezerves kopiju veidošana                                    <div class="desc">Šifrētu kopiju risinājums</div>
                                </a>
								-->								
                            </div>
                        </div>
                    </li>
                    					
											<li data-priority="2" class="nav-button">
							<div class="header_menu_wrap">
								<div class="header_menu_label">Lietotnes</div>
								<div class="header_menu_drawer">
								
									<a class="drawer-item" href="https://play.google.com/store/apps/details?id=com.files.fm" onclick="gaev('HeaderClick', 'Apps-Android', '');" target="_blank"> Mobile: Android <div class="drawer-item-new">Jaunums!</div></a>

									<a class="drawer-item" href="https://apps.apple.com/in/app/files-fm-cloud-storage/id1636301796" onclick="gaev('HeaderClick', 'Apps-IOS', '');" target="_blank"> Mobile: Apple iOS <div class="drawer-item-new">Jaunums!</div></a>									

									<a class="drawer-item" href="/sync-share#setup" onclick="gaev('HeaderClick', 'Apps-Desktop', '');" >  Sync priekš Windows | MacOS | Linux</a>

									<!--<a class="drawer-item" href="/backup#setup" onclick="gaev('HeaderClick', 'Apps-Backup', '');" > Backup Windows | MacOS | Linux</a>-->

									<a class="drawer-item" href="/webdav-info" onclick="gaev('HeaderClick', 'Apps-Webdav', '');" >Tīkla disks ar webdav</a>

								</div>
							</div>
						</li>
										

                    
                                                <li data-priority="2" class="nav-button">
                            <div class="header_menu_wrap">
                                <div class="header_menu_label">Rīki</div>
                                <div class="header_menu_drawer">

                                    
                                                                                                                    <a class="withicon drawer-item Useroutline" href="/public-profiles" onclick="gaev('HeaderClick', 'Tools-My-public-profile', '');">Mans publiskais profils</a>
                                                                                                               
                                    <a class="withicon drawer-item ConvertMp4" href="?convert-to-mp4" onclick="gaev('HeaderClick', 'Tools-convert-to-mp4', '');" >Konvertēt video uz mp4</a> 
                                    <a class="withicon drawer-item ConvertPDF" href="?convert-to-pdf" onclick="gaev('HeaderClick', 'Tools-convert-to-pdf', '');" >Konvertēt doc uz PDF</a>
                                    
                                                                        <a class="withicon drawer-item Eparakts" href="/eparaksts" onclick="gaev('HeaderClick', 'Tools-eparakstit', '');" class="nav-link"> eParakstīt dokumentus </a>
                                    <a class="withicon drawer-item DVS" 	 href="/DVS-demo" onclick="gaev('HeaderClick', 'Tools-DVS', '');" class="nav-link"> Dokumentu vadības sistēma </a>
                                    <a class="withicon drawer-item Print" 	 href="/foto-druka" onclick="gaev('HeaderClick', 'Tools-fotodruka', '');" >Pasūtīt foto izdrukas</a>
                                    <a class="withicon drawer-item Cup" 	 href="/foto-drukas-produkti" onclick="gaev('HeaderClick', 'Tools-Produktu-apdruka', '');" >Pasūtīt produktu apdruku</a>
                                     
                                    
                                                                        <a class="withicon drawer-item VideoCall" href="https://video.failiem.lv/b/auth/openid_connect" onclick="gaev('HeaderClick', 'Tools-Video-room', '');">Izveidot video konferenci</a>
                                    
                                </div>
                            </div>
                        </li>
                        
                                                <li class="nav-button" data-priority="2">
                            <a href="/business" class="nav-link">
                                Biznesam                            </a>
                        </li>
                        
                                                <li class="nav-button showonfirstload_mid" data-priority="2">
                            <a class="nav-link" href="/storage-plans" onclick="gaev('HeaderClick', 'Storage_plans_and_prices', '');">Cenas</a>
                        </li>
                           
                       
                        

                        
                                                <li class="nav-button darker nav-right " data-priority="2">
                            <a href="/" onclick="gaev('HeaderClick', 'Start_upload', ''); hidePopups();" class="nav-link">
                                Uzkopēt failus                            </a>
                        </li>
                        
                        
                        
                                            <li class="nav-right nav-button darker showonfirstload_small" data-priority="0">
                            <div id="login">
                                <a href="javascript:void(0);" onclick="gaev('HeaderClick', 'Log_in', ''); showSignIn(); return false;" id="login_button" class="">
                                    <span id="login_button_text">Ieiet</span>
                                </a>
                            </div>
                        </li>

                        <li class="nav-right nav-button red showonfirstload_small"  data-priority="1">
                            <div>
                                <a href="javascript:void(0);" onclick="gaev('HeaderClick', 'Sign_up', ''); showCreateAccount(); return false;" id="signup">Reģistrēties</a>
                            </div>
                        </li>

                        
                                                <li class="nav-right showonfirstload_mid" id="lang_switch" data-priority="2">
                            <div class="header_menu_wrap">
                                <div class="header_menu_label">
                                    <img id="lang_switch_icon_dark" src="/images/button_icons/globe.svg?v=1"></img>
                                    <span class="currentlang">LV</span>
                                </div>
                                <div class="header_menu_drawer right">
                                    <a class="drawer-item" href="javascript:changeLanguage('en', 'EN');">English (EN)</a>
                                                                        <a class="drawer-item" href="javascript:changeLanguage('es', 'ES');">Español (ES)</a>
                                    <a class="drawer-item" href="javascript:changeLanguage('de', 'DE');">Deutsch (DE)</a>
                                    <a class="drawer-item" href="javascript:changeLanguage('fi', 'FI');">Suomi (FI)</a>
                                    <!-- <a class="drawer-item" href="javascript:changeLanguage('ko', 'KO');">한국어 (KO)</a> -->
                                                                        <a class="drawer-item" href="javascript:changeLanguage('ru', 'РУ');">Русский (РУ)</a>
                                    <a class="drawer-item" href="javascript:changeLanguage('ua', 'РУ');">Українська (UA)</a>
                                    <a class="drawer-item" href="javascript:changeLanguage('lv', 'LV');">Latviešu (LV)</a>
                                </div>
                            </div>
                        </li>
                                            
                </ul>
            </div>
            <script>
                function addAnonymousUploads()
                {
                    var addUploads = confirm('Vai piesaistīt savam kontam augšupielādes, kas ir veiktas iepriekš no šīs ierīces? Varēsi tās pārvaldīt vai dzēst.');
                    if (addUploads == true)
                    {
                        $('.add_anonym_uplaods').val('1');
                    }
                }
            </script>

            <div id="mega-menu" class="collapse">
                <div class="container event_ignore_click">
                    <ul id="nav-functional"></ul>
                </div>
                <div class="overlay"></div>
            </div>
            <div id="mega-menu-close"></div>
        </div>

        <div id="navbar-css"></div>
    </nav>
    
</header>

    

            <script src="/js/Captcha/Google/LazyGoogleReCaptchaV2.js"></script>
            <script>
                objLazyGoogleReCaptchaV2.strLanguageKey = "lv";
                objLazyGoogleReCaptchaV2.strSiteKey = "6LflqXQUAAAAAP2CM782IqIgjzooEt9soXTCwxX2";
            </script>
<link rel="stylesheet" type="text/css" media="all" href="/css/sign_in_form.css?v=28"/>




<div id="sign-in" class="modal-container" tabindex="-1" role="dialog" aria-labelledby="createaccount-header signin-header" aria-hidden="true" style="display:none">

	<div class="modal-inner">


		<!-- START : Header -->
		<div id="sign-in-header">

			<span id="signin-header" onclick="if( !$( '#signin-modal-content' ).is( ':visible' ) ) showSignIn(); return false;">
				Ieiet				<img id="signin-header_icon_inactive" src="/images/signup_form/log_in.svg?v=2" alt="Login to upload files">
				<img id="signin-header_icon_active" src="/images/signup_form/log_in_blue.svg?v=2" alt="Login to upload files">
			</span>

                            <span id="createaccount-header" onclick="if( !$('#createaccount-modal-content').is(':visible')) showCreateAccount(); return false;">
                    Reģistrēties                </span>
            
		</div>
		<!-- END : Header -->

        <div id="createaccount-referral-container" style="display:none">
            <span class="referrer-container">
                Tevi ielūdza lietotājs&nbsp;<span id="createaccount-referral-referrer"></span>&nbsp;izveidot kontu un saņemt 1GB            </span>
            
            <hr/>
        </div>
        
                
        <div id="createaccount-message-container">
        	<table class="alert_container alert_container_danger">
                <tr>
                    <td><i class="fa fa-exclamation-circle"></i></td>
                    <td><div class="alert_main_text"></div></td>
                </tr>
            </table>
        </div>
        
		<!-- START : Create account form -->
		<div id="createaccount-modal-content" class="modal-content">
            <div class="info"></div>
            
            			<!-- START : Social create account -->
			<div class="signin-modal-content-social">

				<div class="signin-modal-content-social-title">Izveidojiet kontu bezmaksas:</div>

				<div class="signin-modal-content-social-buttons-container signin-modal-content-social-buttons-container-2-buttons">

					<!-- 
					<div class="fb_button social_login_button" onclick="checkSocialLogin('facebook');">
						<img src="/images/signup_form/login-facebook.svg?v=2" alt="Sign up with Facebook to upload files for free">
						<span>Facebook</span>
					</div>
                    -->
					
					<div class="standard_button google_button social_login_button" onclick="checkSocialLogin('google');">
						<img src="/images/signup_form/login-google.svg?v=2" alt="Sign up with Google to upload files for free">
						<span>Google</span>
					</div>

					<div class="standard_button ms_button social_login_button" onclick="checkSocialLogin('microsoft');">
                        <img src="/images/signup_form/login-microsoft.svg" alt="Sign up with Microsoft to upload files for free">
						<span>Microsoft</span>
					</div>
					
                    <div class="justify_el"></div>

				</div>

			</div>
			<!-- END : Social create account -->

			<div class="or-delimiter">
				vai			</div>
							
			<!-- START : Simple create account -->
			<div id="createaccount-simple-container">
                <input id="createaccount-referral-hash" name="inviter_hash" type="hidden">
                <input id="createaccount-referral-user" name="inviter_user" type="hidden">

                <div id="register_coupon_code">
                    <div class="input-label">
                        <label for="register_coupon_code_input">Kupona kods</label>
                        <input id="register_coupon_code_input" name="coupon_code" type="text"/>
                    </div>
                    <div class="createaccount-input-container"></div>
                </div>
                    
                <div class="no-coupon-link">
                    <a href="" onclick="revertFormFromCoupon(); return false">Man nav kupona koda »</a>
                </div>

                <div class="input-label">
                    <label for="createaccount_name">Vārds</label>
                    <input id="createaccount_name" name="createaccount_name" type="text" autocomplete="off"  />
                </div>

                <div class="input-label">
                    <label for="createaccount_surname">Uzvārds</label>
                    <input id="createaccount_surname" name="createaccount_surname" type="text" autocomplete="off"  />
                </div>

                <div class="input-label">
                    <label for="createaccount_email">E-pasts</label>
                    <input id="createaccount_email" name="createaccount_email" type="email" autocomplete="off"  onchange="createUsername(this.value);" />
                </div>

                <div class="input-label">
                    <label for="createaccount_password">Parole</label>
                    <input id="createaccount_password" name="createaccount_password" type="password" autocomplete="off">
                </div>

				<div class="justify_el"></div>

								<!-- 
				<div id="business_account_chechbox_container">
					<input id="create_business_account" type="checkbox" onchange="toggleCreateBusinessAccount()">
					<label for="create_business_account">Man varētu vajadzēt biznesa funkcijas, es gribētu uzzināt vairāk</label>
				</div>
				
				<div id="create_business_account_container">

					<input id="createaccount_company_name" name="createaccount_company_name" type="text" autocomplete="off" placeholder="Uzņēmuma nosaukums" />
					<input id="createaccount_company_phone" name="createaccount_company_phone" type="text" autocomplete="off" placeholder="Telefona numurs" />
					<select name="createaccount_company_country" id="createaccount_company_country">

						<option value="">Valsts</option>
							<option value="Afghanistan" >Afghanistan</option>
							<option value="Albania" >Albania</option>
							<option value="Algeria" >Algeria</option>
							<option value="American Samoa" >American Samoa</option>
							<option value="Andorra" >Andorra</option>
							<option value="Angola" >Angola</option>
							<option value="Anguilla" >Anguilla</option>
							<option value="Antarctica" >Antarctica</option>
							<option value="Antigua and Barbuda" >Antigua and Barbuda</option>
							<option value="Argentina" >Argentina</option>
							<option value="Armenia" >Armenia</option>
							<option value="Aruba" >Aruba</option>
							<option value="Australia" >Australia</option>
							<option value="Austria" >Austria</option>
							<option value="Azerbaijan" >Azerbaijan</option>
							<option value="Bahamas" >Bahamas</option>
							<option value="Bahrain" >Bahrain</option>
							<option value="Bangladesh" >Bangladesh</option>
							<option value="Barbados" >Barbados</option>
							<option value="Belarus" >Belarus</option>
							<option value="Belgium" >Belgium</option>
							<option value="Belize" >Belize</option>
							<option value="Benin" >Benin</option>
							<option value="Bermuda" >Bermuda</option>
							<option value="Bhutan" >Bhutan</option>
							<option value="Bolivia" >Bolivia</option>
							<option value="Bonaire, Saint Eustatius and Saba" >Bonaire, Saint Eustatius and Saba</option>
							<option value="Bosnia and Herzegovina" >Bosnia and Herzegovina</option>
							<option value="Botswana" >Botswana</option>
							<option value="Bouvet Island" >Bouvet Island</option>
							<option value="Brazil" >Brazil</option>
							<option value="British Indian Ocean Territory" >British Indian Ocean Territory</option>
							<option value="British Virgin Islands" >British Virgin Islands</option>
							<option value="Brunei" >Brunei</option>
							<option value="Bulgaria" >Bulgaria</option>
							<option value="Burkina Faso" >Burkina Faso</option>
							<option value="Burundi" >Burundi</option>
							<option value="Cambodia" >Cambodia</option>
							<option value="Cameroon" >Cameroon</option>
							<option value="Canada" >Canada</option>
							<option value="Cape Verde" >Cape Verde</option>
							<option value="Cayman Islands" >Cayman Islands</option>
							<option value="Central African Republic" >Central African Republic</option>
							<option value="Chad" >Chad</option>
							<option value="Chile" >Chile</option>
							<option value="China" >China</option>
							<option value="Christmas Island" >Christmas Island</option>
							<option value="Cocos [Keeling] Islands" >Cocos [Keeling] Islands</option>
							<option value="Colombia" >Colombia</option>
							<option value="Comoros" >Comoros</option>
							<option value="Congo [DRC]" >Congo [DRC]</option>
							<option value="Congo [Republic]" >Congo [Republic]</option>
							<option value="Cook Islands" >Cook Islands</option>
							<option value="Costa Rica" >Costa Rica</option>
							<option value="Croatia" >Croatia</option>
							<option value="Cuba" >Cuba</option>
							<option value="Curacao" >Curacao</option>
							<option value="Cyprus" >Cyprus</option>
							<option value="Czech Republic" >Czech Republic</option>
							<option value="Denmark" >Denmark</option>
							<option value="Djibouti" >Djibouti</option>
							<option value="Dominica" >Dominica</option>
							<option value="Dominican Republic" >Dominican Republic</option>
							<option value="East Timor" >East Timor</option>
							<option value="Ecuador" >Ecuador</option>
							<option value="Egypt" >Egypt</option>
							<option value="El Salvador" >El Salvador</option>
							<option value="Equatorial Guinea" >Equatorial Guinea</option>
							<option value="Eritrea" >Eritrea</option>
							<option value="Estonia" >Estonia</option>
							<option value="Ethiopia" >Ethiopia</option>
							<option value="Falkland Islands" >Falkland Islands</option>
							<option value="Faroe Islands" >Faroe Islands</option>
							<option value="Fiji" >Fiji</option>
							<option value="Finland" >Finland</option>
							<option value="France" >France</option>
							<option value="French Guiana" >French Guiana</option>
							<option value="French Polynesia" >French Polynesia</option>
							<option value="French Southern Territories" >French Southern Territories</option>
							<option value="Gabon" >Gabon</option>
							<option value="Gambia" >Gambia</option>
							<option value="Georgia" >Georgia</option>
							<option value="Germany" >Germany</option>
							<option value="Ghana" >Ghana</option>
							<option value="Gibraltar" >Gibraltar</option>
							<option value="Greece" >Greece</option>
							<option value="Greenland" >Greenland</option>
							<option value="Grenada" >Grenada</option>
							<option value="Guadeloupe" >Guadeloupe</option>
							<option value="Guam" >Guam</option>
							<option value="Guatemala" >Guatemala</option>
							<option value="Guernsey" >Guernsey</option>
							<option value="Guinea" >Guinea</option>
							<option value="Guinea-Bissau" >Guinea-Bissau</option>
							<option value="Guyana" >Guyana</option>
							<option value="Haiti" >Haiti</option>
							<option value="Heard Island and McDonald Island" >Heard Island and McDonald Island</option>
							<option value="Honduras" >Honduras</option>
							<option value="Hong Kong" >Hong Kong</option>
							<option value="Hungary" >Hungary</option>
							<option value="Iceland" >Iceland</option>
							<option value="India" >India</option>
							<option value="Indonesia"  selected>Indonesia</option>
							<option value="Iran" >Iran</option>
							<option value="Iraq" >Iraq</option>
							<option value="Ireland" >Ireland</option>
							<option value="Isle of Man" >Isle of Man</option>
							<option value="Israel" >Israel</option>
							<option value="Italy" >Italy</option>
							<option value="Ivory Coast" >Ivory Coast</option>
							<option value="Jamaica" >Jamaica</option>
							<option value="Japan" >Japan</option>
							<option value="Jersey" >Jersey</option>
							<option value="Jordan" >Jordan</option>
							<option value="Kazakhstan" >Kazakhstan</option>
							<option value="Kenya" >Kenya</option>
							<option value="Kiribati" >Kiribati</option>
							<option value="Kosovo" >Kosovo</option>
							<option value="Kuwait" >Kuwait</option>
							<option value="Kyrgyzstan" >Kyrgyzstan</option>
							<option value="Laos" >Laos</option>
							<option value="Latvia" >Latvia</option>
							<option value="Lebanon" >Lebanon</option>
							<option value="Lesotho" >Lesotho</option>
							<option value="Liberia" >Liberia</option>
							<option value="Libya" >Libya</option>
							<option value="Liechtenstein" >Liechtenstein</option>
							<option value="Lithuania" >Lithuania</option>
							<option value="Luxembourg" >Luxembourg</option>
							<option value="Macau" >Macau</option>
							<option value="Macedonia" >Macedonia</option>
							<option value="Madagascar" >Madagascar</option>
							<option value="Malawi" >Malawi</option>
							<option value="Malaysia" >Malaysia</option>
							<option value="Maldives" >Maldives</option>
							<option value="Mali" >Mali</option>
							<option value="Malta" >Malta</option>
							<option value="Marshall Islands" >Marshall Islands</option>
							<option value="Martinique" >Martinique</option>
							<option value="Mauritania" >Mauritania</option>
							<option value="Mauritius" >Mauritius</option>
							<option value="Mayotte" >Mayotte</option>
							<option value="Mexico" >Mexico</option>
							<option value="Micronesia" >Micronesia</option>
							<option value="Moldova" >Moldova</option>
							<option value="Monaco" >Monaco</option>
							<option value="Mongolia" >Mongolia</option>
							<option value="Montenegro" >Montenegro</option>
							<option value="Montserrat" >Montserrat</option>
							<option value="Morocco" >Morocco</option>
							<option value="Mozambique" >Mozambique</option>
							<option value="Myanmar [Burma]" >Myanmar [Burma]</option>
							<option value="Namibia" >Namibia</option>
							<option value="Nauru" >Nauru</option>
							<option value="Nepal" >Nepal</option>
							<option value="Netherlands" >Netherlands</option>
							<option value="Netherlands Antilles" >Netherlands Antilles</option>
							<option value="New Caledonia" >New Caledonia</option>
							<option value="New Zealand" >New Zealand</option>
							<option value="Nicaragua" >Nicaragua</option>
							<option value="Niger" >Niger</option>
							<option value="Nigeria" >Nigeria</option>
							<option value="Niue" >Niue</option>
							<option value="Norfolk Island" >Norfolk Island</option>
							<option value="North Korea" >North Korea</option>
							<option value="Northern Mariana Islands" >Northern Mariana Islands</option>
							<option value="Norway" >Norway</option>
							<option value="Oman" >Oman</option>
							<option value="Pakistan" >Pakistan</option>
							<option value="Palau" >Palau</option>
							<option value="Palestinian Territories" >Palestinian Territories</option>
							<option value="Panama" >Panama</option>
							<option value="Papua New Guinea" >Papua New Guinea</option>
							<option value="Paraguay" >Paraguay</option>
							<option value="Peru" >Peru</option>
							<option value="Philippines" >Philippines</option>
							<option value="Pitcairn Islands" >Pitcairn Islands</option>
							<option value="Poland" >Poland</option>
							<option value="Portugal" >Portugal</option>
							<option value="Puerto Rico" >Puerto Rico</option>
							<option value="Qatar" >Qatar</option>
							<option value="Romania" >Romania</option>
							<option value="Russia" >Russia</option>
							<option value="Rwanda" >Rwanda</option>
							<option value="Réunion" >Réunion</option>
							<option value="Saint Barthélemy" >Saint Barthélemy</option>
							<option value="Saint Helena" >Saint Helena</option>
							<option value="Saint Kitts and Nevis" >Saint Kitts and Nevis</option>
							<option value="Saint Lucia" >Saint Lucia</option>
							<option value="Saint Martin" >Saint Martin</option>
							<option value="Saint Pierre and Miquelon" >Saint Pierre and Miquelon</option>
							<option value="Saint Vincent and the Grenadines" >Saint Vincent and the Grenadines</option>
							<option value="Samoa" >Samoa</option>
							<option value="San Marino" >San Marino</option>
							<option value="Saudi Arabia" >Saudi Arabia</option>
							<option value="Senegal" >Senegal</option>
							<option value="Serbia" >Serbia</option>
							<option value="Serbia and Montenegro" >Serbia and Montenegro</option>
							<option value="Seychelles" >Seychelles</option>
							<option value="Sierra Leone" >Sierra Leone</option>
							<option value="Singapore" >Singapore</option>
							<option value="Sint Maarten" >Sint Maarten</option>
							<option value="Slovakia" >Slovakia</option>
							<option value="Slovenia" >Slovenia</option>
							<option value="Solomon Islands" >Solomon Islands</option>
							<option value="Somalia" >Somalia</option>
							<option value="South Africa" >South Africa</option>
							<option value="South Georgia and the South Sandwich Islands" >South Georgia and the South Sandwich Islands</option>
							<option value="South Korea" >South Korea</option>
							<option value="Spain" >Spain</option>
							<option value="Sri Lanka" >Sri Lanka</option>
							<option value="Sudan" >Sudan</option>
							<option value="Suriname" >Suriname</option>
							<option value="Svalbard and Jan Mayen" >Svalbard and Jan Mayen</option>
							<option value="Swaziland" >Swaziland</option>
							<option value="Sweden" >Sweden</option>
							<option value="Switzerland" >Switzerland</option>
							<option value="Syria" >Syria</option>
							<option value="São Tomé and Príncipe" >São Tomé and Príncipe</option>
							<option value="Taiwan" >Taiwan</option>
							<option value="Tajikistan" >Tajikistan</option>
							<option value="Tanzania" >Tanzania</option>
							<option value="Thailand" >Thailand</option>
							<option value="Togo" >Togo</option>
							<option value="Tokelau" >Tokelau</option>
							<option value="Tonga" >Tonga</option>
							<option value="Trinidad and Tobago" >Trinidad and Tobago</option>
							<option value="Tunisia" >Tunisia</option>
							<option value="Turkey" >Turkey</option>
							<option value="Turkmenistan" >Turkmenistan</option>
							<option value="Turks and Caicos Islands" >Turks and Caicos Islands</option>
							<option value="Tuvalu" >Tuvalu</option>
							<option value="U.S. Minor Outlying Islands" >U.S. Minor Outlying Islands</option>
							<option value="U.S. Virgin Islands" >U.S. Virgin Islands</option>
							<option value="Uganda" >Uganda</option>
							<option value="Ukraine" >Ukraine</option>
							<option value="United Arab Emirates" >United Arab Emirates</option>
							<option value="United Kingdom" >United Kingdom</option>
							<option value="United States" >United States</option>
							<option value="Uruguay" >Uruguay</option>
							<option value="Uzbekistan" >Uzbekistan</option>
							<option value="Vanuatu" >Vanuatu</option>
							<option value="Vatican City" >Vatican City</option>
							<option value="Venezuela" >Venezuela</option>
							<option value="Vietnam" >Vietnam</option>
							<option value="Wallis and Futuna" >Wallis and Futuna</option>
							<option value="Western Sahara" >Western Sahara</option>
							<option value="Yemen" >Yemen</option>
							<option value="Zambia" >Zambia</option>
							<option value="Zimbabwe" >Zimbabwe</option>
							<option value="Åland Islands" >Åland Islands</option>
					</select>

					<div class="justify_el"></div>

				</div>
                 -->
				
				                <!--
				<div id="your_public_profile_container_info_before">
					Savā profila lapā Tu varēsi publicēt un saņemt failus				</div>-->
				
				<div id="your_public_profile_container">
						
					<div id="your_public_profile_label_text_before">
						Tavs profils:
					</div>
					
					<div id="your_public_profile_label">
						
						<span id="your_public_profile_label_text">
							Tavs profils:
						</span>
						
						<span id="your_public_profile_label_host">
							https://failiem.lv/						</span>
						
					</div>

                    <div id="your_public_profile_field_input">
                        <input id="createaccount_username" name="createaccount_username" type="text" autocomplete="off" placeholder="Lietotājvārds"  onkeyup="usernameChanged();" />
                    </div>
					
				</div>
								
				<div id="createaccount_coupon_info" onclick='showSignIn()'>
					Man jau ir reģistrēts Failiem.lv konts »    			</div>

				<div id="createaccount_error_msg" class="error_msg"></div>

                                            <div class="sign_in_captcha" id="createaccount_captcha">
                        <div class="google-recaptcha-v2-container" id="C3726C65-E8C5-09AA-C645-706BDD834974"></div>                            <script>
                                function loadCreateAccountCaptcha()
                                {
                                    (function () {
            var init = function (){
                // Wait for include to load
                if ( typeof(objLazyGoogleReCaptchaV2) !== "undefined" )
                {
                    objLazyGoogleReCaptchaV2.initInstance (
                        "C3726C65-E8C5-09AA-C645-706BDD834974",
                        captchaCreateAccountLoaded,
                        captchaCreateAccountSubmitted
                    )
                }
                else
                {
                    setTimeout(init, 50);
                }
            };
            init();
        })();
                                }
                            </script>

                        </div>
                                        
                <div class="sign_in_submit_bn" onclick="checkCreateAccountForm();">
                    Veidot kontu                    <img src="/images/signup_form/sign_up.svg" alt="Sign up to upload files for free">
                </div>
				
								<div id="createaccount_info">
    				Reģistrēti lietotāji var glabāt failus pastāvīgi un saņemt vairāk iespējas. Lietojot šo vietni, jūs piekrītiet noteikumiem. <a href="/storage-plans" target="_blank">Vairāk info »</a>    			</div>

                <div id="createaccount_info_ico">
                    Reģistrēti lietotāji var glabāt un piekļūt failiem pastāvīgi, kā arī var tos publicēt savā profilā. <a href="/storage-plans" target="_blank">Vairāk info »</a>                </div>
                    			<!--
				<div id="createaccount_termsandcondtotions_hr"></div>
				
				<div id="createaccount_termsandcondtotions">
					Izveidojot kontu, Jūs piekrītat					<a href="/terms" target="blank">lietošanas noteikumiem »</a>
				</div>
				-->
                <div id="createaccount_termsandcondtotions_ico">
                    Izveidojot kontu, Jūs piekrītat <a href="/terms" target="blank">lietošanas noteikumiem »</a>                </div>
                
                <input id="register_from_ico" type="hidden" name="from_ico" value="0" />
				<input type="hidden" name="login_return_url" class="login_return_url" value="" />
				<input type="hidden" name="dont_redirect_after_login" class="dont_redirect_after_login" value="" />

			</div>
			<!-- END : Simple create account -->

		</div>
		<!-- END : Create account form -->


		<!-- START : Sign in form -->
		<div id="signin-modal-content" class="modal-content">
            
            <table id="signin-modal-content-error" class="alert_container alert_container_info">
                <tr>
                    <td>
                        <i class="fa fa-exclamation-circle"></i>
                    </td>
                    <td>
                        <div class="alert_main_text"></div>
                    </td>
                </tr>
            </table>


            			<!-- START : Social sign in -->
			<div class="signin-modal-content-social">

				<div class="signin-modal-content-social-title">Lūdzu, pierakstieties ar:</div>

				<div class="signin-modal-content-social-buttons-container">

					<div class="standard_button fb_button social_login_button" onclick="checkSocialLogin('facebook');">
						<img src="/images/signup_form/login-facebook.svg?v=2" alt="Login with Facebook to upload files for free">
						<span>Facebook</span>
					</div>


					<div class="standard_button google_button social_login_button" onclick="checkSocialLogin('google');">
						<img src="/images/signup_form/login-google.svg?v=2" alt="Login with Google to upload files for free">
						<span>Google</span>
					</div>

					<div class="standard_button ms_button social_login_button" onclick="checkSocialLogin('microsoft');">
                        <img src="/images/signup_form/login-microsoft.svg" alt="Sign up with Microsoft to upload files for free">
						<span>Microsoft</span>
					</div>

					<div class="justify_el"></div>

				</div>

			</div>
			<!-- END : Social sign in -->
			
			<div class="or-delimiter">
				vai			</div>
			<!-- START : Simple sign in -->
			<div id="signin-modal-content-simple">

				<form onsubmit="checkSignInForm(); return false;" id="login_filesfm">

                    <div id="signin_input_container">

                        <div class="input-label l_coupon_code">
                            <label for="l_coupon_code">Kupona kods</label>
                            <input id="l_coupon_code" name="coupon_code" type="text" />
                        </div>
                    
                        <div class="no-coupon-link">
                            <a href="" onclick="revertFormFromCoupon(); return false">Man nav kupona koda »</a>
                        </div>

                        <div class="input-label">
                            <label for="l_user">Lietotājvārds vai e-pasts</label>
                            <input id="l_user" name="l_user" type="text"  />
                        </div>

                        <div class="input-label">
                            <label for="l_pass">Parole</label>
                            <input id="l_pass" name="l_pass" type="password">
                        </div>
    					<div class="justify_el"></div>
					</div>

                    
					<a id="signin-modal-forgot-link" href="" onclick="showForgotPassword(); return false">
						<span>Aizmirsi paroli?</span>
					</a>
					
					<div id="signin_coupon_info" onclick="showCreateAccount()">
                        Man nav reģistrēts Failiem.lv konts »                    </div>

					<div id="signin_error_msg" class="error_msg"></div>
                                            
					<input type="submit" style="display: none;">

					<div class="sign_in_submit_bn" onclick="checkSignInForm()">
    					Ieiet    					<img src="/images/signup_form/sign_up.svg" alt="Sign up">
    				</div>

				</form>

				<div id="signin-modal-link-container">
					<a id="signin-modal-coupon-link" href="javascript:void(0)" onclick="adaptFormForCoupon()">
						<span>Izmantot kupona kodu</span>
					</a>
				</div>
				
				<input type="hidden" name="login_return_url" class="login_return_url" value="" />
				<input type="hidden" name="dont_redirect_after_login" class="dont_redirect_after_login" value="" />

			</div>
			<!-- END : Simple sign in -->

		</div>
		<!-- END : Sign in form -->


		<!-- START : Forgot password form -->
		<div id="forgotpassword-modal-content" class="modal-content">

			<form onsubmit="return false;">

				<div id="forgotpassword_text">
					Ievadiet savu e-pasta adresi, lai atiestatītu paroli. Pārbaudiet arī spam mapi.				</div>
				
                <div class="input-label forgotpassword_email">
                    <label for="forgotpassword_email">E-pasts</label>
                    <input id="forgotpassword_email" type="text" >
                </div>

				<div id="forgotpassword_error_msg" class="error_msg"></div>
				
				<div class="sign_in_submit_bn" onclick="checkForgotPasswordForm();">
					Nosūtīt epastu					<img src="/images/signup_form/sign_up.svg" alt="Nosūtīt epastu">
				</div>
    				
			</form>

		</div>
		<!-- END : Forgot password form -->


		<!-- START : Add cookie uploads suggestion -->
		<div id="addcookieuploads-modal-content" class="modal-content">

				<div id="addcookieuploads_info">
					Vai piesaistīt savam kontam augšupielādes, kas ir veiktas iepriekš no šīs ierīces? Varēsi tās pārvaldīt vai dzēst.				</div>

				<div id="addcookieuploads_button_container">
    				<div class="addcookieuploads_button" id="addcookieuploads_button_no" onclick="setAddCookieUploads(false)">
    					Nē    				</div>
                    <div class="addcookieuploads_button" id="addcookieuploads_button_yes" onclick="setAddCookieUploads(true)">
    					Jā    				</div>
				</div>

		</div>
		<!-- END : Add cookie uploads suggestion -->


		<!-- START : Success message of account creation -->
		<div id="createaccountsuccessmessage-modal-content" class="modal-content">

				<div id="createaccountsuccessmessage_info">
					<div>
						Paldies! Jums ir izveidots Failiem.lv lietotāja konts un uz e-pastu nosūtīti konta pieejas dati.					</div>
					<div>
						Aizveriet šo formu, aizpildiet mapes informāciju un spiediet pogu "Saglabāt un nosūtīt adresi".					</div>
				</div>

				<div id="createaccountsuccessmessage_button" onclick="hideModal('sign-in', true)">
					Aizvērt				</div>

		</div>
		<!-- END : Success message of account creation -->

        <div id="twofactor_authcode-modal-content" class="modal-content" style="display:none">
            <div id="twofactor_authcode_container">
                <div id="twofactor_error_msg" class="error_msg"></div>

                <div class="twofactor_code_required_message">
                    Lai pieslēgtos, lūdzu, ievadiet savu divu faktoru autentifikācijas kodu, kurš tikko tika nosūtīts uz Jūsu kontam reģistrēto e-pasta adresi.                </div>

                <input id="twofactorcode" name="twofactorcode" type="text"
                       placeholder="Autentifikācijas kods"/>

                <div class="sign_in_submit_bn"
                     onclick="trySignIn( $('#twofactorcode').val() )">
                    Ieiet                    <img src="/images/signup_form/sign_up.svg" alt="Ieiet">
                </div>

                <div id="twofactor-modal-link-container">
                    <a id="twofactor-modal-goback-link" href=""
                       onclick="bolPrevFinished_checkSignInForm = true; showSignIn(); return false">
                        <span>Atpakaļ</span>
                    </a>
                </div>
            </div>
        </div>

		<!-- START : Social login -->
		<div style="display: none">
			<form id="login_facebook" method="get" action="/">
				<input type="hidden" name="fb_login" value="" />
				<input type="hidden" name="add_anonym_uplaods" class="add_anonym_uplaods" value="" />
				<input type="hidden" name="login_return_url" class="login_return_url" value="" />
				<input type="hidden" name="dont_redirect_after_login" class="dont_redirect_after_login" value="" />
                <input type="hidden" name="inviter_user" value=""/>
                <input type="hidden" name="inviter_hash" value=""/>
				<input type="submit" class="standard_button" value="Ienākt ar Facebook kontu" style="width: 100%" />
			</form>

			<form id="login_google" method="get" action="/">
				<input type="hidden" name="google_login" value="" />
				<input type="hidden" name="add_anonym_uplaods" class="add_anonym_uplaods" value="" />
				<input type="hidden" name="login_return_url" class="login_return_url" value="" />
				<input type="hidden" name="dont_redirect_after_login" class="dont_redirect_after_login" value="" />
                <input type="hidden" name="inviter_user" value=""/>
                <input type="hidden" name="inviter_hash" value=""/>
				<input type="submit" class="standard_button" value="Ienākt ar Google kontu" style="width: 100%" />
			</form>

			<form id="login_microsoft" method="get" action="/">
				<input type="hidden" name="microsoft_login" value="" />
				<input type="hidden" name="add_anonym_uplaods" class="add_anonym_uplaods" value="" />
				<input type="hidden" name="login_return_url" class="login_return_url" value="" />
				<input type="hidden" name="dont_redirect_after_login" class="dont_redirect_after_login" value="" />
                <input type="hidden" name="inviter_user" value=""/>
                <input type="hidden" name="inviter_hash" value=""/>
				<input type="submit" class="standard_button" value="Ienākt ar Microsoft kontu" style="width: 100%" />
			</form>
			<form id="login_draugiem" method="get" action="/">
				<input type="hidden" name="draugiem_login" value="" />
				<input type="hidden" name="add_anonym_uplaods" class="add_anonym_uplaods" value="" />
				<input type="hidden" name="login_return_url" class="login_return_url" value="" />
				<input type="hidden" name="dont_redirect_after_login" class="dont_redirect_after_login" value="" />
				<input type="submit" class="standard_button" value="Ienākt ar Draugiem kontu" style="width: 100%" />
			</form>
		</div>
		<!-- END : Social login -->

		<div id="sign-in_disable_form">
			<i class="fa fa-spinner fa-spin"></i>
		</div>

	</div>

	<div class="modal-close" id="sign-in_modal_close" data-dismiss="modal" data-close="Aizvērt" ></div>
</div>


<script>

	var bolRewriteUrlHash = true;
	
    var bolSigninCaptchaRequired = Boolean();
    var bolSignupCaptchaRequired = Boolean(1);
    
    var strSinginCaptchaContainerID = 'signin_captcha';
    var strSignupCaptchaContainerID = 'createaccount_captcha';
    
    
	function showCreateAccount( bolICO )
	{
        if( typeof bolICO === 'undefined' )
        {
            // if switching forms, get bolICO from other form
            bolICO = $( "#register_from_ico" ).val() > 0;
        }
        
        $( '#signin-header' ).removeClass( 'active' );
        $( '#createaccount-header' ).addClass( 'active' );

		$( '#signin-modal-content' ).hide();
		$( '#forgotpassword-modal-content' ).hide();
		$( '#addcookieuploads-modal-content' ).hide();
		$( '#createaccountsuccessmessage-modal-content' ).hide();

		$('#createaccount-modal-content').show();
		
		if( bolICO )
        {
            $( "#business_account_chechbox_container" ).hide();
            $( "#createaccount_info_ico" ).show();
            $( "#createaccount_termsandcondtotions_ico" ).show( );
            $( "#createaccount_termsandcondtotions" ).hide( );
            $( "#createaccount_info" ).hide();
            $( "#register_from_ico" ).val( 1 );
        }
        else
        {
            $( "#business_account_chechbox_container" ).show();
            $( "#createaccount_termsandcondtotions" ).show( );
            $( "#createaccount_termsandcondtotions_ico" ).hide( );
            $( "#createaccount_info_ico" ).hide();
            $( "#createaccount_info" ).show();
            $( "#register_from_ico" ).val( 0 );
        }

		showModal( 'sign-in' );
  
		if ( bolSignupCaptchaRequired )
            loadCreateAccountCaptcha();
		
		if ( bolRewriteUrlHash )
		{
			window.location.hash = 'sign_up';
		}
	}
	
	function setRegisterReferral( strInviter, hash, strInviteeEmail )
    {
        $( "#createaccount-referral-referrer" ).text( strInviter );
        $( "#createaccount-referral-container" ).show();
        
        if ( strInviteeEmail )
        {
            $( "#createaccount_email" )
                .val( strInviteeEmail )
                .attr( 'disabled', 'true' );
        }
    
        $("input[name='inviter_user']").val( strInviter );
        $("input[name='inviter_hash']").val( hash );
    }

	function showSignIn( bolICO )
	{
	    if( typeof bolICO === 'undefined' )
        {
            // if switching forms, get bolICO from other form
            bolICO = $( "#register_from_ico" ).val() > 0;
        }

        $( '#signin-header' ).addClass( 'active' );
        $( '#createaccount-header' ).removeClass( 'active' );
        
	    		
		$( '#createaccount-modal-content' ).hide();
		$( '#forgotpassword-modal-content' ).hide();
		$( '#addcookieuploads-modal-content' ).hide();
		$( '#createaccountsuccessmessage-modal-content' ).hide();
        $( '#twofactor_authcode-modal-content' ).hide();
        
        if ( bolICO )
        {
            $( "#register_from_ico" ).val( 1 );
        }
        else
        {
            $( "#register_from_ico" ).val( 0 );
        }

		$( '#signin-modal-content' ).show();

		showModal( 'sign-in' );
  
		if ( bolSigninCaptchaRequired )
            loadSignInCaptcha();
		
		if ( bolRewriteUrlHash )
		{
			window.location.hash = 'log_in';
		}
	}
    
    /*** Start: Captcha callbacks ***/
    
    function captchaCreateAccountLoaded( bolSuccess )
    {
        if ( ! bolSuccess )
        {
            addError(strSignupCaptchaContainerID, "createaccount_error_msg", "Notikusi kļūda! Lūdzu pārbaudiet savu interneta savienujumu un mēģiniet vēlāk. Ja problēma neatrisinās, lūdzu sazinieties ar support@failiem.lv");
        }
        else
        {
            removeError( strSignupCaptchaContainerID );
            removeAllErrors( "createaccount_error_msg" );
            $("#"+strSignupCaptchaContainerID).append('<input type="hidden" class="captcha_response" value="" />');
        }
    }
    
    function captchaCreateAccountSubmitted( strResponse )
    {
        removeError( strSignupCaptchaContainerID );
        removeAllErrors( "createaccount_error_msg" );
        $('#' + strSignupCaptchaContainerID + ' .captcha_response').val( strResponse );
    }
    
    
    function captchaSignInLoaded( bolSuccess )
    {
        if ( ! bolSuccess )
        {
            addError(strSinginCaptchaContainerID, "signin_error_msg", "Notikusi kļūda! Lūdzu pārbaudiet savu interneta savienujumu un mēģiniet vēlāk. Ja problēma neatrisinās, lūdzu sazinieties ar support@failiem.lv");
        }
        else
        {
            removeError( strSinginCaptchaContainerID );
            removeAllErrors( "signin_error_msg" );
            $("#"+strSinginCaptchaContainerID).append('<input type="hidden" class="captcha_response" value="" />');
        }
    }
    function captchaSignInSubmitted( strResponse )
    {
        removeError( strSinginCaptchaContainerID );
        removeAllErrors( "signin_error_msg" );
        $('#' + strSinginCaptchaContainerID + ' .captcha_response').val( strResponse );
    }
    /*** End: Captcha callbacks ***/
    
    
	function revertFormFromCoupon()
    {
	    $( '#sign-in' ).removeClass( 'coupun_form' );
    }
    
    function adaptFormForCoupon()
    {
	    $( '#sign-in' ).addClass( 'coupun_form' );
    }

	function showForgotPassword( strEmail )
	{
	    if ( typeof strEmail != 'undefined' )
	    {
			$( '#sign-in-header' ).hide();
			$( '#forgotpassword_email' ).val( strEmail );
	    }

		$( '#signin-header' ).insertBefore( $( '#createaccount-header' ) );
		
		$( '#createaccount-modal-content' ).hide();
		$( '#signin-modal-content' ).hide();
		$( '#addcookieuploads-modal-content' ).hide();
		$( '#createaccountsuccessmessage-modal-content' ).hide();

		$( '#forgotpassword-modal-content' ).show();

		showModal( 'sign-in' );

		if ( bolRewriteUrlHash )
		{
			window.location.hash = 'forgot_password';
		}
	}

	function showAddCookieUploads()
	{
		$( '#createaccount-modal-content' ).hide();
		$( '#forgotpassword-modal-content' ).hide();
		$( '#signin-modal-content' ).hide();
		$( '#createaccountsuccessmessage-modal-content' ).hide();

		$( '#addcookieuploads-modal-content' ).show();

		showModal( 'sign-in' );
	}

	function showCreateAccountSuccessMessage()
	{
		$( '#createaccount-modal-content' ).hide();
		$( '#forgotpassword-modal-content' ).hide();
		$( '#signin-modal-content' ).hide();
		$( '#addcookieuploads-modal-content' ).hide();
		
		$( '#createaccountsuccessmessage-modal-content' ).show();
		
		showModal( 'sign-in' );
	}


	var bolHasCookieUploads = false;
	var bolAddCookieUploadsAnswered = false;
	var bolAddCookieUploads = false;
	var strActiveForm = '';

	function setAddCookieUploads(val) {

		bolAddCookieUploads = val;
		bolAddCookieUploadsAnswered = true;

		if (val) {
			$('#login_facebook .add_anonym_uplaods').val('1');
			$('#login_google .add_anonym_uplaods').val('1');
			$('#login_draugiem .add_anonym_uplaods').val('1');
		}

		if (strActiveForm == 'signin') {
			checkSignInForm();
			showSignIn();
		}
		else if (strActiveForm == 'createaccount') {
			checkCreateAccountForm();
			showCreateAccount();
		}
		else if (strActiveForm == 'facebook' || strActiveForm == 'google' || strActiveForm == 'draugiem') {

			checkSocialLogin(strActiveForm);
		}
	}


	var bolPrevFinished_checkCreateAccountForm = true;
	function checkCreateAccountForm(bolCouponCheckResult) {
        
        var jqCaptchaResultInput = $('#' + strSignupCaptchaContainerID + ' .captcha_response');
	    
		if ( bolCouponCheckResult === undefined )
		{
			bolCouponCheckResult = null;
		}

		if (bolPrevFinished_checkCreateAccountForm)
		{
			bolPrevFinished_checkCreateAccountForm = false;
			$('#sign-in_disable_form').show();
   
			var bolCreateBusinessAccountDataOk = true;
			if (bolCreateBusinessAccount)
			{
				bolCreateBusinessAccountDataOk = false;

				if ($('#createaccount_company_name').val().trim().length < 4 ) {

					addError('createaccount_company_name', 'createaccount_error_msg', 'Lūdzu ievadiet derīgu uzņēmuma nosaukumu! Tam jābūt vismaz 4 simbolus garam!');
				}
				else {

					removeError('createaccount_company_name');

					if ($('#createaccount_company_phone').val().trim().length < 4 ) {

						addError('createaccount_company_phone', 'createaccount_error_msg', 'Lūdzu ievadiet derīgu uzņēmuma telefona numuru! Tam jābūt vismaz 4 ciparus garam!');
					}
					else {

						removeError('createaccount_company_phone');

						bolCreateBusinessAccountDataOk = true;
					}
				}
			}
            
            if ( $( "#register_coupon_code" ).css("display") !== "none" && !bolCouponCheckResult )
            {
                // coupon field is visible -> so it must be filled
                if( bolCouponCheckResult === false )
                {
                    addError( 'register_coupon_code_input', 'createaccount_error_msg', 'Ievadītais kupona kods nav derīgs, vai ir jau izmantots!' );
                    
                    bolPrevFinished_checkCreateAccountForm = true;
                    $('#sign-in_disable_form').hide();
                    return;
                }
                else if( !bolCouponCheckResult )
                {
                    removeError( 'register_coupon_code_input' );
                    
                    bolPrevFinished_checkCreateAccountForm = true;
                    verifyCouponCode( 'register_coupon_code_input', 'createaccount_error_msg', checkCreateAccountForm );
                    return;
                }                
            }
			
			if ( bolCreateBusinessAccountDataOk )
			{
				if ($('#createaccount_name').val().trim().length < 2 ) {

					addError('createaccount_name', 'createaccount_error_msg', 'Lūdzu ievadiet derīgu vārdu! Tam jābūt vismaz 2 simbolus garam.');

					bolPrevFinished_checkCreateAccountForm = true;
					$('#sign-in_disable_form').hide();
				}
				else {

					removeError('createaccount_name');

					if ($('#createaccount_surname').val().trim().length < 2 ) {

						addError('createaccount_surname', 'createaccount_error_msg', 'Lūdzu ievadiet derīgu uzvārdu! Tam jābūt vismaz 2 simbolus garam.');

						bolPrevFinished_checkCreateAccountForm = true;
						$('#sign-in_disable_form').hide();
					}
					else {
                        function isURL(url) {
                           return url.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g) !== null;
                        }
                        
                        if ( isURL( $( '#createaccount_surname' ).val().trim() ) )
                        {
                            addError('createaccount_surname', 'createaccount_error_msg', 'Nederīgs vārds!');
                            
                            bolPrevFinished_checkCreateAccountForm = true;
                            $('#sign-in_disable_form').hide();
                            return;
                        }
                        else 
                        {
                            removeError( 'createaccount_surname' );
                        }
                        
                        if ( isURL( $( '#createaccount_name' ).val().trim() ) )
                        {
                            addError('createaccount_name', 'createaccount_error_msg', 'Nederīgs vārds!');
                            
                            bolPrevFinished_checkCreateAccountForm = true;
                            $('#sign-in_disable_form').hide();
                            return;
                        }
                        else
                        {
                            removeError( 'createaccount_name' );
                        }
					    
						removeError('createaccount_surname');

						if (!validateEmail($('#createaccount_email').val())) {

							addError('createaccount_email', 'createaccount_error_msg', 'Ievadiet derīgu e-pastu!');

							bolPrevFinished_checkCreateAccountForm = true;
							$('#sign-in_disable_form').hide();
						}
						else {
				            new EmailValidator( $('#createaccount_email').val(), true)
                                .setOnValidCB(function(){
                                    $.ajax({
                                    type: "POST",
                                    dataType: "json",
                                    url: "./ajax/sign_in.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
                                    data: {
                                        'check_email' : true ,
                                        'email' : $('#createaccount_email').val()
                                    },
                                    success: function(data) {
                                        if (data['status'] != 'ok') {
                                            var strError = "\u0160\u012b e-pasta adrese jau ir re\u0123istr\u0113ta!";
                                            strError += "<br/><a href='' onclick='showForgotPassword(); return false'>" + 'Aizmirsi paroli' + "</a>";

                                            addHTMLError('createaccount_email', 'createaccount_error_msg', strError );

                                            bolPrevFinished_checkCreateAccountForm = true;
                                            $('#sign-in_disable_form').hide();
                                        }
                                        else {

                                            removeError('createaccount_email');

                                            if ($('#createaccount_username').val().trim().length < 4 ) {

                                                addError('createaccount_username', 'createaccount_error_msg', 'Lūdzu ievadiet derīgu lietotājvārdu! Tam jābut vismaz 4 simbolus garam.');

                                                bolPrevFinished_checkCreateAccountForm = true;
                                                $('#sign-in_disable_form').hide();
                                            }
                                            else {

                                                if (!validateUsername($('#createaccount_username').val().trim())) {

                                                    addError('createaccount_username', 'createaccount_error_msg', 'Var saturēt tikai "a-z", "A-Z", "0-9" un "_.@-"');

                                                    bolPrevFinished_checkCreateAccountForm = true;
                                                    $('#sign-in_disable_form').hide();
                                                }
                                                else
                                                {
                                                    $.ajax({
                                                        type: "POST",
                                                        dataType: "json",
                                                        url: "./ajax/sign_in.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
                                                        data: {
                                                            'check_username' : true ,
                                                            'username' : $('#createaccount_username').val()
                                                        },
                                                        success: function(data) {
                                                            if (data['status'] != 'ok') {

                                                                addError('createaccount_username', 'createaccount_error_msg', 'Šis lietotājvārds jau ir reģistrēts! Lūdzu ievadiet citu!');

                                                                bolPrevFinished_checkCreateAccountForm = true;
                                                                $('#sign-in_disable_form').hide();
                                                            }
                                                            else {

                                                                removeError('createaccount_username');

                                                                if ($('#createaccount_password').val().trim().length < 4 ) {

                                                                    addError('createaccount_password', 'createaccount_error_msg', 'Lūdzu ievadiet derīgu paroli! Tai jābūt vismaz 4 simbolus garai.');

                                                                    bolPrevFinished_checkCreateAccountForm = true;
                                                                    $('#sign-in_disable_form').hide();
                                                                }
                                                                else
                                                                {
                                                                    removeError('createaccount_password');
    
                                                                    var bolCaptchaOk = true;
                                                                    if ( bolSignupCaptchaRequired )
                                                                    {
                                                                        bolCaptchaOk = false;
                                                                        
                                                                        if ( jqCaptchaResultInput.length && jqCaptchaResultInput.val().length )
                                                                        {
                                                                            bolCaptchaOk = true;
                                                                            removeError( strSignupCaptchaContainerID );
                                                                        }
                                                                        else
                                                                        {
                                                                            if ( ! jqCaptchaResultInput.length )
                                                                            {
                                                                                addError( strSignupCaptchaContainerID, "createaccount_error_msg", "Notikusi kļūda! Lūdzu pārbaudiet savu interneta savienujumu un mēģiniet vēlāk. Ja problēma neatrisinās, lūdzu sazinieties ar support@failiem.lv" );
                                                                            }
                                                                            else
                                                                            {
                                                                                addError( strSignupCaptchaContainerID, 'createaccount_error_msg', 'Lūdzu aizpildi Captcha!' );
                                                                            }
                                                                        }
                                                                    }
                                                                    
                                                                    if ( ! bolCaptchaOk )
                                                                    {
                                                                        bolPrevFinished_checkCreateAccountForm = true;
                                                                        $( '#sign-in_disable_form' ).hide();
                                                                    }
                                                                    else
                                                                    {
                                                                        removeError( 'createaccount_password' );
                                                                        removeError( strSignupCaptchaContainerID );
        
                                                                        removeAllErrors( 'createaccount_error_msg' );
        
        
                                                                        if ( bolHasCookieUploads == true && bolAddCookieUploadsAnswered == false )
                                                                        {
            
                                                                            strActiveForm = 'createaccount';
                                                                            showAddCookieUploads();
            
                                                                            bolPrevFinished_checkCreateAccountForm = true;
                                                                            $( '#sign-in_disable_form' ).hide();
                                                                        }
                                                                        else
                                                                        {
                                                                            var postData = {
                                                                                'create_account': true,
                                                                                'username': $( '#createaccount_username' ).val(),
                                                                                'email': $( '#createaccount_email' ).val(),
                                                                                'password': $( '#createaccount_password' ).val(),
                                                                                'add_cookie_uploads': bolAddCookieUploads,
                                                                                'first_name': $( '#createaccount_name' ).val(),
                                                                                'surname': $( '#createaccount_surname' ).val(),
                                                                                'create_business_account': bolCreateBusinessAccount,
                                                                                'company_name': $( '#createaccount_company_name' ).val(),
                                                                                'company_phone': $( '#createaccount_company_phone' ).val(),
                                                                                'company_country': $( '#createaccount_company_country' ).val(),
                                                                                'from_ico': $( "#register_from_ico" ).val() ,
                                                                                'recaptcha_response': (jqCaptchaResultInput.length ? jqCaptchaResultInput.val() : '')
                                                                            };

                                                                            // add referral fields if the container is visible
                                                                            if ( $( "#createaccount-referral-container" ).css( "display" ) !== "none" )
                                                                            {
                                                                                postData[ 'inviter_hash' ] = $( "#createaccount-referral-hash" ).val();
                                                                                postData[ 'inviter_user' ] = $( "#createaccount-referral-user" ).val();
                                                                            }
                                                                            
                                                                            if ( $( "#register_coupon_code" ).css( "display" ) !== "none" )
                                                                            {
                                                                                postData.coupon_code = $( "#register_coupon_code_input" ).val().trim();
                                                                            }

                                                                                                                                                        
                                                                            var bolDontRedirectAfterLogin = true;
                                                                            
                                                                            if ( $( '.dont_redirect_after_login' ).val() == '' )
                                                                            {
                                                                            	bolDontRedirectAfterLogin = false;
                                                                            }
                                                                            
                                                                            var strCustomLoginReturnUrl = $( '.login_return_url' ).val();
                                                                            
                                                                            
                                                                            if ( ! bolDontRedirectAfterLogin && strCustomLoginReturnUrl == '' )
                                                                            {
                                                                            	postData.show_onboarding_survey = true;
                                                                            }
                                                                            else 
                                                                            {
                                                                            	postData.show_onboarding_survey = false;
                                                                            }
                                                                            
            
                                                                            $.ajax( {
                                                                                type: "POST",
                                                                                dataType: "json",
                                                                                url: "./ajax/sign_in.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
                                                                                data: postData,
                                                                                success: function ( data )
                                                                                {
                                                                                    if ( data[ 'status' ] == 'ok' )
                                                                                    {
                        																                        																
                                                                                        if ( ! bolDontRedirectAfterLogin )
                                                                                        {
                            
                                                                                            if ( strCustomLoginReturnUrl != '' )
                                                                                            {
                                
                                                                                                if (
                                                                                                    ( "/" + strCustomLoginReturnUrl ).search( window.location.pathname ) != -1 &&
                                                                                                    strCustomLoginReturnUrl != 'sync-share?create_cloud_files_user' &&
                                                                                                    strCustomLoginReturnUrl != 'library-info?after_login' &&
                                                                                                    strCustomLoginReturnUrl != 'video?after-signup' &&
                                                                                                    ( "/" + strCustomLoginReturnUrl ).search( 'lifetime-storage' ) == -1 &&
                                                                                                    ( "/" + strCustomLoginReturnUrl ).search( 'save-youtube-video' ) == -1
                                                                                                )
                                                                                                {
                                                                                                    if ( location.hash == '#sign_up' )
                                                                                                    {
                                                                                                        location.hash = '';
                                                                                                    }
                                    
                                                                                                    if ( strCustomLoginReturnUrl == 'storage-plans#subscribe' )
                                                                                                    {
                                                                                                        location.hash = 'subscribe';
                                                                                                    }
                                    
                                                                                                    location.reload();
                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                    window.location = "https://fv2-4.failiem.lv/" + strCustomLoginReturnUrl;
                                                                                                }
                                
                                                                                            }
                                                                                            else
                                                                                            {
                                
                                                                                                window.location = "/account";
                                                                                            }
                                                                                        }
                                                                                        else
                                                                                        {
                            
                                                                                            showCreateAccountSuccessMessage();
                            
                                                                                            bolPrevFinished_checkCreateAccountForm = true;
                                                                                            $( '#sign-in_disable_form' ).hide();
                                                                                        }
                                                                                    }
                                                                                    else
                                                                                    {
                        
                                                                                        addError( 'createaccount_error_msg', 'createaccount_error_msg', 'Notika kļūda, sazinieties ar Failiem.lv komandu!' );
                        
                                                                                        bolPrevFinished_checkCreateAccountForm = true;
                                                                                        $( '#sign-in_disable_form' ).hide();
                                                                                    }
                                                                                },
                                                                                error: function ( data )
                                                                                {
                    
                                                                                    addError( 'createaccount_error_msg', 'createaccount_error_msg', 'Notika kļūda. Lūdzu, mēģiniet vēlreiz vai sazinieties ar support@failiem.lv!' );
                    
                                                                                    bolPrevFinished_checkCreateAccountForm = true;
                                                                                    $( '#sign-in_disable_form' ).hide();
                                                                                }
                                                                            } );
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        } ,
                                                        error: function(data) {

                                                            addError('createaccount_error_msg', 'createaccount_error_msg', 'Notika kļūda. Lūdzu, mēģiniet vēlreiz vai sazinieties ar support@failiem.lv!');

                                                            bolPrevFinished_checkCreateAccountForm = true;
                                                            $('#sign-in_disable_form').hide();
                                                        }
                                                    });
                                                }
                                            }
                                        }
                                    } ,
                                    error: function(data) {

                                        addError('createaccount_error_msg', 'createaccount_error_msg', 'Notika kļūda. Lūdzu, mēģiniet vēlreiz vai sazinieties ar support@failiem.lv!');

                                        bolPrevFinished_checkCreateAccountForm = true;
                                        $('#sign-in_disable_form').hide();
                                    }
                                })
                                }).setOnInvalidCB(function() {
                                    bolPrevFinished_checkCreateAccountForm = true;
                                    $('#sign-in_disable_form').hide();
                                    addError('createaccount_email', 'createaccount_error_msg', 'Ievadiet derīgu e-pastu!');
                                }).setModalID("sign-in").run();
						}
					}
				}
			}
			else
			{
				bolPrevFinished_checkCreateAccountForm = true;
				$('#sign-in_disable_form').hide();
			}
		}
	}

	function getSigninReturnRedirectUrl()
    {
        if ($('.login_return_url').val() != '') {

            if ($('.dont_redirect_after_login').val() == '') {
                if (
                    ("/"+$('.login_return_url').val()).search(window.location.pathname) != -1 &&
                    $('.login_return_url').val() != 'sync-share?create_cloud_files_user' && 
                    $('.login_return_url').val() == 'storage-plans#subscribe' 
                )
                {
                    return '#subscribe';
                }
                else {
                    return $('.login_return_url').val();
                }
            }
        }

        
	    return false;
    }
     
    function verifyCouponCode( strCouponInputID, strErrorID, fnCallback, bolResult )
    {
    	if ( bolResult === undefined )
		{
    		bolResult = null;
		}

        var strCouponInputSelector = "#" + strCouponInputID;
        
        var onError = function ()
        {
            addError( strCouponInputID, strErrorID, 'Nederīgs kupona kods!' );
            
            bolPrevFinished_checkCreateAccountForm = true;
            $( '#sign-in_disable_form' ).hide();
        };
        
        if ( bolResult === false )
        {
            onError();
            return false
        }
        else if ( bolResult === true )
        {
            return true;
        }
        
        if ( $( strCouponInputSelector ).css( "display" ) !== "none" )
        {
            // coupon field is visible -> so it must be filled
            if ( $( strCouponInputSelector ).val().trim().length !== 8 )
            {
                onError();
                return false
            }
            else
            {
                if ( !bolResult )
                {
                    removeError( strCouponInputID );
                    
                    $.ajax( {
                        type: "POST",
                        dataType: "json",
                        url: "./ajax/sign_in.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
                        global: false,
                        data: {
                            'check_coupon': true,
                            'coupon_code': $( strCouponInputSelector ).val().trim()
                        },
                        success: function ( data )
                        {
                            fnCallback( typeof data[ 'status' ] !== "undefined" && data[ 'status' ] === 'ok' );
                        },
                        error: function ( )
                        {
                            fnCallback( false );
                        }
                    } );
                    return false;
                }
                else
                {
                    return true;
                }
            }
        }
        else
        {
            return true;
        }
    }

	var bolPrevFinished_checkSignInForm = true;

    function trySignIn( strTwoFactorAuthCode )
    {
        if ( typeof strTwoFactorAuthCode === "undefined" )
        {
            strTwoFactorAuthCode = "";
        }

        var jqCaptchaResultInput = $( '#' + strSinginCaptchaContainerID + ' .captcha_response' );

        removeAllErrors( 'signin_error_msg' );
       
        var strReturnUrl = getSigninReturnRedirectUrl();

        var objPostData = {
            'signin': true,
            'username': $( '#l_user' ).val(),
            'password': $( '#l_pass' ).val(),
            'remember_me': $( '#remember_me' ).prop( 'checked' ),
            'from_ico': $( '#register_from_ico' ).val(),
            'add_cookie_uploads': bolAddCookieUploads,
            'recaptcha_response': ( jqCaptchaResultInput.length ? jqCaptchaResultInput.val() : '' )
        };

        if ( strTwoFactorAuthCode )
        {
            objPostData[ 'two_factor_auth_code' ] = strTwoFactorAuthCode;
        }

        if ( strReturnUrl )
        {
            objPostData[ 'override_return_url' ] = strReturnUrl;
        }

        if ( $( "#l_coupon_code" ).css( "display" ) !== "none" )
        {
            objPostData.coupon_code = $( "#l_coupon_code" ).val().trim();
        }

        
        $.ajax( {
            type: "POST",
            dataType: "json",
            url: "./ajax/sign_in.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
            crossDomain: true,
            data: objPostData,
            success: function ( data )
            {
                var strAdditionalMessage = "";
                
                if ( typeof data[ 'login_attempts_left' ] !== 'undefined' )
                {
                    var strPartOne = +data[ 'login_attempts_left' ] === 1 ? ' Jums atlicis ' : ' Jums atlikuši ';
                    var strPartTwo = +data[ 'login_attempts_left' ] === 1 ? ' pieslēgšanās mēģinājums līdz jūsu konts tiks bloķēts.' : ' pieslēgšanās mēģinājumi līdz jūsu konts tiks bloķēts.';

                    strAdditionalMessage = strPartOne + data[ 'login_attempts_left' ] + strPartTwo;
                }
                
                if ( ( data[ 'status' ] === 'ok' || data[ 'status' ] === 'missing_account_data' ) && typeof data[ 'redirect_to' ] !== 'undefined' )
                {
                    
                    if ( data[ 'redirect_to' ].substring( 0, 17 ) == '/lifetime-storage' )
                    {
                        data[ 'redirect_to' ] += '?after_login';
                    }

                    if ( data[ 'redirect_to' ].substring( 0, 6 ) == '/token' )
                    {
                        data[ 'redirect_to' ] = '/token';
                    }

                    window.location = data[ 'redirect_to' ];
                }
                else if ( data[ 'status' ] === 'invalid_auth_code' )
                {
                    $( '#twofactor_error_msg' ).text( 'Ievadītais kods nav derīgs! Lūdzu mēģiniet vēlreiz!' + strAdditionalMessage ).show();
                    bolPrevFinished_checkSignInForm = true;
                    $( '#sign-in_disable_form' ).hide();
                }
                else
                {
                    var $errorCont;
                    if( strTwoFactorAuthCode )
                    {
                        $errorCont = $( '#twofactor_error_msg' );
                    }
                    else
                    {
                        $errorCont = $( '#signin_error_msg' );
                    }
                    
                    if ( typeof data[ "message" ] === "undefined" )
                    {
                       $errorCont.text( 'Nepareizs lietotājvārds vai parole! Pieeju var restaurēt uz jūsu epasta adresi.' + strAdditionalMessage );
                       console.log( 'SIGNIN ERROR CODE : 1' );
                    }
                    else
                    {
                        $errorCont.text( data[ "message" ] + strAdditionalMessage );
                    }
                    $errorCont.show();

                    bolPrevFinished_checkSignInForm = true;
                    $( '#sign-in_disable_form' ).hide();
                }
            },
            error: function ( data )
            {

                $( '#signin_error_msg' ).text( 'Notika kļūda. Lūdzu, mēģiniet vēlreiz vai sazinieties ar support@failiem.lv!' );
                $( '#signin_error_msg' ).show();

                bolPrevFinished_checkSignInForm = true;
                $( '#sign-in_disable_form' ).hide();
            }
        } );
    }

    function show2FAPrompt()
    {
        $( '#createaccount-modal-content' ).hide();
        $( '#forgotpassword-modal-content' ).hide();
        $( '#addcookieuploads-modal-content' ).hide();
        $( '#createaccountsuccessmessage-modal-content' ).hide();
        $( '#signin-modal-content' ).hide();

        $( '#twofactor_authcode-modal-content' ).show();
    }
    
	function checkSignInForm(bolCouponCheckResult) {

		if ( bolCouponCheckResult === undefined )
		{
			bolCouponCheckResult = null;
		}
        
        var jqCaptchaResultInput = $('#' + strSinginCaptchaContainerID + ' .captcha_response');
        
		if (bolPrevFinished_checkSignInForm) {

			bolPrevFinished_checkSignInForm = false;
            $('#sign-in_disable_form').show();
            
            if ( $( "#l_coupon_code" ).css("display") !== "none" )
            {
                if ( bolCouponCheckResult )
                {
                    $( "#signin_error_msg" ).hide();
                }
                else if ( bolCouponCheckResult === null )
                {
                    bolPrevFinished_checkSignInForm = true;
                    return verifyCouponCode( "l_coupon_code", "signin_error_msg", checkSignInForm, bolCouponCheckResult );
                }
                else
                {
                    $( "#signin_error_msg" )
                        .text( "Ievadītais kupona kods nav derīgs, vai ir jau izmantots!" )
                        .show();
                    bolPrevFinished_checkSignInForm = true;
                    $( '#sign-in_disable_form' ).hide();
                    return false;
                }
            }
                
			bolError = false;

			if ($('#l_user').val() == '' ) {

				$('#l_user').addClass( 'has_error' );
				bolError = true;
			}
			else {
				$('#l_user').removeClass( 'has_error' );
			}

			if ($('#l_pass').val() == '' ) {
				$('#l_pass').addClass( 'has_error' );
				bolError = true;
			}
			else {
				$('#l_pass').removeClass( 'has_error' );
			}
            
            
            if ( bolSigninCaptchaRequired )
            {
                if ( jqCaptchaResultInput.length === 0 )
                {
                    bolError = true;
    
                    addError(strSinginCaptchaContainerID, "signin_error_msg", "Notikusi kļūda! Lūdzu pārbaudiet savu interneta savienujumu un mēģiniet vēlāk. Ja problēma neatrisinās, lūdzu sazinieties ar support@failiem.lv");
                }
                else if ( jqCaptchaResultInput.val().length === 0 )
                {
                    bolError = true;
    
                    addError(strSinginCaptchaContainerID, "signin_error_msg", "Lūdzu aizpildiet Captcha lauku!");
                }
                else
                {
                    removeError( strSinginCaptchaContainerID );
                }
            }

			if (!bolError) {

				$.ajax({
					type: "POST",
					dataType: "json",
					url: "./ajax/sign_in.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
                    crossDomain: true,
                    data: {
						'check_signin' : true ,
						'username' : $('#l_user').val() ,
						'password' : $('#l_pass').val()
					},
					success: function(data) {
                        if ( data[ 'status' ] === 'ok' )
                        {
                            if ( bolHasCookieUploads == true && bolAddCookieUploadsAnswered == false && data[ 'show_add_cookie_uploads' ] == true )
                            {
                                strActiveForm = 'signin';
                                showAddCookieUploads();

                                bolPrevFinished_checkSignInForm = true;
                                $( '#sign-in_disable_form' ).hide();
                            }
                            else
                            {
                                trySignIn();
                            }
                        }
                        else if ( data[ 'status' ] === 'requires_auth_code' )
                        {
                            $( '#sign-in_disable_form' ).hide();
                            bolPrevFinished_checkSignInForm = true;
                            
                            show2FAPrompt();
                        }
                        else
                        {
                            var strMessage = 'Nepareizs lietotājvārds vai parole! Pieeju var restaurēt uz jūsu epasta adresi.';

                            if ( typeof data[ 'message' ] !== "undefined" )
                            {
                                strMessage = data[ 'message' ];
                            } 
                            else if ( typeof data[ 'login_attempts_left' ] !== 'undefined' ) 
                            {
                                var strPartOne = +data['login_attempts_left'] === 1 ? ' Jums atlicis ' : ' Jums atlikuši ';
                                var strPartTwo = +data['login_attempts_left'] === 1 ? ' pieslēgšanās mēģinājums līdz jūsu konts tiks bloķēts.' : ' pieslēgšanās mēģinājumi līdz jūsu konts tiks bloķēts.';
                                
                                strMessage += strPartOne + data[ 'login_attempts_left' ]  + strPartTwo;
                            }
                            else
                            {
                                console.log( 'SIGNIN ERROR CODE : 2' );
                            }

                            $( '#signin_error_msg' ).text( strMessage );
							$('#signin_error_msg').show();

							bolPrevFinished_checkSignInForm = true;
							$('#sign-in_disable_form').hide();
						}
					} ,
					error: function(data) {

						$('#signin_error_msg').text('Notika kļūda. Lūdzu, mēģiniet vēlreiz vai sazinieties ar support@failiem.lv!');
						$('#signin_error_msg').show();

						bolPrevFinished_checkSignInForm = true;
						$('#sign-in_disable_form').hide();
					}
				});
			}
			else {

				bolPrevFinished_checkSignInForm = true;
				$('#sign-in_disable_form').hide();
			}
		}
	}


	function checkForgotPasswordForm() {

		if (!validateEmail($('#forgotpassword_email').val())) {

			addError('forgotpassword_email', 'forgotpassword_error_msg', 'Ievadiet derīgu e-pastu!');
		}
		else {

			removeError('forgotpassword_email');

			$.ajax({
				type: "POST",
				dataType: "json",
				url: "./ajax/sign_in.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
				data: {
					'recover_password' : true ,
					'email' : $('#forgotpassword_email').val()
				},
				success: function(data) {
					if (data['status'] == 'ok') {

						removeAllErrors('forgotpassword_error_msg');

						$('#forgotpassword_error_msg').addClass('ok_msg_active');
						$('#forgotpassword_error_msg').text('Paroles atjaunošanas saite ir nosūtīta uz Jūsu e-pastu.');
						$('#forgotpassword_error_msg').show();
					}
					else {

						addError('forgotpassword_email', 'forgotpassword_error_msg', 'Šāds e-pasts nav reģistrēts.');
					}
				}
			});
		}
	}

	function checkSocialLogin(strType) {
	
		if ( strType == 'facebook' )
		{
			fError( 'Facebook ir kautko mainījis, tāpēc diemžēl šobrīd pieteikšanās ar Facebook nav pieejama. Lai tiktu iekšā, atjauno paroli uz savu epastu (ar kuru esi lietojis Facebook) <a href="/?a#forgot_password">spiežot šeit</a>. Turpmāk iesakam izmantot savu e-pastu vai Google kontu, lai nebūtu atkarīgi no Facebook. Mēs plānojam atslēgt šo metodi.' );
			return;
		}

		if (bolHasCookieUploads == true && bolAddCookieUploadsAnswered == false) {

			strActiveForm = strType;
			showAddCookieUploads();
		}
		else {

			if ($('.dont_redirect_after_login').val() == 'true')
			{
				$('#sendfiles').submit();
				$('.add_anonym_uplaods').val('true');
			}

			if (strType == 'facebook') {

				$('#login_facebook').submit();
			}
			else if (strType == 'google') {

				$('#login_google').submit();
			}
			else if (strType == 'draugiem') {

				$('#login_draugiem').submit();
			}
			else if (strType == 'microsoft') {

				$('#login_microsoft').submit();
			}

		}
	}


	function validateEmail(email) {
		var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
		var result = re.test(email);
		return result;
	}

	function validateUsername(username) {

		var re = /^[a-zA-Z0-9_\.@\-]+$/;
		var result = re.test(username);
		return result;
	}
    
    function addHTMLError(strDomId, strErrorMsgId, strErrorMsgText) {
        $('#' + strDomId).addClass( 'has_error' );
        $('#' + strErrorMsgId).html(strErrorMsgText);
        $('#' + strErrorMsgId).show();
    }

	function addError(strDomId, strErrorMsgId, strErrorMsgText) {
		$('#' + strDomId).addClass( 'has_error' );
		$('#' + strErrorMsgId).text(strErrorMsgText);
		$('#' + strErrorMsgId).show();
	}

	function removeError(strInputId) {
		$('#' + strInputId).removeClass( 'has_error' );
	}

	function removeAllErrors(strErrorMsgId) {
		$('#' + strErrorMsgId).text('');
		$('#' + strErrorMsgId).hide();
	}

	var isUsernameChanged = false;
	function usernameChanged()
	{
		isUsernameChanged = true;
	}

	function createUsername(strEmail)
	{
		if( !isUsernameChanged && strEmail != '' && validateEmail(strEmail))
		{
			var arrEmail = strEmail.split("@");

			var strUsername = arrEmail[0];
			while (strUsername.length < 4)
			{
				strUsername += '1';
			}


			$.ajax(
			{
				type: "POST",
				dataType: "json",
				url: "./ajax/sign_in.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
				data:
				{
					'get_username' : true ,
					'username' : strUsername
				},
				success: function(data)
				{
					if (data['status'] == 'ok' && data['username'])
					{
						$('#createaccount_username').val(data['username']);
					}
				}
			});
		}
	}

	var bolCreateBusinessAccount = false;
	function toggleCreateBusinessAccount()
	{
		if (bolCreateBusinessAccount)
		{
			bolCreateBusinessAccount = false;
			$('#create_business_account_container').hide();
		}
		else
		{
			bolCreateBusinessAccount = true;
			$('#create_business_account_container').show();
		}
	}


    
    </script>
<script>
    $('#mega-menu .other-apps LI').on('click', function () {
        if ( $('A:first-child', this).attr('href') != null && $('A:first-child', this).attr('href').indexOf('javascript:') == -1 )
        {
            window.location = $('A:first-child', this).attr('href');
        }
    });
    
    $('#mega-menu-close').on('click', function () {
        $( '#navbar-toggler-chb' ).prop('checked', false);
    });

    $('.header_menu_wrap').on('mouseleave', function (e)
    {
        var $elem = $(this);
        if ($elem.parents('#mega-menu').length) 
        {
            $elem.find('.header_menu_label').removeClass('open');
        }
        else
        {
            if ($elem.is("#usergreeting") ){
                setTimeout(function() {
                    if(! $('#usergreeting:hover').length > 0)
                    {
                        $elem.find('.header_menu_label').removeClass('open');
                    }
                }, 500);
            }
            else
            {
                if(!$elem[ 0 ].matches(":hover"))
                {
                    $elem.find('.header_menu_label').removeClass('open');
                }
            }
        }
    });

    $('.header_menu_label').on('click', function () {
       
        var that = this;

        $(".header_menu_label").filter(function() {
            // check object in list is not current object
            return this != that;
        }).removeClass('open');

        $(this).toggleClass('open');
       
        var $elem = $(this);
        
        $elem.parent().find('.header_menu_drawer').css({
            'left': '', 
            'right': ''
        });
        
        var bounding = $elem.parent().find('.header_menu_drawer')[0].getBoundingClientRect();
        var boundingParent = $elem[0].getBoundingClientRect();
        if (bounding.left < 0)
        {
            $elem.parent().find('.header_menu_drawer').css({
                'left': -boundingParent.left+5 + 'px', 
                'right': 'unset'
            });
        }
        if (bounding.right > (window.innerWidth || document.documentElement.clientWidth))
        {
            $elem.parent().find('.header_menu_drawer').css({
                'left': 'unset', 
                'right': -(window.innerWidth-boundingParent.right)+20 + 'px'
            });
        }
    });
</script>


    <script type="text/javascript" src="js/prebid-ads.js"></script>
    <script type="text/javascript">
        if( window.canRunAds === undefined )
        {
            fError( "J\u016bsu p\u0101rl\u016bkprogramm\u0101 ir uzst\u0101d\u012bts rekl\u0101mu blo\u0137\u0113\u0161anas spraudnis. Past\u0101v iesp\u0113ja, ka lapa tiek nekorekti uzr\u0101d\u012bta. L\u016bdzu, atsl\u0113dziet spraudni un atjaunojiet lapu!" );
            document.cookie="adblock_warning_shown; max-age=86400";
        }
    </script>



	<div id="content">

<script type="text/javascript">

	var objWebTorrentDownloadForm;
	
	$( function()
	{
		objWebTorrentDownloadForm = new WebTorrentDownloadForm( 'a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8' );
	} );

</script>
<link rel="stylesheet" type="text/css" media="all" href="/css/webtorrent_download_form.css?v=1569158051" />
                <script src="/webtorrent/FilesFm_P2P/filesfm_p2p.min.js?v=1612871226"></script>
                <script src="/js/webtorrent_download_form.js?v=1663680226"></script>
                <script src="/js/p2p-graph/p2p-graph.js?v=1542827819"></script>
<section id="webtorrent_download_form" class="modal-container" tabindex="-1" role="dialog" aria-labelledby="modal-label" aria-hidden="true">
	
	<div class="modal-inner">
	
		<div class="modal-content">
			
			<!-- S: Header -->
			
			<div id="webtorrent_download_form__header_main">
                Peer-to-Peer-Powered Lejupielāde            </div>
            <div id="webtorrent_download_form__close_btn" onclick="$('#webtorrent_download_form_modal_close').click()">
                <i class="fal fa-times-circle"></i>
            </div>
			
			<!-- E: Header -->

            <div id="webtorrent_download_form__top_content">

                <div id="webtorrent_download_form__main_content__wt_download">

                    <div class="webtorrent_download_form__main_content__wt_download__status" id="webtorrent_download_form__main_content__wt_download__status__in_progress">
                		<span id="webtorrent_download_form__main_content__wt_download__status__in_progress__label">
                			Turi šo pārlūka logu aktīvu un redzamu. Tiks pabeigts            			</span>
                        <span id="webtorrent_download_form__main_content__wt_download__status__in_progress__value"></span>
                    </div>

                    <div id="webtorrent_download_form__main_content__wt_download__progress" class="progress-bar">
                        <div id="webtorrent_download_form__main_content__wt_download__progress__bar_outer" class="progress-bar-outer"><!--
            			 --><div id="webtorrent_download_form__main_content__wt_download__progress__bar_inner" class="progress-bar-inner"><!--
            			 --></div><!--
        			 --></div>
                        <div id="webtorrent_download_form__main_content__wt_download__progress__bar_text" class="progress-bar-text"></div>
                    </div>

<!--                    <div class="webtorrent_download_form__main_content__wt_download__status" id="webtorrent_download_form__main_content__wt_download__status__finished">-->
<!--                        <i class="fa fa-check-circle"></i>-->
<!--                        --><!--                    </div>-->

                    <div class="webtorrent_download_form__main_content__wt_download__status" id="webtorrent_download_form__main_content__wt_download__status__download_error">
                        <i class="fa fa-exclamation-circle"></i>
                        Notika kļūda! Mēģiniet vēlreiz REFRESH vai citu lejupielādes veidu!                    </div>

                </div>

                <div class="webtorrent_download_form__sharing_stats_cont">
                    <div class="webtorrent_download_form__sharing_info__stats" title="Lejupielāde">
                        <i class="fal fa-arrow-down"></i>
                        <span class="webtorrent_download_form__sharing_size" id="webtorrent_download_form__sharing_size__download"></span><br/>
                        <span class="webtorrent_download_form__sharing_speed" id="webtorrent_download_form__sharing_speed__download"></span>
                    </div>
                    <div class="webtorrent_download_form__download_all_button"></div>
                    <div class="webtorrent_download_form__sharing_info__stats" title="Augšupielāde">
                        <i class="fal fa-arrow-up"></i>
                        <span class="webtorrent_download_form__sharing_size" id="webtorrent_download_form__sharing_size__upload"></span><br/>
                        <span class="webtorrent_download_form__sharing_speed" id="webtorrent_download_form__sharing_speed__upload"></span>
                    </div>
                </div>
            </div>

            <div id="webtorrent_download_form__desktop_clients_line">
                <a id="webtorrent_download_form__torrent_file_url" title="Lejupielādēt" href="javascript:void()" target="_blank">.torrent</a>
                <span class="webtorrent_download_form__desktop_clients_text">
                     Vari lietot <a href="https://www.vuze.com" target="_blank">Vuze</a> vai citus <a href="https://webtorrent.io/desktop/" target="_blank">WebTorrent</a> desktop klientus, lai ērti saglabātu folderus                </span>
            </div>

            <div id="webtorrent_download_form__top_alerts_container">

                <table id="webtorrent_download_form__alert_container__wait" class="alert_container alert_container_info">
                    <tr>
                        <td>
                            <i class="fa fa-spinner fa-spin"></i>
                        </td>
                        <td>
                            <div class="alert_main_text"></div>
                        </td>
                    </tr>
                </table>

                <table id="webtorrent_download_form__alert_container__error" class="alert_container alert_container_danger">
                    <tr>
                        <td>
                            <i class="fa fa-exclamation-circle"></i>
                        </td>
                        <td>
                            <div class="alert_main_text"></div>
                        </td>
                    </tr>
                </table>

                <table id="webtorrent_download_form__alert_container__ok" class="alert_container alert_container_success">
                    <tr>
                        <td>
                            <i class="fa fa-check-circle"></i>
                        </td>
                        <td>
                            <div class="alert_main_text"></div>
                        </td>
                    </tr>
                </table>
            </div>
            
            <div id="webtorrent_download_form__main_content">
                <div id="webtorrent_download_form__world_image"></div>
                <div id="webtorrent_download_form__p2p_graph"></div>				
			</div>

            <div id="webtorrent_download_form__bottom_content">
                <div>
                    Kad lejupielāde būs beigusies, katram failam uzleks "Save as" logs. Šim logam jābūt atvērtam priekšplānā. Ja Jūsu pārlūks neļauj saglabāt uzreiz vairākus failus, to variet mainīt: Settings > Advanced > Ask where to save each file before downloading. Nestrādā? <a href="/contacts" target="_blank">Padod ziņu</a>                </div>
                <div id="webtorrent_download_form__file_links" style="width: 100%; height: 1px; overflow: hidden;">
                
                </div>
            </div>
			
		</div>
	
	</div>
	
	<div id="webtorrent_download_form_modal_close" class="modal-close" data-dismiss="modal" data-close="Aizvērt">X</div>
	
</section><link rel="stylesheet" type="text/css" media="all" href="/css/elements/upload_access_switch.css?v=112" />

<script type="text/javascript">

	var bolUploadAccessSwitch_closeAllSelect_Binded = false;
	var bolSessionUser_IsStorageSubscriber = false;
	var bolSessionUser_HasLifetimeStorage = false;

	function UploadAccessSwitch( objParentElement, objUploadAccessSwitchSettings )
	{
		this.objParentElement = objParentElement;
		this.bolAccessTypeChanged = false;


		this.strItemType = 'upload';

		if ( typeof objUploadAccessSwitchSettings.item_type != 'undefined' && objUploadAccessSwitchSettings.item_type == 'file' )
		{
			this.strItemType = objUploadAccessSwitchSettings.item_type;
		}
		
		
		this.strUploadHash = objUploadAccessSwitchSettings.upload_hash;
		this.strFileHash = objUploadAccessSwitchSettings.file_hash;
		this.strParentAccessType = objUploadAccessSwitchSettings.parent_access_type;

		
		this.bolOwnerLoggedIn;

		if ( typeof objUploadAccessSwitchSettings.owner_logged_in == 'undefined' )
		{
			this.bolOwnerLoggedIn = 1;
		}
		else
		{
			this.bolOwnerLoggedIn = objUploadAccessSwitchSettings.owner_logged_in;
		}

		this.strAccessType;
		this.strUploadPassword = '';

		if ( objUploadAccessSwitchSettings.access_type == 'PRIVATE' )
		{
			this.strAccessType = 'private';
		}
		else if ( this.strItemType == 'upload' && objUploadAccessSwitchSettings.password != null && objUploadAccessSwitchSettings.password != '' )
		{
			this.strAccessType = 'password';
			this.strUploadPassword = objUploadAccessSwitchSettings.password;
		}
		else if ( this.strItemType == 'upload' && objUploadAccessSwitchSettings.is_public == 1 )
		{
			this.strAccessType = 'public';
		}
		else
		{
			this.strAccessType = 'link';
		}

		
		if ( objUploadAccessSwitchSettings.access_type != 'PRIVATE' && typeof objUploadAccessSwitchSettings.from_eparaksts != 'undefined' && objUploadAccessSwitchSettings.from_eparaksts )
		{
			this.strAccessType = 'link-can-edit';
		}

		if ( objUploadAccessSwitchSettings.access_type == 'link-can-upload' )
		{
			this.strAccessType = 'link-can-upload';
		}

		this.strUploadAccessSwitchType = 'default';

		if ( typeof objUploadAccessSwitchSettings.upload_access_switch_type != 'undefined' )
		{
			this.strUploadAccessSwitchType = objUploadAccessSwitchSettings.upload_access_switch_type;
		}

		this.strEmbedPlace = objUploadAccessSwitchSettings.embed_place;

		
		
		var _this = this;
		
		
		this.init = function()
		{
			var objTypeCopyWrap = $( '#copy_button_drawer_popup' );
			objTypeCopyWrap.html('');
			$( '.copy_button_wrapper_popup' ).removeClass('copy_input_value_to_clipboard_no_tooltip');
			
			var strHtml = '';

			var objTypeSelectWrap = $( '<div></div>' ).attr( {
        						'class' : 'styled-select upload-access-switch-select' ,
        					} )
			var objTypeSelect = $( '<select></select>' ).attr( {
                    				'class' : 'upload-access-switch_type-select' ,
                    				'disabled' : ( this.strUploadAccessSwitchType == 'default' && ! this.bolOwnerLoggedIn ? true : false )
                    			} );

			objTypeSelect.append(
				$( '<option></option>' ).text( '&nbsp;' )
			);
			if ( this.bolOwnerLoggedIn )
			{
				objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'private' ,
    						'desc' : 'Varat piekļūt tikai jūs vai noteikti lietotāji, kas ielūgti ar epastu.' ,
    						'selected' : ( this.strAccessType == 'private' ? true : false )
    					} )
    					.text( 'Tikai ar privātu atļauju' )
    				);
			}
			
			if ( this.strUploadAccessSwitchType == 'default' )
			{ 
    			objTypeSelect.append(
						$( '<option></option>' ).attr( {
							'value' : 'link' ,
							'desc' : 'Var apskatīt un lejupielādēt.' ,
							'selected' : ( this.strAccessType == 'link' ? true : false )
						} )
						.text( 'Jebkuram, kurš zina saiti' )
					);

				strHtml = 	'<div id="drawer_copy_button_view" class="share-input copy_input_value_to_clipboard_no_tooltip checked" onclick="updateSharePopupLink(1)">' +
								'<span>Kopēt skatīšanās saiti</span>' +
								'<span class="desc_popup">Var apskatīt un lejupielādēt</span>' +
							'</div>';
			}
			else if ( this.strUploadAccessSwitchType == 'sharing_form' )
			{
    			objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'link-can-view' ,
    						'desc' : 'Var apskatīt un lejuplādēt' ,
    						'selected' : ( this.strAccessType == 'link' ? true : false ) ,
    						'class' : 'upload-access-switch_type-select_option_link-can-view'
    					} )
    					.text( 'Atverot šo saiti, var piekļūt' )
    				);
					
					strHtml = 	'<div id="drawer_copy_button_view" class="share-input copy_input_value_to_clipboard_no_tooltip checked" onclick="updateSharePopupLink(1)">' +
								'<span>Kopēt skatīšanās saiti</span>' +
								'<span class="desc_popup">Var apskatīt un lejupielādēt</span>' +
							'</div>';
							objTypeCopyWrap.append(strHtml);

    			objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'link-can-edit' ,
    						'desc' : 'Var pievienot, rediģēt saturu, e-parakstīt un dzēst.' ,
    						'selected' : ( this.strAccessType == 'link-can-edit' ? true : false ) ,
    					} )
    					.text( 'Saņem saiti rediģēšanai' )
    				);

					strHtml = 	'<div id="drawer_copy_button_edit" class="share-input copy_input_value_to_clipboard_no_tooltip" onclick="updateSharePopupLink(2)">' +
									'<span>Kopēt rediģēšanas saiti</span>' +
									'<span class="desc_popup">Var pievienot, rediģēt saturu,  e-parakstīt un dzēst</span>' +
								'</div>';
								objTypeCopyWrap.append(strHtml);

    			if ( this.strItemType == 'upload' )
    			{
        			objTypeSelect.append(
        					$( '<option></option>' ).attr( {
        						'value' : 'link-can-upload' ,
        						'desc' : 'Var pievienot klāt failus, bet nevar dzēst vai rediģēt esošos.' ,
        						'selected' : ( this.strAccessType == 'link-can-upload' ? true : false ) ,
        					} )
        					.text( 'Saņem saiti failu pievienošanai' )
        				);

					strHtml = 	'<div id="drawer_copy_button_upload" class="share-input copy_input_value_to_clipboard_no_tooltip" onclick="updateSharePopupLink(3)">' +
									'<span>Kopēt pievienošanas saiti</span>' +
									'<span class="desc_popup">Var pievienot klāt failus, bet ne dzēst vai rediģēt esošos</span>' +
								'</div>';
								objTypeCopyWrap.append(strHtml);
    			}
			}
			else if ( this.strUploadAccessSwitchType == 'modal_gallery' )
			{
    			objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'link-can-view' ,
    						'desc' : 'Var apskatīt un lejuplādēt' ,
    						'selected' : ( this.strAccessType == 'link' ? true : false ) ,
    						'class' : 'upload-access-switch_type-select_option_link-can-view'
    					} )
    					.text( 'Atverot šo saiti, var piekļūt' )
    				);

    			objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'link-can-edit' ,
    						'desc' : 'Var pievienot, rediģēt saturu, e-parakstīt un dzēst.' ,
    						'selected' : ( this.strAccessType == 'link-can-edit' ? true : false ) ,
    					} )
    					.text( 'Saņem saiti rediģēšanai' )
    				);

    			if ( this.strItemType == 'upload' )
    			{
        			objTypeSelect.append(
        					$( '<option></option>' ).attr( {
        						'value' : 'link-can-upload' ,
        						'desc' : 'Var pievienot klāt failus, bet nevar dzēst vai rediģēt esošos.' ,
        						'selected' : ( this.strAccessType == 'link-can-upload' ? true : false ) ,
        					} )
        					.text( 'Saņem saiti failu pievienošanai' )
        				);
    			}
			}

			if ( this.strItemType == 'upload' && this.bolOwnerLoggedIn )
			{
				objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'password' ,
    						'desc' : 'Apmeklētājiem ir jāievada parole' ,
    						'selected' : ( this.strAccessType == 'password' ? true : false )
    					} )
    					.text( 'Uzstādīt paroli' )
    				);
			
				objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'public' ,
    						'desc' : 'Publiski redzams ikvienam jūsu profilā un atrodams meklētājā.' ,
    						'selected' : ( this.strAccessType == 'public' ? true : false )
    					} )
    					.text( 'Publicēts manā profila lapā' )
    				);
			}

			objTypeSelectWrap.append( objTypeSelect );

			$('.url_wrapper ').removeClass('switch');
			
			if ( this.strUploadAccessSwitchType == 'sharing_form' )
			{
				strHtml = 	'<div id="upload-access-switch_type-toggle_wrapper">'+
							'<input type="checkbox" class="upload-access-switch_type-toggle"'+
							( this.strAccessType == 'private' ? ' ' : 'checked ' )+
							//'disabled="'+( this.strUploadAccessSwitchType == 'default' && ! this.bolOwnerLoggedIn ? true : false )+'"'+
							'id="upload-access-switch_type-toggle">'+
							'<label for="upload-access-switch_type-toggle"></label>'+
							'<div>Privāti</div>'+
							'<div>Saite</div>'+
							'</div>';


				if (this.strItemType == 'upload' )
				{
					$('.url_wrapper ').addClass('switch');
					strHtml += '<div id="upload-access-switch-password-download-wrap">'+
									'<div class="upload-access-switch_password-wrapper ' + (this.strAccessType == 'password' ? 'has_password' : '') + '">'+
										'<label onclick="$(this).parent().addClass(\'open\'); $(this).parent().find(\'input\').focus()"> ' + (this.strAccessType == 'password' ? 'Parole:' : 'Uzstādīt paroli') + '</label>'+
										'<input onclick="$(this).parent().addClass(\'open\')" type="text" class="upload-access-switch_password" value="'+this.strUploadPassword+'"></input>'+
										'<input onclick="$(this).parent().addClass(\'open\')" type="password" class="upload-access-switch_password_placeholder" value="111111"></input>'+
										'<div class="upload-access-switch_password-save-btn">Saglabāt</div>'+
									'</div>';
					
					if (typeof objUploadAccessSwitchSettings.hide_download_buttons !== 'undefined' && ! (! bolSessionUser_IsStorageSubscriber && ! bolSessionUser_HasLifetimeStorage) )
					{
						strHtml +=	'<div class="upload-access-switch-hide-download">' +
										'<label for="upload-access-switch_hide-download-toggle">Atslēgt lejupielādes:</label>' +
										'<input type="checkbox" class="upload-access-switch_hide-download-toggle" '+ (objUploadAccessSwitchSettings.hide_download_buttons == '1' ? 'checked' : '') +' id="upload-access-switch_hide-download-toggle">' +
										'<label for="upload-access-switch_hide-download-toggle"></label>' +
										'<label>'+(objUploadAccessSwitchSettings.hide_download_buttons == '1' ? 'Jā' : 'Nē')+'</label>'+
									'</div>';	
					}
					
					strHtml += '</div>';
				}

				$( this.objParentElement ).html(

					$( '<div></div>' ).attr( {
						'class' : 'upload-access-switch ' + (typeof objUploadAccessSwitchSettings.propagate_settings !== 'undefined' && objUploadAccessSwitchSettings.propagate_settings == 2 ? 'disabled' : '') ,
						'data-selected-access-type' : this.strAccessType 
					} )
					.append(
						$( '<div></div>' ).attr( {
							'class' : 'upload-access-switch_type-wrapper' 
						} )
						.append(
							$( '<label></label>' ).text( ( this.strUploadAccessSwitchType == 'sharing_form' ? 'Piekļuves tiesības:' : 'Piekļuve:' ) )
						)
						.append(
							$( '<label></label>' ).attr( {
							'class' : 'upload-access-switch_type-wrapper-desc' 
							} ).text(( this.strAccessType == 'private' ? 'Tikai ar privātu atļauju' : 'Jebkuram, kurš zina saiti' ))
						)
					)
					.append( strHtml )

					
					
				);
			}
			else
			{
				$( this.objParentElement ).html(

					$( '<div></div>' ).attr( {
						'class' : 'upload-access-switch' ,
						'data-selected-access-type' : this.strAccessType 
					} )
					.append(
						$( '<div></div>' ).attr( {
							'class' : 'upload-access-switch_type-wrapper' 
						} )
						.append(
							$( '<label></label>' ).text( ( this.strUploadAccessSwitchType == 'sharing_form' ? 'Saites un piekļuves tiesības:' : 'Piekļuve:' ) )
						)
						.append( objTypeSelectWrap )
					)
					.append(
						$( '<div></div>' ).attr( {
							'class' : 'upload-access-switch_password-wrapper'
						} )
						.append(
							$( '<label></label>' ).text( 'Parole:' )
						)
						.append(
							$( '<input/>' ).attr( {
								'class' : 'upload-access-switch_password' ,
								'type' : 'text' ,
								'title' : 'Ievadi mapes paroli' ,
								'value' : this.strUploadPassword
							} )
						)
						.append(
							$( '<div></div>' ).attr( {
								'class' : 'upload-access-switch_password-save-btn'
							} ).text( 'Saglabāt' )
						)
					)
					.append(
						$( '<div></div>' ).attr( {
							'class' : 'upload-access-switch_loading-mask'
						} )
						.append(
							$( '<i></i>' ).attr( {
								'class' : 'fal fa-spinner fa-spin'
							} )
						)
					)
				);
			}
		


			checkTooltips();
			
			var x, i, j, selElmnt, a, b, c, d, e;
			/*look for any elements with the class "styled-select":*/
			x = document.getElementsByClassName("upload-access-switch-select");
			
			for (i = 0; i < x.length; i++) 
			{
				if (x[i].getElementsByClassName("select-selected").length < 1) 
				{
					selElmnt = x[i].getElementsByTagName("select")[0];
					/*for each element, create a new DIV that will act as the selected item:*/
					a = document.createElement("DIV");
					a.setAttribute("class", "select-selected");
					a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
					x[i].appendChild(a);
					/*for each element, create a new DIV that will contain the option list:*/
					b = document.createElement("DIV");
					b.setAttribute("class", "select-items select-hide");
					for (j = 1; j < selElmnt.length; j++) {
						/*for each option in the original select element,
						create a new DIV that will act as an option item:*/
						c = document.createElement("DIV");
						d = document.createElement("DIV");
						if(selElmnt.options[j].value == selElmnt.value)
						{
							c.setAttribute("class", "checked");
						}
						e = document.createElement("DIV");
						e.setAttribute("class", "value");
						d.setAttribute("class", "desc");
						//c.innerHTML = selElmnt.options[j].innerHTML;
						e.innerHTML = selElmnt.options[j].innerHTML;
						d.innerHTML = selElmnt.options[j].getAttribute('desc');
						c.appendChild(e);
						c.appendChild(d);
						if ( !!selElmnt.id && !!selElmnt.options[j].value )
						{
							c.setAttribute( 'id', selElmnt.id + '_' + selElmnt.options[j].value );
						}
						c.addEventListener("click", function(e) {
							/*when an item is clicked, update the original select box,
							and the selected item:*/
							var y, i, k, s, sjq, h, clicked;
							clicked = this;
							s = this.parentNode.parentNode.getElementsByTagName("select")[0];
							sjq = $(s);
							$(clicked).parents().children().removeClass('checked');
							$(clicked).addClass('checked');

									
							h = this.parentNode.previousSibling;
							for (i = 0; i < s.length; i++) {
								if (s.options[i].innerHTML == this.getElementsByClassName("value")[0].innerHTML) {
									s.selectedIndex = i;
									h.innerHTML = this.getElementsByClassName("value")[0].innerHTML;
									y = this.parentNode.getElementsByClassName("same-as-selected");
									for (k = 0; k < y.length; k++) {
										y[k].removeAttribute("class");
									}
									this.setAttribute("class", "same-as-selected checked");
									sjq.trigger("change");
									break;
								}
							}
							h.click();
						});
						b.appendChild(c);
					}
					x[i].appendChild(b);
					a.addEventListener("click", function(e) {
						/*when the select box is clicked, close any other select boxes,
						and open/close the current select box:*/
						e.stopPropagation();
						closeAllSelect(this);
						this.nextSibling.classList.toggle("select-hide");
						this.classList.toggle("select-arrow-active");
						this.parentElement.classList.toggle("blue-border");
						if (this.parentElement.previousElementSibling)
						{
							this.parentElement.previousElementSibling.classList.toggle("blue-span");
						}
						
					});
				}
			}
			function closeAllSelect(elmnt) {
				/*a function that will close all select boxes in the document,
				except the current select box:*/
				var x, y, i, arrNo = [];
				x = document.getElementsByClassName("select-items");
				y = document.getElementsByClassName("select-selected");
				for (i = 0; i < y.length; i++) {
					if (elmnt == y[i]) {
						arrNo.push(i)
					} else {
						y[i].classList.remove("select-arrow-active");
					}
				}
				for (i = 0; i < x.length; i++) {
					if (arrNo.indexOf(i)) {
						x[i].classList.add("select-hide");
						x[i].parentElement.classList.remove("blue-border");
						if (x[i].parentElement.previousElementSibling)
						{
							x[i].parentElement.previousElementSibling.classList.remove("blue-span");
						}
					}
				}
			}
			/*if the user clicks anywhere outside the select box,
			then close all select boxes:*/
			if ( ! bolUploadAccessSwitch_closeAllSelect_Binded )
			{
				document.addEventListener("click", closeAllSelect);
				bolUploadAccessSwitch_closeAllSelect_Binded = true;
			}

			if ( ! this.bolOwnerLoggedIn )
			{
				if ( this.strUploadAccessSwitchType == 'sharing_form' )
				{
					// do nothing
				}
				else
				{
        			$( this.objParentElement ).on( 'click', function( event )
        			{
        				showCreateAccount();
        			} );
				}
			}
			else
			{
    			$( this.objParentElement ).find( '.upload-access-switch_type-select' ).on( 'change', function()
    			{
    				_this.changeAccessType( $( this ).val() );
    			} );
    
				$( this.objParentElement ).find( '.upload-access-switch_password' ).on( 'blur', function()
    			{
					if($( this ).val().trim() != '' ) {
						$(this).parent().delay(500).queue(function(next) {
							$(this).removeClass('open');
							$( '.upload-access-switch_password-save-btn' ).html('Saglabāt');
							$( '.upload-access-switch_password-save-btn' ).removeClass("green");
							next();
						});
					}
					else
					{
						$( this ).parent().removeClass('has_password').removeClass('open');
						$( '.upload-access-switch_password-save-btn' ).html('Saglabāt');
						$( '.upload-access-switch_password-save-btn' ).removeClass("green");
					}
				} );

    			$( this.objParentElement ).find( '.upload-access-switch_password' ).on( 'change', function()
    			{
					$(this).parent().addClass('has_password');
    				_this.changeAccessType( 'password' );
    			} );

				$( this.objParentElement ).find( '#upload-access-switch_type-toggle' ).on( 'change', function()
    			{
					if ($(this).is(':checked'))
					{
						_this.changeAccessType( 'link' );
					}
					else
					{
						_this.changeAccessType( 'private' );
					}
    				
    			} );

				$( this.objParentElement ).find( '.upload-access-switch_hide-download-toggle' ).on( 'change', function()
    			{

					if ($(this).is(':checked'))
					{
						_this.changeHideDownloadButtons( 1 );
						$(this).next().next().html('Jā');
					}
					else
					{
						_this.changeHideDownloadButtons( 0 );
						$(this).next().next().html('Nē');
					}
    			} );
				

				$( this.objParentElement ).find( '.upload-access-switch_password' ).on( 'input', function()
    			{
					$( '.upload-access-switch_password-save-btn' ).html('Saglabāt');
            		$( '.upload-access-switch_password-save-btn' ).removeClass("green");
    			} );
			}
		}

		this.init();

		this.changeHideDownloadButtons = function( intHideDownloadButtons )
		{
			this.showLoadingMask();

			var strAjax_Url = '';
            var objAjax_Data = null;

            if ( this.strItemType == 'upload' )
            {
            	strAjax_Url = '/ajax/upload_info.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8';
            	
            	objAjax_Data = {
                    'set_upload_hide_download_buttons': true ,
					'upload_hash' : this.strUploadHash ,
					'hide_download_buttons' : intHideDownloadButtons
                };
            }
            
            			
            $.ajax(
            {
                type: "POST",
                dataType: "json",
                url: strAjax_Url ,
                data: objAjax_Data ,
                success: function( data )
                {
                    if ( data['status'] == 'ok' )
                    {
                    	if ( _this.strItemType == 'upload' && ( _this.strEmbedPlace == 'filebrowser' || _this.strEmbedPlace == 'list' ) )
            			{
                        	location.reload();
            			}

            			_this.hideLoadingMask();
                    }
                    else
                    {
                        _this.afterErrorOn_changeAcceccType();
                    }
                } ,
                error: function()
                {
                    _this.afterErrorOn_changeAcceccType();
                }
            } );
		}
		

		this.changeAccessType = function( strNewAccessType )
		{
			$( this.objParentElement ).find( '.upload-access-switch' ).attr( 'data-selected-access-type', strNewAccessType );

			
			if ( strNewAccessType == 'password' && $( this.objParentElement ).find( '.upload-access-switch_password' ).val().trim() == '' )
			{
				if ( this.strUploadAccessSwitchType == 'sharing_form' )
				{
					this.changeAccessType( 'link' );
					$( this.objParentElement ).find( '.upload-access-switch_password' ).parent().removeClass('has_password').removeClass('open');
					$( '.upload-access-switch_password-save-btn' ).html('Saglabāt');
					$( '.upload-access-switch_password-save-btn' ).removeClass("green");
				}
				return;
			}

			if (
					strNewAccessType == 'link-can-view'
					|| strNewAccessType == 'link-can-edit'
					|| strNewAccessType == 'link-can-upload'
				)
			{
				strNewAccessType = 'link';
			}


			if ( this.strItemType == 'file' )
			{
				if ( this.strParentAccessType == 'LINK' && strNewAccessType == 'private' )
				{
                    this.afterErrorOn_changeAcceccType( 'Privāta piekļuve šim failam nestrādās, jo augšējās mapes piekļuve nav privāta. Vispirms pārslēdziet piekļuves uzstādījumus mapei.' );
					return;
				}
			}

			
			this.showLoadingMask();


			var strAjax_Url = '';
            var objAjax_Data = null;

            if ( this.strItemType == 'upload' )
            {
            	strAjax_Url = '/ajax/upload_info.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8';
            	
            	objAjax_Data = {
                    'set_upload_access_type' : true ,
					'upload_hash' : this.strUploadHash ,
					'upload_access_type' : strNewAccessType ,
					'upload_password' : $( this.objParentElement ).find( '.upload-access-switch_password' ).val()
                };
            }
            else if ( this.strItemType == 'file' )
            {
            	strAjax_Url = '/ajax/file_info.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8';
            	
            	objAjax_Data = {
                    'set_file_access_type' : true ,
					'file_hash' : this.strFileHash ,
					'file_access_type' : strNewAccessType 
                };
            }
            
            			
            $.ajax(
            {
                type: "POST",
                dataType: "json",
                url: strAjax_Url ,
                data: objAjax_Data ,
                success: function( data )
                {
                    if ( data['status'] == 'ok' )
                    {
                    	_this.strAccessType = strNewAccessType;
                    	_this.bolAccessTypeChanged = true;

                    	if ( _this.strItemType == 'upload' )
                    	{
                			if ( strNewAccessType != 'password' )
                			{
                				$( _this.objParentElement ).find( '.upload-access-switch_password' ).val( '' );
								$( _this.objParentElement ).find( '.upload-access-switch_password-wrapper' ).find('label').eq(0).html('Uzstādīt paroli');
								$( _this.objParentElement ).find( '.upload-access-switch_password' ).parent().removeClass('has_password').removeClass('open');
                			}
							else 
							{
								$( '.upload-access-switch_password-save-btn' ).html('Saglabāts!');
            					$( '.upload-access-switch_password-save-btn' ).addClass("green");
								$( _this.objParentElement ).find( '.upload-access-switch_password-wrapper' ).find('label').eq(0).html('Parole:');
							}
    
                			if ( strNewAccessType == 'link' )
                			{
                    			$( '#upload_button__publish' ).show();
                    			$( '#upload_button__unpublish' ).hide();
                			}
                			else if ( strNewAccessType == 'public' )
                			{
                    			$( '#upload_button__publish' ).hide();
                    			$( '#upload_button__unpublish' ).show();
                			}
                			else 
                			{
                    			$( '#upload_button__publish' ).hide();
                    			$( '#upload_button__unpublish' ).hide();
                			}
    
                			if ( _this.strEmbedPlace == 'filebrowser' )
                			{
    							gaev( 'filebrowser-folder-info', 'access', strNewAccessType );
                			}
                    	}

                    	if ( _this.strItemType == 'upload' && ( _this.strEmbedPlace == 'filebrowser' || _this.strEmbedPlace == 'list' ) )
            			{
                        	location.reload();
            			}

            			_this.hideLoadingMask();
            			
                    }
                    else
                    {
                        _this.afterErrorOn_changeAcceccType();
                    }
                } ,
                error: function()
                {
                    _this.afterErrorOn_changeAcceccType();
                }
            } );
		}

		this.afterErrorOn_changeAcceccType = function( strErrorMsg )
		{
			if ( this.strAccessType == 'link' && this.strUploadAccessSwitchType == 'sharing_form' )
			{
				this.strAccessType = 'link-can-view';
			}
    					
			$( this.objParentElement ).find( '.upload-access-switch' ).attr( 'data-selected-access-type', this.strAccessType );
			$( this.objParentElement ).find( '.upload-access-switch_type-select option[value="' + this.strAccessType + '"]' ).attr( 'selected', 'selected' );

			$( this.objParentElement ).find( '.upload-access-switch_type-select' ).trigger( 'change' );

			if ( typeof strErrorMsg == 'undefined' )
			{
				strErrorMsg = 'Notika kļūda. Mēģiniet vēlreiz!';
			}
			
			fError( strErrorMsg );

			this.hideLoadingMask();
		}

		this.showLoadingMask = function()
		{
			$( this.objParentElement ).find( '.upload-access-switch_loading-mask' ).show();
		}

		this.hideLoadingMask = function()
		{
			$( this.objParentElement ).find( '.upload-access-switch_loading-mask' ).hide();
		}
	}

</script><script type="text/javascript" src="/js/download_selected_files/download_selected_files.js?v=104"></script>

<script type="text/javascript">
	
	var objDownloadSelectedFiles;
	
	$( function()
	{
		objDownloadSelectedFiles = new downloadSelectedFiles(
			{
				'Warning-DontUseIOS' : 'Apple mobilās ierīces nemāk veikt šo opciju. Lejupielādējiet katru failu atsevišķi vai visus failus ZIP arhīvā, vai arī izmantojiet citu ierīci. IOSā faili tiek saglabāti "Files">"Downloads" mapē.<br/><br/>Jūs izmantojat iOS operētājsistēmu, kuras ierobežojumu dēļ jūs nevarat izmantot šo iespēju. MacOS, Windows vai Android operētājsistēmās tas strādā. IOSā faili tiek saglabāti "Files">"Downloads" mapē.' ,
				'Warning-SelectFiles' : 'Lūdzu, izvēlies vismaz vienu failu.' ,
			}
		);
	} );

</script>    <script type="text/javascript" src="/js/file.report.functions.js.php"></script>

<div id="list_waiting_overly_for_printing_order" style="display: none;position: absolute; top: 0; left:0; width: 100%; height: 100%; background: rgba(43, 61, 82, 0.9); z-index: 10000001; padding-top: 20%; text-align: center;">
    <i class="fa fa-spinner fa-spin fa-fw" style="color: white; font-size: 50px;"></i>
</div>

<script type="text/javascript">

    if ( window.location.hash == '#order'|| window.location.hash.substr( 0, 10 ) == '#eparaksts' )
    {
        $( '#list_waiting_overly_for_printing_order' ).show();
    }

</script>


<div id="center" class="list_page_container ">

<!-- File context menu template, used by jQote to prepare html from JavaScript -->
<script type="text/x-jqote-template" id="file_context_menu_template"><![CDATA[
<ul id="file_context_menu" class="dropdown-menu">

    <li role="presentation" style="display: inline-flex;align-items: center; font-size: 12px; line-height:16px; padding: 10px 15px; color: #1A2533;width: calc(100% - 40px);">
        <img style="width: 18px; margin-right: 10px;" src="/images/file_types_v2/<*= this.file_icon *>"/>
        <span style=" display: inline-block;display: -webkit-inline-box;font-size: 12px;line-height:16px;-webkit-line-clamp: 2;-webkit-box-orient: vertical;overflow: hidden;">
            <*= this.name *>
        </span>
        <div id="file_context_menu_close"> <i class="fal fa-times"></i></div>
    </li>

    
    <li role="presentation" class="divider" style="margin-top: 0"></li>
    
    <!-- View -->
    <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)" onclick="listPreviewFile('<*= this.name *>')"><img style="width: 16px; margin-right: 9px;" src="/images/button_icons/eye.svg?v=1"/> Apskatīt</a></li>
     
    
        <!-- Download -->
    <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)" onclick="downloadFile( '<*= this.file_hash *>' )"><img style="margin-left: 1px; margin-right: 12px;" src="/images/button_icons/download.svg?v=1"/> Lejuplādēt</a></li>
        
        
        <!-- Open in web view -->
    <*= this.panel_id != 'shared-with-me' ? '<li role="presentation"><a role="menuitem" tabindex="-1" href="/f/' + this.file_hash + '" target="_blank"><img style="margin-left: 1px; margin-right: 12px;" src="/images/button_icons/external.svg?v=1"/> Atvērt tiešo saiti</a></li>' : '' *>
        
        <!-- Copy link -->
    <*= this.panel_id != 'shared-with-me' ? '<li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)" onclick="copyToClipboard(\'https://failiem.lv/f/' + this.file_hash + '\')"><img style="width: 16px; margin-right: 9px;" src="/images/button_icons/link.svg?v=1"/> Kopēt saiti</a></li>' : '' *>
        
        <!-- Embed -->
    <li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)" onclick="$( '#list_item_embed_button_for_file_<*= this.file_hash *>' ).click();"><img style="width: 16px; margin-right: 9px;" src="/images/button_icons/code.svg?v=1"/>Iegult saturu</a></li>
    
	<*= this.can_sell_file || this.can_buy_file || this.can_order_prints || this.can_order_producs ? '<li role="presentation" class="divider"></li>':''*>
	
	<!-- Sell file-->
    <*= ! this.can_sell_file ? '<!--':''*>
	<li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)" onclick="showSetPriceFormModal('<*= this.file_hash *>')"><img src="/images/button_icons/buy.svg?v=1"/> Pārdot failu</a></li>
    <*= ! this.can_sell_file ? '-->':''*>

	<!-- Buy file-->
    <*= ! this.can_buy_file ? '<!--':''*>
	<li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)" onclick="showBuyFileFormModal('<*= this.file_hash *>')"><img src="/images/button_icons/buy.svg?v=1"/> Pirkt šo produktu</a></li>
    <*= ! this.can_buy_file ? '-->':''*>

	<!-- Order prints-->
    <*= ! this.can_order_prints ? '<!--':''*>
	<li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)" onclick="showPrintingOrderModal('<*= this.file_hash *>', 'ListActionLineDropdown');"><img src="/images/button_icons/print.svg?v=1"/> Pasūtīt foto izdrukas</a></li>
    <*= ! this.can_order_prints ? '-->':''*>

	<!-- Order products -->
    <*= ! this.can_order_producs ? '<!--':''*>
	<li role="presentation"><a role="menuitem" tabindex="-1" href="/c/<*= this.upload_hash *>?h=<*= this.file_hash *>" target="_blank"><img src="/images/button_icons/cup.svg?v=1"/>Apskatīt apdrukas</a></li>
    <*= ! this.can_order_producs ? '-->':''*>
    
	
        
    
	<!-- Report-->
	<*= ! this.can_be_reported ? '<!--':''*>
	<li role="presentation" class="divider"></li>
	<*= ! this.can_be_reported ? '-->':''*>

	<*= ! this.can_be_reported ? '<!--':(! this.has_reported ? '<!--':'')*>
	<li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)" onclick="showCancelFileReportModal(this, '<*= this.file_hash *>');"><img style="width: 16px; margin-right: 9px;" src="/images/button_icons/report.svg?v=1"/> Atcelt ziņojumu par bīstama satura failu</a></li>
    <*= ! this.can_be_reported ? '-->':(! this.has_reported ? '-->':'')*>

    <*= ! this.can_be_reported ? '<!--':( this.has_reported ? '<!--':'')*>
	<li role="presentation"><a role="menuitem" tabindex="-1" href="javascript:void(0)" onclick="showFileReportModal(this, '<*= this.file_hash *>');"><img style="width: 16px; margin-right: 9px;" src="/images/button_icons/report.svg?v=1"/> Ziņot par problēmu</a></li>
    <*= ! this.can_be_reported ? '-->':( this.has_reported ? '-->':'')*>
    
</ul>
]]>
</script>
<link rel="stylesheet" type="text/css" media="all" href="/css/upload_copy_form.css?v=101" />
<script type="text/javascript" src="/js/upload_copy_form.js?v=109"></script>

<script type="text/javascript">

	var objUploadCopyForm = null;
	var PHPSESSID = 'a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8';
	
	$( function()
	{
		objUploadCopyForm = new UploadCopyForm(
			false ,
			false ,
			'a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8' ,
			{
				'Error-General' : 'Diemžēl notika kļūda datu apstrādes laikā. Lūdzu, mēģini vēlreiz!' ,
				'Error-FileSizeLimitExceeded' : 'Kāds no izvēlētajiem failiem kopēšanai pārsniedz Jūsu konta faila izmēra limitu.' ,
				'Error-UploadSizeLimitExceeded' : 'Kopējais failu izmērs pārsniedz Jūsu konta mapes izmēra limitu.' ,
				'Error-CircularMove' : 'Kopēt mapi uz kādu no tās apakšmapēm vai sevi nav iespējams! Izvēlies citu mapi, uz kuru kopēt.' ,
				'Error-HttpDownloadNotAllowed' : 'Kādu no izvēlētajiem failiem nav atļauts lejupielādēt.' ,
				'ConfirmText-CloseForm' : 'Vai tiešām vēlies aizvērt formu un pārtraukt failu kopēšanu?' ,
				'YES' : 'Jā' ,
				'NO' : 'Nē' ,
				'Header' : 'Tiek kopēti faili' ,
				'SubHeader-1' : 'Neveriet ciet šo logu, kamēr notiek failu kopēšana.' ,
				'Copied' : 'Pārkopēti' ,
				'Header-Share' : 'Failu saglabāšana kontā' ,
				'SubHeader-1-Share' : 'Neveriet ciet šo logu, kamēr notiek failu augšupielāde' ,
				'Copied-Share' : 'Saglabāti' ,
			} ,
		);
	} );

</script>


<section id="upload-copy-form" class="modal-container" tabindex="-1" role="dialog" aria-labelledby="modal-label" aria-hidden="true">
	
	<div class="modal-inner">
		
		<div id="upload-copy-form__close-top-button" onclick="objUploadCopyForm.confirmClose()"><i class="fal fa-times"></i></div>
		
		<div class="modal-content">
			
			<div id="upload-copy-form_header-main"></div>
			
			<div id="upload-copy-form_header-info"></div>
    		
			<div id="upload-copy-form_main-content">
    			
    			<div id="upload-copy-form_stats-top">
    				<span id="upload-copy-form_stats_text"></span>
    				<span id="upload-copy-form_stats_finished-count">-</span>
    				<span>no</span>
    				<span id="upload-copy-form_stats_total-count">-</span>
    			</div>
    			
    			<div id="upload-copy-form_progress-bar">
	    			<div id="upload-copy-form_progress-bar_text">-%</div>
	    			<div id="upload-copy-form_progress-bar_outer">
		    			<div id="upload-copy-form_progress-bar_inner"></div>
	    			</div>
    			</div>
    			
    			<div id="upload-copy-form_stats-bottom">
    				<span id="upload-copy-form_stats_finished-size">-</span>
    				<span id="upload-copy-form_stats_total-size">-</span>
    			</div>
    			
    			<div id="upload-copy-form_finished-info">
    			
	    			<div id="upload-copy-form_finished-info_text">
	    				Kopēšana ir pabeigta	    			</div>
	    			
	    			<div id="upload-copy-form_finished-info_button" onclick="hideModal('upload-copy-form')">
	    				OK	    			</div>
    			
    			</div>
		
        		<!-- S: Loading mask -->
        		<div id="upload-copy-form_main-content_loading-mask">
        			<i class="fa fa-spinner fa-spin"></i>
        		</div>
        		<!-- E: Loading mask -->
        		
			</div>
			
		</div>
		
	</div>
	
	<div id="upload-copy-form_modal-close" class="modal-close modal-close-dont-close" data-dismiss="modal" data-close="Aizvērt" onclick="objUploadCopyForm.confirmClose()"></div>
	
</section>
<link rel="stylesheet" type="text/css" media="all" href="/js/bxslider/jquery.bxslider.min.css?v=1677489352" /><link rel="stylesheet" type="text/css" media="all" href="/js/video/ffm.video.min.css?v=1677846886" /><link rel="stylesheet" type="text/css" media="all" href="/css/modal_gallery.v2.css?v=1680771594" /><link rel="stylesheet" type="text/css" media="all" href="/css/global_facelift.css?v=1670411891" /><link rel="stylesheet" type="text/css" media="all" href="/css/audio_player.css?v=1679642735" /><link rel="stylesheet" type="text/css" media="all" href="/css/modal_gallery_for_specific_file.css?v=1672322135" />
                <script src="/js/jquery.tagsinput.js?v=1680771601"></script>
                <script src="/js/jquery.fitvids.js?v=1458071156"></script>
                <script src="/js/bxslider/jquery.bxslider.js?v=1677489352"></script>
                <script src="/js/autosize.min.js?v=1451900648"></script>
                <script src="/js/audio_player.js?v=1679642735"></script>
                <script src="/js/video/ffm.video.cookie.settings.js?v=1612179880"></script>
                <script src="/js/video/ffm.video.min.js?v=1677846884"></script>
                <script src="/js/functions.js?v=1598421347"></script>
                <script src="/js/dropdown.button.js?v=1677241974"></script>
                <script src="/js/panzoom/panzoom.min.js?v=1588163970"></script>

<div id="gallery2" style="display: none;" class=" p2p_download ">
    <div id="gallery2__bg"></div>

    <div id="gallery2__content-wrapper">
        <div id="gallery2__header_mobile">
            <span class="gallery2__header__img-count">&nbsp;</span>
            <span class="gallery2__header__file_name_value"></span>
            <span class="gallery2__header__close" onclick="if($( '#gallery2__content' ).hasClass( 'gallery__sidebar__info-visible' ) && $( '#gallery2__content' ).hasClass( 'gallery__sidebar-visible' ) ){showGalleryInfo(); $(window).trigger('resize');} else {closeGallery(strCurrentFileHash);}"></span>
        </div>
        <div id="gallery2__header">
            <div id="gallery2__header__inner" class="clearfix">
                <div class="gallery2__header__icon-group" id="gallery2__header__left">
                    
                    <div id="gallery2__header__logo" class="failiem_lv" onclick="window.location='https://fv2-4.failiem.lv'"></div>
                    
                    <!--<div id="gallery2__header__info" class="gallery2__header__icon" onclick="showGalleryInfo();"></div>-->

                    <!--<div id="gallery2__header__view-original-small" class="gallery2__header__icon" onclick="showOrginal(strCurrentFileHash);"></div>-->
                    
                    <span class="gallery2__header__img-count">&nbsp;</span>
                    
                                            <div id="gallery_vote_header" class="gallery_vote gallery2__header__icon" onclick="voteForFile(strCurrentFileHash)">
                            <span class="vote_count"></span>
                        </div>
                                        
                </div>
                
                <div id="gallery2__header__mid">
                    <div id="gallery2__header__mid_content">

                        <!--
                        <span id="gallery2__save" class="gallery2__save_button gallery2__header_middle_button"  onclick="modalGalleryDownloadFileBtn( strCurrentFileHash )" style="background: #03a84e;">
                            <a href="javascript:void(0);">
                                <span>Lejuplādēt šo failu</span>
                                <span class="gallery2__save_short_text">Simple</span>
                            </a>
                        </span>
                        <span id="gallery2__save_p2p" style="display: none;" class="gallery2__p2p_save_button gallery2__header_middle_button"  onclick="modalGalleryDownloadFileP2PBtn( intCurrentFileIndex )">
                            <a href="javascript:void(0);">
                                <span>Lejuplādēt ar P2P</span>
                                <span class="gallery2__save_p2p_short_text">P2P</span>
                            </a>
                        </span>
                        -->
                        <span id="gallery2__buyfile" style="display:none" class="gallery2__header_middle_button ">
                            <a href="javascript:void(0);">
                                <span class="text">Pirkt šo produktu</span>
                                <span class="price"></span>
                            </a>
                        </span>

                        <div class="seperator"></div>
                        
                                                                        <span id="gallery2__buy-products" class="gallery2__header_middle_button gallery2__button__buy-products">
                            <a href="javascript:void(0);">
                                <span class="text">Pirkt apdrukas</span>
                            </a>
                        </span>
                                                
                        <span id="gallery2__share" class="gallery2__header_middle_button">
                            <a href="javascript:void(0);" id="gallery2__share_button">
                                <span>Koplietot</span>
                            </a>
                        </span>
                                                <span id="gallery2__order" class="gallery2__header_middle_button" onclick="showPrintingOrderModal(strCurrentFileHash, 'ListActionLineDropdown');">
                            <a href="javascript:void(0);">
                                <span>Pasūtīt foto izdrukas</span>
                            </a>
                        </span>
                                                
                        <span id="gallery2__edit" class="gallery2__header_middle_button gallery2__edit">
                            <a href="javascript:void(0);" id="gallery2__edit_button">
                                <span>Rediģēt</span>
                            </a>
                        </span>
                        
                                                <span id="gallery2__sign" class="gallery2__header_middle_button">
                            <a href="javascript:void(0);">
                                <span>E-parakstīt</span>
                            </a>
                        </span>
                                                
                    </div>
                </div>
                
                <div class="gallery2__header__icon-group" id="gallery2__header__right">
                    <span id="gallery2__info" onclick="showGalleryInfo(); $(window).trigger('resize');"></span>
                    <span id="gallery2__close" onclick="closeGallery(strCurrentFileHash);"></span>
                </div>
            </div>
        </div>
        
				
        <div id="gallery2__content" class="gallery__image__is-image gallery__thumbs-visible clearfix">
            <div id="gallery2__content__sidebar">
                <div id="gallery2__content__sidebar__inner" class="gallery2__content__sidebar__inner__flex">
                    <div id="gallery2__sidebar-close" onclick="hideSidebar();"></div>

                    <div id="gallery2__sidebar__info">
                        
                        <div class="gallery2__sidebar__content">

                            <div id="file-info">Faila informācija:</div>

                            <div id="gallery2_file_info">

                                                                <div id="gallery2_item_info_bottom_section">

                                                                        
                                        <div id="gallery2_item_info_share-wrapper">
                                            <div id="gallery2_item_info_share">
                                                <div class="gallery2_input-container">
                                                    <input type="text" id="gallery_share_popup_url" title="Saiti vari nosūtīt citiem lietotājiem piekļuvei šiem failiem. Failu īpašnieks piekļuves tiesības mapei var izmainīt." onclick="this.setSelectionRange(0, this.value.length); gaev( 'filebrowser-file-info', 'share-link', '' );" class="gallery2_share-input" data-clipboard-text=""/>
                                                </div>
                                                <div id="gallery2_upload_button__share_with_users" class="gallery2_share-button-after-input">
                                                    Dalīties                                                </div>
                                            </div>

                                            <div id="gallery_upload-access-switch"></div>
                                        </div>

                                                                        
                                    
                                                                        <div class="gallery2_item_info_padded buttons">

                                                                                <span id="gallery2__item_info_save" class="gallery2__sidebar__info-button half-button"  onclick="modalGalleryDownloadFileBtn( strCurrentFileHash )">
                                            <a href="javascript:void(0);">
                                                Lejuplādēt                                            </a>
                                        </span>
                                        
                                                                                <a id="gallery2__item_info_delete" class="gallery2__sidebar__info-button half-button" href="javascript:void(0)">
                                            Dzēst šo failu                                        </a>   
                                        
                                                                                <a id="gallery2__item_info_edit" class="gallery2__sidebar__info-button gallery2__edit half-button" href="javascript:void(0)">
                                            Rediģēt faila saturu                                        </a>   


                                    	                                        <a id="gallery2__item_info_order" class="gallery2__sidebar__info-button" onclick="showPrintingOrderModal(strCurrentFileHash, 'ListActionLineDropdown');" href="javascript:void(0)">
                                            Pasūtīt foto izdrukas                                        </a>
                                                                                
                                                                                                                        <a id="gallery2__sidebar__info-price" class="gallery2__sidebar__info-button" href="javascript:void(0)"></a>
                                                                                
                                                                                                                        <div id="gallery2__sidebar__info-buy-products" class="gallery2__sidebar__info-button gallery2__button__buy-products">Pirkt apdrukas</div>
                                                                                
                                        
                                                                                    <a href="javascript:void(0);" id="gallery2__sidebar__info_embed_button" class="gallery2__sidebar__info-button half-button">
                                                <span>Saites</span>
                                                <span class="gallery2__sidebar__info_embed_short_text"><!--Links--></span>
                                            </a>
                                        
                                                                                                                            <a id="gallery2__left_info-button_sign" class="gallery2__sidebar__info-button half-button" href="javascript:void(0);" >
                                                E-parakstīt                                            </a>
                                            <div id="gallery2__left_info__signers-list-container">
                                            	<div class="file-signing-eparaksts-form_file-list_file-item_signatures-info_is-signed_header">
                                            		Parakstījis:
                                        		</div>
                                        		<div id="gallery2__left_info__signers-list">
                                    			</div>
                                            </div>
                                                                               
                                        
                                    </div>
                                    

                                    
                                                                        <div class="gallery2_item_info_padded">
                                        
                                        <div id="gallery2_info_head">

                                            <div class="info_head">

                                                                                                <div class="thumbnail-wrapper">
                                                </div>
                                                
                                                                                                                                                <div id="gallery2__sidebar__info-name" class="not_owner_hide">
                                                    <div id="file_name_edit_wrapper" >
                                                        <div class="error_msg">Notika kļūda. Mēģiniet vēlreiz!</div>
                                                        <textarea class="gallery2__sidebar__info-value gallery2__sidebar__file_name_value" rows="1"></textarea>
                                                        <div class="editable_field_save_button">
                                                            Saglabāt                                                        </div>  
                                                        <div class="edit_wrapper_edit_button" ><div class="edit_wrapper_edit_button_icon" ></div></div>
                                                    </div>
                                                </div>
                                            
                                                                                                <h1 id="gallery2__sidebar__info-name-uneditable" style="word-wrap: break-word;" class="not_owner_show">
                                                    <span class="gallery2__sidebar__file_name_value"></span>
                                                </h1>
                                                                                                

                                            </div>

                                            
                                            
                                                                                                                                    <div id="gallery2__sidebar__info-description" class="not_owner_hide">
                                                <div id="file_description_edit_wrapper" >
                                                    <div class="error_msg">Notika kļūda. Mēģiniet vēlreiz!</div>
                                                    <textarea class="gallery2__sidebar__info-value not_owner_hide gallery2__sidebar__file_description_value" placeholder="Ieraksti faila aprakstu"></textarea>
                                                    <div class="editable_field_save_button">
                                                        Saglabāt                                                    </div>  
                                                    <div class="edit_wrapper_edit_button not_owner_hide" ><div class="edit_wrapper_edit_button_icon" ></div></div>
                                                </div>
                                            </div>
                                                                                        <div class="not_owner_show">
                                                <span class="gallery2__sidebar__file_description_value"></span>
                                            </div>
                                            
                                            
                                                                                        <div id="gallery2__sidebar__info-set-custom-thumbnail"></div>
                                            
                                        </div>

                                    </div>
                                    

                                    
                                    <div class="header-owner">
                                        <div class="header-owner_image-wrapper"></div>
                                        <div>
                                            <div class="header-owner_title">
                                                Lietotājs                                            </div>
                                            <div class="header-owner_name"></div>
                                        </div>
                                    </div>
                                    
                                                                        <table id="gallery2_file_details_table" class="zebra_table gallery2_item_info_padded">
                                        <tbody>
											
                                                                                        <tr id="gallery2__sidebar__info-date">
                                                <td>
                                                    Uzkopēts:
                                                </td>
                                                <td class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-moddate">
                                                <td>
                                                    Modificēts:
                                                </td>
                                                <td class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>

                                                                                        <tr id="gallery2__sidebar__info-date-delete">
                                                <td style="color:#C96F6F">
                                                    Tiks dzēsts:
                                                </td>
                                                <td class="gallery2__sidebar__info-value" style="color:#C96F6F">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-size">
                                                <td>
                                                    Izmērs:
                                                </td>
                                                <td class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-views">
                                                <td>
                                                    Skatījumi:
                                                </td>
                                                <td class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-downloads">
                                                <td>
                                                    Lejuplādēts:
                                                </td>
                                                <td class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-comments">
                                                <td>
                                                    Komentāri:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-title" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Nosaukums:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-subject" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Temats:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-content_type" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Satura tips:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-category" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Kategorija:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-categories" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Kategorijas:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-keywords" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Atslēgvārdi:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-creator" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Autors:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-publisher" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Izdevējs:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-contributor" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Contributor:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-copyrights" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Autortiesības:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-license_type" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Licences veids:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-license_details" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Licences detaļas:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-language" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Valoda:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-location" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Vieta:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-location_lat" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    GPS Lat:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-location_long" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    GPS Long:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-references" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Atsauces:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-relates_to" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Attiecas uz:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-format" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Formāts:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-device" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Ierīce:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-date_created" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Datums:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-source" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Avots:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr> 
                                            
                                                                                        <tr id="gallery2__sidebar__info-metadata-tags" class="gallery2__sidebar__info-metadata">
                                                <td>
                                                    Tagi:
                                                </td>
                                                <td  class="gallery2__sidebar__info-value">
                                                </td>
                                            </tr>
                                            
                                        </tbody>
                                    </table>
                                    
                                    <ul class="fa-ul" id="gallery2__sidebar__info-data">
                                        <li id="gallery2__sidebar__info-tags">
                                            <div id="gallery_file_tags_container" class="file_tags_container ">
                                                <input class="file_tags_input" style="display:none"/>
                                                <div class="file_tags_error">Notika kļūda. Mēģiniet vēlreiz!</div>
                                            </div>
                                        </li>
                                    </ul>
                                    
                                </div>
                                
                            </div> <!-- /#file_info -->

                        </div>
                        
                    </div>
                    
                    
                    <div id="gallery2__report_button">
                        <img src="/images/button_icons/grey/danger.svg?v=1" />
                        <span class="not-reported">Ziņot par problēmu</span>
                        <span class="reported">Atcelt ziņojumu par bīstama satura failu</span>
                    </div>
                                            <div id="gallery2__comments_button" onclick="showGalleryMessages(); $(window).trigger('resize');">
                            <img src="/images/button_icons/white/comment.svg?v=1" />
                            Pievienot komentāru                        </div>
                    
                </div>
                    <script>
                        var bolDisableGalleryChat = false;
                    </script>
                                            <script>
                            var CHAT_DATA = {
                                // null - guest
                                userId: null,
                                phpSessid: 'a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8',
                                fullChat: false,
                                apiUrl: "https://fv2-4.failiem.lv/api/chat/",
                                mainUrl: "https://fv2-4.failiem.lv/",
                                // use as avatar image cache number
                                avatarCache: Date.now(),
                                isOrg: false,
                                translations: {"CHATFM_SEND-BUTTON":"S\u016bt\u012bt","CHATFM_MEMBERS":"Lietot\u0101ji","CHATFM_TYPE-NEW-MESSAGE":"Pievienot zi\u0146ojumu","CHATFM_NEW-CONVERSATION-BUTTON":"Jauna sarakste","CHATFM_START-NEW-CONVERSATION-BUTTON":"Uzs\u0101kt jaunu saraksti","CHATFM_GROUP-CHAT-TITLE":"Izveidot jaunu saraksti:","CHATFM_GROUP-CHAT-INPUT":"Sarakstes nosaukums","CHATFM_GROUP-CHAT-SELECT":"Sarakstes lietot\u0101ji:","CHATFM_GROUP-CHAT-ACTION-ALL":"Atz\u012bm\u0113t visus","CHATFM_GROUP-CHAT-ACTION-NONE":"Nodz\u0113st","CHATFM_GROUP-CHAT-CREATE-BUTTON":"Izveidot","CHATFM_SELECT-CONVERSATION":"Izv\u0113lies saraksti vai","CHATFM_EMPTY-CHANNELS":"Pa\u0161laik nav nevienas sarakstes","CHATFM_CANCEL-BUTTON":"Atcelt","CHATFM_REPORT-TITLE":"Zi\u0146ot par p\u0101rk\u0101pumu?","CHATFM_REPORT-BUTTON":"Zi\u0146ot","CHATFM_DELETE-TITLE":"Dz\u0113st zi\u0146ojumu?","CHATFM_DELETE-BUTTON":"Dz\u0113st","CHATFM_MESSAGE-DELETED":"Zi\u0146ojums dz\u0113sts","CHATFM_NEW-ACCOUNT-TITLE":"Izveido kontu, lai pievienotu jaunu zi\u0146ojumu!","CHATFM_SIGN-UP":"Re\u0123istr\u0113ties","CHATFM_LOG-IN":"Ieiet","CHATFM_ERROR":"Zi\u0146ojumu sist\u0113m\u0101 radusies k\u013c\u016bda. L\u016bdzu, p\u0101rl\u0101d\u0113jiet lapu!","CHATFM_MESSAGES-LOAD-MORE":"R\u0101d\u012bt vec\u0101kus zi\u0146ojumus","CHATFM_SYSTEM-MESSAGES":"Sist\u0113mas zi\u0146ojumi","CHATFM_SYSTEM-MESSAGE":"Sist\u0113mas zi\u0146ojums","CHATFM_NOT_VALID_EMAIL":"Neder\u012bga e-pasta adrese!","CHATFM_ALREADY_ADDED_TO_WAITINGLIST":"Uzaicin\u0101jums nos\u016bt\u012bts!","CHATFM_ADDED_TO_WAITINGLIST":"Uzaicin\u0101jums nos\u016bt\u012bts!","CHATFM_ALREADY_ADDED_TO_CHANNEL":"Lietot\u0101js ar \u0161\u0101du epastu jau pievienots sarakstei!","CHATFM_ADDED_TO_CHANNEL":"Lietot\u0101js pievienots sarakstei!","CHATFM_NOT_FROM_ORG":"E-pasts nepieder organiz\u0101cijai!","CHATFM_ADD_MEMBER_TITLE":"Iel\u016bgt dal\u012bbnieku ar epastu","CHATFM_ADD_MEMBER_INPUT":"E-pasta adrese","CHATFM_ADD_MEMBER_BUTTON":"Pievienot","CHATFM_REQUEST_ACCESS_ALREADY_MEMBER":"Lietot\u0101js jau ir pievienots sarakstei!","CHATFM_REQUEST_ACCESS_NOT_POSSIBLE":"Nav iesp\u0113jams nos\u016bt\u012bt piepras\u012bjumu!","CHATFM_REQUEST_ACCESS_SENT":"Piepras\u012bjums nos\u016bt\u012bts!","CHATFM_REQUEST_ACCESS_TITLE":"Jums nav piek\u013cuves ties\u012bbas sarakstei","CHATFM_REQUEST_ACCESS_BUTTON_SEND":"Nos\u016bt\u012bt piek\u013cuves piepras\u012bjumu","CHATFM_REQUEST_ACCESS_BUTTON_BACK":"Atgriezties uz sarakst\u0113m","CHATFM_YES-BUTTON":"J\u0101","CHATFM_NO-BUTTON":"N\u0113","CHATFM_WAITINGLIST-TITLE":"Uzaicin\u0101tie (nav re\u0123istr\u0113ju\u0161ies)","CHATFM_WAITINGLIST-EMPTY":"\u0160obr\u012bd nav uzaicin\u0101to lietot\u0101ju","CHATFM_WAITINGLIST-DELETE-TITLE":"Atcelt uzaicin\u0101jumu?","CHATFM_MENTION_DESCRIPTION":"Raksti @ z\u012bmi, lai nos\u016bt\u012btu lietot\u0101jam e-pastu","CHATFM_MEMBER-DELETE-TITLE":"Dz\u0113st lietot\u0101ju?","CHATFM_EDIT-NAME-UPDATED":"Nosaukums saglab\u0101ts!","CHATFM_EDIT-NAME-TITLE":"Labot nosaukumu","CHATFM_EDIT-NAME-INPUT":"Sarakstes nosaukums","CHATFM_EDIT-NAME-BUTTON":"Saglab\u0101t","CHATFM_CHANNEL-ERROR-BACK-BUTTON":"Atgriezties uz sarakst\u0113m","CHATFM_CHANNEL-ERROR-NO-ACCESS":"Jums nav piek\u013cuves ties\u012bbas sarakstei.","CHATFM_CONTACT-MESSAGE":"Lai sazin\u0101tos ar Failiem.lv atbalstu, dodies uz sada\u013cu %link% un nos\u016bti zi\u0146u.","CHATFM_CONTACT-TITLE":"Kontakti"},
                                showMessagesHeader: false,
                                allowAddNewMember: false,
                                allowSendAccessRequest: false,
                                initChannelId: null,
                                initChannelStatus: null,
                                initChannelType: null,
                                initChannelName: null,
                                showWaitinglist: false
                            };
                            bolDisableGalleryChat = false;
                        </script>
                        <div id="gallery2__comments" class="gallery2__comments">
                            <a href="javascript:void(0)" onclick="hideGalleryMessages(); $(window).trigger('resize');" id="gallery2__comments_button_close" title="Atpakaļ uz informāciju">
                                <i class="fas fa-chevron-left"></i>
                            </a>
                            <div id="chatfm-app-wrapper">
                                <div id="chatfm-app" class="chatfm-app"></div>
                            </div>
                        </div>
                                    </div>

            <div id="gallery2__content__viewport">
                <div id="gallery2__image-wrapper">
                    <div id="gallery2__swipe-wrapper"><i class="fa fa-spinner fa-spin gallery2__load-spinner"></i></div>
                    
                    <div id="gallery2__controls_middle">
                        <div id="gallery2__header__zoom" onclick="openPanZoomImage()" title="Palielināt attēlu"></div>
                        <div id="gallery2__header__view-original" onclick="showOrginal(strCurrentFileHash)"  title="Atvērt pilnā kvalitātē"></div>
                                                    <div id="gallery2__header__fullscreen" onclick="galleryToggleFullScreen(document.body)" title="Pilnekrāna režīms"></div>
                                                                            <div id="gallery_vote_middle" title="Atzīmēt" class="gallery_vote gallery2__header__icon" onclick="voteForFile(strCurrentFileHash)">
                                <span class="vote_count"></span>
                            </div>
                        					
                    </div>

                    <div id="gallery2__controls_left">
                        <a href="javascript:void(0);" id="gallery2__controls__prev" onclick="galleryOpenPrevItem()"></a>
                    </div>
                    <!--<div id="gallery2__controls_zoom">
                        <a href="javascript:void(0);" id="gallery2__controls__zoom" onclick="openPanZoomImage()"><i class="fal fa-search-plus"></i>Zoom</a>
                    </div>-->
                    <div id="gallery2__controls_right">
                        <a href="javascript:void(0);" id="gallery2__controls__next" onclick="galleryOpenNextItem()"></a>
                    </div>

                    <!--<div id="vote_heart_on_image" class="bx_allow_events" style="position: absolute; width: 30px; height: 30px; cursor: pointer; opacity: 0.7; z-index: 100000; display: none;" onclick="voteForFile(strCurrentFileHash)"></div>-->
                </div>
                
                
            

                <div id="gallery2__thumb-strip__hide_container">
                        <a href="javascript:void(0)" id="gallery2__thumb-strip__hide" onclick="toggleThumbs();"></a>
                </div>
                <div id="gallery2__thumb-strip">
                    <div id="gallery2__thumb-strip__buttons">
                        <a href="javascript:void(0)" id="gallery2__thumb-strip__prev" onclick="$('#gallery2__thumb-strip__inner').css({'left': parseInt($('#gallery2__thumb-strip__inner').css('left'))+216}); galleryLazyloadRecalc();"></a>
                        <a href="javascript:void(0)" id="gallery2__thumb-strip__next" onclick="$('#gallery2__thumb-strip__inner').css({'left': parseInt($('#gallery2__thumb-strip__inner').css('left'))-216}); galleryLazyloadRecalc();"></a>
                    </div>
                    <div id="gallery2__thumb-strip__inner" style="width: 0; left: 0;">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    
    var bolStartAudioOnOpen = false;    
    var bolHashtagViewUseSemicolon = false;
	
	var bolGalleryIsVisible = false;
    var bolGallerySidebarVisible = false;
    var bolGalleryCommentsVisible = false;

	var intPreloadImagesCount = 1;
	var intPreloadThumbnailsCount = 2;
	
    var strLinkToView = 'https://fv2-4.failiem.lv/f/5vwfkz7eg';
    var strGalleryCloseHashtag = '';
	
    var intCurrentFileIndex = null;
    var strCurrentFileHash = null;
    var strCurrentFileName = null;
    
    var intNextIndex = null;
    var intPreviousIndex = null;
    
    var intThumbWidth = 108;
    
    var jqThumbViewport = null;
    var jqThumbContainer = null;

    var jqMainSlider = null;
    
    var objVideoIsLoading = {};

    var resVideoCheckInterval = null;

    var bolHaveToRedrawGallery = false;
    
    
    var bolIsOwner = Boolean();
    var bolCanEdit = Boolean(); 
    var bolCanDelete = Boolean(); 
    
    var bolCloseGalleryIfHashRemoved = false;
    
    var objMainShareParams = null;
    
    var strFolderName = null;
    
    var bolIsiOSDevice = window.navigator.userAgent.match(/(iPod|iPhone|iPad)/) && window.navigator.userAgent.match(/AppleWebKit/);
    
    var bolIsListViewForSpecificFile = Boolean(1);
    
    var objEmbedPlayerFileEventCallback = {};
    
    var strActiveCommentsEntityHash = "";

    var strPublicProfileHref = '';
    if ( typeof strUploadUserNameHref != 'undefined' && strUploadUserNameHref != '' )
    {
        strPublicProfileHref =  '/' + strUploadUserNameHref;
    }
    else if ( typeof PublicProfile != 'undefined' && typeof PublicProfile.strProfileName != 'undefined' )
    {
        strPublicProfileHref = '/' + PublicProfile.strProfileName;
    }

    function browserSupportsCanvas() {
        var elem = document.createElement('canvas');
        return !!(elem.getContext && elem.getContext('2d'));
    }

    window.addEventListener('message', function(data)
    {
        if ( data.data === "info" )
        {
            showGalleryInfo();
        }
    }, false);

        objMainShareParams = {"show_type_select":false,"type":"one_file","can_share":false,"all_files":{"view_url":"https:\/\/fv2-4.failiem.lv\/f\/5vwfkz7eg","edit_url":"","upload_url":"","facebook":{"name":"https:\/\/fv2-4.failiem.lv\/f\/5vwfkz7eg","picture_url":"https:\/\/failiem.lv\/images\/failiem.lv_300.png","description":"https:\/\/fv2-4.failiem.lv\/f\/5vwfkz7eg","link":"https:\/\/fv2-4.failiem.lv\/f\/5vwfkz7eg","return_link":"https:\/\/fv2-4.failiem.lv\/f\/5vwfkz7eg?after_fb_share"},"twitter":{"text":"failiem.lv: ","link":"https:\/\/fv2-4.failiem.lv\/f\/5vwfkz7eg"},"share_email":{"upload_hash":"5xdjhkcbh","file_view_hash":"5vwfkz7eg"},"item_info":{"upload_hash":"5xdjhkcbh","item_name":"MENDIRMAN JALOLIDDIN"},"logged_in_user_is_owner":false},"one_file":{"item_info":{"file_view_hash":"5vwfkz7eg","upload_hash":"5xdjhkcbh","file_name":"MJ1_720p.mp4","item_name":"MJ1_720p.mp4","extension":"mp4"},"view_url":"https:\/\/fv2-4.failiem.lv\/f\/5vwfkz7eg","embed_player":{"file_view_hash":"5vwfkz7eg","file_extension":"mp4"}}};
    
        strFolderName = "MENDIRMAN JALOLIDDIN";
        
    var bolUseEmbedPlayer = WEBRTC_SUPPORT && (window.navigator.userAgent.indexOf("Edge") == -1);
    var viewItemIsDeleted = 0;

    var bolShowP2PDownloadButton = 'true' === 'true';
    
    var bolGalleryInitalizedState = null;
    function galleryInitalize()
    {
    	bolGalleryInitalizedState = 0;

    	if( viewItemIsDeleted )
        {
            return;
        }
    	
    	if ( bolIsListViewForSpecificFile )
        {
            $( '#gallery2' ).addClass( 'list_for_specific_file' );
        }

        $('body').append('<div id="gallery_panzoomdiv" style="overflow:hidden;height:100%;width:100%;position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 999999999; background: #666666; display: none;" height="100%" width="100%"></div>')

        $('.edit_wrapper_edit_button').click(function() {
            $(this).parent().find("textarea").focus();
        });

        $('#file_description_edit_wrapper textarea').on("keyup change", function(e) {
            autoGrow( this, '32px' );
            if ( bolIsOwner )
            {
                updateFileDescription();
            }
        });

        $('#file_name_edit_wrapper textarea').on("keyup change", function(e) {
            autoGrow( this, '32px' );
            if ( bolIsOwner )
            {
                updateFileName();
            }
        });

        $('#file_name_edit_wrapper textarea').on("focus", function(e) {

        	$('#file_name_edit_wrapper textarea').val( $('#file_name_edit_wrapper textarea').val().replace( '.' + arrExtensions[ intCurrentFileIndex ], '' ) );
        } )

        $('#file_name_edit_wrapper textarea').on("focusout", function(e) {

        	$('#file_name_edit_wrapper textarea').val( $('#file_name_edit_wrapper textarea').val() + '.' + arrExtensions[ intCurrentFileIndex ] );
        } )


        $('#file_description_edit_wrapper textarea').on("focus", function(e) {

            $( "#file_description_edit_wrapper" ).removeClass("no-description");
        } )

        $('#file_description_edit_wrapper textarea').on("focusout", function(e) {
            if ( $('#file_description_edit_wrapper textarea').val() == '' )
            {
            	$( "#file_description_edit_wrapper" ).addClass("no-description");
            }
            else
            {
            	$( "#file_description_edit_wrapper" ).removeClass("no-description");
            }
        } )

        if ( bolIsOwner )
        {
            $('#gallery2__header__setprice').show();
        }

		if ( ! bolHideShareButtons )
		{
	        $('#gallery2__share').show();
            $('#gallery2_item_info_share-wrapper').show();
		}
        
		if (arrHashes.length == 1)
		{
			hideThumbs();
		}
		
		$('#gallery_file_tags_container .file_tags_input').tagsInput(
		{
			'autocomplete_url': './ajax/file_tag.php?autocomplete&PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8' ,
			'autocomplete': { selectFirst:false, autoFill:false},
			'height' : 'auto',
			'width' : '100%',
            'interactive' : bolIsOwner || ( window.location.href.indexOf( "filebrowser" ) !== -1 && 0 ),
			'defaultText' : 'Pievieno šeit tagus',
			'onAddTag' : function(strTagName) 
			{
				$('#gallery_file_tags_container .file_tags_error').hide();
				
				$.ajax({
					type: "POST",
					dataType: "json",
					url: "./ajax/file_tag.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
					data: 
					{
						'add_file_tag': true ,
						'file_hash' : strCurrentFileHash ,
						'tag_name': strTagName
					} ,
					success: function(data)
					{
						if (data['status'] == 'ok')
						{
							var intItemIndex = getItemIndex(strCurrentFileHash);
							arrTags[intItemIndex] += ';' + strTagName;
                            $('#sidebar_file_tags_container .file_tags_input').importTags(typeof arrTags[intItemIndex] === "undefined" ? "" : arrTags[intItemIndex]); //update tags in filebrowser
						}
						else
						{
							$('#gallery_file_tags_container .file_tags_error').show();
						}
					} ,
					error: function()
					{
						$('#gallery_file_tags_container .file_tags_error').show();
					}
				});
			} ,
			'onRemoveTag' : function(strTagName)
			{
				$('#gallery_file_tags_container .file_tags_error').hide();

				$.ajax({
					type: "POST",
					dataType: "json",
					url: "./ajax/file_tag.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
					data: 
					{
						'delete_file_tag': true ,
						'file_hash' : strCurrentFileHash ,
						'tag_name': strTagName
					} ,
					success: function(data)
					{
						if (data['status'] == 'ok')
						{
							var intItemIndex = getItemIndex(strCurrentFileHash);
							arrTags[intItemIndex] = arrTags[intItemIndex].replace(strTagName, '');
                            $('#sidebar_file_tags_container .file_tags_input').importTags(typeof arrTags[intItemIndex] === "undefined" ? "" : arrTags[intItemIndex]); //update tags in filebrowser
						}
						else
						{
							$('#gallery_file_tags_container .file_tags_error').show();
						}
					} ,
					error: function()
					{
						$('#gallery_file_tags_container .file_tags_error').show();
					}
				});
			} ,
            'onSearchTag' : function(strTagName)
            {
                if ( typeof strUploadUserNameHref != 'undefined' && strUploadUserNameHref != '' )
                {
                    window.open('/' + strUploadUserNameHref + '#search='+  strTagName, '_self');
                }
                else if ( typeof PublicProfile != 'undefined' && typeof PublicProfile.strProfileName != 'undefined' )
                {
                    window.open('/' + PublicProfile.strProfileName + '#search='+  strTagName, '_self');
                }
            } ,
			'delimiter' : [';'] ,
			'removeWithBackspace' : false ,
			'minChars' : 1 ,
			'maxChars' : 245 ,
			'placeholderColor' : '#666666'
		});


        $('#gallery_file_tags_container .file_tags_input')

        if (( typeof strUploadUserNameHref != 'undefined' && strUploadUserNameHref != '' ) ||
            ( typeof PublicProfile != 'undefined' && typeof PublicProfile.strProfileName != 'undefined' ))
        {
            $('#gallery_file_tags_container .tagsinput').addClass('searchable');
        }
        else
        {
            $('#gallery_file_tags_container .tagsinput').removeClass('searchable');
        }

		function getFileShareParams()
        {
            if ( objMainShareParams )
            {
                var intItemIndex = getItemIndex( strCurrentFileHash );
    
                var objFileShareParams = {};
                for ( idx in objMainShareParams )
                {
                    objFileShareParams[ idx ] = objMainShareParams[ idx ];
                }
    
                if ( typeof( arrFileShareLinks ) != 'undefined' && typeof( arrFileShareLinks[ intItemIndex ] ) != 'undefined' )
                {
                    objFileShareParams[ 'view_url' ] = 'https://fv2-4.failiem.lv' + arrFileShareLinks[ intItemIndex ];
                }
                else
                {
                    objFileShareParams[ 'view_url' ] += '#/view/' + arrHashes[ intItemIndex ];
                }
    
                objFileShareParams[ 'can_share' ] = bolIsOwner;
                
                objFileShareParams[ 'show_type_select' ] = false;
                objFileShareParams[ 'type' ] = 'one_file';
                
                var strFileShareParams_PictureUrl = '';
                if ( arrFileTypes[ intItemIndex ] == 'image' )
                {
                    strFileShareParams_PictureUrl = 'https://fv2-4.failiem.lv/thumb_show.php?i=' + arrHashes[ intItemIndex ] + '&view';
                }
    
                var strFileViewLink = 'https://fv2-4.failiem.lv/f/' + strCurrentFileHash;

                var strFileEditLink = '';
                
                if ( bolCanDelete && typeof arrFileDeleteKeys != 'undefined' && arrFileDeleteKeys[ intItemIndex ] != '' )
                {
                	strFileEditLink = strFileViewLink + '?fk=' + arrFileDeleteKeys[ intItemIndex ];
                }
    
                objFileShareParams[ 'one_file' ] = {
                    'view_url': strFileViewLink,
                    'edit_url': strFileEditLink,
                    'facebook': {
                        'name': strFileViewLink,
                        'picture_url': strFileShareParams_PictureUrl,
                        'description': strFileViewLink,
                        'link': strFileViewLink,
                        'return_link': objFileShareParams[ 'all_files' ][ 'facebook' ][ 'return_link' ]
                    },
                    'twitter': {
                        'text': DOMAIN_NAME + ': ',
                        'link': strFileViewLink
                    },
                    'share_email': {
                        'upload_hash': '',
                        'file_view_hash': strCurrentFileHash
                    },
                    'embed_player': {
                        'file_view_hash': null
                    },
                    'item_info': {
                    	'file_view_hash': strCurrentFileHash,
                    	'upload_hash': objFileShareParams[ 'all_files' ][ 'share_email' ][ 'upload_hash' ],
                    	'file_name': arrDisplayNames[ intItemIndex ],
                        'item_name': arrDisplayNames[ intItemIndex ],
                        'extension': arrExtensions[ intItemIndex ],
                        'owner_logged_in': bolIsOwner,
                        'access_type': ( typeof arrFileAccessTypes != 'undefined' ? arrFileAccessTypes[ intItemIndex ] : '' ),
                        'parent_access_type': arrAccessType[ intItemIndex ]
                    }
                };
    
                if (
                        typeof( bolIsAnonymousUpload ) == 'boolean' && 
                        bolIsAnonymousUpload && 
                        arrFeeDownloadPrice[ intItemIndex ] == null && 
                        arrAllowDownload[ intItemIndex ] && 
                        ( arrAccessType[ intItemIndex ] == 'LINK' || arrAccessType[ intItemIndex ] == 'PUBLIC' ) && 
                        arrUploadPassword[ intItemIndex ] == '' && 
                        arrAllowPublicDownload[ intItemIndex ]
                    )
                {
                    objFileShareParams[ 'one_file' ][ 'embed_player' ] = {
                        'file_view_hash': strCurrentFileHash,
                        'file_extension': arrExtensions[ intItemIndex ],
                        'is_video': arrIsVideo[ intItemIndex ]
                    }
                }
    
                return objFileShareParams;
            }
            
            return null;
        }
        
        window.galleryGetFileShareParams = getFileShareParams;
    
        $( document ).on( 'click', '#gallery2__share', function ( e )
        {
            var objFileShareParams = getFileShareParams();
            if ( objFileShareParams !== null )
            {
                showSharePopup( e, objFileShareParams );
            }
        } );

        $( document ).on( 'click', '#gallery2_upload_button__share_with_users', function ( e )
        {
            var objFileShareParams = getFileShareParams();
            if ( objFileShareParams !== null )
            {
                showSharePopup( e, objFileShareParams );
            }
        } );

        $( document ).on( 'click', '#gallery2__sign, #gallery2__left_info-button_sign', function ( e )
        {
        	if ( bolCanEdit )
        	{
	        	objEparakstsFileSigningForm.showForm( [ strCurrentFileHash ] );
        	}
	        else 
	        {
	        	fError( 'Šī atvērtā saite der tikai dokumenta apskatei. Lai parakstītu, lūdzu, jautā failu īpašniekam atsūtīt faila rediģēšanas saiti - no e-parakstīšanas formas.', 'Brīdinājums!' );
	        }
        } );

        $( document ).on( 'click', '.gallery2__edit', function ( e )
        {
        	window.open( '/edit/' + strCurrentFileHash, '_blank' );
        } );

                    $( document ).on( 'click', '.gallery2__button__buy-products', function ( e )
            {
                window.open( '/c/' + strUploadHash + '?h=' + strCurrentFileHash, '_blank' );
            } );
            $( document ).on( 'click', '.print_or_buy_popup__products', function ( e )
            {
                window.open( '/c/' + strUploadHash + '?h=' + strCurrentFileHash, '_blank' );
            } );
        
        $( document ).on( 'contextmenu', 'video', function ( e )
        {
        	e.preventDefault();
        } );
        
    
        $( document ).on( 'click', '#gallery2__sidebar__info_embed_button', function ( e )
        {
            var objFileShareParams = getFileShareParams();
            
            if ( objFileShareParams !== null )
            {
                window.FileEmbedPopup.showPopup( e, objFileShareParams );
            }
        } );
    
    
        $(window).resize(function() {

			if (!bolGalleryIsVisible)
			{
				bolHaveToRedrawGallery = true;
			}
			else
			{
    	    	recalculateGalleryForBanner(true);
			}
		});

		/*** Check video network state, if loading longer than 1+1 intervals, show thumbnail generation message ***/
		var bolHasVideo = false;
		for ( idx in arrFileTypes)
		{
			if ( arrFileTypes[idx] == 'video' )
			{
				bolHasVideo = true;
			}
		}

		if (bolHasVideo)
		{
			if ( resVideoCheckInterval != null)
			{
				clearInterval(resVideoCheckInterval);
				resVideoCheckInterval = null;
			}
			
			resVideoCheckInterval = setInterval(function () {
				for ( idx in arrFileTypes)
				{
					if ( arrFileTypes[idx] == 'video' )
					{
						var domVideo = document.getElementById('video_' + arrHashes[idx]);
                        
						if ( domVideo )
						{
						    // iOS safari workaround - "play" gets fired when the play button is clicked => set video as loading
                            if(bolIsiOSDevice)
                            {
                                domVideo.addEventListener('play', function ()
                                {
                                    objVideoIsLoading[idx] = true;
                                });
                            }
                            
							var bolIsLoading = bolIsiOSDevice ? objVideoIsLoading[idx] : false;
                                    // iOS safari workaround: video has stopped loading when its duration attribute is > 0
                                    if (domVideo.duration > 0 && bolIsiOSDevice) 
                                    {
                                        bolIsLoading = false;
                                    }
                                    // If network connection active (2=NETWORK_LOADING) - this is broken in iOS safari
                                    else if (domVideo.networkState == 2)	
									{
										bolIsLoading = true;
									}									

							if ( bolIsLoading )
							{
								if (objVideoIsLoading[idx] == true)
								{
									$('#video_thumb_gen_'+ arrHashes[idx]).css({'visibility':'visible'});
								}
								objVideoIsLoading[idx] = true;
							}
							else if ( objVideoIsLoading[idx] )
							{
								objVideoIsLoading[idx] = false;
								$('.video_thumb_gen').css({'visibility':'hidden'});
							}
						}
					}
				}
			}, 3000);
		}
		/***/

        /*** Close in item main element click ***/
        $( '#gallery2' ).on( 'bx_slider_click', '.bx-viewport', function( e, domElement ){
            if ( $(domElement).hasClass('gallery2__item') )
            {
                closeGallery(strCurrentFileHash);
            }
        });

		bolGalleryInitalizedState = 1;
    }
    
    $(function (){
    	if ( bolGalleryInitalizedState === null )
    	{
    		galleryInitalize();
		}
	});

    $(document).on( "fullscreenchange", function () {
        adjustContentWidth( true );
    } );
    
	$(document).on("keydown", function(evt) {
        if (evt.altKey || evt.ctrlKey || evt.metaKey || $(evt.target).is(":input"))
        { 
            return; 
        }
        
        if ( ! bolGalleryIsVisible )
        {
        	return;	
		}
		
		if( 1)
        {
            return;
        }
        
        var key = evt.keyCode;
    
        if (key == 37 )
        {
            galleryOpenPrevItem();
        }
        else if (key == 39)
        {
        	galleryOpenNextItem();
		}
        else if (key == 27)
        {
        	closeGallery(strCurrentFileHash);
        }
    });
    
    function autoGrow( element, strMinHeight )
    {
        if( typeof strMinHeight === "undefined" )
        {
            strMinHeight = '32px';
        }
        
        element.style.height = strMinHeight;
        element.style.height = element.scrollHeight + "px";
        element.style.height = element.scrollHeight + 5 + "px";
    }
	
    function galleryCalculateOffset(el) {
	    var rect = el.getBoundingClientRect(),
	    scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,
	    scrollTop = window.pageYOffset || document.documentElement.scrollTop;
	    return { top: rect.top + scrollTop, left: rect.left + scrollLeft }
	}
    
	window.getImageCountText = function() {
        return ( parseInt( intCurrentFileIndex ) + 1 ) + ' / ' + arrIDs.length;
    };

    function checkThumbStripArrows()
    {
        var jqThumbStrip = $('#gallery2__thumb-strip');
        var jqThumbStripInner = $('#gallery2__thumb-strip__inner');

        var intThumbWidthSum = 0;
        $('A', jqThumbStripInner).each(function (){
            intThumbWidthSum += $(this).width();
        });

        var bolShowThumbStripArrows = false;
        if (
            parseInt( jqThumbStripInner.css('left') ) + parseInt( jqThumbStripInner.css('margin-right') ) < 0
            || jqThumbStrip.width() - ( parseInt( jqThumbStripInner.css('left') ) + parseInt( jqThumbStripInner.css('margin-right') ) ) <= intThumbWidthSum
        )
        {
            bolShowThumbStripArrows = true;
        }

        if ( ! bolShowThumbStripArrows )
        {
            $('#gallery2__thumb-strip__buttons').hide();
        }
        else
        {
            $('#gallery2__thumb-strip__buttons').show();
        }
    }

    var bolHideShareButtons = false;
	var bolGalleryIsShowingItem = false;
    var clickedItemHash = null;
    function showGalleryItem( strHash )
    {
    	if (arrHashes.length == 1)
		{
    		hideThumbs();
		}

		
        clickedItemHash = strHash;
		if ( bolGalleryIsShowingItem )
		{
			return;
		}
		bolGalleryIsShowingItem = true;

        var bolP2PDownloadAllowed = false;
        var bolSimpleDownloadAllowed = false;

    	strCurrentFileHash = strHash;

        intCurrentFileIndex = getItemIndex ( strHash );
        strCurrentFileName = arrDisplayNames[intCurrentFileIndex];

        preloadImage ( intCurrentFileIndex );

		if ( ! bolGalleryIsVisible )
		{
			showGallery();
		}

		stopActiveContent();


		checkBeforeContentChange ();

        jqMainSlider.goToSlide( intCurrentFileIndex );
        checkAfterContentChange();
        // checkGalleryArrows();

        if ($('#share_popup').is(":visible"))
        {
            hideSharePopup();
        }

        if ( typeof window.FileEmbedPopup !== 'undefined' )
        {
            window.FileEmbedPopup.hidePopup();
        }

        if ( arrFileTypes[intCurrentFileIndex] == 'image' && arrFeeDownloadPrice[intCurrentFileIndex] == null)
        {
            $('#gallery2__header__view-original').show();
            $('#gallery2__header__view-original-small').css( 'visibility', 'visible' );
        }
        else
        {
            $('#gallery2__header__view-original').hide();
            $('#gallery2__header__view-original-small').css( 'visibility', 'hidden' );
        }

        $('.gallery2__header__img-count').text( window.getImageCountText() );


		if (arrAllowDownload[intCurrentFileIndex] && ( typeof(bolHideDownloadButtons) === 'undefined' || ! bolHideDownloadButtons ) && ( typeof(arrHideDownloadButtons) === 'undefined' || ! arrHideDownloadButtons[intCurrentFileIndex] ))
		{
            bolSimpleDownloadAllowed = true;
			$('.gallery2__save_button').show();
			$('#gallery2__sidebar__info_embed_button').show();
			$('#gallery2__share').show();
			$('#gallery2_item_info_share-wrapper').show();
		}
		else
		{
            bolSimpleDownloadAllowed = false;
			$('.gallery2__save_button').hide();
			$('#gallery2__sidebar__info_embed_button').hide();
			$('#gallery2__share').hide();
            $('#gallery2_item_info_share-wrapper').hide();
		}


        if ( bolIsOwner )
        {
            $('#gallery2__item_info_delete').show();
        }
        else
        {
            $('#gallery2__item_info_delete').hide();
        }


        $( '#gallery2__left_info__signers-list-container' ).hide();

        
        if (
            	bolCanEdit 
            	&& 
            	( 
                	typeof arrFileIsLockedByOtherUser == 'undefined' 
                	|| ! arrFileIsLockedByOtherUser[ intCurrentFileIndex ]
            	) 
        	)
        {
            $( '#gallery2__left_info-button_sign' ).show();

            if (
				arrExtensions[intCurrentFileIndex] == 'edoc'
				|| arrExtensions[intCurrentFileIndex] == 'pdf'
				|| arrExtensions[intCurrentFileIndex] == 'doc'
				|| arrExtensions[intCurrentFileIndex] == 'docx'
			)
		    {
                $('#gallery2__sign').css('display', 'inline-flex');
            }
            else
            {
                $('#gallery2__sign').hide();
            }
        }
        else
        {
            $( '#gallery2__left_info-button_sign' ).hide();
            $( '#gallery2__sign' ).hide();
        }

                
        


        if ( bolCanEdit )
        {
            if ( canOpenFileInEditor( 'edit', arrExtensions[ intCurrentFileIndex ] ) )
            {
                $( '#gallery2__edit_button span' ).text( 'Rediģēt' );
	            $( '.gallery2__edit' ).show();
            }
            else if ( canOpenFileInEditor( 'view', arrExtensions[ intCurrentFileIndex ] ) )
            {
                $( '#gallery2__edit_button span' ).text( 'Skatīt' );
	            $( '.gallery2__edit' ).show();
            }
            else 
            {
                $( '.gallery2__edit' ).hide();
            }
        }
        else
        {
            $( '.gallery2__edit' ).hide();
        }
        
        
        $( '.gallery2__button__buy-products' ).hide();
		        if ( arrFileHasProductSelling[ intCurrentFileIndex ] == 1 )
        {
            $( '.gallery2__button__buy-products' ).show();
        }
                

        /*
		if ( typeof(bolHideDownloadButtons) !== 'undefined' && bolHideDownloadButtons ||  ( typeof(arrHideDownloadButtons) !== 'undefined' && arrHideDownloadButtons[intCurrentFileIndex] ) )
        {
            $('.gallery2__save_button').addClass('hidden');
            $('.gallery2__p2p_save_button').addClass('hidden');
        }

		if ( arrDownloads[ intCurrentFileIndex ] < 20 )
        {
            $('.gallery2__p2p_save_button').addClass('hidden');
        }
		else
        {
            $('.gallery2__p2p_save_button').removeClass('hidden');
        }
        */

        if( !bolIsOwner && window.location.href.indexOf("filebrowser") === -1 && typeof arrReports != 'undefined' && typeof arrStatuses != 'undefined' && ! [3, 4].includes(arrStatuses[ intCurrentFileIndex ]) &&
            ( 
                typeof arrFileIsLockedByOtherUser == 'undefined' 
                || ! arrFileIsLockedByOtherUser[ intCurrentFileIndex ]
            )
        ) 
        {
            $( '#gallery2__report_button' ).show();
    
            if (arrReports[ intCurrentFileIndex ] == 0)
            {
                $( '#gallery2__report_button' ).click(function() {
                    showFileReportModal(this, strCurrentFileHash);
                });
            }
            else 
            {
                $( '#gallery2__report_button' ).click(function() {
                    showCancelFileReportModal(this, strCurrentFileHash);
                });
            }
            
        }
        else
        {
            $( '#gallery2__report_button' ).hide();
        }

        if (
                arrFileTypes[ intCurrentFileIndex ] === 'document'
                && 
                (
                    arrExtensions[ intCurrentFileIndex ] === 'pdf' 
                    || arrExtensions[ intCurrentFileIndex ] === 'odt' 
                    || arrExtensions[ intCurrentFileIndex ] === 'ods' 
                    || arrExtensions[ intCurrentFileIndex ] === 'odp'  
                    || isFileConvertable( 'pdf', intCurrentFileIndex )
                ) 
                && arrFeeDownloadPrice[ intCurrentFileIndex ] == null 
                && arrAllowDownload[ intCurrentFileIndex ] 
            )
        {
            $( "#gallery2__controls_left" ).css( {
                'margin-top': '32px',
                'height': 'calc(100% - 50px)'
            } );
            
            $( "#gallery2__controls_right" ).css( {
                'right': '15px',
                'margin-top': '32px',    
                'height': 'calc(100% - 50px)'
            } );
            
            if( window.location.pathname.substr(0,3) !== "/f/" )
            {
                $("#gallery2__header__info").hide();
            }
        }
        else
        {
            $( "#gallery2__controls_right" ).css( {
                'right': '0',
                'margin-top': '32px',
                'height': 'calc(100% - 50px)'
                
            } );
    
            $( "#gallery2__controls_left" ).css( {
                'margin-top': '32px',
                'height': 'calc(100% - 50px)'
            } );
    
            if( window.location.pathname.substr(0,3) !== "/f/" )
            {
                $("#gallery2__header__info").show();
            }
        }

        if ( arrFileTypes[ intCurrentFileIndex ] !== 'image' )
        {
            $('#gallery2__controls_middle').removeClass('image');
            $('#gallery2__controls_zoom').css('display', 'none');
            $('#gallery_vote_header').show();
            $('#gallery2__content-wrapper').removeClass( 'gallery__only_image' );
            $('#gallery2__content-wrapper').removeClass( 'gallery__is_image' );
        }
        else
        {
            $('#gallery2__controls_middle').addClass('image');
            $('#gallery2__controls_zoom').css('display', 'block');
            $('#gallery_vote_header').hide();
            $('#gallery2__content-wrapper').addClass( 'gallery__is_image' );
        }
        
        if ( arrFileTypes[ intCurrentFileIndex ] !== 'audio' )
        {
            $('#gallery2__header__fullscreen').show();
        }
        else
        {
            $('#gallery2__header__fullscreen').hide();
        }

		if (
		    bolShowP2PDownloadButton
            && ( typeof(objWebTorrentDownloadForm) === 'object' || ! bolIsListViewForSpecificFile )
            && arrFeeDownloadPrice[ intCurrentFileIndex ] == null
            && arrAllowDownload[ intCurrentFileIndex ]
            && ( arrAccessType[ intCurrentFileIndex ] == 'LINK' || arrAccessType[ intCurrentFileIndex ] == 'PUBLIC' )
            && arrUploadPassword[ intCurrentFileIndex ] == ''
            && arrAllowPublicDownload[ intCurrentFileIndex ]
        )
        {
            bolP2PDownloadAllowed = true;
            $('.gallery2__p2p_save_button').css({display: 'inline-flex'});
            $('.gallery2__video_filename-download .gallery2__save_button').hide();
        }
        else
        {
            bolP2PDownloadAllowed = false;
            $('.gallery2__p2p_save_button').hide();
            $('.gallery2__video_filename-download .gallery2__save_button').show();
        }
        
        
        if (bolIsOwner)
        {
            $("#gallery2__buyfile").attr("onclick", "showSetPriceFormModal(strCurrentFileHash)");
            $(".print_or_buy_popup__buyfile").attr("onclick", "showSetPriceFormModal(strCurrentFileHash)");
        }
        else 
        {
            $("#gallery2__buyfile").attr("onclick", "showBuyFileFormModal(strCurrentFileHash)");
            $(".print_or_buy_popup__buyfile").attr("onclick", "showBuyFileFormModal(strCurrentFileHash)");
        }

		// spec for public profile -> fee file count can be dynamic, assume it is > 0
        
		if (arrFeeDownloadPrice[intCurrentFileIndex] == null)
		{
			$('.gallery2__buy_button').hide();
			$('.gallery2__save_button').show();

            if ( typeof bolHideDownloadButtons != 'undefined' && bolHideDownloadButtons )
            {
                $( '.gallery2__save_button' ).hide();
            }

            if (bolIsOwner)
            {
                $('#gallery2__buyfile span.text').html('Pārdot failu');
                $('#gallery2__buyfile span.price').html('');
                $('#gallery2__buyfile').hide(); //hide, if there's no price
                $( '#gallery2__header__mid .seperator' ).hide();
                $('.print_or_buy_popup__buyfile span.text').html('Pārdot failu');
                $('.print_or_buy_popup__buyfile span.price').html('');
                $('.print_or_buy_popup__buyfile').hide(); //hide, if there's no price
            }
            else 
            {
                $('#gallery2__buyfile').hide();
                $( '#gallery2__header__mid .seperator' ).hide();
                $('.print_or_buy_popup__buyfile').hide();
            }
		}
		else 
		{
			$('.gallery2__buy_button').css( 'display', 'inline-flex' );
            $('.gallery2__save_button').hide();
            if (bolIsOwner)
            {
                $('#gallery2__buyfile').show();
                $( '#gallery2__header__mid .seperator' ).css('display', '');
                $('#gallery2__buyfile span.text').html('Pārdot failu');
                $('#gallery2__buyfile span.price').html(' (' + arrFeeDownloadPrice[ intCurrentFileIndex ] + ' &euro;)');
                $('.print_or_buy_popup__buyfile').show();
                $('.print_or_buy_popup__buyfile span.text').html('Pārdot failu');
                $('.print_or_buy_popup__buyfile span.price').html(' (' + arrFeeDownloadPrice[ intCurrentFileIndex ] + ' &euro;)');
            }
            else 
            {
                $('#gallery2__buyfile').hide();
                $( '#gallery2__header__mid .seperator' ).hide();
                $('.print_or_buy_popup__buyfile').hide();
            }
		}
		
		if (
				(arrExtensions[intCurrentFileIndex] == 'png' || arrExtensions[intCurrentFileIndex] == 'jpg' || arrExtensions[intCurrentFileIndex] == 'jpge')
				&& arrFeeDownloadPrice[intCurrentFileIndex] == null
				&& bolSimpleDownloadAllowed
			)
		{
			$('#gallery2__item_info_order').show();
			$('#gallery2__order').css({display: 'inline-flex'});
            
                        if ( arrFileHasProductSelling[ intCurrentFileIndex ] == 1 )
            {
                $('#gallery2__order').hide();
                $('#gallery2__item_info_order').hide();
            }
            		}
		else
		{
			$('#gallery2__item_info_order').hide();
			$('#gallery2__order').hide();
		}

		if (intCurrentFileIndex == 0)
		{
			$('#gallery2__controls_left').hide();
		}
		else 
		{
			$('#gallery2__controls_left').show();
		}

		if (intCurrentFileIndex == arrIDs.length - 1)
		{
			$('#gallery2__controls_right').hide();
		}
		else 
		{
			$('#gallery2__controls_right').show();
		}


		// Hide share button for audio player on mobile
		if (
				arrFileTypes[ intCurrentFileIndex ] == 'audio'
				&&
				( 
					arrAllowDownload[ intCurrentFileIndex ]
					|| false					|| arrFileAttributes[ intCurrentFileIndex ].readOnly
					|| arrFileAttributes[ intCurrentFileIndex ].hasPreviewVideo
				)
				&& typeof objAudioPlayer !== "undefined"
				&& objAudioPlayer !== null
				&& objAudioPlayer._isMobileView
			)
		{
			bolHideShareButtons = true;
			$( '#gallery2__share' ).hide()
			$( '#gallery2__sidebar__info_embed_button' ).hide()
            $('#gallery2_item_info_share-wrapper').hide();
		}
		else
		{
						bolHideShareButtons = false;
			$( '#gallery2__share' ).show();
            $('#gallery2_item_info_share-wrapper').show();
			$( '#item_info_share' ).show();
			$( '#gallery2__sidebar__info_embed_button' ).css( 'display', 'inline-flex' );

            var strAccessType = '';

            if (typeof strAccessType != 'undefined')
            {
                strAccessType = arrAccessType[ intCurrentFileIndex ];
            }
            else 
            {
                strAccessType = 'LINK';
            }

            if(strAccessType != '') 
            {
                if (bolIsOwner)
                {
                    $( '#gallery_upload-access-switch' ).show();
                    var intItemIndex = getItemIndex( strCurrentFileHash );
                    var strFileAccessType = ( typeof arrFileAccessTypes != 'undefined' ? arrFileAccessTypes[ intItemIndex ] : '' )
                    var strUploadAccessType = ( typeof arrAccessType != 'undefined' ? arrAccessType[ intItemIndex ] : '' )
                    
                    if ( strFileAccessType == '' || strFileAccessType == null )
                    {
                        strFileAccessType = strUploadAccessType;
                    }
                  
                    if ( strFileAccessType == 'PRIVATE' && strUploadAccessType == 'LINK' )
                    {
                        strFileAccessType = 'LINK';
                    }

                    var objGalleryUploadAccessSwitch = new UploadAccessSwitch(
                        $( '#gallery_upload-access-switch' ) ,
                        {
                            item_type : 'file' ,
                            file_hash : strCurrentFileHash ,
                            owner_logged_in : bolIsOwner ,
                            access_type : strFileAccessType ,
                            parent_access_type : strUploadAccessType,
                            upload_access_switch_type : 'modal_gallery'
                        }
                    );
                }
                else 
                {
                    $( '#gallery_upload-access-switch' ).hide();
                    if ( strAccessType == 'PRIVATE' )
                    {
                        $( '#gallery2_item_info_share-wrapper' ).hide();
                    }
                    else
                    {
                        $( '#gallery2_item_info_share-wrapper' ).show();
                    }
                }
            }
            else 
            {
                $( '#gallery_upload-access-switch' ).hide();
                if ( strAccessType == 'PRIVATE' )
                {
                    $( '#gallery2_item_info_share-wrapper' ).hide();
                }
                else
                {
                    $( '#gallery2_item_info_share-wrapper' ).show();
                }
            }

            
            $( document ).on( 'change', '#gallery2_file_info .upload-access-switch_type-select', function()
            {
                var strAccessSwitchType = $( this ).val();

                
                if ( strAccessSwitchType == 'link-can-view' )
                {
                    updateSharePopupLink( 1 );
                }
                else if ( strAccessSwitchType == 'link-can-edit' )
                {
                    updateSharePopupLink( 2 );
                }
                else if ( strAccessSwitchType == 'link-can-upload' )
                {
                    updateSharePopupLink( 3 );
                }
            } );

            function updateSharePopupLink(intSelected)
            {
                
                var objFileShareParams = galleryGetFileShareParams();

                if ( intSelected == 2 && objFileShareParams[ 'one_file' ][ 'edit_url' ] != '' )
                {
                    $( '#gallery_share_popup_url' ).val( objFileShareParams[ 'one_file' ][ 'edit_url' ] );
                    $( '#gallery_share_popup_url' ).attr( 'data-clipboard-text', objFileShareParams[ 'one_file' ][ 'edit_url' ] );
                }
                else if( intSelected == 3 && objFileShareParams[ 'one_file' ][ 'upload_url' ] )
                {
                    $( '#gallery_share_popup_url' ).val( objFileShareParams[ 'one_file' ][ 'upload_url' ] );
                    $( '#gallery_share_popup_url' ).attr( 'data-clipboard-text', objFileShareParams[ 'one_file' ][ 'upload_url' ] );
                }
                else
                {
                    $( '#gallery_share_popup_url' ).val( objFileShareParams[ 'one_file' ][ 'view_url' ] );
                    $( '#gallery_share_popup_url' ).attr( 'data-clipboard-text', objFileShareParams[ 'one_file' ][ 'view_url' ] );
                }
            }

					}
		

        checkThumbStripArrows();

		// $('#gallery2__header__comments_count').text(arrCommentCounts[intCurrentFileIndex]);
		
        galleryUpdateVoteCount();
        galleryLoadFileInfo();
        $( '#gallery2__comments-list__loadmore' ).remove();
        galleryLoadFileComments();

        setTimeout('gallerySelectThumb('+ intCurrentFileIndex +')', 100);
                 
        var bolLogViews = 1;

        // bolOwnerIsStorageSubscriber - comes from public.php, this overrides bolLogViews
        if( typeof bolOwnerIsStorageSubscriber !== 'undefined' ) {
            bolLogViews |= bolOwnerIsStorageSubscriber;
        }
        
        var bolLogFileView = true;

        /*
        // Don't log view event for video, audio files. Player will log it on its own.
        if ( arrFileTypes[ intCurrentFileIndex ] == 'video' || arrFileTypes[ intCurrentFileIndex ] == 'audio' )
        {
            bolLogFileView = false;
        }
        */
        
        if ( bolLogFileView )
            $.post('./fileView.php', {'h': strCurrentFileHash, 'p': bolLogViews});

		/* Google Analytics */
        if ( typeof _gaq != 'undefined' )
        {
            _gaq.push( [ '_trackPageview', window.location.href ] );
        }
    
        var jqGalleryContainer = $('#gallery2');
        
        if ( bolP2PDownloadAllowed )
        {
            jqGalleryContainer.addClass( 'p2p_download_allowed' );
        }
        else
        {
            jqGalleryContainer.removeClass( 'p2p_download_allowed' );
        }
    
        if ( bolSimpleDownloadAllowed )
        {
            jqGalleryContainer.addClass( 'simple_download_allowed' );
        }
        else
        {
            jqGalleryContainer.removeClass( 'simple_download_allowed' );
        }
        
		bolGalleryIsShowingItem = false;
        if( bolStartAudioOnOpen )
        {
            $( "#audio_" + strCurrentFileHash ).trigger( 'play' );
            bolStartAudioOnOpen = false;
        }

        //repositionHeartButton();


        /*** Build main download button ***/
        var intItemIndex = getItemIndexByHashOrName( strCurrentFileHash );
        var bolSimpleDownloadAllowed = false;
        var bolP2PDownloadAllowed = false;
        if  (   arrFeeDownloadPrice[ intItemIndex ]==null && 
                arrAllowDownload[ intItemIndex ] && 
                ( typeof(bolHideDownloadButtons) === 'undefined' || ! bolHideDownloadButtons ) && 
                ( typeof(arrHideDownloadButtons) === 'undefined' || ! arrHideDownloadButtons[ intItemIndex ] ))
        {
            bolSimpleDownloadAllowed = true;
        }

        if (
            bolShowP2PDownloadButton
            && ( typeof(objWebTorrentDownloadForm) === 'object' || ! bolIsListViewForSpecificFile )
            && arrFeeDownloadPrice[ intItemIndex ] == null
            && arrAllowDownload[ intItemIndex ]
            && ( arrAccessType[ intItemIndex ] == 'LINK' || arrAccessType[ intItemIndex ] == 'PUBLIC' )
            && arrUploadPassword[ intItemIndex ] == ''
            && arrAllowPublicDownload[ intItemIndex ]
            && ( typeof(bolHideDownloadButtons) === 'undefined' || ! bolHideDownloadButtons ) && ( typeof(arrHideDownloadButtons) === 'undefined' || ! arrHideDownloadButtons[ intItemIndex ] )
        ) {
            bolP2PDownloadAllowed = true;
        }

        $( '#gallery-main-download-button' ).remove();
        
        if ( bolSimpleDownloadAllowed || bolP2PDownloadAllowed ) {

            var objDownloadButton = new DropdownButton ();

            if ( bolSimpleDownloadAllowed ) {
                objDownloadButton.addButton('gallery-download-simple-split-button', 'Lejuplādēt šo failu', 'Lejuplādēt', '<img src="/images/button_icons/white/download.svg?v=1" /> ', function (){
                    gaev('split-download-button-engagement', 'header-download-simple-click', 'Split button simple download click');
                    modalGalleryDownloadFileBtn( strCurrentFileHash )
                })
            }
            
            if ( bolSimpleDownloadAllowed && ! bolIsOwner && typeof objUploadCopyForm != 'undefined' && typeof strUploadHash != 'undefined' ) {
                objDownloadButton.addButton('gallery-download-myfiles-split-button', 'Saglabāt manā kontā', 'Saglabāt manā kontā', null, function (){
                    gaev('split-download-button-engagement', 'header-download-myfiles-click', 'Split button myfiles download click');
                    modalGalleryDownloadFileBtn( strCurrentFileHash, 'my-files' );
                })
            }
            if ( bolP2PDownloadAllowed ) {
                objDownloadButton.addButton('gallery-download-p2p-split-button', 'Lejuplādēt ar P2P', 'Lejuplādēt ar P2P', null, function (){
                    gaev('split-download-button-engagement', 'header-download-p2p-click', 'Split button P2P download click');
                    modalGalleryDownloadFileP2PBtn( intCurrentFileIndex );
                })
            }

            if ( isFileConvertable( 'pdf', intItemIndex ) )
            {
                objDownloadButton.addButton(
                    'gallery-download-simple-split-button' ,
                    'Lejuplādēt šo failu kā PDF' ,
                    'Lejuplādēt PDF' ,
                    '<img src="/images/button_icons/white/download.svg?v=1" /> ' ,
                    function ()
                    {
                    	gaev( 'split-download-button-engagement', 'header-download-pdf-click', 'Split button pdf download click' );
	                    modalGalleryDownloadFileBtn( strCurrentFileHash, 'pdf' )
                } );
            }
            else if ( isFileConvertable( 'mp4', intItemIndex ) )
            {
                objDownloadButton.addButton(
                    'gallery-download-simple-split-button' ,
                    'Lejuplādēt kā MP4' ,
                    'MP4' ,
                    '<img src="/images/button_icons/white/download.svg?v=1" /> ' ,
                    function ()
                    {
                    	gaev( 'split-download-button-engagement', 'header-download-mp4-click', 'Split button mp4 download click' );
	                    modalGalleryDownloadFileBtn( strCurrentFileHash, 'mp4' )
                } );
            }
            
            var jqDownloadButton = objDownloadButton.build( 'gallery-download-split-button', 'gallery-main-download-button' );

            $( '#gallery2__header__mid_content' ).prepend( jqDownloadButton );
            $( '#gallery2__header__mid .seperator' ).css('display', '');
        }

        /*********/

        // var intTotalItems = parseInt( window.getImageCountText().split( '/' )[ 1 ] );
        // if ( intCurrentFileIndex >= arrIDs.length - 2 && arrIDs.length < intTotalItems && typeof window.galleryLoadNextPage === "function" )
        // {
        //    window.galleryLoadNextPage(); 
        // }


        if ( ! objMainShareParams )
        {
            $('#gallery2__share').hide();
            $('#gallery2_item_info_share-wrapper').hide();
            $('#gallery2__sidebar__info_embed_button').hide();
        }

        $( '#gallery2_info_head .thumbnail-wrapper' ).html( '' );
        $( '#gallery2_info_head .thumbnail-wrapper' ).removeClass("two-actions");
        $( '#gallery2_info_head .thumbnail-wrapper' ).removeClass("one-action");
        var strThumbnailActions = '';
        if( bolIsOwner && arrFileTypes[intCurrentFileIndex] != 'image' )
		{
            if ( arrThumbnails[intItemIndex] )
            {
                var strThumbPath = arrThumbnails[intItemIndex];
                
                strThumbHTML = '<img src="'+strThumbPath+'"/>';

            }
            else if ( typeof( arrIconSvg ) !== 'undefined' && arrIconSvg[intItemIndex] )
            {
                strThumbHTML = '<img src="/images/file_types_v2/'+arrIconSvg[ intItemIndex ]+'" />';
            }
            else
            {
                strThumbHTML = '<img src="/images/file_types_v2/default.svg" />';
            }

            $( '#gallery2_info_head .thumbnail-wrapper' ).html( '' );
            $( '#gallery2_info_head .thumbnail-wrapper' ).append(strThumbHTML);
            $( '#gallery2_info_head .thumbnail-wrapper' ).append('<div class="thumbnail-actions"></div>');

			
    		if ( arrFileAttributes[ intItemIndex ][ 'hasCustomThumb' ] )
    		{
                strThumbnailActions = 
                    '<a href="javascript:void(0)" onclick="modalGallery_changeFileThumbnail( \'' +  arrHashes[ intItemIndex ] + '\', ' + intItemIndex + ' )">' +
                        '<div class="thumbnail-actions-edit" title="Nomainīt faila bildi"></div>' +
                    '</a>' +
                    '<a href="javascript:void(0)" onclick="modalGallery_removeFileThumbnail( \'' +  arrHashes[ intItemIndex ] + '\', ' + intItemIndex + ' )">' +
                        '<div class="thumbnail-actions-delete" title="Dzēst faila bildi"></div>' +
                    '</a>';
                    
                $( '#gallery2_info_head .thumbnail-actions' ).append(strThumbnailActions);
                $( '#gallery2_info_head .thumbnail-wrapper' ).addClass("two-actions");

    		}
    		else
    		{
                strThumbnailActions = 
                    '<a href="javascript:void(0)" onclick="modalGallery_changeFileThumbnail( \'' +  arrHashes[ intItemIndex ] + '\', ' + intItemIndex + ' )">' +
                        '<div class="thumbnail-actions-edit" title="Uzstādīt failam preview bildi"></div>' +
                    '</a>';
                    
                $( '#gallery2_info_head .thumbnail-actions' ).append(strThumbnailActions);
                $( '#gallery2_info_head .thumbnail-wrapper' ).addClass("one-action");
    		}
		}
        else 
        {
            if ( typeof( arrIconSvg ) !== 'undefined' && arrIconSvg[intItemIndex] )
            {
                strThumbHTML = '<img src="/images/file_types_v2/'+arrIconSvg[ intItemIndex ]+'" />';
            }
            else
            {
                strThumbHTML = '<img src="/images/file_types_v2/default.svg" />';
            }

            $( '#gallery2_info_head .thumbnail-wrapper' ).html( '' );
            $( '#gallery2_info_head .thumbnail-wrapper' ).append(strThumbHTML);

        }

        var strName = arrDisplayNames[intItemIndex];
		if (strName == '')
		{
			strName = arrNames[intItemIndex];
		}
        
        $( ".gallery2__header__file_name_value" ).html( strName );

        if( bolIsOwner )
        {
            $(".not_owner_show").hide();
            $(".not_owner_hide").show();
        }
        else
        {
            $(".not_owner_show").show();
            $(".not_owner_hide").hide();
        }
	}
	window.showGalleryItem = showGalleryItem;
	
	function stopActiveContent()
	{
		// Stop video
		var jqAllVideos = $("video");
		if (jqAllVideos.length>0)
		{
			jqAllVideos.each(function () {
				this.pause();
			});
		}
		// Stop audio
		var jqAllAudios = $("audio");
		if (jqAllAudios.length>0)
		{
			jqAllAudios.each(function () {
				this.pause();
			});
		}
	}
	
    function GalleryDeleteFile(strFileH, strFileName)
    {
        fConfirm( 'Vai tiešām vēlaties dzēst šo failu?</br><b>"' + strFileName + '"</b>', 'Dzēst šo failu', 'Jā, dzēst!', 'Atcelt', function(r){
            if( r == true )
            {                
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: "./ajax/delete_file.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
                    data: {
                        'delete_user_file' : true ,
                        'f'             : strFileH ,
                        'source'		: 'filebrowser'
                    },
                    success: function( data ){
                        if( data['status'] == 'ok' )
                        {
                            if(bolGalleryIsVisible && intNextIndex != null && !isNaN( intNextIndex ))
                            {
                                galleryOpenNextItem();
                            }
                            else if (intPreviousIndex != null && !isNaN( intPreviousIndex ))
                            {
                                galleryOpenPrevItem();
                            }
                            fSuccess( "Fails <b>"+ strFileName +"</b> ir izdzēsts!", "Info" );
                            location.reload();
                        }
                        else
                        {
                            if( typeof data[ 'file_read_only' ] !== 'undefined' && data[ 'file_read_only' ] ) 
                            {
                                fError( "Falu nevar izdzēst, jo tas ir koplietots!", "Info" );
                            }
                            else if ( typeof data[ 'file_is_locked' ] !== 'undefined' && data[ 'file_is_locked' ] ) 
                            {
                                fError( "Šo failu nav atļauts dzēst, jo tas ir nobloķēts.", "Info" );
                            }
                            else
                            {
                                fError( "Notikusi kļūda, fails netika izdzēsts!", "Info" );
                            }
                        }
                    }
                });
            }
        });
        return false;
    }

    function checkGalleryArrows()
    {
        if( $( window ).width() < 550 )
        {
            if( arrFileTypes[intCurrentFileIndex] == 'audio' || arrFileTypes[intCurrentFileIndex] == 'video' || arrFileTypes[intCurrentFileIndex] == 'document' )
            {
                $( '#gallery2__controls_left, #gallery2__controls_right' ).show();
                $( '#gallery2__controls_left a, #gallery2__controls_right a' ).css({
                    'top': 'initial',
                    'bottom': '0px'
                });
            }
            else
            {
                $( '#gallery2__controls_left, #gallery2__controls_right' ).hide();
            }
        }
        else
        {
            $( '#gallery2__controls_left a, #gallery2__controls_right a' ).removeAttr( 'style' );
            $( '#gallery2__controls_left, #gallery2__controls_right' ).show();
        }
    }
	
	function galleryLoadFileInfo()
	{
		if ( ! bolGallerySidebarVisible )
		{
			return;	
		}
		var intItemIndex = getItemIndex ( strCurrentFileHash );

        var strPublicProfileHref = '';
        if ( typeof strUploadUserNameHref != 'undefined' && strUploadUserNameHref != '' )
        {
            strPublicProfileHref =  '/' + strUploadUserNameHref;
        }
        else if ( typeof PublicProfile != 'undefined' && typeof PublicProfile.strProfileName != 'undefined' )
        {
            strPublicProfileHref = '/' + PublicProfile.strProfileName;
        }


        if ( typeof strUploadUserNameLink != 'undefined' )
		{
            $( '#gallery2__sidebar__info-owner-user .gallery2__sidebar__info-value' ).html( strUploadUserNameLink );
			$( '#gallery2__sidebar__info .header-owner_name' ).html( strUploadUserNameLink );
            if( typeof strUploadUserID != 'undefined' && strUploadUserID != '' && typeof strUploadUserLastProfileEditTimestamp != 'undefined')
            {
                $( '#gallery2__sidebar__info .header-owner .header-owner_image-wrapper' ).html( '<a class="header-owner_image" style="background-image: url( \'/avatars/thumb.php?i='+ strUploadUserID +'_'+ strUploadUserLastProfileEditTimestamp +'.jpg\' );"></a>' );
            }
            else 
            {
                $( '#gallery2__sidebar__info .header-owner .header-owner_image-wrapper' ).html( '<div class="header-owner_image"><img src="/images/list/unknown-owner.svg"></div>' );
            }
		}
		else if ( typeof PublicProfile != 'undefined' && typeof PublicProfile.strProfileName != 'undefined' )
		{
			$( '#gallery2__sidebar__info-owner-user .gallery2__sidebar__info-value' ).html( '<a href="/' + PublicProfile.strProfileName + '" target="_blank">' + PublicProfile.strProfileName + '</a>' );
			$( '#gallery2__sidebar__info .header-owner_name' ).html( '<a href="/' + PublicProfile.strProfileName + '" target="_blank">' + PublicProfile.strProfileName + '</a>' );
            if( typeof strUploadUserID  != 'undefined' && strUploadUserID != '' && typeof strUploadUserLastProfileEditTimestamp != 'undefined')
            {
                $( '#gallery2__sidebar__info .header-owner .header-owner_image-wrapper' ).html( '<a class="header-owner_image" style="background-image: url( \'/avatars/thumb.php?i='+ strUploadUserID +'_'+ strUploadUserLastProfileEditTimestamp +'.jpg\' );"></a>' );
            }
            else if( typeof PublicProfile.strAvatarPath  != 'undefined' && PublicProfile.strAvatarPath != '')
            {
                $( '#gallery2__sidebar__info .header-owner .header-owner_image-wrapper' ).html( '<a class="header-owner_image" style="background-image: url( \''+PublicProfile.strAvatarPath+'\' );"></a>' );
            }
            else
            {
                $( '#gallery2__sidebar__info .header-owner .header-owner_image-wrapper' ).html( '<div class="header-owner_image"><img src="/images/list/unknown-owner.svg"></div>' );
            }
		}
		else 
		{
			$( '#gallery2__sidebar__info-owner-user' ).hide();
			$( '#gallery2__sidebar__info .header-owner' ).hide();
		}	

        //$('#gallery2__sidebar__info-upload .gallery2__sidebar__info-value').html( strFolderName ); 
		$('#gallery2__sidebar__info-size .gallery2__sidebar__info-value').html(arrSizes[intItemIndex]);
        if( typeof arrDatesCreated != 'undefined')
        {
//             const DateTimeCreated = new Date(arrDatesCreated[intItemIndex]);
//             const DateCreated = DateTimeCreated.toISOString().slice(0,10);
            $('#gallery2__sidebar__info-date .gallery2__sidebar__info-value').html( arrDatesCreated[intItemIndex] );
        }
        else
        {
            $('#gallery2__sidebar__info-date .gallery2__sidebar__info-value').html( arrDates[intItemIndex] );
        }
        if( typeof arrDatesModified != 'undefined')
        {
//             const DateTimeModified = new Date(arrDatesModified[intItemIndex]);
//             const DateModified = DateTimeModified.toISOString().slice(0,10);
            $('#gallery2__sidebar__info-moddate .gallery2__sidebar__info-value').html( arrDatesModified[intItemIndex] );
        }
        else
        {
            $('#gallery2__sidebar__info-moddate .gallery2__sidebar__info-value').html( arrDates[intItemIndex] );
        }
		$('#gallery2__sidebar__info-views .gallery2__sidebar__info-value').html(arrViews[intItemIndex]);
		$('#gallery2__sidebar__info-downloads .gallery2__sidebar__info-value').html(arrDownloads[intItemIndex]);
		$('#gallery2__sidebar__info-comments .gallery2__sidebar__info-value').html(arrCommentCounts[intItemIndex]);
		
		
		$( '.gallery2__sidebar__info-metadata' ).hide();
		
		if ( typeof arrFileTitle != 'undefined' )
		{
    		$( '#gallery2__sidebar__info-metadata-title .gallery2__sidebar__info-value' ).html( arrFileTitle[ intItemIndex ] );
    		if ( arrFileTitle[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-title' ).show();
		}
		
		if ( typeof arrFileSubject != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-subject .gallery2__sidebar__info-value' ).html( arrFileSubject[ intItemIndex ] );
            if ( arrFileSubject[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-subject' ).show();
		}
		
		if ( typeof arrFileContentType != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-content_type .gallery2__sidebar__info-value' ).html( arrFileContentType[ intItemIndex ] );
            if ( arrFileContentType[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-content_type' ).show();
		}
		
		if ( typeof arrFileCategory != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-category .gallery2__sidebar__info-value' ).html('');

            if (strPublicProfileHref != '')
            {
                $( '#gallery2__sidebar__info-metadata-category .gallery2__sidebar__info-value' ).append('<a href="' + strPublicProfileHref + '#search='+  arrFileCategory[ intItemIndex ] +'" target="_self">' +  arrFileCategory[ intItemIndex ] + '</a>');
            }
            else
            {
                $( '#gallery2__sidebar__info-metadata-category .gallery2__sidebar__info-value' ).html( arrFileCategory[ intItemIndex ] );
            }
            
            if ( arrFileCategory[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-category' ).show();
		}
		
		if ( typeof arrFileCategories != 'undefined' )
		{           
            var arrCategories = arrFileCategories[ intItemIndex ].split(',')
            $( '#gallery2__sidebar__info-metadata-categories .gallery2__sidebar__info-value' ).html('');

            if (strPublicProfileHref != '')
            {
                arrCategories.forEach(function(elem, idx, array) {
                    if (idx != array.length - 1)
                    { 
                        $( '#gallery2__sidebar__info-metadata-categories .gallery2__sidebar__info-value' ).append('<a href="' + strPublicProfileHref + '#search='+ elem +'" target="_self">' + elem + ',</a> ');
                    }
                    else
                    {
                        $( '#gallery2__sidebar__info-metadata-categories .gallery2__sidebar__info-value' ).append('<a href="' + strPublicProfileHref + '#search='+ elem +'" target="_self">' + elem + '</a>');
                    }
                });
            }
            else
            {
                $( '#gallery2__sidebar__info-metadata-categories .gallery2__sidebar__info-value' ).html( arrFileCategories[ intItemIndex ] );
            }
            if ( arrFileCategories[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-categories' ).show();
		}
		
		if ( typeof arrFileKeywords != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-keywords .gallery2__sidebar__info-value' ).html( arrFileKeywords[ intItemIndex ] );
            if ( arrFileKeywords[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-keywords' ).show();
		}
		
		if ( typeof arrFileCreator != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-creator .gallery2__sidebar__info-value' ).html( arrFileCreator[ intItemIndex ] );
            if ( arrFileCreator[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-creator' ).show();
		}
		
		if ( typeof arrFilePublisher != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-publisher .gallery2__sidebar__info-value' ).html( arrFilePublisher[ intItemIndex ] );
            if ( arrFilePublisher[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-publisher' ).show();
		}
		
		if ( typeof arrFileContributor != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-contributor .gallery2__sidebar__info-value' ).html( arrFileContributor[ intItemIndex ] );
            if ( arrFileContributor[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-contributor' ).show();
		}
		
		if ( typeof arrFileCopyrights != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-copyrights .gallery2__sidebar__info-value' ).html( arrFileCopyrights[ intItemIndex ] );
            if ( arrFileCopyrights[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-copyrights' ).show();
		}
		
		if ( typeof arrFileLicenseType != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-license_type .gallery2__sidebar__info-value' ).html( arrFileLicenseType[ intItemIndex ] );
            if ( arrFileLicenseType[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-license_type' ).show();
		}
		
		if ( typeof arrFileLicenseDetails != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-license_details .gallery2__sidebar__info-value' ).html( arrFileLicenseDetails[ intItemIndex ] );
            if ( arrFileLicenseDetails[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-license_details' ).show();
		}
		
		if ( typeof arrFileLanguage != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-language .gallery2__sidebar__info-value' ).html( arrFileLanguage[ intItemIndex ] );
            if ( arrFileLanguage[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-language' ).show();
		}
		
		if ( typeof arrFileLocation != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-location .gallery2__sidebar__info-value' ).html( arrFileLocation[ intItemIndex ] );
            if ( arrFileLocation[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-location' ).show();
		}
		
		if ( typeof arrFileLocationLat != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-location_lat .gallery2__sidebar__info-value' ).html( arrFileLocationLat[ intItemIndex ] );
            if ( arrFileLocationLat[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-location_lat' ).show();
		}
		
		if ( typeof arrFileLocationLong != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-location_long .gallery2__sidebar__info-value' ).html( arrFileLocationLong[ intItemIndex ] );
            if ( arrFileLocationLong[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-location_long' ).show();
		}
		
		if ( typeof arrFileReferences != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-references .gallery2__sidebar__info-value' ).html( arrFileReferences[ intItemIndex ] );
            if ( arrFileReferences[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-references' ).show();
		}
		
		if ( typeof arrFileRelatesTo != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-relates_to .gallery2__sidebar__info-value' ).html( arrFileRelatesTo[ intItemIndex ] );
            if ( arrFileRelatesTo[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-relates_to' ).show();
		}
		
		if ( typeof arrFileFormat != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-format .gallery2__sidebar__info-value' ).html( arrFileFormat[ intItemIndex ] );
            if ( arrFileFormat[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-format' ).show();
		}
		
		if ( typeof arrFileDevice != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-device .gallery2__sidebar__info-value' ).html( arrFileDevice[ intItemIndex ] );
            if ( arrFileDevice[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-device' ).show();
		}
		
		if ( typeof arrFileDateCreated != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-date_created .gallery2__sidebar__info-value' ).html( arrFileDateCreated[ intItemIndex ] );
            if ( arrFileDateCreated[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-date_created' ).show();
		}
		
		if ( typeof arrFileSource != 'undefined' )
		{
            $( '#gallery2__sidebar__info-metadata-source .gallery2__sidebar__info-value' ).html( arrFileSource[ intItemIndex ] );
            if ( arrFileSource[ intItemIndex ] != '' ) $( '#gallery2__sidebar__info-metadata-source' ).show();
		}
		
		
        $('.gallery2_share-input').val('https://fv2-4.failiem.lv/f/' + strCurrentFileHash  );

		if ( typeof arrDatesDelete == 'undefined' || arrDatesDelete[intItemIndex] == '' )
		{
			$('#gallery2__sidebar__info-date-delete').hide();
		}
		else
		{
			$('#gallery2__sidebar__info-date-delete .gallery2__sidebar__info-value').html( ( typeof arrDatesDelete != 'undefined' ? arrDatesDelete[intItemIndex] : '' ) );
			$('#gallery2__sidebar__info-date-delete').show();
		}
		
		var strName = arrDisplayNames[intItemIndex];
		if (strName == '')
		{
			strName = arrNames[intItemIndex];
		}

		var $name = $('#gallery2__sidebar__info-name .gallery2__sidebar__info-value');
        
        $name.val( strName );
        
        if( bolIsOwner )
        {
            autoGrow( $name.get( 0 ), '32px' );
            
            $(".not_owner_show").hide();
            $(".not_owner_hide").show();
        }
        else
        {
            $(".not_owner_show").show();
            $(".not_owner_hide").hide();
            
            $( ".gallery2__sidebar__file_name_value" ).html( strName );
            $( ".gallery2__header__file_name_value" ).html( strName );
        }

                
        var $desc = $('#gallery2__sidebar__info-description .gallery2__sidebar__info-value');

        var strDescriptionForInput = arrDescriptions[ intItemIndex ].replaceAll('&#10;', String.fromCharCode(13, 10));
        var strDescriptionForHtml = arrDescriptions[ intItemIndex ].replaceAll('&#10;', '<br/>');
        
        $desc.val( strDescriptionForInput );
        var strDescription = strDescriptionForInput;
        
        if ( strDescription == '' || typeof strDescription == 'undefined' )
        {
            strDescription = '';
            $desc.html( strDescription );
        }
        else
        {
            $( ".gallery2__sidebar__file_description_value" ).html( strDescription );
        }
        
        if( bolIsOwner )
        {
            autoGrow( $desc.get( 0 ), '32px' );
            
            $(".not_owner_show").hide();
            $(".not_owner_hide").show();

            if ( strDescription == '' )
            {
            	$( "#file_description_edit_wrapper" ).addClass("no-description");
            }
            else
            {
            	$( "#file_description_edit_wrapper" ).removeClass("no-description");
            }
        }
        else
        {
            
            $("#file_description_edit_wrapper").click(function () {
                if( window.location.href.indexOf("filebrowser") === -1 )
                {
                    showSignIn();
                }
            });
            
            $( ".gallery2__sidebar__file_description_value" ).html( strDescriptionForHtml );

            if ( strDescription == '' )
            {
            	$( "#gallery2__sidebar__info-description" ).hide();
            	$( ".gallery2__sidebar__file_description_value" ).css('padding-bottom', '');
            }
            else
            {
            	$( "#gallery2__sidebar__info-description" ).show();
            	$( ".gallery2__sidebar__file_description_value" ).css('padding-bottom', '5px');
            }

            $(".not_owner_show").show();
            $(".not_owner_hide").hide();
        }
        
		
		if(window.location.href.indexOf( "filebrowser" ) !== -1 ) //regenerate tagsInput in filebrowser
        {   //user can browse folders without reloading filebrowser, recheck if user owns file has to be done for each file
            $('#gallery_file_tags_container .file_tags_input').html('');
            $('#gallery_file_tags_container .file_tags_input').removeAttr('data-tagsinput-init');
            $('#gallery_file_tags_container .file_tags_input').removeAttr('id');
            $('#gallery_file_tags_container .tagsinput').remove();

            $('#gallery_file_tags_container .file_tags_input').tagsInput(
            {
                'autocomplete_url': './ajax/file_tag.php?autocomplete&PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8' ,
                'autocomplete': { selectFirst:false, autoFill:false},
                'height' : 'auto',
                'width' : '100%',
                'interactive' : bolIsOwner || ( window.location.href.indexOf( "filebrowser" ) !== -1 && 0 ),
                'defaultText' : 'Pievieno šeit tagus',
                'onAddTag' : function(strTagName) 
                {
                    $('#gallery_file_tags_container .file_tags_error').hide();
                    
                    $.ajax({
                        type: "POST",
                        dataType: "json",
                        url: "./ajax/file_tag.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
                        data: 
                        {
                            'add_file_tag': true ,
                            'file_hash' : strCurrentFileHash ,
                            'tag_name': strTagName
                        } ,
                        success: function(data)
                        {
                            if (data['status'] == 'ok')
                            {
                                var intItemIndex = getItemIndex(strCurrentFileHash);
                                arrTags[intItemIndex] += ';' + strTagName;
                                $('#sidebar_file_tags_container .file_tags_input').importTags(typeof arrTags[intItemIndex] === "undefined" ? "" : arrTags[intItemIndex]); //update tags in filebrowser
                            }
                            else
                            {
                                $('#gallery_file_tags_container .file_tags_error').show();
                            }
                        } ,
                        error: function()
                        {
                            $('#gallery_file_tags_container .file_tags_error').show();
                        }
                    });
                } ,
                'onRemoveTag' : function(strTagName)
                {
                    $('#gallery_file_tags_container .file_tags_error').hide();

                    $.ajax({
                        type: "POST",
                        dataType: "json",
                        url: "./ajax/file_tag.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
                        data: 
                        {
                            'delete_file_tag': true ,
                            'file_hash' : strCurrentFileHash ,
                            'tag_name': strTagName
                        } ,
                        success: function(data)
                        {
                            if (data['status'] == 'ok')
                            {
                                var intItemIndex = getItemIndex(strCurrentFileHash);
                                arrTags[intItemIndex] = arrTags[intItemIndex].replace(strTagName, '');
                                $('#sidebar_file_tags_container .file_tags_input').importTags(typeof arrTags[intItemIndex] === "undefined" ? "" : arrTags[intItemIndex]); //update tags in filebrowser
                            }
                            else
                            {
                                $('#gallery_file_tags_container .file_tags_error').show();
                            }
                        } ,
                        error: function()
                        {
                            $('#gallery_file_tags_container .file_tags_error').show();
                        }
                    });
                } ,
                'onSearchTag' : function(strTagName)
                {
                    if (strPublicProfileHref != '')
                    {
                        window.open(strPublicProfileHref + '#search='+  strTagName, '_self');
                    }
                    
                } ,
                'delimiter' : [';'] ,
                'removeWithBackspace' : false ,
                'minChars' : 1 ,
                'maxChars' : 245 ,
                'placeholderColor' : '#666666'
            });
        }

        if (strPublicProfileHref != '')
        {
            $('#gallery_file_tags_container .tagsinput').addClass('searchable');
        }
        else
        {
            $('#gallery_file_tags_container .tagsinput').removeClass('searchable');
        }

		$('#gallery_file_tags_container .file_tags_input').importTags(typeof arrTags[intItemIndex] === "undefined" ? "" : arrTags[intItemIndex]);

		if ( ( arrTags[ intItemIndex ] == '' || typeof arrTags[intItemIndex] === "undefined" ) && ! bolIsOwner )
		{
			$( '#gallery2__sidebar__info-tags' ).hide();
			$( '#gallery2__sidebar__info-metadata-tags' ).hide();
            
		}
		else
		{
			$( '#gallery2__sidebar__info-tags' ).show();
			$( '#gallery2__sidebar__info-metadata-tags' ).show();
		}


		if( bolIsOwner && arrFileTypes[intCurrentFileIndex] != 'image' )
		{
			$( '#gallery2__sidebar__info-set-custom-thumbnail' ).html( '' );
			
    		if ( arrFileAttributes[ intItemIndex ][ 'hasCustomThumb' ] )
    		{
    			$( '#gallery2__sidebar__info-set-custom-thumbnail' ).append( '<div class="gallery2__sidebar__info-button no-background" onclick="modalGallery_changeFileThumbnail( \'' +  arrHashes[ intItemIndex ] + '\', ' + intItemIndex + ' )"><i class="fal fa-image"></i> Nomainīt faila bildi</div>' );
    			$( '#gallery2__sidebar__info-set-custom-thumbnail' ).append( '<div class="gallery2__sidebar__info-button no-background" onclick="modalGallery_removeFileThumbnail( \'' +  arrHashes[ intItemIndex ] + '\', ' + intItemIndex + ' )"><i class="fal fa-times"></i> Dzēst faila bildi</div>' );
    		}
    		else
    		{
    			$( '#gallery2__sidebar__info-set-custom-thumbnail' ).append( '<div class="gallery2__sidebar__info-button no-background" onclick="modalGallery_changeFileThumbnail( \'' +  arrHashes[ intItemIndex ] + '\', ' + intItemIndex + ' )"><i class="fal fa-image"></i> Uzstādīt failam preview bildi</div>' );
    		}

			$( '#gallery2__sidebar__info-set-custom-thumbnail' ).show();
		}
		else
		{
			$( '#gallery2__sidebar__info-set-custom-thumbnail' ).hide();
		}

        
        $( "#gallery2__item_info_delete" ).on( 'click', function()
        {
            GalleryDeleteFile(arrHashes[ intItemIndex ], strName );
        });

		$( '#gallery2__sidebar__info-price' ).html( '' );
		$( '#gallery2__sidebar__info-price' ).hide();
		$( '#gallery2__item_info_save' ).hide();
		
		if ( arrFeeDownloadPrice[ intCurrentFileIndex ] != null )
		{
			if ( bolIsOwner )
			{
				$("#gallery2__sidebar__info-price").attr("onclick", "showSetPriceFormModal(strCurrentFileHash)")
                $("#gallery2__sidebar__info-price").append("Mainīt cenu")
                $( '#gallery2__item_info_save' ).show();
                $('#gallery2__buyfile span.text').html('Mainīt cenu');
                $('.print_or_buy_popup__buyfile span.text').html('Mainīt cenu');
                
            }
			else
			{
				$("#gallery2__sidebar__info-price").attr("onclick", "showBuyFileFormModal(strCurrentFileHash)")
                $("#gallery2__sidebar__info-price").append("Pirkt šo produktu")
                $('#gallery2__buyfile span.text').html('Pirkt šo produktu');
                $('.print_or_buy_popup__buyfile span.text').html('Pirkt šo produktu');
                $( '#gallery2__item_info_save' ).hide();
			}
			
			$( '#gallery2__sidebar__info-price' ).append( ' (' + arrFeeDownloadPrice[ intCurrentFileIndex ] + ' &euro;)' );
			$( '#gallery2__sidebar__info-price' ).show();
		}
		else
		{
            if ( bolIsOwner )
            {
                $("#gallery2__sidebar__info-price").attr("onclick", "showSetPriceFormModal(strCurrentFileHash)")
                $("#gallery2__sidebar__info-price").append("Pārdot")	
                $('#gallery2__buyfile span.text').html('Pārdot');
                $('.print_or_buy_popup__buyfile span.text').html('Pārdot');
                $( '#gallery2__sidebar__info-price' ).show();
                $( '#gallery2__item_info_save' ).show();
            }
            else 
            {
                if (    arrFeeDownloadPrice[ intItemIndex ]==null && 
                        arrAllowDownload[ intItemIndex ] && 
                        ( typeof(bolHideDownloadButtons) === 'undefined' || ! bolHideDownloadButtons ) && 
                        ( typeof(arrHideDownloadButtons) === 'undefined' || ! arrHideDownloadButtons[ intItemIndex ] ))
                {
                    $( '#gallery2__item_info_save' ).show();
                    $( '.gallery2__save_button' ).show();
                }
                else
                {
                    $( '#gallery2__item_info_save' ).hide();
                    $( '.gallery2__save_button' ).hide();

                }
            }
		}		
		
		autosize.update($('#file_description_edit_wrapper textarea'));
		autosize.update($('#file_name_edit_wrapper textarea'));
        
        bolGalleryCommentsVisible = true;
        galleryLoadFileComments();
	}

    function galleryLoadFileComments()
    {
        if (bolDisableGalleryChat || !bolGalleryCommentsVisible || strActiveCommentsEntityHash == strCurrentFileHash)
        {
            return;
        }
    
        // Check if global variable is available
        if (typeof window.ChatFM === 'undefined')
        {
            setTimeout(function() {
                galleryLoadFileComments()
            }, 100)
            return
        }
        
        strActiveCommentsEntityHash = strCurrentFileHash;
    
        ChatFM.resetChat();
        ChatFM.setNewEntityChat(strCurrentFileHash, "1");
    }

    function galleryUpdateVoteCount()
    {
		var intItemIndex = getItemIndex ( strCurrentFileHash );
		
		$('.gallery_vote .vote_count').text( arrVoteCounts[intItemIndex] );
		var strVoteIcon = null;
		if ( arrHasVoted[intItemIndex] )
		{
            strVoteIcon = '/images/gallery/heart_red.svg';
			$('.gallery_vote').addClass('has_voted');
		}
		else
		{
            strVoteIcon = '/images/gallery/heart_hollow.svg';
			$('.gallery_vote').removeClass('has_voted');	
		}
		
		if( typeof objAudioPlayer !== "undefined" && objAudioPlayer !== null )
        {
            objAudioPlayer.afterVote();
        }

        var jqImage = $('#main_image_' + strCurrentFileHash);
        /*
        if ( jqImage.length )
        {
            $('#vote_heart_on_image').html('<img src="'+ strVoteIcon +'" class="bx_allow_events" />');
        }
        */

	}


    /************************************************************************************************************/
	function galleryChangeLocation ( strLocation )
    {
        
        if ( window.location.hash === strLocation )
        {
            setTimeout( "galleryCheckLocation ();", 50 );
        }
        else
        {
            var bolChangeLocation = true;
            
                        if ( window.location.hash == '#eparaksts' || window.location.hash == '#sign_up' )
            {
            	bolChangeLocation = false;
            }
            
            if ( bolChangeLocation )
            {
                if(window.location.hash.indexOf('#') != -1)
                {
                    window.location.replace(('' + window.location).split('#')[0] + strLocation)
                }
                else
                {
                    window.location.replace(('' + window.location) + '#' + strLocation)
                }
            }
        }
            }

    /************************************************************************************************************/
    var bolCheckLocationRunning = false;
    function galleryCheckLocation ()
    {
        if ( bolCheckLocationRunning )
            return;

        bolCheckLocationRunning = true;

    	var intFileIndex = null;


        if (window.location.hash.indexOf(';/view/') != -1)
        {
            bolHashtagViewUseSemicolon = true;
        }
        else
        {
            bolHashtagViewUseSemicolon = false;
        }

        var intIndexOfView = window.location.hash.indexOf('/view/');
        if (intIndexOfView != -1)
        {
            var strViewLink = window.location.hash.slice(intIndexOfView, window.location.hash.length);
            var intIndexOfFileNameEnd = strViewLink.indexOf(';');
            if ( intIndexOfFileNameEnd == -1 )
            {
                intIndexOfFileNameEnd = strViewLink.length;
            }
            var strItemHashOrName = strViewLink.slice(6, intIndexOfFileNameEnd);
            intFileIndex = getItemIndexByHashOrName ( strItemHashOrName );
        }
        else
        {
            if( strCurrentFileHash && ! bolIsListViewForSpecificFile  ) closeGallery(strCurrentFileHash);
            if(bolGalleryOpened)
            {
                bolPushWhenOpen = true; //if user goes backwards in history, add the entry of /u/ page again
            }
        }



		if (window.location.hash.indexOf(';zoom') == -1)
		{
            $('#gallery_panzoomdiv').css('display', 'none');
        }

		if ( typeof intFileIndex !== "undefined" && intFileIndex !== null )
		{
			$('#gallery2').show();
			if ( strCurrentFileHash !== arrHashes[ intFileIndex ]  )
            {
                setTimeout( "showGalleryItem( '" + arrHashes[ intFileIndex ] + "')", 0 );
            }
		}
        else
        {
            if ( bolGalleryIsVisible && bolCloseGalleryIfHashRemoved )
            {
                closeGallery(strCurrentFileHash);
            }
        }

        bolCheckLocationRunning = false;
	}

    var galleryCheckHashtag = galleryCheckLocation;

    /********/
    if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))
    {
        var mql = window.matchMedia("(orientation: portrait)");
        // If there are matches, we're in portrait
        // Add a media query change listener
        mql.addListener(function(m) {
            if(m.matches) {
                // Changed to portrait
                $('#gallery2__content-wrapper').removeClass( 'gallery__only_image' );
            }
            else {
                // Changed to landscape
                $('#gallery2__content-wrapper').addClass( 'gallery__only_image' );
            }
            setTimeout( function() {
                var evt = document.createEvent('UIEvents');
                evt.initUIEvent('resize', true, false,window,0);
                window.dispatchEvent(evt);
            }, 300 );
        });
    }

    $(window).bind('hashchange', galleryCheckLocation);
    // $(window).bind('popstate', galleryCheckLocation);
        /********/
    
    function galleryDestroyMainSlider ()
    {
    	if ( jqMainSlider )
    	{
    		jqMainSlider.destroySlider();	
    		jqMainSlider = null;
		}
	}
    
    function galleryReinitalize ()
    {
    	galleryDestroyMainSlider ();
    	$( '#gallery2__swipe-wrapper .gallery2__item' ).remove();
    	$( '#gallery2__thumb-strip__inner' ).html('');

        if ( bolIsOwner )
        {
            $('#gallery2__header__setprice').show();
            $('#gallery2__sign').show();
            $('.gallery2__edit').show();
        }
        else
        {
            $('#gallery2__header__setprice').hide();
            $('#gallery2__sign').hide();
            $('.gallery2__edit').hide();
        }
	}
    
    function initVideoPlayer (intFileIndex)
    {
        var logoHref = "https://fv2-4.failiem.lv";
        var logoImgUrL = logoHref;
    
                logoImgUrL += "/images/logo/white/failiem_logo_full.svg";
                
        var player = new FilesFm_VideoJS( "video_" + arrHashes[ intFileIndex ], {
            autoplay: false,
            hash: arrHashes[ intFileIndex ],
            title: arrDisplayNames[ intFileIndex ],
            downloadURL: "https://"+ arrFileHost[ intFileIndex ]  +"/down.php?i=" + arrHashes[ intFileIndex ],
            logoHref: logoHref,
            logoImgURL: logoImgUrL,
            smallLogoImgURL: "/images/logo/white/logo_small.svg",
            isLiked: arrHasVoted[ intFileIndex ],
            posterHref: 'https://' + arrFileHost[ intFileIndex ]  + '/thumb_video_picture.php?i=' + arrHashes[intFileIndex],
            likeBtnClick: function ( callback )
            {
                voteForFile( arrHashes[ intFileIndex ], callback );
            },
            commentsBtnClick: function ()
            {
                player.exitFullscreen();
                showGalleryInfo();
            },
            shareBtnClick: function ( e )
            {
                var objFileShareParams = galleryGetFileShareParams();
                if ( objFileShareParams !== null )
                {
                    player.exitFullscreen();
                    showSharePopup( window.event, objFileShareParams );
                }
            },
            muted: getVideoSettingsFromCookie_Muted() ,
            volume: getVideoSettingsFromCookie_Volume() ,
            onVolumeChange: function( volume, muted )
            {
            	saveVideoSettingsInCookie( 'sound', 'volume', volume );
            	saveVideoSettingsInCookie( 'sound', 'muted', muted );
            } ,
            onPlay: function()
            {
            	player.setVolume( getVideoSettingsFromCookie_Volume() );
            	player.setMuted( getVideoSettingsFromCookie_Muted() );
            }
        } );
        
        fitVideoPlayer( $( "#video_" + arrHashes[ intFileIndex ] ) );
    
        $( "#video_" + arrHashes[ intFileIndex ] ).find( "*" ).addClass( "bx_allow_events" );

        $( "#video_" + arrHashes[ intFileIndex ] ).addClass( 'ffm_video_fallback' );

        $( "#video_" + arrHashes[ intFileIndex ] + ' .vjs-loading-spinner .vjs-control-text' ).text( 'Uzgaidiet, kamēr pirmo reizi tiek konvertēts MP4 video formāts atspēlēšanai pārlūkā. Tas prasa kādu laiku, atkarībā no video garuma. Ja video nesākas, tas nozīmē, ka šī faila formāts nav piemērots streamingam. Atjaunojiet lapu un lejuplādējiet.' );

        // let's not resize the player anymore
        player.fluid( false );
    }

    function getVideoSize($video) 
    {
        $video = $($video);
        
        var $viewPort = $video.closest( ".gallery2__video_container" );
    
        var viewportHeight = $viewPort.height() - 100;
        var viewportWidth = $viewPort.width();
        
        var minHeight = 240;
    
        var videoHeight = $video.get( 0 ).offsetHeight;
        var videoWidth = $video.get( 0 ).offsetWidth;
    
        var widthToHeight = $video.attr( 'data-wth' );
    
        if ( typeof widthToHeight === "undefined" || !widthToHeight )
        {
            widthToHeight = Math.floor( videoWidth / videoHeight * 100 ) / 100;
            $video.attr( 'data-wth', widthToHeight );
        }
        
        if( widthToHeight == 0 )
        {
            widthToHeight = 1;
        }
    
        var maxHeight = viewportHeight;
    
        if ( maxHeight * widthToHeight >= viewportWidth )
        {
            maxHeight = Math.round( viewportWidth / widthToHeight );
        }
        
        if( maxHeight > viewportHeight )
        {
            maxHeight = viewportHeight;
        }
    
        if ( maxHeight < minHeight )
        {
            maxHeight = minHeight;
        }
        
        var w = Math.floor( widthToHeight * maxHeight );
        
        return {
            height: maxHeight + 'px',
            width: !isNaN(w) ? (w + "px") : "0px"
        };
    }
    
    function fitVideoPlayer( $video )
    {
        $video = $($video);
        
        var size = getVideoSize( $video );

        $video.css( {
            paddingTop: size.height,
            width: size.width,
            height: 0
        } );
        
        $video.find( "video" ).css( 'width', '100%' );
    }

    function fitEmbedPlayer( $video )
    {
        $video = $( $video );
        var size = getVideoSize( $video );

        if ( size.width !== "0px" )
        {
            $video.closest( ".gallery2__video_container__embed_palyer" ).css( {
                'maxWidth': size.width
            } );
    
            $video.closest( ".filesfm__embed_player__container" ).css( {
                height: "auto"
            } );
        }
    
        $video.find( "video" ).css( 'width', '100%' );
    }
    
    var bolGalleryIsOpening = false;
    var arrThumbWidth = [];
    function showGallery()
    {
    	if ( bolGalleryIsOpening )
    	{
    		return;
		}

		bolGalleryIsOpening = true;

        $( 'html' ).css( 'overflow', 'hidden' );
        $( '#gallery2' ).show();

        $('#tawkchat-iframe-container').hide();

        if( $( '#gallery2__swipe-wrapper .gallery2__item' ).length == 0 )
        {
            if (jqThumbContainer == null)
            {
                jqThumbContainer = $('#gallery2__thumb-strip__inner');

                var intAllThumbCount = $( 'A', jqThumbContainer ).length;

                jqThumbContainer.width( intAllThumbCount * intThumbWidth + 3 );
            }
            var intThumbsW = 0;

            var arrItems = [];
            var arrThumbs = [];
            for( idx in arrIDs )
            {
            	// JU. Removed jQuery from content composing
				var strItemHTML = '<span class="gallery2__item" id="gallery2__item-' + idx + '"></span>';
				
                strAddress = '';
                
                var strThumbHTML = '';
                var strClass = null;
                if ( arrThumbnails[idx] )
                {
                    var strThumbPath = arrThumbnails[idx];
                    
                    strThumbHTML = '<img src="/images/gallery-image-icon.png" data-original="'+strThumbPath+'" id="thumb_strip_img_'+arrHashes[idx]+'" class="lazyload-image-gallery" />';

                    jqThumbContainer.width( jqThumbContainer.width() + intThumbWidth + 3 );

                    /*
                    $("<img>").attr("src", arrThumbnails[idx]).load(function(){
                        var realWidth = this.width;
                        var realHeight = this.height;
                        var intThisThumbWidth = 93 / realHeight * realWidth;
                        
	                    jqThumbContainer.width( jqThumbContainer.width() + intThisThumbWidth + 3);
                    });
                    */
                }
                else if ( typeof( arrIconSvg ) !== 'undefined' && arrIconSvg[idx] )
                {
                    strThumbHTML = '<span class="gallery2__item__thumbnail '+ arrExtensions[ idx ].toLowerCase() +' thumb-svg-icon"><img src="/images/file_types_v2/'+arrIconSvg[ idx ]+'" data-original="/images/file_types_v2/'+arrIconSvg[ idx ]+'" style="max-width: 35px" /><span class="gallery2__item__thumbnail-ext">'+ arrExtensions[ idx ].toUpperCase() +'</span></span>';

                    jqThumbContainer.width( jqThumbContainer.width() + intThumbWidth + 3 );
                }
                else if ( arrIconClass[idx] )
                {
                    strThumbHTML = '<span class="gallery2__item__thumbnail '+ arrExtensions[ idx ].toLowerCase() +'"><i class="' + arrIconClass[idx] + '"></i><span class="gallery2__item__thumbnail-ext">'+ arrExtensions[ idx ].toUpperCase() +'</span></span>';
                    strClass = 'doc-icon';

                    jqThumbContainer.width( jqThumbContainer.width() + intThumbWidth + 3 );
                }
                else
                {
                    strThumbHTML = '<span class="gallery2__item__thumbnail '+ arrExtensions[ idx ].toLowerCase() +'"><i class="fal fa-file"></i><span class="gallery2__item__thumbnail-ext">'+ arrExtensions[ idx ].toUpperCase() +'</span></span>';
                    strClass = 'doc-icon';

                    jqThumbContainer.width( jqThumbContainer.width() + intThumbWidth + 3 );
                }
                
                var strThumbItemHTML = '<a href="javascript:void(0)" class="thumb_' + arrHashes[idx] + ''+ (strClass ? ' '+strClass : '') +'" file_hash="'+arrHashes[idx]+'" onclick="galleryChangeLocation ( getItemLink ( \''+arrHashes[idx]+'\' ) )" ';
                if( !arrThumbnails[idx] )
                {
                    strThumbItemHTML += 'style="min-width:65px;"';
                }
                strThumbItemHTML += '><!--<div class="thumb-loader">Loading</div>-->'+ strThumbHTML +'</a>';
                
                arrItems.push(strItemHTML);
                arrThumbs.push(strThumbItemHTML);
            }
            
            $( '#gallery2__swipe-wrapper' )[0].innerHTML = arrItems.join('');
            jqThumbContainer[0].innerHTML = arrThumbs.join('');
            
            arrItems = null;
            arrThumbs = null;
        }
		
		if (jqThumbContainer == null)
		{
			jqThumbContainer = $('#gallery2__thumb-strip__inner');
		}
		
		if (jqThumbViewport == null)
		{
			jqThumbViewport = $('#gallery2__thumb-strip');
		}

        if( jqMainSlider == null )
        {
            recalculateGalleryForBanner();
            var bolTwoFingers = false;
            

            jqMainSlider = $( '#gallery2__swipe-wrapper' ).bxSlider({
                slideSelector: 'span.gallery2__item',
                infiniteLoop: false,
                hideControlOnEnd: true,
                preventDefaultSwipeX: true,
                video: true,
                pager: false,
                controls: false,
                slideWidth: 9999,
                useCSS: true,
                speed: 0,
                animationSpeed: 0,
                touchEnabled: false ,
                onSlideBefore: function( $slide, oldIDx, newIDx ){

                    galleryChangeLocation ( getItemLink ( arrHashes[newIDx] ) );

                    if( !$slide.hasClass( 'content_ready' ) )
                    {
                        loadSlideContent( $slide, newIDx );
                    }
                },
                onSlideAfter: function( $slide, oldIDx, newIDx ){
                    var slidePrevIDx = parseInt( newIDx ) - 1;
                    var slideNextIDx = parseInt( newIDx ) + 1;

                    if( slidePrevIDx >= 0 )
                    {
                        $slidePrev = $( '#gallery2__item-' + slidePrevIDx );

                        if( $slidePrev.length > 0 && !$slidePrev.hasClass( 'content_ready' ) )
                        {
                            loadSlideContent( $slidePrev, slidePrevIDx );
                        }
                    }

                    if( slideNextIDx < jqMainSlider.getSlideCount() )
                    {
                        $slideNext = $( '#gallery2__item-' + slideNextIDx );

                        if( $slideNext.length > 0 && !$slideNext.hasClass( 'content_ready' ) )
                        {
                            loadSlideContent( $slideNext, slideNextIDx );
                        }
                    }
    
                    if ( $slide.find( ".gallery2__item__audio-wrapper" ).length )
                    {
                        objAudioPlayer.appendTo( $slide.find( ".gallery2__item__audio-wrapper" ) );
                        objAudioPlayer.setCurrentTrackByHash( arrHashes[ newIDx ] );
                    }
                }
            });

            var obj = document.getElementById('gallery2__swipe-wrapper');
            obj.addEventListener('touchmove', function(event) {
                if(event.targetTouches.length > 1)
                {
                    $( '#gallery2__swipe-wrapper' ).attr('data-multi-touch', true)
                }
                else
                {
                    $( '#gallery2__swipe-wrapper' ).attr('data-multi-touch', false)
                }
            }, false);
            
        }
        else if (bolHaveToRedrawGallery)
        {
        	recalculateGalleryForBanner(true);
        	bolHaveToRedrawGallery = false;
        }
        
        // At the beginning we need fixed size for lazyload to work
        $( 'img.lazyload-image-gallery', jqThumbContainer).css( {'width': 'auto', 'height':'73px'} ).addClass('image-not-loaded');

        $(function(){

            var intAllThumbCount = $( 'A', jqThumbContainer ).length;
            jqThumbContainer.width( intAllThumbCount * ( intThumbWidth + 5) + 3 );

            // After preload image is loaded - set auto size for original images.
            $( 'img.lazyload-image-gallery', jqThumbContainer ).on( 'load', function (){
                /*
                var w = this.clientWidth;
                var h = this.clientHeight;
                this.style.width = 'auto';
                this.style.height = '100%';
                if ( w < 108 )
                {
                    this.parentNode.style.width = 'auto';
                }
                */

                //$('.thumb-loader', $(this).parent()).remove();

                var intW = this.naturalWidth;
                if ( intW < intThumbWidth )
                    intW = intThumbWidth;
                arrThumbWidth.push( intW );
                var intLoadedThumbCount = 0;
                var intLoadedThumbWidthSum = 0;
                for ( var i = 0; i<arrThumbWidth.length; i++ )
                {
                    intLoadedThumbCount++;
                    intLoadedThumbWidthSum += arrThumbWidth[i];
                }

                var intAllThumbCount = $( 'A', jqThumbContainer ).length;

                jqThumbContainer.width( (intAllThumbCount - intLoadedThumbCount) * intThumbWidth + intLoadedThumbWidthSum + 3 );

                this.className = this.className + ' image-loaded';
            } );
        });

		$( 'img.lazyload-image-gallery' ).lazyload({
			container: jqThumbViewport,
			skip_invisible: true,
			event: 'scroll touchmove thumb-scroll',
			threshold: parseInt(intPreloadThumbnailsCount * intThumbWidth)
		});
		
		bolGalleryIsVisible = true;

		setTimeout("$('#info_tooltip_global').hide();", 100);

		        if ( objMainShareParams )
            $('#gallery2__share').show();
            $('#gallery2_item_info_share-wrapper').show();
                
		bolGalleryIsOpening = false;

        var bolIsMobile = navigator.userAgent.match( '/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/i' )
        if ( !bolIsMobile && $( window ).width() >= 1400 && !bolGallerySidebarVisible )
        {
            showGalleryInfo();
        }
    }

    
    function galleryLazyloadRecalc()
    {
		// Optimization for lazy load to work faster on large set of images.
		// Trigger lazy load recalc event for 5 images before loaded images and 5 after.
		var arrPreElements = [];
		var arrPostElements = [];
		var bolPassedLoadedImages = false; 
		$('img.lazyload-image-gallery').each (function (){
			var jqImage = $(this);
			if ( jqImage.hasClass('image-loaded') )
			{
				bolPassedLoadedImages = true;
			}
			if ( bolPassedLoadedImages == false )
			{
				arrPreElements.unshift( jqImage );
				if (arrPreElements.length == intPreloadThumbnailsCount)
				{
					delete arrPreElements[intPreloadThumbnailsCount-1];
				}
			}
			else
			{
				if (arrPostElements.length < intPreloadThumbnailsCount)
				{
					arrPostElements.push( jqImage );
				}
			}
		});
		/*
		for ( idx in arrPreElements )
		{
			arrPreElements[idx].trigger('scroll');
		}
		
		for ( idx in arrPostElements )
		{
			arrPostElements[idx].trigger('scroll');
		}*/

        jqThumbViewport.trigger('scroll');
		
	}

	function openPanZoomImage ()
    {
        if ( arrFileTypes[intCurrentFileIndex] !== 'image' )
            return;

        var strImageURL = 'https://'+ arrFileHost[ intCurrentFileIndex ]  +'/thumb_show.php?i=' + arrHashes[intCurrentFileIndex] + '&view';
        if (arrFeeDownloadPrice[intCurrentFileIndex] > 0)
        {
            strImageURL += '&wm=103';
        }

        if ( typeof( arrFileVersion ) != 'undefined' && typeof( arrFileVersion[ intCurrentFileIndex ] ) != 'undefined' && arrFileVersion[ intCurrentFileIndex ] > 0 )
        {
            strImageURL += '&version=' + arrFileVersion[ intCurrentFileIndex ];
        }

        var srNewPanZoomLink = getItemLink ( strCurrentFileHash );
        if ( window.location.hash.length > 0 )
        {
            srNewPanZoomLink += ';zoom';
        }
        else
        {
            srNewPanZoomLink += '#;zoom';
        }
        galleryChangeLocation ( srNewPanZoomLink );

        var strHtml = '<img id="gallery_panzoomdiv_content" src="' + strImageURL + '" onload="initPanZoomImage(this)" />';

        //strHtml += '<div id="gallery_panzoomdiv_close" style="position: absolute; top: 0px; right: 0px; font-size: 26px; color: #fff; padding: 10px;"><div style="border-radius: 26px; background: rgba(83,108,121,0.49);"><i class="fal fa-times-circle"></i></div></div>';
        strHtml += '<div id="gallery_panzoomdiv_info" style="position: absolute; top: 0px; left: 0px; font-size: 12px; color: #fff; padding: 10px;"></div>';


        var resCloseTimeout = null;
        $('#gallery_panzoomdiv')
            .html( strHtml )
            .css('display', 'block')
            .on('mouseup', function (e){
                resCloseTimeout = setTimeout( function (){
                    $('#gallery_panzoomdiv').css('display', 'none');
                }, 50);
            })
            .on('mousemove', function (e){
                if ( resCloseTimeout )
                {
                    clearTimeout( resCloseTimeout );
                    resCloseTimeout = null;
                }
            });

        $('#gallery_panzoomdiv_close').on('click', function () {
            $('#gallery_panzoomdiv').css('display', 'none');
        });
    }

    function initPanZoomImage (dom)
    {
        var intBodyHeight = $('body').outerHeight();

        var panzoom_instance = panzoom(dom, {
            transformOrigin: {x: 0.5, y: 0.5},
            maxZoom: 8,
            minZoom: 0.25,
            onTouch: function(e) {
                // `e` - is current touch event.

                return false; // tells the library to not preventDefault.
            }
        });
        var container_width = $('#gallery_panzoomdiv').width();
        var container_height = $('#gallery_panzoomdiv').height();
        var width = $('#gallery_panzoomdiv_content').width();
        var height = $('#gallery_panzoomdiv_content').height();

        panzoom_instance.moveTo((width - container_width)/-2, (height - container_height)/-2);

        var jqHead = $( 'head' );
        jqHead.find( 'meta[name=viewport]' ).remove();
        jqHead.prepend( '<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0" />' );
    }

    var arrIframeTimers = [];
    var objAudioPlayer = null;

    function getBackgroundSize(elem) {
        var objElemComputedStyle = getComputedStyle(elem),
        objImage = new Image(),
        strElemSrc = objElemComputedStyle.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi, '$2'),
        intElemWidth = parseInt(objElemComputedStyle.width.replace('px', ''), 10),
        intElemHeight = parseInt(objElemComputedStyle.height.replace('px', ''), 10);
        objImage.src = strElemSrc;
        
        var intBackgroundWidth, intBackgroundHeight;
        var intRatioWidth = objImage.width / intElemWidth;
        var intRatioHeight = objImage.height / intElemHeight;

        if (intRatioWidth > intRatioHeight)
        {
            intBackgroundHeight = objImage.height / intRatioWidth;
            intBackgroundWidth = intElemWidth;
        }
        else
        {
            intBackgroundWidth = objImage.width / intRatioHeight;
            intBackgroundHeight = intElemHeight;
        }
        return {
            width: intBackgroundWidth,
            height: intBackgroundHeight
        };
    }

    function loadSlideContent( $jqSlideElem, intFileIndex )
    {
		var strHttpCacheKey = '';
		if ( typeof(arrHttpCacheKeys) != 'undefined' && typeof(arrHttpCacheKeys[intFileIndex]) != 'undefined' )
		{
			strHttpCacheKey = '' + arrHttpCacheKeys[intFileIndex];
		}

        if ( arrFileAttributes && arrFileAttributes[ intFileIndex ] && arrFileAttributes[ intFileIndex ][ 'readOnly' ] )
        {
            $( '#gallery2__header__mid_content' ).hide();
        }
        else
        {
            $( '#gallery2__header__mid_content' ).show();
        }

        
    	var strFileType = arrFileTypes[intFileIndex];
    	
    	var bolIsFileConvertableToPdf = isFileConvertable( 'pdf', intFileIndex );

    	if ( bolIsFileConvertableToPdf )
    	{
    		strFileType = 'pdf_converted';
    	}
    	
        
        switch( strFileType )
        {
            default:
                var jqThumb;

                if ( arrFileAttributes[ intFileIndex ][ 'hasCustomThumb' ] )
                {
                	jqThumbInner = $( "<div>" )
                    .css({
                        'background-image': 'url("/thumb.php?i=' + arrHashes[ intFileIndex ] + '")',
                        'height': function() 
                        {
                            if (0) //( !arrDescriptions[intFileIndex] ) // AD: description isn't visible anymore
                            {
                                return 'calc( 100% - 115px )';
                            }
                        }
                    })
                    .addClass( 'gallery2__item__custom_thumb gallery2__item__base-width-on-two' );

                    if ( arrFeeDownloadPrice[intFileIndex] > 0 )
                    {
                        if (bolIsOwner)
                        {
                            jqThumbInner.attr( 'onclick', 'showSetPriceFormModal(strCurrentFileHash)' );
                        }
                        else 
                        {
                            jqThumbInner.attr( 'onclick', 'showBuyFileFormModal(strCurrentFileHash)' );
                        }
                    	jqThumbInner.addClass( 'bx_allow_events' );
                    	jqThumbInner.addClass( 'has_price' );
                    }

                    jqThumb = $( '<span class="gallery2__item__doc-icon">' ) .append( jqThumbInner );
                }
                else
                {
                    var strIconHtml = '<i class="fa-5x fa ' + arrIconClass[ intFileIndex ] + '"></i>';
                    if ( typeof( arrIconSvg ) !== 'undefined' && arrIconSvg[ intFileIndex ] )
                    {
                        strIconHtml = '<img src="/images/file_types_v2/'+arrIconSvg[ intFileIndex ]+'" class="gallery2__item__base-width-on-two ext-icon" />';
                    }
                    jqThumb = $( '<span class="gallery2__item__doc-icon ' + arrExtensions[ intFileIndex ].toLowerCase() + '">' + strIconHtml + '</span>' );
                }

                var bolSimpleDownloadAllowed = false;
                var bolP2PDownloadAllowed = false;

                if (
                    bolShowP2PDownloadButton
                    && ( typeof( objWebTorrentDownloadForm ) === 'object' || ! bolIsListViewForSpecificFile )
                    && arrFeeDownloadPrice[ intFileIndex ] == null
                    && arrAllowDownload[ intFileIndex ]
                    && ( arrAccessType[ intFileIndex ] === 'LINK' || arrAccessType[ intFileIndex ] === 'PUBLIC' )
                    && arrUploadPassword[ intFileIndex ] === ''
                    && arrAllowPublicDownload[ intFileIndex ]
                    && ( typeof(bolHideDownloadButtons) === 'undefined' || ! bolHideDownloadButtons ) && ( typeof(arrHideDownloadButtons) === 'undefined' || ! arrHideDownloadButtons[ intFileIndex ] )
                ) {
                    bolP2PDownloadAllowed = true;
                }

                if ( arrAllowDownload[ intFileIndex ]
                    &&  arrFeeDownloadPrice[ intFileIndex ] == null
                    && ( typeof(bolHideDownloadButtons) === 'undefined' || ! bolHideDownloadButtons ) && ( typeof(arrHideDownloadButtons) === 'undefined' || ! arrHideDownloadButtons[ intFileIndex ] )
                ) {
                    bolSimpleDownloadAllowed = true;
                }

                $jqSlideElem.append( '<span class="gallery2__vertical-helper"></span><span class="gallery2__item__doc-wrapper' + ( arrFileAttributes[ intFileIndex ][ 'hasCustomThumb' ] ? ' has_custom_thumb' : '' ) + '"></span>' );
                $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append( jqThumb );
                if (!arrFileAttributes[ intFileIndex ][ 'hasCustomThumb' ]) 
                {
                    $('.gallery2__item__doc-wrapper', $jqSlideElem).append('<div class="gallery2__item__information-wrapper"><p class="gallery2__item__doc-filename">' + arrDisplayNames[intFileIndex] + '</p></div>');
                    if (0) //( arrDescriptions[intFileIndex] ) // AD: description isn't visible anymore
                    {
                        $('.gallery2__item__doc-wrapper', $jqSlideElem).append('<div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p></div>');
                    }
                }

                function updateDefaultDescriptionWidth() 
                {
                    var intDefaultWidth;
                    $('.gallery2__item__base-width-on-two').each(function() 
                    {
                        switch(this.tagName) 
                        {
                            case 'IMG':
                                intDefaultWidth =  $( this ).outerWidth();
                                break;
                            case 'DIV':
                                var objBackground = getBackgroundSize(this);
                                intDefaultWidth = objBackground.width;
                                break;
                            default:
                                intDefaultWidth =  $( this ).outerWidth();
                                break;
                        }
                        if(intDefaultWidth>=$('#gallery2__image-wrapper').width())
                        {
                            intDefaultWidth=intDefaultWidth-20;
                        }
                        $(this).parent().parent().find('.gallery2__item__desc-wrapper, .gallery2__item__information-wrapper').width(intDefaultWidth);
                    });
                }
                updateDefaultDescriptionWidth();
                $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append( '<p class="gallery2__item__doc-nopreview"></p>' );

                //var jqButtonContainer = $('<div />').css({'white-space': 'normal'});

                /*** Build download button ***/
                /*
                if ( bolSimpleDownloadAllowed || bolP2PDownloadAllowed ) {

                    var objDownloadButton = new DropdownButton ();

                    if ( bolSimpleDownloadAllowed ) {
                        objDownloadButton.addButton('gallery-download-simple-split-button', 'Lejuplādēt šo failu', 'Lejuplādēt', null, function (){
                            gaev('split-download-button-engagement', 'document-main-download-simple-click', 'Main split button simple download click');
                            modalGalleryDownloadFileBtn( strCurrentFileHash ) })
                    }
                    if ( bolSimpleDownloadAllowed && ! bolIsOwner && typeof objUploadCopyForm != 'undefined' && typeof strUploadHash != 'undefined' ) {
                        objDownloadButton.addButton('gallery-download-myfiles-split-button', 'Saglabāt manā kontā', 'Saglabāt manā kontā', null, function (){
                            gaev('split-download-button-engagement', 'document-main-download-myfiles-click', 'Main split button myfiles download click');
                            modalGalleryDownloadFileBtn( strCurrentFileHash, 'my-files' );
                        })
                    }
                    if ( bolP2PDownloadAllowed ) {
                        objDownloadButton.addButton('gallery-download-p2p-split-button', 'Lejuplādēt ar P2P', 'Lejuplādēt ar P2P', null, function (){
                            gaev('split-download-button-engagement', 'document-main-download-p2p-click', 'Main split button P2P download click');
                            modalGalleryDownloadFileP2PBtn( intCurrentFileIndex )
                        })
                    }
                    var jqDownloadButton = objDownloadButton.build( 'gallery-download-split-button large extra-large', 'file-' + intFileIndex + '-download-split-button', arrDisplayNames[ intFileIndex ] );

                    jqButtonContainer.append( jqDownloadButton );
                    $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append(jqButtonContainer);
                }
                */
                /*********/

                $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append(jqButtonContainer);
                break;

            case 'image':
	            	 var strImageURL = 'https://' + arrFileHost[ intFileIndex ] + '/thumb_show.php?i=' + arrHashes[intFileIndex] + '&view';
	            	 if (arrFeeDownloadPrice[intFileIndex] > 0)
					 {
	            		 strImageURL += '&wm=103';
					 }

	            	 if ( typeof( arrFileVersion ) != 'undefined' && typeof( arrFileVersion[ intFileIndex ] ) != 'undefined' && arrFileVersion[ intFileIndex ] > 0 )
                     {
                         strImageURL += '&version=' + arrFileVersion[ intFileIndex ];
                     }

					var strHtml = '' +
						'<span class="gallery2__vertical-helper"></span>' +
						'<i class="fa fa-spinner fa-spin gallery2__load-spinner" id="main_image_load-spinner_'+ arrHashes[intFileIndex] +'"></i>' +
                        '<img class="gallery2__item__img gallery2__item__base-width-on bx_allow_events" src="" alt="" id="main_image_'+ arrHashes[intFileIndex] +'" />' +
                        // '<div class="gallery2__item__information-wrapper"></div>' +
                        // '<div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p>' +
                        '<div class="print_or_buy_popup">' +
                            '<div class="print_or_buy_popup_close bx_allow_events" onclick="$(\'.print_or_buy_popup\').hide();"></div>' +
                            '<div class="print_or_buy_popup_desc">Tu vari nopirkt šo failu vai pasūtīt apdrukas:</div>' +
                            '<span class="print_or_buy_popup__buyfile print_or_buy_popup_button" style="display:none"  onclick="showSetPriceFormModal(strCurrentFileHash)">' +
                                '<a href="javascript:void(0);">' +
                                ' <span class="text">Pirkt šo produktu</span>' +
                                    '<span class="price"></span>' +
                                '</a>' +
                            '</span>' +
                            '<span class="print_or_buy_popup__products print_or_buy_popup_button">' +
                                '<a href="javascript:void(0);">' +
                                    '<span class="text">Apskatīt apdrukas</span>' +
                                '</a>' +
                            '</span>' +
                        '</div>' +
                        '</div>';
                     $jqSlideElem.append( strHtml );

                     /*
                     if( !arrDescriptions[intFileIndex] )
                     {
                        $('.gallery2__item__desc-wrapper', $jqSlideElem).hide();
                        $( 'img', $jqSlideElem ).css({  'margin' : 'auto', 
                                                        'max-height': 'calc( 100% - 160px )' 
                                                    });
                        $( '.gallery2__item__information-wrapper', $jqSlideElem ).css({  'position' : 'relative', 
                            'bottom': '70px' 
                        });                                                
                     } 
                     else 
                     {
                        $( 'img', $jqSlideElem ).css({  'position' : 'relative', 
                                                        'bottom': '75px' 
                                                    });
                        $( '.gallery2__item__desc-wrapper', $jqSlideElem ).css({  'position' : 'relative', 
                                                        'bottom': '145px' 
                                                    });
                        $( '.gallery2__item__information-wrapper', $jqSlideElem ).css({  'position' : 'relative', 
                            'bottom': '150px' 
                        });      
                     }
                     */
                     
                     var bolImageLoaded = false;
                     var strImageFileHash = arrHashes[intFileIndex];
                     $( 'img', $jqSlideElem ).attr( 'src', strImageURL ).on( 'load', function(){
                     	 bolImageLoaded = true;
                         $( this ).css( 'opacity', '1' );
                         $('#main_image_load-spinner_'+ strImageFileHash).hide();

                         $(this).attr( 'data-image-loaded', true );
                        /*
                         repositionHeartButton();
                         
                         $('#vote_heart_on_image').show();
                         */
                         var intImageWidth =  $( 'img', $jqSlideElem ).width();
                         if(intImageWidth>=$('#gallery2__image-wrapper').width())
                         {
                            intImageWidth=intImageWidth-20;
                         }
                         $('img', $jqSlideElem).siblings('.gallery2__item__desc-wrapper, .gallery2__item__information-wrapper').width( intImageWidth );
                     }).on('click', function (){
                        if($( this ).hasClass( "bx_allow_events" ))
                        {
                            if ( arrFeeDownloadPrice[intFileIndex] > 0 )
                            {
                                                                    if ( arrFileHasProductSelling[ intCurrentFileIndex ] == 1 )
                                    {
                                        $( this ).siblings(".print_or_buy_popup").toggle();
                                    }
                                    else
                                    {
                                        if (bolIsOwner)
                                        {
                                            showSetPriceFormModal(strCurrentFileHash);
                                        }
                                        else 
                                        {
                                            showBuyFileFormModal(strCurrentFileHash);
                                        }
                                    }
                                                            }
                            else 
                            {
                                                                if ( arrFileHasProductSelling[ intCurrentFileIndex ] == 1 )
                                {
                                    window.open( '/c/' + strUploadHash + '?h=' + strCurrentFileHash, '_blank' );
                                }
                                                            }
                        }
                        else
                        {
                            $('#gallery2__content-wrapper').toggleClass( 'gallery__only_image' );
                            //openPanZoomImage ();
                        }
                     });

                     setTimeout("var domImg=document.getElementById('main_image_"+ arrHashes[intFileIndex] +"');  if ( ! domImg.complete ) { $( domImg ).css( 'opacity', '0.6' );}", 300);

                break;

            case 'document':
            case 'pdf_converted':
            	var jqThumb;

                if ( arrFileAttributes[ intFileIndex ][ 'hasCustomThumb' ] )
                {
                    jqThumb = $( "<div>" ).css( 'background-image', 'url("/thumb.php?i=' + arrHashes[ intFileIndex ] + '")' ).addClass( 'gallery2__item__custom_thumb gallery2__item__base-width-on' );

                    if ( arrFeeDownloadPrice[intFileIndex] > 0 )
                    {
                        if (bolIsOwner)
                        {
                            jqThumb.attr( 'onclick', 'showSetPriceFormModal(strCurrentFileHash)' );
                        }
                        else 
                        {
                            jqThumb.attr( 'onclick', 'showBuyFileFormModal(strCurrentFileHash)' );
                        }
                    	jqThumb.addClass( 'bx_allow_events' );
                    	jqThumb.addClass( 'has_price' );
                    }
                }
                else
                {
                    jqThumb = $( '<i />' ).addClass( 'fa-5x fa ' + arrIconClass[intFileIndex] );
                    if ( typeof( arrIconSvg ) !== 'undefined' && arrIconSvg[ intFileIndex ] )
                    {
                        jqThumb = $( '<img />' ).attr('src', '/images/file_types_v2/' + arrIconSvg[ intFileIndex ]).addClass( 'gallery2__item__base-width-on ext-icon' );
                    }
                }

                var bolSimpleDownloadAllowed = false;
                var bolP2PDownloadAllowed = false;

                if (
                    bolShowP2PDownloadButton
                    && ( typeof( objWebTorrentDownloadForm ) === 'object' || ! bolIsListViewForSpecificFile )
                    && arrFeeDownloadPrice[ intFileIndex ] == null
                    && arrAllowDownload[ intFileIndex ]
                    && ( arrAccessType[ intFileIndex ] === 'LINK' || arrAccessType[ intFileIndex ] === 'PUBLIC' )
                    && arrUploadPassword[ intFileIndex ] === ''
                    && arrAllowPublicDownload[ intFileIndex ]
                    && ( typeof(bolHideDownloadButtons) === 'undefined' || ! bolHideDownloadButtons ) && ( typeof(arrHideDownloadButtons) === 'undefined' || ! arrHideDownloadButtons[ intFileIndex ] )
                ) {
                    bolP2PDownloadAllowed = true;
                }

                if ( arrAllowDownload[ intFileIndex ]
                    &&  arrFeeDownloadPrice[ intFileIndex ] == null
                    && ( typeof(bolHideDownloadButtons) === 'undefined' || ! bolHideDownloadButtons ) && ( typeof(arrHideDownloadButtons) === 'undefined' || ! arrHideDownloadButtons[ intFileIndex ] )) {

                    bolSimpleDownloadAllowed = true;
                }

                $jqSlideElem.append( '<span class="gallery2__vertical-helper"></span><span class="gallery2__item__doc-wrapper' + ( arrFileAttributes[ intFileIndex ][ 'hasCustomThumb' ] ? ' has_custom_thumb' : '' ) + '"></span>' );
                $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append( jqThumb );
                if (!arrFileAttributes[ intFileIndex ][ 'hasCustomThumb' ]) 
                {
                    $('.gallery2__item__doc-wrapper', $jqSlideElem).append('<div class="gallery2__item__information-wrapper"><p class="gallery2__item__doc-filename">' + arrDisplayNames[intFileIndex] + '</p></div>');
                    // AD: description isn't visible anymore
                    // $('.gallery2__item__doc-wrapper', $jqSlideElem).append('<div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p></div>');
                }
                
    
                var jqButtonContainer = $('<div />').css({'white-space': 'normal'});
                jqButtonContainer.append('<div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p></div>');
                
                /*** Build download button ***/
                /*
                if ( bolSimpleDownloadAllowed || bolP2PDownloadAllowed ) {

                    var objDownloadButton = new DropdownButton ();

                    if ( bolSimpleDownloadAllowed ) {
                        objDownloadButton.addButton('gallery-download-simple-split-button', 'Lejuplādēt šo failu', 'Lejuplādēt', null, function (){
                            gaev('split-download-button-engagement', 'document-main-download-simple-click', 'Main split button simple download click');
                            modalGalleryDownloadFileBtn( strCurrentFileHash )
                        })
                    }
                    if ( bolSimpleDownloadAllowed && ! bolIsOwner && typeof objUploadCopyForm != 'undefined' && typeof strUploadHash != 'undefined' ) {
                        objDownloadButton.addButton('gallery-download-myfiles-split-button', 'Saglabāt manā kontā', 'Saglabāt manā kontā', null, function (){
                            gaev('split-download-button-engagement', 'document-main-download-myfiles-click', 'Main split button myfiles download click');
                            modalGalleryDownloadFileBtn( strCurrentFileHash, 'my-files' );
                        })
                    }
                    if ( bolP2PDownloadAllowed ) {
                        objDownloadButton.addButton('gallery-download-p2p-split-button', 'Lejuplādēt ar P2P', 'Lejuplādēt ar P2P', null, function (){
                            gaev('split-download-button-engagement', 'document-main-download-p2p-click', 'Main split button P2P download click');
                            modalGalleryDownloadFileP2PBtn( intCurrentFileIndex )
                        })
                    }
                    var jqDownloadButton = objDownloadButton.build( 'gallery-download-split-button large extra-large', 'file-' + intFileIndex + '-download-split-button', arrDisplayNames[ intFileIndex ] );

                    jqButtonContainer.append( jqDownloadButton );
                    $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append(jqButtonContainer);
                }
                */
                /*********/
                
                if ( arrExtensions[ intFileIndex ] == 'pdf' || bolIsFileConvertableToPdf )
                {
                    var bolForbidDirectDownload = false;
                    
                	if ( typeof( arrForbidDirectDownload ) != 'undefined' && arrForbidDirectDownload[ intFileIndex ] == true )
                	{
                		bolForbidDirectDownload = true;
                	}
                	

                    if (
                            arrFeeDownloadPrice[ intFileIndex ] == null
                            && arrAllowDownload[ intFileIndex ] 
                            && browserSupportsCanvas() 
                            && ! bolForbidDirectDownload 
                            && arrSizesInBytes[ intFileIndex ] < 104857600                        )
                    {
                        ( function()
                        {
                            $( this ).attr( 'disabled', 'disabled' );
            
                            var $jqSlideElem = $( this ).closest( ".gallery2__item" );
                            var intFileIndex = $jqSlideElem.attr( 'id' ).split( "-" ).slice( -1 )[ 0 ];
            
                            $jqSlideElem.prepend(
                                '<div class="gallery2__item__iframe-wrapper" id="gallery2__item__iframe-wrapper__' + intFileIndex + '">' +
	                                '<div class="gallery2__item__iframe-loading">' +
    		                            '<span class="gallery2__vertical-helper"></span>' +
    		                            '<div class="gallery2__item__iframe-loading__wrapper">' +
	            		                    '<i class="fa fa-spinner fa-spin gallery2__item__iframe-loading__icon"></i>' +
    	                            		'<span class="gallery2__item__iframe-loading__text">Lūdzu, uzgaidiet, kamēr tiek veidots faila priekšskatījums...<br/> Liela izmēra failiem tas var aizņemt vairāk laika. Lai apskatītu failu, varat to lejupielādēt.</span>' +
	                            		'</div>' +
                    	            '</div>' +
                        	        '<iframe src=""></iframe>' +
                                    // AD: description isn't visible anymore
                            	    // '<div class="gallery2__item__information-wrapper"><p class="gallery2__item__doc-filename">' + arrDisplayNames[ intFileIndex ] + '</p></div>' +
                                	// '<div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p></div>' + 
                                '</div>'
                            );

                            var strPdfSrc;

                            if ( bolIsFileConvertableToPdf ) 
                            {
                                var strDateModified = ( typeof arrDatesModified != 'undefined' ? arrDatesModified[ intFileIndex ] : ( typeof arrModDate != 'undefined' ? arrModDate[ intFileIndex ] : '' ) );
                            	strPdfSrc = 'https://' + arrFileHost[ intFileIndex ] + '/api/file/get_thumb_pdf.php?i=' + arrHashes[ intFileIndex ] + '&PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8&dm=' + strDateModified + '&v=102&n=' + arrDisplayNames[ intFileIndex ] + '.pdf';
                            }
                            else 
                            {
                            	strPdfSrc = 'https://' + arrFileHost[ intFileIndex ] + '/down.php?pdf=1&truemimetype=1&i=' + arrHashes[ intFileIndex ] + '&PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8&n=' + arrDisplayNames[ intFileIndex ];
                            }

                        	$.ajax(
                        	{
                                type: "GET",
                                url: strPdfSrc,
                                success: function()
                                {
                                    $( 'iframe', $jqSlideElem )
                                        .attr( 'src', '/js/pdfjs-v2/web/viewer.html#' + encodeURI( strPdfSrc ) )
                                        .addClass( 'gallery2__item__base-width-on' )
                                        .css(
                                        {
                                            'height': function()
                                            {
                                                return '100%';
                                                // AD: description isn't visible anymore
                                                /*
                                                if ( arrDescriptions[intFileIndex] )
                                                {
                                                    return 'calc( 100% - 150px )';
                                                }
                                                else 
                                                {
                                                    return 'calc( 100% - 60px )';
                                                }
                                                */
                                            }
                                        } )
                                    .on( 'load', function ()
                                    {
                                        if ( ! bolSimpleDownloadAllowed )
                                        {
                                            $( this ).contents().find( '#print' ).hide();
                                            $( this ).contents().find( '#download' ).hide();
                                        }
                                    } );
                            	} ,
                            	error: function(data)
                            	{
                            		var stErrorText = 'Diemžēl neizdevās izveidot faila priekšskatījumu. Lūdzu, mēģiniet vēlreiz atkārtoti, atjaunojot lapu, vai sazinieties ar support@failiem.lv. Lai apskatītu failu, varat to lejupielādēt.';
                            		
                                	if ( data.status == 405 )
                                	{
                                		stErrorText = 'Šim failam nav pieejams priekšskatījums. Lai apskatītu, lejupielādējiet failu.';
                                	}

                                	$( 'iframe', $jqSlideElem ).replaceWith(
                                    	'<div class="gallery2__item__msg_has_no_preview">' + 
	                                    	'<span class="gallery2__vertical-helper"></span>' +
    	                                	'<div>' + stErrorText + '</div>' +
	                                	'</div>'
                                	);

                                	$( '.gallery2__item__msg_has_no_preview' )
                                        .addClass( 'gallery2__item__base-width-on' )
                                        .css(
                                        {
                                            'height': function()
                                            {
                                                return '100%';
                                                // AD: description isn't visible anymore
                                                /*
                                                if ( arrDescriptions[intFileIndex] )
                                                {
                                                    return 'calc( 100% - 150px )';
                                                }
                                                else 
                                                {
                                                    return 'calc( 100% - 60px )';
                                                }
                                                */
                                            }
                                        } );

                                    $( '.gallery2__item__iframe-loading', $jqSlideElem ).hide();
                            	}
                            } );
                        } ).apply( $jqSlideElem );
                    }
                }
                else if (
                        	(
                               arrExtensions[intFileIndex] == "txt" || arrExtensions[intFileIndex] == "php"
    					   	   || 	arrExtensions[intFileIndex] == "js"  || arrExtensions[intFileIndex] == "html" 
    						   || 	arrExtensions[intFileIndex] == "css" || arrExtensions[intFileIndex] == "xml"
    						   || 	arrExtensions[intFileIndex] == "csv" || arrExtensions[intFileIndex] == "ini" 
						   ) 
						   && arrFeeDownloadPrice[ intFileIndex ] == null
                           && arrAllowDownload[ intFileIndex ]
                        )
                {
                	var fnLoadIframe = function ()
                    {
                        $( this ).attr( 'disabled', 'disabled' );
        
                        var $jqSlideElem = $( this ).closest( ".gallery2__item" );
                        var intFileIndex = $jqSlideElem.attr( 'id' ).split( "-" ).slice( -1 )[ 0 ];
        
                        $jqSlideElem.prepend( '<div class="gallery2__item__iframe-wrapper" id="gallery2__item__iframe-wrapper__' + intFileIndex + '"><div class="gallery2__item__iframe-loading"><span class="gallery2__vertical-helper"></span><i class="fa fa-spinner fa-spin"></i></div><iframe src="" class="modal_gallery_simple_iframe"></iframe><div class="gallery2__item__information-wrapper"><p class="gallery2__item__doc-filename">' + arrDisplayNames[ intFileIndex ] + '</p></div><div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p></div></div>' );
        
                        arrIframeTimers[ intFileIndex ] = setTimeout( function ()
                        {
                            $( '#gallery2__item__iframe-wrapper__' + intFileIndex ).hide();
                        }, 30000 );

                       
                        $( 'iframe', $jqSlideElem )
                            .attr( 'src', 'https://' + arrFileHost[ intFileIndex ] + '/down.php?i=' + arrHashes[ intFileIndex ] + '&gpv=1&view=1&truemimetype=1' )
                            .attr( 'onload', 'clearTimeout( arrIframeTimers[ ' + intFileIndex + ' ] );' )
                            .css({
                                'height': function(){
                                    return '100%';
                                    // AD: description isn't visible anymore
                                    /*
                                    if ( arrDescriptions[intFileIndex] )
                                    {
                                        return 'calc( 100% - 150px )';
                                    }
                                    else 
                                    {
                                        return 'calc( 100% - 60px )';
                                    }
                                    */
                                },
                                "background": "white"
                            })
                            .addClass( 'gallery2__item__base-width-on' )
                    };
                    
                    fnLoadIframe.apply( $jqSlideElem );
                }
                else
                {
                    //JV 2019.12.13: doc preview strādās līdz 50MB failiem
                    if (
                            arrFeeDownloadPrice[ intFileIndex ] == null 
                            && arrSizesInBytes[ intFileIndex ] < 50 * 1024 * 1024 
                            && arrUploadPassword[ intFileIndex ] == '' 
                            && arrAccessType[ intFileIndex ] == 'LINK' 
                        )
                    {
                        var fnLoadIframe = function ()
                        {
                            $( this ).attr( 'disabled', 'disabled' );
            
                            var $jqSlideElem = $( this ).closest( ".gallery2__item" );
                            var intFileIndex = $jqSlideElem.attr( 'id' ).split( "-" ).slice( -1 )[ 0 ];
            
                            $jqSlideElem.prepend(
                                '<div class="gallery2__item__iframe-wrapper" id="gallery2__item__iframe-wrapper__' + intFileIndex + '">' + 
                                '<div class="gallery2__item__iframe-loading">' +
                                '<span class="gallery2__vertical-helper"></span>' + 
                                '<i class="fa fa-spinner fa-spin"></i>' + 
                                '</div>' + 
                                '<iframe src=""></iframe>' + 
                                //'<div class="gallery2__item__information-wrapper"><p class="gallery2__item__doc-filename">' + arrDisplayNames[ intFileIndex ] + '</p></div>' +
                                //'<div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p></div>' + 
                                '</div>'
                            );

                            arrIframeTimers[ intFileIndex ] = setTimeout( function ()
                            {
                                $( '#gallery2__item__iframe-wrapper__' + intFileIndex ).hide();
                            }, 30000 );


                            if ( arrExtensions[intFileIndex] == "dwg" || arrExtensions[intFileIndex] == "dxf" )
                            {
                                // JV: ja ir DWG vai DXF AutoCAD fails, tad radisim citu dokumentu preview iframe:
                                // ShareCad.org nestrada down.php linki, tapec ielikts direct path access links
                                $.ajax( {
                                    type: "GET",
                                    url: "/api/embed_urls.php",
                                    data: {
                                        'i': arrHashes[ intFileIndex ]
                                    },
                                    success: function ( data )
                                    {
                                        data = JSON.parse( data );

                                        $( 'iframe', $jqSlideElem )
                                        .attr( 'src', 'https://sharecad.org/cadframe/load?url='+data[ 'path_access_url' ] )
                                        .attr( 'onload', 'clearTimeout( arrIframeTimers[ ' + intFileIndex + ' ] );' );
                                    }
                                } );
                            }
                            else if ( arrExtensions[intFileIndex] == "rtf" || arrSizesInBytes[ intFileIndex ] > 10 * 1024 * 1024 ) //MS ofisam ir file size limits 10MB?
                            {
                                $( 'iframe', $jqSlideElem )
                                .attr( 'src', 'https://docs.google.com/viewerng/viewer?embedded=true&url=https://api.files.fm/down.php?i=' + arrHashes[ intFileIndex ] + '&gpv=1' )
                                .attr( 'onload', 'clearTimeout( arrIframeTimers[ ' + intFileIndex + ' ] );' );
                            }
                            // Google docs iframe dokumentu paradisanai
							// https://docs.google.com/viewer?embedded=true&url=
							// https://docs.google.com/viewerng/viewer?embedded=true&url=
							// MS Office: https://view.officeapps.live.com/op/embed.aspx?src=
                            else //JV: 2020-05-22 Googli aizstāju ar Office
                            {
                                $( 'iframe', $jqSlideElem )
                                .attr( 'src', 'https://view.officeapps.live.com/op/embed.aspx?src=https://api.files.fm/down.php?i=' + arrHashes[ intFileIndex ] + '&gpv=1' )
                                .attr( 'onload', 'clearTimeout( arrIframeTimers[ ' + intFileIndex + ' ] );' );
                            }

                            $( 'iframe', $jqSlideElem )
                            .css({
                                'height': function(){
                                    return '100%';
                                    // AD: description isn't visible anymore
                                    /*
                                    if ( arrDescriptions[intFileIndex] )
                                    {
                                        return 'calc( 100% - 150px )';
                                    }
                                    else 
                                    {
                                        return 'calc( 100% - 60px )';
                                    }
                                    */
                                }
                            })
                            .addClass( 'gallery2__item__base-width-on' )
                    
                        };
                        
                        if ( 1 ) // clickedItemHash !== arrHashes[ intFileIndex ] )
                        {
                            var jqPreviewButton = $( '<a />' ).attr( {
                                'href': 'javascript:void(0);',
                                'title': 'Apskatīt',
                                'class': 'gallery2__item__doc-wrapper__download_button gallery2__save_button gallery2__item__doc-wrapper__download_button gallery2__preview_button'
                            } ).html( 'Apskatīt šo failu' )
                                .click( function() {
                                  
                                    if ( arrExtensions[intFileIndex] == "dwg" || arrExtensions[intFileIndex] == "dxf" )
                                    {
                                                                                    showSignIn();
                                                                            }
                                    else
                                    {
                                        fnLoadIframe.apply( $jqSlideElem );
                                        var jqDownloadButton = $( '<a />' ).attr( {
                                            'href': 'javascript:void(0);',
                                            'onclick': 'modalGalleryDownloadFileBtn( "' + arrHashes[ intFileIndex ] + '" )',
                                            'title': 'Lejuplādēt',
                                            'class': 'gallery2__item__doc-wrapper__download_button gallery2__save_button'
                                        } ).html( 'Lejuplādēt šo failu' );

                                        $( '.gallery2__item__information-wrapper', $jqSlideElem ).append( jqDownloadButton );
                                    }
                                } )
            
                            $( '.gallery2__item__information-wrapper', $jqSlideElem ).append( jqPreviewButton );
                        }
                        else
                        {
                            fnLoadIframe.apply( $jqSlideElem );
                            var jqDownloadButton = $( '<a />' ).attr( {
                                'href': 'javascript:void(0);',
                                'onclick': 'modalGalleryDownloadFileBtn( "' + arrHashes[ intFileIndex ] + '" )',
                                'title': 'Lejuplādēt',
                                'class': 'gallery2__item__doc-wrapper__download_button gallery2__save_button'
                            } ).html( 'Lejuplādēt šo failu' );

                            $( '.gallery2__item__information-wrapper', $jqSlideElem ).append( jqDownloadButton );
                        }
        
                    }
                }

                if(0)//( !arrDescriptions[intFileIndex] ) // AD: description isn't visible anymore
                {
                    $('.gallery2__item__desc-wrapper', $jqSlideElem).hide()
                    $( '.gallery2__item__custom_thumb', $jqSlideElem ).css({'height': 'calc( 100% - 100px )'});
                }
                
                $(".gallery2__item__custom_thumb" ).each(function() 
                {
                    var objBackground = getBackgroundSize(this);    
                    if(objBackground.width>=$('#gallery2__image-wrapper').width())
                    {
                        objBackground.width=objBackground.width-20; 
                    }
                    $(this).siblings('.gallery2__item__desc-wrapper, .gallery2__item__information-wrapper').width( objBackground.width );
                    $(this).parent().siblings('.gallery2__item__desc-wrapper, .gallery2__item__information-wrapper').width( objBackground.width );
                }); 
                $("img").each(function() 
                {
                    var intImageWidth = $(this).width();
                    if(intImageWidth>=$('#gallery2__image-wrapper').width())
                    {
                        intImageWidth=intImageWidth-20; 
                    }
                    $(this).siblings('.gallery2__item__desc-wrapper, .gallery2__item__information-wrapper').width( intImageWidth );
                });      
                $("iframe", ".gallery2__item__iframe-wrapper" ).each(function() 
                {
                    var intIframeWidth = $(this).width();
                    if(intIframeWidth>=$('#gallery2__image-wrapper').width())
                    {
                        intIframeWidth=intIframeWidth-20;   
                    }
                    $(this).siblings('.gallery2__item__desc-wrapper, .gallery2__item__information-wrapper').width( intIframeWidth );
                });
                break;
    
            case 'video':
                var bolThisVideoUseEmbedPlayer = false;
        
                var strHtml = '';
                strHtml += '<span class="gallery2__vertical-helper"></span>';
                strHtml += '<div class="gallery2__video_container">';

                if ( useEmbedPlayer( intFileIndex ) )
                {
                    bolThisVideoUseEmbedPlayer = true;
                }
        
                strHtml += "<div class='gallery2__video_wrapper //'>";
    
                if ( !arrFileAttributes[ intFileIndex ][ 'canDownload' ] && arrFileAttributes[ intFileIndex ][ 'isForSale' ] && !arrFileAttributes[ intFileIndex ][ 'hasPreviewVideo' ] ) 
                {
                    jqThumb = $( '<div class="gallery2__item__doc-icon">' )
                            .css({
                                'height': function(){
                                        if (!arrDescriptions[intFileIndex])
                                        {
                                            return 'calc( 100% - 115px )';
                                        }
                                        else {
                                            // return 'calc( 100% - 150px )';
                                            // AD: description isn't visible anymore
                                            return 'calc( 100% - 115px )';
                                        }
                                    },
                            })
                        .append(
                            $( "<img>" )
                                .css({
                                    'padding-bottom': '24px',
                                })
                                .attr( 'src', '/thumb_video_picture.php?i=' + arrHashes[ intFileIndex ] )
                                .addClass( 'gallery2__item__base-width-on-two' )
                        );
    
                    $jqSlideElem.append( '<span class="gallery2__vertical-helper"></span><span class="gallery2__item__doc-wrapper" style="height: 100%; padding-bottom:20px;"></span>' );
                    $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append( jqThumb );
                    // $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append( '<div class="gallery2__item__information-wrapper"><p class="gallery2__item__doc-filename">' + arrDisplayNames[ intFileIndex ] + '</p></div>' );
                    if( arrDescriptions[intFileIndex] )
                    {
                        // $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append( '<div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p></div>');
                    }
                    // JV: slikti izskatas pardodamajiem video failiem, ka "nav kautkas pieejams" - nonemu
					//$( '.gallery2__item__doc-wrapper', $jqSlideElem ).append( '<p class="gallery2__item__doc-nopreview">Faila priekšskatījums nav pieejams</p>' );
                    break;
                }
                
                if ( bolThisVideoUseEmbedPlayer )
                {
                    var strAutoload = 'off';

                	if ( arrExtensions[ intFileIndex ] == 'mp4' )
                	{
                		strAutoload = 'on';
                	}
                    
                    strHtml += '<div class="gallery2__video_container__embed_palyer">';
                    strHtml += '<script type="text/javascript" src="/embed/playerv2?hash=' + arrHashes[ intFileIndex ] + 
                        '&autoload=' + strAutoload + '&autoplay=off&w=auto&h=auto&poster_src=/thumb_video_picture.php?i=' + arrHashes[ intFileIndex ] +
                        '' + ( arrFileAttributes[ intFileIndex ][ 'readOnly' ] ? '&readOnly=1' : '' ) + '" ' +
                        'id="filesfm_embed_js__' + arrHashes[ intFileIndex ] + '"><' + '/script>';
                    strHtml += '</div>';
                }
                else
                {
                    var strVideoSrc = 'https://' + arrFileHost[ intFileIndex ]  + '/thumb_video/' + arrHashes[ intFileIndex ] + '' + strHttpCacheKey + '.mp4?v=1681335634&PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8';

                	                    if ( arrExtensions[ intFileIndex ] == 'mp4' && ! arrFileAttributes[ intFileIndex ][ 'hasVideoThumb' ]  )
                    {
                    	$.get( strVideoSrc, function() {} );
                    	strVideoSrc = 'https://' + arrFileHost[ intFileIndex ]  + '/down.php?i=' + arrHashes[ intFileIndex ] + '&PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8&pv=1&' + strHttpCacheKey + '.mp4';
                    }
                                     
                    strHtml += '<video playsinline id="video_' + arrHashes[ intFileIndex ] + '">'; //AD: playsinline fixes double controls on iPhone
                    strHtml += '<div class="video_thumb_gen" style="visibility: hidden;" id="video_thumb_gen_' + arrHashes[ intFileIndex ] + '">Tiek veidots video priekšskatījums,<br /> lūdzu uzgaidiet!<br /><br /><i class="fa fa-spin fa-spinner"></i></div>';
                    strHtml += '<source src="' + strVideoSrc + '" type="video/mp4">Your browser does not support the video tag.';
                    strHtml += '</video>';
                    strHtml += '<script type="text/javascript">';
                    strHtml += 'document.getElementById("video_' + arrHashes[ intFileIndex ] + '").addEventListener("error", function(){' +
                        '        var me_ = this;' +
                        '        if (me_.src.indexOf("' + arrHashes[ intFileIndex ] + '") === -1) return;' +
                        '        last_video_src = me_.src;' +
                        '        me_.src = "";' +
                        '        setTimeout(function(){me_.src=last_video_src}, 500);' +
                        '    });';
                    strHtml += '<'+'/script>';
                }

                strHtml += "<div class='gallery2__video_wrapper_bottom'>";
                // strHtml += " <div class='gallery2__item__information-wrapper'></div>";
                /*
                if ( !bolThisVideoUseEmbedPlayer )
                {
                    if ( arrFileAttributes[ intFileIndex ][ 'isForSale' ] )
                    {
                    	strHtml += '<div class="gallery2__video_previewtext">Šis ir priekšskatījums. Jūs varat iegādāties pilnu video.</div>';
                    }
                    else
                    {
	                    strHtml += '<div class="gallery2__video_previewtext">Šis ir priekšskatījums, samazinātā kvalitātē.</div>';
                    }
                }
                */

                /*
                if( arrDescriptions[intFileIndex] )
                {
                    strHtml += '<div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p></div>';
                }
                */
                
                //strHtml += '<div class="gallery2__video_filename-download">';
                //strHtml += '<div class="gallery2__video_downloadbutton gallery2__buy_button bx_allow_events" onclick="showBuyFileFormModal(strCurrentFileHash)">Pirkt šo produktu</div>';

                //strHtml += '</div>';
                strHtml += '</div>';
                strHtml += "</div>";

                strHtml += "</div>";

                $jqSlideElem.append( strHtml );

                /*
                function updateVideoDescriptionWidth()
                {

                    $('.gallery2__item__base-width-on-two, .vjs-poster, .filesfm__embed_player__container').each(function() 
                    {
                        var intVideoWidth = $(this).width();
                        if(intVideoWidth>=$('#gallery2__image-wrapper').width())
                        {
                            intVideoWidth=intVideoWidth-20;   
                        }
                        $(this).parent().parent().find('.gallery2__item__desc-wrapper, .gallery2__item__information-wrapper').width(intVideoWidth);
                    });
                }
                updateVideoDescriptionWidth();
                */
                
                if ( arrFileTypes[ intFileIndex ] === 'video' )
                {
                    if ( !useEmbedPlayer( intFileIndex ) )
                    {
                        initVideoPlayer( intFileIndex );
                    }
                    else
                    {
                        //fitEmbedPlayer( $( "#gallery2__item-" + intCurrentFileIndex + " .filesfm__embed_player__container" ) );
                    }
                }
                break;
    
            case 'audio':
                
                    var bolThisAudioUseEmbedPlayer = false;

                    if (
                        false && // Disable embed audio player
                        useEmbedPlayer( intFileIndex )
                    )
                    {
                        bolThisAudioUseEmbedPlayer = true;
                    }
        
                    if (bolThisAudioUseEmbedPlayer)
                    {
                        $jqSlideElem.append( '<span class="gallery2__vertical-helper"></span><div class="gallery2__item__audio-wrapper">' + arrDisplayNames[intFileIndex] + '<br>'+'<script type="text/javascript" src="/embed/playerv2?hash=' + arrHashes[intFileIndex] + '&autoload=on&autoplay=off&w=100%&h=auto" id="filesfm_embed_js__' + arrHashes[intFileIndex] + '"><'+'/script>'+'</div>' );
                        $jqSlideElem.append( '<div class="gallery2__item__information-wrapper"></div>' );
                        if( arrDescriptions[intFileIndex] )
                        {
                            $jqSlideElem.append( '<div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p></div>');
                        }
    
                    }

                    else if ( arrAllowDownload[ intFileIndex ] || false || arrFileAttributes[ intFileIndex ].readOnly || arrFileAttributes[ intFileIndex ].hasPreviewVideo )
                    {
                        var strAllHashes = '';
                        for ( var strHash in arrHashes )
                        {
                            strAllHashes += ',' + strHash;
                        }
                        if( objAudioPlayer === null || ( objAudioPlayer.getAllUploadFileHashes() !== strAllHashes ) )
                        {
                            if ( objAudioPlayer !== null )
                            {
                                objAudioPlayer.destroy();
                                objAudioPlayer = null;
                            }

                            objAudioPlayer = new AudioPlayer();
                            objAudioPlayer.loadTracksFromGlobalArrays();
                            if ( objMainShareParams != null && typeof( objMainShareParams['all_files'] ) !== 'undefined')
                            {
                                if ( typeof PublicProfile != 'undefined' && PublicProfile.openFolderDisplayName != '' )
                                {
	                            	objAudioPlayer.setPlayListTitle( PublicProfile.openFolderDisplayName );
                                }
                                else if ( typeof PublicProfile != 'undefined' && PublicProfile.strProfileName != '' )
                                {
	                            	objAudioPlayer.setPlayListTitle( PublicProfile.strProfileName );
                                }
                                else
                                {
	                                objAudioPlayer.setPlayListTitle( strFolderName );
                                }
                            }
                            objAudioPlayer.setCurrentTrackByHash( arrHashes[ intFileIndex ] );
                            objAudioPlayer.setAllUploadFileHashes( strAllHashes );
                            objAudioPlayer.setIsPlayerForOneFile( arrHashes.length == 1 );
                            objAudioPlayer.getElem().addEventListener( 'audioTrackLoaded', function ( data )
                                {
                                    var hash = data.detail.strHash;
                                    
                                    if( arrHashes.indexOf( hash ) !== -1 && arrHashes[ intCurrentFileIndex ] !== hash )
                                    {
                                        galleryChangeLocation ( getItemLink( hash ) );
                                    }
                                }
                            );
                            objAudioPlayer.getElem().addEventListener( 'audioTrackLikeChange', function ( data )
                                {
                                    var hash = data.detail.track.strHash;
                                    var bolState = data.detail.state;
                                    var intFileIdx;
        
                                    if ( strCurrentFileHash === hash )
                                    {
                                        intFileIdx = intCurrentFileIndex;
                                    }
                                    else
                                    {
                                        for ( var i in arrHashes )
                                        {
                                            if ( arrHashes.hasOwnProperty( i ) && arrHashes[ i ] === hash )
                                            {
                                                intFileIdx = +i;
                                                break;
                                            }
                                        }
                                    }
        
                                    bolState ? arrVoteCounts[ intFileIdx ]++ : arrVoteCounts[ intFileIdx ]--;
                                    arrHasVoted[ intFileIdx ] = bolState ? 1 : 0;
                                    galleryUpdateVoteCount();
                                }
                            );
                        }
                        $jqSlideElem.append( "<span class=\"gallery2__vertical-helper\"></span>" );
                        var jqItemAudioWrapper = $( "<div class=\"gallery2__item__audio-wrapper\"></div>" );

                        jqItemAudioWrapper.appendTo( $jqSlideElem );

                        objAudioPlayer.appendTo( jqItemAudioWrapper );

                        //jqItemAudioWrapper.append( '<div class="gallery2__item__information-wrapper"></div>');
                        //jqItemAudioWrapper.append( '<br/><div style="text-align: center;"><div class="gallery2__video_downloadbutton gallery2__buy_button bx_allow_events" onclick="showBuyFileFormModal(strCurrentFileHash)">Pirkt šo produktu</div></div>' );
                        /* AD: description isn't visible anymore
                        if( arrDescriptions[intFileIndex] )
                        {
                            jqItemAudioWrapper.append( '<div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p></div>');
	                    }
                        */
	                }
	                else
	                {
	                    var jqThumb = $( '<i />' ).addClass( 'fa-5x fa ' + arrIconClass[intFileIndex] );
                        if ( typeof( arrIconSvg ) !== 'undefined' && arrIconSvg[ intFileIndex ] )
                        {
                            jqThumb = $( '<img />' ).attr('src', '/images/file_types_v2/' + arrIconSvg[ intFileIndex ]).addClass('ext-icon');
                        }
	                    $jqSlideElem.append( '<span class="gallery2__vertical-helper"></span><span class="gallery2__item__doc-wrapper"></span>' );
	                    $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append( jqThumb );
	                    $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append( '<div class="gallery2__item__information-wrapper"><p class="gallery2__item__doc-filename">' + arrDisplayNames[intFileIndex] + '</p></div>' );
                        if( arrDescriptions[intFileIndex] )
                        {
                            $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append( '<div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p></div>');
	                    }
	                }
                    
                    function updateAudioDescriptionWidth()
                    {
                        $('i, .audio_player ').each(function()
                        {
                            var intVideoWidth = $(this).outerWidth();
                            if(intVideoWidth>=$('#gallery2__image-wrapper').width())
                            {
                                intVideoWidth=intVideoWidth-20;   
                            }
                            $(this).parent().find('.gallery2__item__desc-wrapper, .gallery2__item__information-wrapper').width(intVideoWidth);
                        });        
                    }
                    updateAudioDescriptionWidth();
                break;

                case 'image-raw':
                    // Beware! This has been heavily based on previously made code and its flaws.
                        
                    // Main container for file info/buttons/etc.
                    var $jqMainContainerHelper = $( '<span class="gallery2__vertical-helper"></span>' );
                    var $jqMainContainer = $( '<span class="gallery2__item__doc-wrapper"></span>' );

                    // Icon container
                    var $jqIconContainer = $( '<span class="gallery2__item__doc-icon ' + arrExtensions[ intFileIndex ].toLowerCase() + '"></span>' );

                    // File type icon
                    var $jqIcon = $('<i class="fa-5x fa ' + arrIconClass[ intFileIndex ] + '"></i>');
                    if ( typeof( arrIconSvg ) !== 'undefined' && arrIconSvg[ intFileIndex ] )
                    {
                        $jqIcon = $( '<img />' ).attr('src', '/images/file_types_v2/' + arrIconSvg[ intFileIndex ]).addClass('ext-icon');
                    }
                    $jqIconContainer.append($jqIcon);

                    // Loading icon
                    var $jqLoadingIcon = $('<i class="fa-5x fa fa-spinner fa-spin"></i>').hide();
                    $jqIconContainer.append($jqLoadingIcon);

                    // Error icon
                    var $jqErrorIcon = $('<i class="fa-5x fa fa-times"></i>').hide();
                    $jqIconContainer.append($jqErrorIcon);

                    // Add the icon container to the main container
                    $jqMainContainer.append( $jqIconContainer );

                    // Filename
                    var $jqFileName = $( '<p class="gallery2__item__doc-filename">' + arrDisplayNames[ intFileIndex ] + '</p>' );
                    $jqMainContainer.append( $jqFileName );

                    // A container for buttons/actions
                    var $jqButtonContainer = $('<div />').css({'white-space': 'normal'});
        
                    // P2P download button
                    if (
                        bolShowP2PDownloadButton
                        && ( typeof( objWebTorrentDownloadForm ) === 'object' || ! bolIsListViewForSpecificFile )
                        && arrFeeDownloadPrice[ intFileIndex ] == null
                        && arrAllowDownload[ intFileIndex ]
                        && ( arrAccessType[ intFileIndex ] === 'LINK' || arrAccessType[ intFileIndex ] === 'PUBLIC' )
                        && arrUploadPassword[ intFileIndex ] === ''
                        && arrAllowPublicDownload[ intFileIndex ]
                    )
                    {
                        var $jP2PDownloadButton = $( '<a />' ).attr( {
                            'href': 'javascript:void(0);',
                            'onclick': 'modalGalleryDownloadFileP2PBtn(' + intFileIndex + ')',
                            'class': 'gallery2__item__doc-wrapper__download_button gallery2__p2p_save_button'
                
                        } ).html( 'Lejuplādēt ar P2P' );

                        // Add the P2P download button to the button container
                        $jqButtonContainer.append( $jP2PDownloadButton ).append( ' ' );
                    }

                    // Download button 
                    var $jqDownloadButton = $( '<a />' ).attr( {
                        'href': 'javascript:void(0);',
                        'onclick': 'modalGalleryDownloadFileBtn( "' + arrHashes[ intFileIndex ] + '" )',
                        'title': 'Lejuplādēt',
                        'class': 'gallery2__item__doc-wrapper__download_button gallery2__save_button'
                
                    } ).html( 'Lejuplādēt šo failu' );

                    // Add the download button to the button container
                    $jqButtonContainer.append( $jqDownloadButton );
                    
    
                    // Holds the load image timeout
                    var intLoadImageTimeout;

                    // Holds the image
                    var $jqImg;

                    var fnLoadImageFailed = function()
                    {
                        clearTimeout(intLoadImageTimeout);
                        $jqImg.remove();

                        $jqIcon.hide();
                        $jqErrorIcon.show();
                        $jqLoadingIcon.hide();
                    }
                    
                    var fnLoadImageSucceeded = function()
                    {
                        clearTimeout(intLoadImageTimeout);

                        $jqMainContainer.empty().append($jqImg);
                    }

                    var fnLoadImage = function()
                    {
                        $jqPreviewButton.hide();

                        $jqIcon.hide();
                        $jqErrorIcon.hide();
                        $jqLoadingIcon.show();

                        var strImageURL = 'https://'+ arrFileHost[ intFileIndex ] +'/thumb_show.php?i=' + arrHashes[intFileIndex] + '&view';
                        if (arrFeeDownloadPrice[intFileIndex] > 0)
                        {
                            strImageURL += '&wm=103';
                        }

                        if ( typeof( arrFileVersion ) != 'undefined' && typeof( arrFileVersion[ intFileIndex ] ) != 'undefined' && arrFileVersion[ intFileIndex ] > 0 )
                        {
                            strImageURL += '&version=' + arrFileVersion[ intFileIndex ];
                        }

                        $jqImg = $('<img>').attr('src', strImageURL);

                        intLoadImageTimeout = setTimeout(function() {
                            fnLoadImageFailed();
                        }, 30000);

                        $jqImg.on('load', function() 
                        {
                            if (!this.complete || typeof this.naturalWidth == "undefined" || this.naturalWidth == 0) 
                            {
                                fnLoadImageFailed();
                            } else {
                                fnLoadImageSucceeded();
                            }
                        });
                        
                    }

                    var $jqPreviewButton = $( '<a />' );

                    $jqPreviewButton.attr( {
                                'href': 'javascript:void(0);',
                                'title': 'Lejuplādēt',
                                'class': 'gallery2__item__doc-wrapper__download_button gallery2__save_button gallery2__item__doc-wrapper__download_button gallery2__preview_button'
                            } );
                    
                    $jqPreviewButton.css( "marginLeft", "0px" );

                    $jqPreviewButton.html( 'Apskatīt šo failu' );
                    
                    $jqPreviewButton.click( function() { fnLoadImage(); } );
                                
                    
                    $jqButtonContainer.append("<br />");

                    // Add the preview button to the button container
                    $jqButtonContainer.append( $jqPreviewButton );


                    // Add the buttons container to the main item info container
                    $jqMainContainer.append($jqButtonContainer);

                    // Add the helper and the main container to the DOM
                    $jqSlideElem.append( $jqMainContainerHelper );
                    $jqSlideElem.append( $jqMainContainer );


                    break;

                case 'url' :
                {
            		var jqThumb;
                    
                    if ( arrFileAttributes[ intFileIndex ][ 'hasCustomThumb' ] )
                    {
                        jqThumb = $( "<div>" ).css({
                            'background-image': 'url("/thumb.php?i=' + arrHashes[ intFileIndex ] + '")',
                            'height': function(){
                                if(0) //( !arrDescriptions[intFileIndex] ) // AD: description isn't visible anymore
                                {
                                    return 'calc( 100% - 115px )';
                                }
                            }
                        })
                        .addClass( 'gallery2__item__custom_thumb gallery2__item__base-width-on' );
                    }
                    else
                    {
                        jqThumb = $( '<i />' ).addClass( 'fa-5x fa ' + arrIconClass[intFileIndex] );
                        if ( typeof( arrIconSvg ) !== 'undefined' && arrIconSvg[ intFileIndex ] )
                        {
                            jqThumb = $( '<img />' ).attr('src', '/images/file_types_v2/' + arrIconSvg[ intFileIndex ]).addClass( 'gallery2__item__base-width-on ext-icon' );
                        }
                    }

                    if ( arrFeeDownloadPrice[intFileIndex] > 0 )
                    {
                    	if (bolIsOwner)
                        {
                            jqThumb.attr( 'onclick', 'showSetPriceFormModal(strCurrentFileHash)' );
                        }
                        else 
                        {
                            jqThumb.attr( 'onclick', 'showBuyFileFormModal(strCurrentFileHash)' );
                        }
                    	jqThumb.addClass( 'bx_allow_events' );
                    	jqThumb.addClass( 'has_price' );
                    }


                    $jqSlideElem.append( '<span class="gallery2__vertical-helper"></span><span class="gallery2__item__doc-wrapper' + ( arrFileAttributes[ intFileIndex ][ 'hasCustomThumb' ] ? ' has_custom_thumb' : '' ) + '"></span>' );
                    $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append( jqThumb );
                    
        
                    var jqButtonContainer = $('<div />').css({'white-space': 'normal'});

                    if ( arrFeeDownloadPrice[ intFileIndex ] == null )
                	{
                        var $jqSlideElem = $( $jqSlideElem ).closest( ".gallery2__item" );
                        var intFileIndex = $jqSlideElem.attr( 'id' ).split( "-" ).slice( -1 )[ 0 ];
            			
                        $jqSlideElem.prepend( '<div class="gallery2__item__iframe-wrapper" id="gallery2__item__iframe-wrapper__' + intFileIndex + '"><div class="gallery2__item__iframe-loading"><span class="gallery2__vertical-helper"></span><i class="fa fa-spinner fa-spin"></i></div><iframe class="gallery2__item__base-width-on" src=""></iframe><div class="gallery2__item__information-wrapper"></div><div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p></div></div>' );
            			
                        arrIframeTimers[ intFileIndex ] = setTimeout( function ()
                        {
                            $( '#gallery2__item__iframe-wrapper__' + intFileIndex ).hide();
                        }, 30000 );
    
                        $.get( 'https://'+ arrFileHost[ intFileIndex ]  + '/down.php?i=' + arrHashes[ intFileIndex ] + '&gpv=1&view=1&truemimetype=1', function( strFileContent )
                        {
                        	$( 'iframe', $jqSlideElem )
                                .attr( 'src', strFileContent )
                                .attr( 'onload', 'clearTimeout( arrIframeTimers[ ' + intFileIndex + ' ] );' )
                                .css({
                                    'height': function()
                                    {
                                        if ( arrDescriptions[intFileIndex] )
                                        {
                                            // return 'calc( 100% - 150px )';
                                            // AD: description isn't visible anymore
                                            return 'calc( 100% - 60px )';
                                        }
                                        else 
                                        {
                                            return 'calc( 100% - 60px )';
                                        }
                                    },
                                    "background": "white",
                                })
                    	} );
                	} 
                    else 
                    {
                        $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append( '<div class="gallery2__item__information-wrapper"><p class="gallery2__item__doc-filename">' + arrDisplayNames[intFileIndex] + '</p></div>' );
                        $( '.gallery2__item__doc-wrapper', $jqSlideElem ).append( '<div class="gallery2__item__desc-wrapper"><p class="gallery2__item__desc-wrapper-text">' + arrDescriptions[intFileIndex] + '</p></div>');
                    }
                    if( !arrDescriptions[intFileIndex] )
                    {
                        $('.gallery2__item__desc-wrapper', $jqSlideElem).hide();
                    }
                    
                    function updateURLDescriptionWidth()
                    {
                        $(".gallery2__item__base-width-on" ).each(function() {
                            switch(this.tagName) 
                            {
                                case 'IMG':
                                    intElementWidth =  $( this ).width();
                                    break;
                                case 'DIV':
                                    var objBackground = getBackgroundSize(this);
                                    intElementWidth = objBackground.width;
                                    break;
                                case 'IFRAME':
                                    intElementWidth =  $( this ).width();
                                    break;
                                default:
                                    intElementWidth =  $( this ).width();
                                    break;
                            }
                            if(intElementWidth>=$('#gallery2__image-wrapper').width())
                            {
                                intElementWidth=intElementWidth-20;   
                            }
                            $(this).siblings('.gallery2__item__desc-wrapper, .gallery2__item__information-wrapper').width( intElementWidth );   
                        }); 
                                   
                    }
                    updateURLDescriptionWidth();
                	break;
                }
        }

        if ( arrFileTypes[ intCurrentFileIndex ] !== 'audio' )
        {
            var jqPreviewButton = $( '<a />' ).attr( {
                'href': 'javascript:void(0);',
                'title': function() {
                            if (bolIsOwner)
                            {
                                return 'Pārdot';
                            }
                            else 
                            {
                                return 'Pirkt';
                            }
                        },
                'class': 'gallery2__buy_button',
                'style': "display:none;"
            } ).html( function(){
                if ( arrFeeDownloadPrice[ intCurrentFileIndex ] )
                    {
                        return 'Pirkt šo produktu (' + arrFeeDownloadPrice[ intCurrentFileIndex ] + ' &euro;)';
                    }
                    else 
                    {
                        return 'Pirkt šo produktu';
                    }
            } )
                .click( function() { 
                    if (bolIsOwner)
                    {
                        return showSetPriceFormModal(strCurrentFileHash);
                    }
                    else 
                    {
                        return showBuyFileFormModal(strCurrentFileHash);
                    }
            } )

            $( '.gallery2__item__information-wrapper', $jqSlideElem ).append( jqPreviewButton );
        }
        
        if ($('.gallery2__item__information-wrapper', $jqSlideElem).find('.gallery2__preview_button').length<1) 
        {
            var jqDownloadButton = $( '<a />' ).attr( {
                'href': 'javascript:void(0);',
                'onclick': 'modalGalleryDownloadFileBtn( "' + arrHashes[ intFileIndex ] + '" )',
                'title': 'Lejuplādēt',
                'class': 'gallery2__item__doc-wrapper__download_button gallery2__save_button'
            } ).html( 'Lejuplādēt šo failu' );

            $( '.gallery2__item__information-wrapper', $jqSlideElem ).append( jqDownloadButton );
        }
        
        $('a', $jqSlideElem).addClass( 'bx_allow_events' );
        $('a', $jqSlideElem).find( "*" ).addClass( 'bx_allow_events' );
        $('.gallery2__video_downloadbutton', $jqSlideElem).find( "*" ).addClass( 'bx_allow_events' );

        $jqSlideElem.addClass( 'content_ready' );
    }

    function adjustDescriptionWidth() 
    {
        var intElementWidth;
        $(".gallery2__item__base-width-on").each(function() 
        {
            switch(this.tagName) 
            {
                case 'IMG':
                case 'IFRAME':
                    intElementWidth =  $( this ).width();
                    break;
                case 'DIV':
                    var objBackground = getBackgroundSize(this);
                    intElementWidth = objBackground.width;
                    break;
                default:
                intElementWidth =  $( this ).width();
                    break;
            }
            if(intElementWidth>=$('#gallery2__image-wrapper').width())
            {
                intElementWidth=intElementWidth-20;   
            }
            $(this).siblings('.gallery2__item__desc-wrapper, .gallery2__item__information-wrapper').width( intElementWidth );            
        });
        $('.gallery2__item__base-width-on-two').each(function() 
        {
            switch(this.tagName) 
            {
                case 'IMG':
                    intElementWidth =  $( this ).outerWidth();
                    break;
                case 'DIV':
                    var objBackground = getBackgroundSize(this);
                    intElementWidth = objBackground.width;
                    break;
                default:
                    intElementWidth =  $( this ).outerWidth();
                    break;
            }
            if(intElementWidth>=$('#gallery2__image-wrapper').width())
            {
                intElementWidth=intElementWidth-20;   
            }
            $(this).parent().parent().find('.gallery2__item__desc-wrapper, .gallery2__item__information-wrapper').width(intElementWidth);
        });
        $('.vjs-poster, .filesfm__embed_player__container, .audio_player').each(function() 
        {
            intElementWidth =  $( this ).outerWidth();
            if(intElementWidth>=$('#gallery2__image-wrapper').width())
            {
                intElementWidth=intElementWidth-20;   
            }
            $(this).parent().parent().find('.gallery2__item__desc-wrapper, .gallery2__item__information-wrapper').width(intElementWidth);
        });
    }
    adjustDescriptionWidth();

    function resizeend()
    {
        adjustDescriptionWidth();
    }

    var intTimer;
    window.addEventListener('resize', function()
    {
        //source: https://stackoverflow.com/questions/5489946/how-to-wait-for-the-end-of-resize-event-and-only-then-perform-an-action
        clearTimeout(intTimer);
        intTimer = setTimeout(resizeend, 300);
        adjustDescriptionWidth();
    });
    
    function registerEmbedPlayerFileEventCallback( strFileHash, fncCallback )
    {
        var intEmbedPlayerFileIndex = getItemIndex ( strFileHash );
        if ( intEmbedPlayerFileIndex !== null && typeof fncCallback === 'function' )
        {
            objEmbedPlayerFileEventCallback[ intEmbedPlayerFileIndex ] = fncCallback;
        }
    }
    
    function callEmbedPlayerFileEventCallback( strEventCode, intFileIndex )
    {
        if ( typeof( objEmbedPlayerFileEventCallback[intFileIndex] ) === 'function' )
        {
            objEmbedPlayerFileEventCallback[intFileIndex]( strEventCode );
        }
    }
    
    function galleryOpenPrevItem()
    {
    	if ( intPreviousIndex != null && !isNaN( intPreviousIndex ))
		{
            galleryChangeLocation ( getItemLink ( arrHashes[intPreviousIndex] ) );
            adjustDescriptionWidth();
		}
	}
    function galleryOpenNextItem()
    {
    	if ( bolGalleryIsVisible && intNextIndex != null && !isNaN( intNextIndex ))
		{
            galleryChangeLocation ( getItemLink ( arrHashes[intNextIndex] ) );
            adjustDescriptionWidth();
		}
	}

	var resThumbLoadTimeout;

    function gallerySelectThumb( intItemIndex )
    {
		if ( bolGalleryIsVisible && bolGalleryInitalizedState < 1 )
		{
			// If dom not loaded yet, wait for it to load.
			setTimeout('gallerySelectThumb( '+ intItemIndex +' )', 100);
			return;
		}
		if (jqThumbViewport == null)
		{
			jqThumbViewport = $('#gallery2__thumb-strip');
		}
		var intViewportWidthPx = jqThumbViewport.width();

		if (jqThumbContainer == null)
		{
			jqThumbContainer = $('#gallery2__thumb-strip__inner');
		}

		var jqThumb = $('A.thumb_' + arrHashes[intItemIndex], jqThumbContainer);

		function onThumbReady()
        {
            var intThumbPossitionLeftPx = jqThumb.position().left;
            // If scrollable on mobile
            if (jqThumbViewport.css('overflow-x')=='auto')
            {
                var intThumbPossitionLeftPx = jqThumb[0].offsetLeft;
                var intThumbOffsetLeftPx = galleryCalculateOffset(jqThumb[0]).left;
                var intScrollLeft = jqThumbViewport.scrollLeft();

                var jqThImg = $('IMG', jqThumb);
                var intThisThumbWidth = intThumbWidth;
                
                if ( intThisThumbWidth < intThumbWidth )
                    intThisThumbWidth = intThumbWidth;

                if ( intThumbOffsetLeftPx + intScrollLeft > intViewportWidthPx + intScrollLeft - intThisThumbWidth )
                {
                    jqThumbViewport.scrollLeft( intThumbOffsetLeftPx + intScrollLeft - intViewportWidthPx + intThisThumbWidth );
                }
                else if (intThumbOffsetLeftPx < 0)
                {
                    jqThumbViewport.scrollLeft( intThumbPossitionLeftPx  );
                }

            }
            else
            {
                var intThumbOffsetLeftPx = jqThumb.offset().left;

                var jqThumbStrip = $('#gallery2__thumb-strip');
                var jqThumbStripInner = $('#gallery2__thumb-strip__inner');

                var intThumbWidthSum = 0;
                $('A', jqThumbStripInner).each(function (){
                    intThumbWidthSum += $(this).width();
                });

                var bolThumbsAreOutside = false;
                if (
                    jqThumbStrip.width() <= intThumbWidthSum
                )
                {
                    bolThumbsAreOutside = true;
                }

                if ( $( '#gallery2' ).hasClass( 'gallery__sidebar-visible' ) )
                {
                    intThumbOffsetLeftPx = intThumbOffsetLeftPx -360;
                }

                if ( ! bolThumbsAreOutside )
                {
                    jqThumbContainer.css({'left': '0px'});
                }
                else
                {
                    /**** If outside viewport ****/
                    // If outside to the right
                    if ( intThumbOffsetLeftPx < 0 )
                    {
                        var jqThImg = $('IMG', jqThumb);
                        var intThisThumbWidth = intThumbWidth;
                        
                        if ( intThisThumbWidth < intThumbWidth )
                            intThisThumbWidth = intThumbWidth;

                        var intSetLeftPx = (-1*intThumbPossitionLeftPx + intThisThumbWidth );
                        jqThumbContainer.css({'left': intSetLeftPx + 'px'});
                    }
                    // else - outside to left
                    else if ( intThumbOffsetLeftPx > intViewportWidthPx - 360 )
                    {

                        var jqThImg = $('IMG', jqThumb);
                        var intThisThumbWidth = intThumbWidth;
                        
                        if ( intThisThumbWidth < intThumbWidth )
                            intThisThumbWidth = intThumbWidth;

                        var intSetLeftPx = -1*intThumbPossitionLeftPx + intViewportWidthPx - intThisThumbWidth - intThumbWidth;
                        jqThumbContainer.css({'left': intSetLeftPx + 'px'});
                    }
                    /****/
                }
                checkThumbStripArrows();
            }

            $('A.active', jqThumbContainer).removeClass('active');
            jqThumb.addClass('active');

            setTimeout("checkThumbStripArrows()", 500);
            setTimeout("galleryLazyloadRecalc()", 500);
        }

        if ( $('IMG', jqThumb).length===0 || ( $('IMG', jqThumb)[0].complete && $('IMG', jqThumb).attr('src')===$('IMG', jqThumb).attr('data-original') ) )
        {
            onThumbReady();
        }
        else
        {
            $('IMG', jqThumb).on('load', function (){
                if ($(this).attr('src') === $(this).attr('data-original'))
                {
                    onThumbReady();
                }
            });

            var intElementIndex = jqThumb.index();
            if (jqThumbViewport.css('overflow-x') == 'auto')
            {
                jqThumbViewport.scrollLeft(intElementIndex * intThumbWidth);
            }
            else
            {
                jqThumbContainer.css({'left': (-1 * (intElementIndex + 2) * intThumbWidth) + 'px'});
            }

            galleryLazyloadRecalc();
            setTimeout( function (){ galleryLazyloadRecalc(); }, 1000);
            setTimeout( function (){ galleryLazyloadRecalc(); }, 5000);
        }
	}
    
    function closeGallery(strScrollHash)
    {
        if ( ! bolGalleryIsVisible )
            return;

        $( 'html' ).css( 'overflow', 'auto' );
        $( '#gallery2' ).fadeOut( 'fast' );

        $('#gallery_panzoomdiv').css('display', 'none');
        $('#gallery2__content-wrapper').removeClass( 'gallery__only_image' );
        $('#gallery2__content-wrapper').removeClass( 'gallery__is_image' );
        
        if ( strGalleryCloseHashtag )
        {
            window.location.hash = strGalleryCloseHashtag;
        }
		else
		{
            if ( window.location.href.indexOf( "filebrowser" ) !== -1 )
            {
                var intIndexOfView = window.location.hash.indexOf(';/view/');
                if (intIndexOfView == -1)
                {
                    intIndexOfView = window.location.hash.indexOf('/view/');
                    if (intIndexOfView == -1)
                    {
                        intIndexOfView = window.location.hash.length;
                    }
                }
    
                history.replaceState( null, '', ('' + window.location).split('#')[0] + window.location.hash.slice(0, intIndexOfView))
            }
            else
            {
                                history.replaceState( 'gallery', document.title, ('' + window.location).split('#')[0] );
                            }
		}
        
		bolGalleryIsVisible = false;
        strCurrentFileHash = null;

		stopActiveContent();
		
		if ($('#share_popup').is(":visible"))
        {
            hideSharePopup();
        }
    
        if ( typeof window.FileEmbedPopup !== 'undefined' )
        {
            window.FileEmbedPopup.hidePopup();
        }
        
                
        if ( !bolDisableGalleryChat && strActiveCommentsEntityHash != "" ) {
            ChatFM.resetChat();
            strActiveCommentsEntityHash = "";
        }


        
        if($("#item_"+strScrollHash).length)
        {
            if ( window.location.href.indexOf( "filebrowser" ) !== -1 )  /* for filebrowser */
            {
                var myElem = document.getElementById("item_"+strScrollHash);
                let topOffset = myElem.getBoundingClientRect().top;

                while (myElem != document.documentElement) {
                    myElem = myElem.parentElement;
                    topOffset += myElem.scrollTop;
                }
                
                $(".main_content").animate({scrollTop: topOffset - $(".main_content").height() / 2});
            }
            else
            {
                $(document.body).animate({
                    scrollTop: $("#item_"+strScrollHash).offset().top - window.innerHeight / 2
                }, 1000);
            }
            $("#item_"+strScrollHash).addClass('active-hover');
        }
    }

    function showGalleryInfo()
    {
        var $gallery_content = $( '#gallery2__content' );
        if( $gallery_content.hasClass( 'gallery__sidebar__info-visible' ) && $gallery_content.hasClass( 'gallery__sidebar-visible' ) )
        {
        	bolGallerySidebarVisible = false;
            bolGalleryCommentsVisible = false;
            $gallery_content.removeClass( 'gallery__sidebar-visible' );
            $( '#gallery2' ).removeClass( 'gallery__sidebar-visible' );
        }
        else
        {
            $gallery_content.removeClass( 'gallery__sidebar__comments-visible' ).addClass( 'gallery__sidebar__info-visible' );

            if( !$gallery_content.hasClass( 'gallery__sidebar-visible' ) )
            {
                $gallery_content.addClass( 'gallery__sidebar-visible' );
                $( '#gallery2' ).addClass( 'gallery__sidebar-visible' );
            }
            
        	bolGallerySidebarVisible = true;
        	galleryLoadFileInfo();
        }
        
        adjustContentWidth(true);
        
        loadGalleryInfoAd();
    }

    function showGalleryMessages()
    {
        $( '#gallery2__content' ).addClass( 'gallery__sidebar__comments-visible' ).addClass( 'gallery__sidebar__info-visible' );
    }

    function hideGalleryMessages()
    {
        $( '#gallery2__content' ).removeClass( 'gallery__sidebar__comments-visible' ).addClass( 'gallery__sidebar__info-visible' );
    }
    
    var bolGalleryInfoAdLoaded = false;
    function loadGalleryInfoAd()
    {
    	if ( bolGalleryInfoAdLoaded ) return;
    	
    	if ( typeof fncDynamicLoadBanner_gallery2__sidebar__banner == 'function' )
    	{
	    	fncDynamicLoadBanner_gallery2__sidebar__banner();
    	}
    	
    	bolGalleryInfoAdLoaded = true;
    }

    function hideSidebar()
    {
        $( '#gallery2__content' ).removeClass( 'gallery__sidebar-visible' );
        $( '#gallery2' ).removeClass( 'gallery__sidebar-visible' );
        bolGallerySidebarVisible = false;
        bolGalleryCommentsVisible = false;
        adjustContentWidth(true);
    }

    function toggleThumbs()
    {
        $( '#gallery2__content' ).toggleClass( 'gallery__thumbs-visible' );
        
        // fire resize event after transition, so audio player knows to resize
        if( typeof objAudioPlayer !== "undefined" )
        {
            setTimeout( function() {
                var evt = document.createEvent('UIEvents');
                evt.initUIEvent('resize', true, false,window,0);
                window.dispatchEvent(evt);
            }, 300 );
        }
    }

    function hideThumbs()
    {
        $( '#gallery2__content' ).removeClass( 'gallery__thumbs-visible' );
        $( '#gallery2__thumb-strip__hide_container' ).hide();
    }

    function showThumbs()
    {
        $( '#gallery2__content' ).addClass( 'gallery__thumbs-visible' );
        $( '#gallery2__thumb-strip__hide_container' ).show();
    }
    

    function getItemLink ( strHash )
    {
    	var intIndex = null;
    	for (idx in arrIDs)
    	{
    		if (arrHashes[idx] == strHash)
    		{
    		 	intIndex = idx;
    		 	break;	
			}
		}
		
        
        
        return '';

                
        
		var strHashtag = window.location.hash;
		var intIndexOfView = strHashtag.indexOf(';/view/');
		if (intIndexOfView != -1)
	    {
	    	strHashtag = strHashtag.slice(0, intIndexOfView);
		}
		else
		{
			var intIndexOfView = strHashtag.indexOf('/view/');
			if (intIndexOfView != -1)
		    {
	    		strHashtag = strHashtag.slice(0, intIndexOfView);
			}
		}
		var intIndexOfDelimiter = strHashtag.indexOf(';/view/');
		if (intIndexOfDelimiter != -1)
	    {
	    	strHashtag = strHashtag.slice(0, intIndexOfDelimiter);
		}
		
		/*
		if (strHashtag.slice(strHashtag.length-1, strHashtag.length) == '/')
		{
			strHashtag = strHashtag.slice(0, strHashtag.length-1);
		}
		*/
				
		strHashtag = strHashtag + ( bolHashtagViewUseSemicolon ? ';' : '') + '/view/' + arrHashes[intIndex];
		
		return strHashtag;
	}
    function getItemIndex ( strHash )
    {
    	var intIndex = null;
    	for (idx in arrIDs)
    	{
    		if (arrHashes[idx] == strHash)
    		{
    		 	intIndex = idx;
    		 	break;	
			}
		}
		return intIndex;
	}
	
    function getItemIndexByHashOrName ( strHashOrName )
    {
        if( typeof arrHashes === "undefined" )
        {
            return null;
        }
        // edit: before comparisons, urldecode both strings
        strHashOrName = decodeURIComponent( strHashOrName.replace( /\+/g, ' ' ) );
    	var intIndex = null;
        for (idx in arrHashes)
        {
            if ( decodeURIComponent( arrHashes[ idx ].replace( /\+/g, ' ' ) ) === strHashOrName )
            {
                intIndex = idx;
                break;
            }
        }

        if ( intIndex === null )
        {
            var intIndex = null;
            for (idx in arrNames)
            {
                if ( decodeURIComponent( arrNames[ idx ].replace( /\+/g, ' ' ) ) === strHashOrName )
                {
                    intIndex = idx;
                    break;
                }
            }
        }

		return intIndex;
	}

    function getNextIndex ( strHash )
    {
    	var intIndex = null;
    	var intNextIndex = null;
    	for (idx in arrIDs)
    	{
    		if ( intIndex !== null )
    		{
    			intNextIndex = idx;
    			break;	
			}
    		if (arrHashes[idx] == strHash)
    		{
    		 	intIndex = idx;
			}
		}
		return parseInt(intNextIndex);
	}

    function getPreviousIndex ( strHash )
    {
    	var intPreviousIndex = null;
    	for (idx in arrIDs)
    	{
    		if (arrHashes[idx] == strHash)
    		{
    		 	break;
			}
			else
			{
				intPreviousIndex = idx;
			}
		}
		return parseInt(intPreviousIndex);
	}
	
	function preloadImage ( intIndex )
	{
		if (typeof arrIsPreloaded == 'undefined')
			arrIsPreloaded = {};

		if (typeof arrIsPreloaded[intIndex] == 'undefined')
			arrIsPreloaded[intIndex]	

		if ( arrFileTypes[intIndex] == 'image' && arrIsPreloaded[intIndex] != true )
		{
			var strHash = arrHashes[intIndex];
			var strImageURL = 'https://'+ arrFileHost[ intIndex ] +'/thumb_show.php?i=' + strHash + '&view';
			if (arrFeeDownloadPrice[intIndex] > 0)
			{
       			strImageURL += '&wm=103';
			}

            if ( typeof( arrFileVersion ) != 'undefined' && typeof( arrFileVersion[ intIndex ] ) != 'undefined' && arrFileVersion[ intIndex ] > 0 )
            {
                strImageURL += '&version=' + arrFileVersion[ intIndex ];
            }

			$("<img />").attr("src", strImageURL);
			arrIsPreloaded[intIndex] = true;
		}
	}
	
	function checkBeforeContentChange ()
	{
		intNextIndex = getNextIndex ( strCurrentFileHash );
		intPreviousIndex = getPreviousIndex ( strCurrentFileHash );
		
		if ( intNextIndex != null && !isNaN( intNextIndex ) )
		{
			$('#gallery2__controls_right').show();
		}
		else
		{
			$('#gallery2__controls_right').hide();
		}
		
		if ( intPreviousIndex != null && !isNaN( intPreviousIndex ) )
		{
			$('#gallery2__controls_left').show();
		}
		else
		{
			$('#gallery2__controls_left').hide();
		}

        //$('#vote_heart_on_image').hide();
	}
	
	function useEmbedPlayer( intFileIndex )
    {
	    
	    var bolUseEmbedPlayerForThisFiles = false;

	    if ( arrFileAttributes[ intFileIndex ][ 'readOnly' ] )
	    {
	    	bolUseEmbedPlayerForThisFiles = true;
	    }
	    else if (
                typeof ( bolUseEmbedPlayer ) == 'boolean' 
                && bolUseEmbedPlayer 
                && typeof ( bolIsAnonymousUpload ) == 'boolean' 
                && arrFeeDownloadPrice[ intFileIndex ] == null 
                && arrAllowDownload[ intFileIndex ] 
                && arrAllowPublicDownload[ intFileIndex ] 
            )
	    {
		    if ( ( [ 'm4a', 'webm', 'ogg' ] ).indexOf( arrExtensions[ intFileIndex ] ) !== -1 )
		    {
		    	bolUseEmbedPlayerForThisFiles = true;
		    }
		    else if ( arrExtensions[ intFileIndex ] == 'mp4' )
		    {
			    if ( arrViews[ intFileIndex ] < 1000 )
			    { 
			    	bolUseEmbedPlayerForThisFiles = false;
			    }
			    else 
			    {
			    	bolUseEmbedPlayerForThisFiles = true;
			    }
		    }
	    }

        return bolUseEmbedPlayerForThisFiles;
    }
	
	function checkAfterContentChange ()
	{
		if ( ! intNextIndex )
		{
			intNextIndex = getNextIndex ( strCurrentFileHash );
		}
		if ( ! intPreviousIndex )
		{
			intPreviousIndex = getPreviousIndex ( strCurrentFileHash );
		}
		
		if ( intNextIndex != null && !isNaN( intNextIndex ) )
		{
			$('#gallery2__controls_right').show();
		}
		else
		{
			$('#gallery2__controls_right').hide();
		}
		
		if ( intPreviousIndex != null && !isNaN( intPreviousIndex ) )
		{
			$('#gallery2__controls_left').show();
		}
		else
		{
			$('#gallery2__controls_left').hide();
		}
		/*** do preloading ***/
		for (var int=0; int<intPreloadImagesCount; int++)
		{
			var intPrev = intPreviousIndex - int;
			if (intPrev  >= 0)
			{
				if ( arrFileTypes[intPrev] == 'image' )
				{
					setTimeout('preloadImage ('+intPrev+')',300);
				}
			}
			var intNext = intNextIndex + int;
			if (intNext  < arrHashes.length)
			{
				if ( arrFileTypes[intNext] == 'image' )
				{
					setTimeout('preloadImage ('+intNext+')',300);
				}
			}
		}
		/*** ***/
	}

    function galleryToggleFullScreen(elem)
	{
	    if ((document.fullScreenElement !== undefined && document.fullScreenElement === null) || (document.msFullscreenElement !== undefined && document.msFullscreenElement === null) || (document.mozFullScreen !== undefined && !document.mozFullScreen) || (document.webkitIsFullScreen !== undefined && !document.webkitIsFullScreen)) {
	        if (elem.requestFullScreen) {
	            elem.requestFullScreen();
	        } else if (elem.mozRequestFullScreen) {
	            elem.mozRequestFullScreen();
	        } else if (elem.webkitRequestFullScreen) {
	            elem.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);
	        } else if (elem.msRequestFullscreen) {
	            elem.msRequestFullscreen();
	        }
	    } else {
	        if (document.cancelFullScreen) {
	            document.cancelFullScreen();
	        } else if (document.mozCancelFullScreen) {
	            document.mozCancelFullScreen();
	        } else if (document.webkitCancelFullScreen) {
	            document.webkitCancelFullScreen();
	        } else if (document.msExitFullscreen) {
	            document.msExitFullscreen();
	        }
	    }
	}

	function updateFileDescription()
	{
		$('#file_description_edit_wrapper').removeClass('has_error');
		
		$.ajax({
			type: "POST",
			dataType: "json",
			url: "./ajax/file_info.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
			data: 
			{
				'update_file_description': true ,
				'file_hash' : strCurrentFileHash ,
				'file_description' : $('#file_description_edit_wrapper textarea').val()
			} ,
			success: function(data)
			{
				if (data['status'] == 'ok')
				{
					var intItemIndex = getItemIndex(strCurrentFileHash);
					arrDescriptions[intItemIndex] = $('#file_description_edit_wrapper textarea').val();
				}
				else
				{
					$('#file_description_edit_wrapper').addClass('has_error');
				}
			} ,
			error: function()
			{
				$('#file_description_edit_wrapper').addClass('has_error');
			}
		});
	}

	function updateFileName()
	{
		$('#file_name_edit_wrapper').removeClass('has_error');
		
		$.ajax({
			type: "POST",
			dataType: "json",
			url: "./ajax/file_info.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
			data: 
			{
                'without_extension': 1 ,
				'update_file_name': true ,
				'file_hash' : strCurrentFileHash ,
				'file_name' : $('#file_name_edit_wrapper textarea').val()
			} ,
			success: function(data)
			{
				if (data['status'] == 'ok')
				{
					var intItemIndex = getItemIndex(strCurrentFileHash);
					arrDisplayNames[intItemIndex] = $('#file_name_edit_wrapper textarea').val() + '.' + arrExtensions[ intCurrentFileIndex ];
				}
				else
				{
					$('#file_name_edit_wrapper').addClass('has_error');
				}
			} ,
			error: function()
			{
				$('#file_name_edit_wrapper').addClass('has_error');
			}
		});
	}

	function showOrginal(strCurrentFileHash) 
	{
	    var intFileIndex = getItemIndexByHashOrName( strCurrentFileHash );
		window.open('https://'+ arrFileHost[ intFileIndex ]  +'/down.php?i='+ strCurrentFileHash +'&view', '_blank');
	}


    function adjustContentWidth (bolOnResize)
    {
        var intGalleryHeight = $('#gallery2').height();
        var intGalleryWidth = $('#gallery2').width();

        var intImageWrapperWidth = intGalleryWidth;
        var intThumbStripWidth = intGalleryWidth;
        var intGalleryHeaderWidth = intGalleryWidth;
        var intBannerInnerPaddingTop = 0;

        var intBannerWidth = 0;
        var intBannerHeight = 0;
        var intLeftSideWidth = 0;
        if ( bolGallerySidebarVisible || bolGalleryCommentsVisible )
        {
            intLeftSideWidth = 360;
        }
            
        if (intGalleryWidth >= 800 && intGalleryHeight >= 600)
        {
            
            if (intGalleryHeight > ( 600 + 196 + 95 ) )
            {
                intBannerInnerPaddingTop = ( (intGalleryHeight - 600 - 196 - 95) / 2 ) + 196;
            }
            else 
            {
                intThumbStripWidth = intImageWrapperWidth;

                if (intGalleryHeight < (600 + 196) )
                {
                    intGalleryHeaderWidth = intImageWrapperWidth;
                    intBannerInnerPaddingTop = 0;
                }
                else
                {
                    intBannerInnerPaddingTop = 196;
                }
            }
        }
        else
        {
            intBannerWidth = 0;
        }

        intImageWrapperWidth = intGalleryWidth - intBannerWidth - intLeftSideWidth;
        
        $('#gallery2__image-wrapper').width(intImageWrapperWidth + 'px');

        $('#gallery2__thumb-strip').width(intThumbStripWidth + 'px');

        $('#gallery2__banner__inner').css('padding-top', intBannerInnerPaddingTop +'px');

        $('#gallery2__header').width(intGalleryHeaderWidth +'px');
        
        
        if (bolOnResize)
        {
            jqMainSlider.redrawSlider();
        }
    
        if ( arrFileTypes[ intCurrentFileIndex ] === "video" )
        {
            if ( !useEmbedPlayer( intCurrentFileIndex ) )
            {
                var $video = $( "#video_" + arrHashes[ intCurrentFileIndex ] );
                if( $video.length)
                {
                    fitVideoPlayer( $video );
                }
            }
        }

        //repositionHeartButton ();

    }

    function repositionHeartButton ()
    {
        if ( ! jqMainSlider )
            return;

        if ( strCurrentFileHash !== arrHashes[ jqMainSlider.getCurrentSlide() ] )
            return;

        var jqImage = $('#main_image_' + arrHashes[ jqMainSlider.getCurrentSlide() ]);

        if ( jqImage.length )
        {
            var objImgPosition = jqImage.offset();
            $('#vote_heart_on_image').css({
                top: (jqImage[0].y + jqImage.height() -110) + 'px',
                left: (objImgPosition.left + jqImage.width() -50) + 'px'
            });

            if ( jqImage.attr('data-image-loaded') )
            {
                $('#vote_heart_on_image').show();
            }
        }
    }
    
	function recalculateGalleryForBanner(bolOnResize)
	{
        return adjustContentWidth (bolOnResize);
	}


    function modalGalleryDownloadFileP2PBtn( intItemIndex )
    {
        if ( typeof(bolHideDownloadButtons) !== 'undefined' && bolHideDownloadButtons )
        {
            return;
        }

        if ( ! bolIsListViewForSpecificFile )
        {
            window.location = '/f/' + arrHashes[ intItemIndex ] + '?start_p2p_download';
        }
        else
        {
    
            if (
                typeof ( objWebTorrentDownloadForm ) === 'object'
                && arrFeeDownloadPrice[ intItemIndex ] == null
                && arrAllowDownload[ intItemIndex ]
                && ( arrAccessType[ intItemIndex ] === 'LINK' || arrAccessType[ intItemIndex ] === 'PUBLIC' )
                && arrUploadPassword[ intItemIndex ] === ''
                && arrAllowPublicDownload[ intItemIndex ]
            )
            {
                var strFileExtension = arrExtensions[ intItemIndex ];
        
                var arrExecutableExtensions = ['exe','com','dll','pif','scr','bat','bin','pl','sh','scf','sct','shs','vb','lnk','jnlp','apk','vbs','js','msi','jse','jar','dmg','bin','wsf'];
        
                if ( arrExecutableExtensions.indexOf( strFileExtension ) === -1 )
                {
                    objWebTorrentDownloadForm.showForm( 'file', arrHashes[ intItemIndex ] );
                }
                else
                {
                    fConfirm( 'Šis fails ir pārbaudīts ar antivīrusu servera pusē, taču izpildāmie faili var saturēt potenciāli bīstamu kodu, ko antivīruss pagaidām neķer. Lietojiet šo failu tikai gadījumā, ja uzticaties sūtītājam. Ja neesat pārliecināts, izmantojiet Virustotal.com. Vai vēlaties saglabāt šo failu?', '', 'OK', 'Cancel', function ( r )
                    {
                        if ( r )
                        {
                            objWebTorrentDownloadForm.showForm( 'file', arrHashes[ intItemIndex ] );
                        }
                    } );
                }
            }
            else
            {
                modalGalleryDownloadFileBtn( arrHashes[ intItemIndex ] );
            }
        }
    }
    
    function modalGalleryDownloadFileBtn( strFileHash, strDownloadType="simple" )
    {
        var intItemIndex = getItemIndex( strFileHash );

        if ( typeof(bolHideDownloadButtons) !== 'undefined' && bolHideDownloadButtons )
        {
            return;
        }

        if ( typeof(arrHideDownloadButtons) !== 'undefined' && arrHideDownloadButtons[intItemIndex] )
        {
            return;
        }

        var intItemIndex = getItemIndex( strFileHash );

        
        
        
        var bolUserIsAuthenticated = false;
        
        if (
            typeof(arrForbidDirectDownload) != 'undefined'
            && typeof(arrForbidDirectDownload_Authenticated) != 'undefined'
            && arrForbidDirectDownload[ intItemIndex ]
        	&& ! arrForbidDirectDownload_Authenticated[ intItemIndex ]
            && ! bolUserIsAuthenticated
        )
        {
            if ( ! bolIsListViewForSpecificFile )
                closeGallery(strCurrentFileHash);
            
            var jqSigninErrorContainer = $('#signin-modal-content-error');
            
            $('.alert_main_text', jqSigninErrorContainer)
                .html('Sasniegts limits. Lai saglabātu šo failu, lūdzu pieslēdzies vai izveido sev kontu');
    
            jqSigninErrorContainer.show();
            
            showSignIn();
        
        }
        else if (
            typeof(arrForbidDirectDownload) != 'undefined'
            && typeof(arrForbidDirectDownload_Authenticated) != 'undefined'
            && arrForbidDirectDownload[ intItemIndex ]
            && arrForbidDirectDownload_Authenticated[ intItemIndex ]
        )
        {
            modalGalleryDownloadFileP2PBtn(intItemIndex);
        }
        else if ( strDownloadType == 'pdf' )
        {
        	var strDateModified = ( typeof arrDatesModified != 'undefined' ? arrDatesModified[ intItemIndex ] : ( typeof arrModDate != 'undefined' ? arrModDate[ intItemIndex ] : '' ) );
            window.location = '/api/file/get_thumb_pdf.php?i=' + strFileHash + '&PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8&dm=' + strDateModified + '&v=102&n=' + arrDisplayNames[ intItemIndex ] + '.pdf';
        }
        else if ( strDownloadType == 'mp4' )
        {
        	var strDateModified = ( typeof arrDatesModified != 'undefined' ? arrDatesModified[ intItemIndex ] : ( typeof arrModDate != 'undefined' ? arrModDate[ intItemIndex ] : '' ) );
            window.location = '/thumb_video/' + strFileHash + '.mp4?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8&dm=' + strDateModified + '&v=102&n=' + arrDisplayNames[ intItemIndex ] + '.mp4';
        }
        else if ( strDownloadType == 'my-files' )
        {
        	objUploadCopyForm.showForm(
    			strUploadHash ,
    			false ,
    			[ strFileHash ] ,
    			[] ,
    			true ,
    			'' ,
    			function( strTargetUploadHash )
    			{
    				window.location = '/filebrowser?u=' + strTargetUploadHash;
    			}
        	);
        }
        else
        {
            var strFileExtension = arrExtensions[ intItemIndex ];
    
            var arrExecutableExtensions = ['exe','com','dll','pif','scr','bat','bin','pl','sh','scf','sct','shs','vb','lnk','jnlp','apk','vbs','js','msi','jse','jar','dmg','bin','wsf'];
    
            if ( arrExecutableExtensions.indexOf( strFileExtension ) == -1 )
            {
                window.location = 'https://'+ arrFileHost[ intItemIndex ]  +'/down.php?i=' + strFileHash;
            }
            else
            {
                fConfirm( 'Šis fails ir pārbaudīts ar antivīrusu servera pusē, taču izpildāmie faili var saturēt potenciāli bīstamu kodu, ko antivīruss pagaidām neķer. Lietojiet šo failu tikai gadījumā, ja uzticaties sūtītājam. Ja neesat pārliecināts, izmantojiet Virustotal.com. Vai vēlaties saglabāt šo failu?', '', 'OK', 'Cancel', function( r )
                {
                    if ( r )
                    {
                        window.location = 'https://'+ arrFileHost[ intItemIndex ]  +'/down.php?i=' + strFileHash;
                    }
                } );
            }
        }
	}


	function modalGallery_changeFileThumbnail( strFileHash, intItemIndex )
    {
        var $input;
        
        $( "<form method='post'>" )
            .append( $input = $( "<input type='file' name='image' accept='image/png, image/jpeg' required>" ) );
        
        $input.change( function ( event )
        {
            var data = new FormData();
            
            if ( !event.target.files.length )
            {
                return;
            }
            
            var file = event.target.files[ 0 ];
            
            data.append( 'image', file, file.name );
            data.append( 'file_hash', strFileHash );
            
            var xhr = new XMLHttpRequest();
            //post file data for upload
            xhr.open( 'POST', '/api/file/set_thumb.php', true );
            xhr.send( data );
            
            xhr.onload = function ()
            {
                //get response and show the uploading status
                var response = JSON.parse( xhr.responseText );
                if ( xhr.status === 200 && response.success )
                {
                    $( '#gallery2__item-' + intItemIndex + ' .gallery2__item__custom_thumb' ).remove();
                    $( '#gallery2__item-' + intItemIndex + ' .fa:first-child' ).remove();
                    $( '#gallery2__item-' + intItemIndex + ' .gallery2__item__doc-wrapper' ).prepend( $( "<div>" ).css( 'background-image', 'url("/thumb.php?i=' + strFileHash + '&t=' + ( new Date ).getTime() + '")' ).addClass( 'gallery2__item__custom_thumb' ) );
                    $( '#gallery2__item-' + intItemIndex + ' .gallery2__item__doc-wrapper' ).addClass( 'has_custom_thumb' );

                    $( '#' + ( $( '#gallery2__item-' + intItemIndex + ' .filesfm__embed_player__container' ).attr( 'id' ) + '_poster' ) ).attr( 'src', '/thumb_video_picture.php?i=' + strFileHash + '&t=' + ( new Date ).getTime() );

                    $( '.thumb_' + strFileHash ).removeClass( 'doc-icon' );
                    $( '.thumb_' + strFileHash ).html( '<img src="/thumb.php?i=' + strFileHash + '&t=' + ( new Date ).getTime() + '" id="thumb_strip_img_drummscm" class="lazyload-image-gallery image-not-loaded image-loaded" style="width: auto; height: 73px; display: inline;">' );

                    $( '#gallery2__sidebar__info-set-custom-thumbnail' ).html( '' );
                    $( '#gallery2__sidebar__info-set-custom-thumbnail' ).append( '<div class="gallery2__sidebar__info-button no-background" onclick="modalGallery_changeFileThumbnail( \'' +  strFileHash + '\', ' + intItemIndex + ' )"><i class="fal fa-image"></i> Nomainīt faila bildi</div>' );
        			$( '#gallery2__sidebar__info-set-custom-thumbnail' ).append( '<div class="gallery2__sidebar__info-button no-background" onclick="modalGallery_removeFileThumbnail( \'' +  strFileHash + '\', ' + intItemIndex + ' )"><i class="fal fa-times"></i> Dzēst faila bildi</div>' );

                    strThumbnailActions = 
                    '<a href="javascript:void(0)" onclick="modalGallery_changeFileThumbnail( \'' +  arrHashes[ intItemIndex ] + '\', ' + intItemIndex + ' )">' +
                        '<div class="thumbnail-actions-edit" title="Nomainīt faila bildi"></div>' +
                    '</a>' +
                    '<a href="javascript:void(0)" onclick="modalGallery_removeFileThumbnail( \'' +  arrHashes[ intItemIndex ] + '\', ' + intItemIndex + ' )">' +
                        '<div class="thumbnail-actions-delete" title="Dzēst faila bildi"></div>' +
                    '</a>';
                    
                    $( '#gallery2_info_head .thumbnail-wrapper img' ).remove();
                    $( '#gallery2_info_head .thumbnail-wrapper' ).prepend( '<img src="/thumb.php?i=' + strFileHash + '&t=' + ( new Date ).getTime() + '" id="thumb_strip_img_drummscm" class="lazyload-image-gallery image-not-loaded image-loaded">' );
                    $( '#gallery2_info_head .thumbnail-actions' ).html('');
                    $( '#gallery2_info_head .thumbnail-actions' ).append(strThumbnailActions);
                    $( '#gallery2_info_head .thumbnail-wrapper' ).addClass("two-actions");
                    $( '#gallery2_info_head .thumbnail-wrapper' ).removeClass("one-action");
                    
                    fSuccess( 'Faila bilde tika veiksmīgi nomainīta!', '', 'OK' );
                }
                else
                {
                    if( typeof response.bad_file !== "undefined" && response.bad_file )
                    {
                        fError( 'Lūdzu izvēlaties bildi!', '', 'OK' );
                    }
                    else
                    {
                        fError( 'Neizdevās nomainīt faila bildi! Lūdzu mēģini vēlāk!', '', 'OK' );
                    }
                }
            };
        } );
        
        $input.click();
    };

    function modalGallery_removeFileThumbnail( strFileHash, intItemIndex )
    {
        fConfirm(
            'Vai tiešām noņemt faila bildi?',
            '',
            'Jā',
            'Nē',
            function ( ok )
            {
                if ( !ok )
                {
                    return;
                }
                
                var data = { file_hash: strFileHash };
                
                var successCB = function ()
                {
                    $( '#gallery2__item-' + intItemIndex + ' .gallery2__item__custom_thumb' ).remove();
                    $( '#gallery2__item-' + intItemIndex + ' .gallery2__item__doc-wrapper' ).prepend( '<img src="/images/file_types_v2/default.svg" class="ext-icon" />' );
                    $( '#gallery2__item-' + intItemIndex + ' .gallery2__item__doc-wrapper' ).removeClass( 'has_custom_thumb' );

                    $( '#' + ( $( '#gallery2__item-' + intItemIndex + ' .filesfm__embed_player__container' ).attr( 'id' ) + '_poster' ) ).attr( 'src', '/thumb_video_picture.php?i=' + strFileHash + '&t=' + ( new Date ).getTime() );
                    
                    $( '.thumb_' + strFileHash ).addClass( 'doc-icon' );
                    $( '.thumb_' + strFileHash ).html( '<span class="gallery2__item__thumbnail txt"><i class="fal fa-file-alt"></i><span class="gallery2__item__thumbnail-ext">TXT</span></span>' );

                    $( '#gallery2__sidebar__info-set-custom-thumbnail' ).html( '' );
        			$( '#gallery2__sidebar__info-set-custom-thumbnail' ).append( '<div class="gallery2__sidebar__info-button no-background" onclick="modalGallery_changeFileThumbnail( \'' +  strFileHash + '\', ' + intItemIndex + ' )"><i class="fal fa-image"></i> Uzstādīt failam preview bildi</div>' );

                    strThumbnailActions = 
                    '<a href="javascript:void(0)" onclick="modalGallery_changeFileThumbnail( \'' +  arrHashes[ intItemIndex ] + '\', ' + intItemIndex + ' )">' +
                        '<div class="thumbnail-actions-edit" title="Uzstādīt failam preview bildi"></div>' +
                    '</a>';

                    $( '#gallery2_info_head .thumbnail-wrapper img' ).remove();
                    $( '#gallery2_info_head .thumbnail-wrapper' ).prepend( '<img src="/images/file_types_v2/'+arrIconSvg[ intItemIndex ]+'" />' );
                    $( '#gallery2_info_head .thumbnail-actions' ).html('');
                    $( '#gallery2_info_head .thumbnail-actions' ).append(strThumbnailActions);
                    $( '#gallery2_info_head .thumbnail-wrapper' ).removeClass("two-actions");
                    $( '#gallery2_info_head .thumbnail-wrapper' ).addClass("one-action");
                    
                    fSuccess( 'Faila bilde tika veiksmīgi noņemta!', '', 'OK' );
                };
                
                var failCB = function ()
                {
                    fError( 'Neizdevās noņemt faila bildi! Lūdzu mēģini vēlāk!', '', 'OK' );
                };
                
                jQuery.post(
                    '/api/file/remove_thumb.php',
                    data,
                    successCB,
                    'JSON'
                ).fail( failCB );
            }
        );
    }

    
    function isFileConvertable( strConverToFormat, intItemIndex )
    {
    	var bolIsFileConvertable = false;

    	if ( strConverToFormat == 'pdf' )
    	{
        	
        	if (
        	    	[ 'asice','edoc','zip' , 'doc','docx','odp','ods','odt','pps','ppsx','ppt','pptx','rtf','xls','xlsx','dotx' ].indexOf( arrExtensions[ intItemIndex ] ) != -1
    	    		&& arrSizesInBytes[ intItemIndex ] < 104857600        		)
        	{
            	var bolIsDocTempFile = false
    
            	if (
                		[ 'doc','docx','odp','ods','odt','pps','ppsx','ppt','pptx','rtf','xls','xlsx','dotx' ].indexOf( arrExtensions[ intItemIndex ] ) != -1
                		&& arrDisplayNames[ intItemIndex ].substring( 0, 2 ) == '~$'
            		)
            	{
            		bolIsDocTempFile = true;
            	}
    
        		if ( ! bolIsDocTempFile )
        		{
    	    		bolIsFileConvertable = true;
        		}
        	}
    	}
    	else if ( strConverToFormat == 'mp4' )
    	{
        	if ( arrFileTypes[ intItemIndex ] == 'video' && arrExtensions[ intItemIndex ] != 'mp4' )
        	{
        		bolIsFileConvertable = true;
        	}
    	}
    	
    	return bolIsFileConvertable;
    }

    
    function fileCanBeSigned( strFileExtension, intFileSize )
    {
    	var bolFileCanBeSigned = false;
    	
    	if (
	    		[ 'edoc', 'pdf', 'asice' ].indexOf( strFileExtension ) != -1
	    		&& ( intFileSize / 1024 / 1024 ) < 50
    		)
    	{
    		bolFileCanBeSigned = true;
    	}

    	return bolFileCanBeSigned;
    }

    function getFileIcon (strFileHash)
    {
        var strFileIcon = 'default.svg';
        var intFileIndex = getItemIndexByHashOrName( strFileHash );

        if ( typeof( arrIconSvg ) !== 'undefined' && arrIconSvg[intFileIndex] )
        {
            strFileIcon = arrIconSvg[ intFileIndex ];
        }

        return strFileIcon;
    }
    function canBeReported (strFileHash)
    {
        var bolCanBeReported = false;

        var intFileIndex = getItemIndexByHashOrName( strFileHash );

        if( !bolIsOwner && window.location.href.indexOf("filebrowser") === -1 && typeof arrReports != 'undefined' && typeof arrStatuses != 'undefined' && ! [3, 4].includes(arrStatuses[ intFileIndex ]) &&
            ( 
                typeof arrFileIsLockedByOtherUser == 'undefined' 
                || ! arrFileIsLockedByOtherUser[ intFileIndex ]
            )
        ) 
        {
           bolCanBeReported = true; 
        }

        return bolCanBeReported;
    }
    function hasReported (strFileHash)
    {
        var bolHasReported = false;
        var intFileIndex = getItemIndexByHashOrName( strFileHash );

        if( !bolIsOwner && window.location.href.indexOf("filebrowser") === -1 && typeof arrReports != 'undefined' && typeof arrStatuses != 'undefined' && ! [3, 4].includes(arrStatuses[ intFileIndex ]) &&
            ( 
                typeof arrFileIsLockedByOtherUser == 'undefined' 
                || ! arrFileIsLockedByOtherUser[ intFileIndex ]
            )
        ) 
        {
            if (arrReports[ intFileIndex ] == 0)
            {
                bolHasReported = false;
            }
            else 
            {
                bolHasReported = true;
            }
        }
        return bolHasReported;
    }
    function canOrderPrints( strFileHash )
    {
        var bolCanOrderPrints = false;

        var intFileIndex = getItemIndexByHashOrName( strFileHash );
         
        	
        if (
                (arrExtensions[intFileIndex] == 'png' || arrExtensions[intFileIndex] == 'jpg' || arrExtensions[intFileIndex] == 'jpge') && 
                arrFeeDownloadPrice[intFileIndex] == null &&  
                (arrAllowDownload[ intFileIndex ] && 
                ( typeof(bolHideDownloadButtons) === 'undefined' || ! bolHideDownloadButtons ) && 
                ( typeof(arrHideDownloadButtons) === 'undefined' || ! arrHideDownloadButtons[ intFileIndex ] ))
			)
		{
            bolCanOrderPrints = true;
        }
                
        return bolCanOrderPrints;
    }
	function canOrderProducts( strFileHash )
    {
    	var bolCanOrderProducts = false;
        var intFileIndex = getItemIndexByHashOrName( strFileHash );
                if ( arrFileHasProductSelling[ intFileIndex ] == 1 )
        {
            bolCanOrderProducts = true;
        }
                return bolCanOrderProducts;
    }

	function canBuyFile( strFileHash )
    {
    	var bolCanBuyFile = false;
        var intFileIndex = getItemIndexByHashOrName( strFileHash );


        if ( arrFeeDownloadPrice[ intFileIndex ] != null )
		{
			if ( ! bolIsOwner )
			{
				bolCanBuyFile = true;
			}
		}
    	return bolCanBuyFile;
    }

    function canSellFile( strFileHash )
    {
    	var bolCanSellFile = false;
        var intFileIndex = getItemIndexByHashOrName( strFileHash );


        if ( bolIsOwner )
        {
            bolCanSellFile = true;
        }
		
    	return bolCanSellFile;
    }

    
    function canOpenFileInEditor( strMode, strFileExtension )
    {
    	var bolcanOpenFileInEditor = false;
    	
    	if ( strMode == 'edit' && [ 'odt','fodt','ott','doc','dot','docx','docm','rtf','txt','odm','otm','oth','ods','fods','ots','xls','xla','xlsx','xlsb','xlsm','dif','slk','csv','dbf','odp','fodp','otp','ppt','pot','pptx','pptm','potx','potm','ppsx','odg','fodg','otg' ].indexOf( strFileExtension ) != -1 )
    	{
    		bolcanOpenFileInEditor = true;
    	}
    	/*
    	else if ( strMode == 'view' && [ 'sxw','stw','dotx','dotm','wpd','pdb','hwp','wps','wri','lrf','mw','fb2','cwk','pages','abw','602','sxg','sxc','stc','xltx','xltm','wk1','gnumeric','numbers','sxi','sti','cgm','key','sxd','std','dxf','emf','wmf','cdr','vsd','vsdx','vss','pub','p65','wpg','fh','tiff','pdf' ].indexOf( strFileExtension ) != -1 )
    	{
    		bolcanOpenFileInEditor = true;
    	}
    	*/

    	return bolcanOpenFileInEditor;
    }


</script>
<script type="text/javascript">

	var intTotalItems = parseInt('0');
	var intTotalMP3Items = parseInt('0');
	var intMediaItems = parseInt('1');
	var dblGlobalVolume = 0.8;

    var bolAllowDownload = Boolean(parseInt('1'));
    var bolHideDownloadButtons = Boolean(parseInt('0'));

	var bolClickAds = true;
	var intPrevAdRefreshTST = (new Date()).getTime();

	
</script>


	<div id="list-container" class="left_menu_visible files">

		<style type="text/css">
			.item-list-loading {
				display: none;	
			}
		</style>
		

	<script type="text/javascript">
	
		// Variables for new modal gallery
		var arrIDs_Unordered = [];
		var arrHttpCacheKeys_Unordered = [];
		var arrFileTypes_Unordered = [];
		var arrHashes_Unordered = [];
		var arrExtensions_Unordered = [];
		var arrNames_Unordered = [];
		var arrDisplayNames_Unordered = [];
		var arrWidths_Unordered = [];
		var arrHeights_Unordered = [];
		var arrIsVideo_Unordered = [];
		var arrHasVoted_Unordered = [];
		var arrVoteCounts_Unordered = [];
		var arrOrderIndex_Unordered = [];
		var arrModDate_Unordered = [];
		var arrThumbnails_Unordered = [];
		var arrIconClass_Unordered = [];
		var arrIconSvg_Unordered = [];
		var arrIsPreloaded_Unordered = [];
		var arrFeeDownloadPrice_Unordered = [];
		var arrSizes_Unordered = [];
		var arrSizesInBytes_Unordered = [];
		var arrDates_Unordered = [];
		var arrDatesCreated_Unordered = [];
		var arrDatesModified_Unordered = [];
		var arrViews_Unordered = [];
		var arrDownloads_Unordered = [];
		var arrDescriptions_Unordered = [];
		var arrTags_Unordered = [];
		var arrAllowDownload_Unordered = [];
		var arrAllowPublicDownload_Unordered = [];
		var arrAccessType_Unordered = [];
		var arrUploadPassword_Unordered = [];
		var arrFileHost_Unordered = [];
		var arrCommentCounts_Unordered = [];
		var arrFileAttributes_Unordered = [];
		var arrFileIsLockedByOtherUser_Unordered = [];
		var arrFileDeleteKeys_Unordered = [];
		var arrFileAccessTypes_Unordered = [];
		var arrFileHasProductSelling_Unordered = [];
        var arrFileTitle_Unordered = [];
        var arrFileSubject_Unordered = [];
        var arrFileContentType_Unordered = [];
        var arrFileCategory_Unordered = [];
        var arrFileCategories_Unordered = [];
        var arrFileKeywords_Unordered = [];
        var arrFileCreator_Unordered = [];
        var arrFilePublisher_Unordered = [];
        var arrFileContributor_Unordered = [];
        var arrFileCopyrights_Unordered = [];
        var arrFileLicenseType_Unordered = [];
        var arrFileLicenseDetails_Unordered = [];
        var arrFileLanguage_Unordered = [];
        var arrFileLocation_Unordered = [];
        var arrFileLocationLat_Unordered = [];
        var arrFileLocationLong_Unordered = [];
        var arrFileReferences_Unordered = [];
        var arrFileRelatesTo_Unordered = [];
        var arrFileFormat_Unordered = [];
        var arrFileDevice_Unordered = [];
        var arrFileDateCreated_Unordered = [];
        var arrFileSource_Unordered = [];
		
		
		arrIDs_Unordered = ["1445750615"];
		arrHttpCacheKeys_Unordered = [""];
		arrFileTypes_Unordered = ["video"];
		arrHashes_Unordered = ["5vwfkz7eg"];
		arrExtensions_Unordered = ["mp4"];
		arrNames_Unordered = ["Mendirman+Jaloliddin+Episode+1.mp4"];
		arrDisplayNames_Unordered = ["MJ1_720p.mp4"];
		arrWidths_Unordered = [0];
		arrHeights_Unordered = [0];
		arrIsVideo_Unordered = [true];
		arrHasVoted_Unordered = [false];
		arrVoteCounts_Unordered = ["1"];
		arrOrderIndex_Unordered = [0];
		arrModDate_Unordered = ["2021-02-19 04:51:28"];
		arrThumbnails_Unordered = ["https://fv2-4.failiem.lv/thumb.php?i=5vwfkz7eg&n=Mendirman+Jaloliddin+Episode+1.mp4"];
		arrIconClass_Unordered = ["fal fa-file-video-o"];
		arrIconSvg_Unordered = ["mp4.svg?v=2"];
		arrIsPreloaded_Unordered = [false];
		arrFeeDownloadPrice_Unordered = [null];
		arrSizes_Unordered = ["823&nbsp;MB"];
		arrSizesInBytes_Unordered = [863064170];
		arrDates_Unordered = ["2021-02-19"];
		arrDatesCreated_Unordered = ["2021-11-08 10:08:23"];
		arrDatesModified_Unordered = ["2021-02-19 04:51:28"];
		arrViews_Unordered = [532];
		arrDownloads_Unordered = [272];
		arrDescriptions_Unordered = [""];
		arrTags_Unordered = [""];
		arrAllowDownload_Unordered = [true];
		arrAllowPublicDownload_Unordered = [true];
		arrAccessType_Unordered = ["LINK"];
		arrUploadPassword_Unordered = [""];
		arrFileHost_Unordered = ["fv2-4.failiem.lv"];
		arrCommentCounts_Unordered = ["0"];
		arrFileAttributes_Unordered = [{"hasCustomThumb":1,"hasPreviewVideo":0,"isForSale":0,"canDownload":1,"readOnly":0,"hasVideoThumb":1}];
		arrFileIsLockedByOtherUser_Unordered = [0];
		arrFileDeleteKeys_Unordered = [""];
		arrFileAccessTypes_Unordered = [""];
		arrFileHasProductSelling_Unordered = ["0"];
        arrFileTitle_Unordered = [ "" ];
        arrFileSubject_Unordered = [ "" ];
        arrFileContentType_Unordered = [ "" ];
        arrFileCategory_Unordered = [ "" ];
        arrFileCategories_Unordered = [ "" ];
        arrFileKeywords_Unordered = [ "" ];
        arrFileCreator_Unordered = [ "" ];
        arrFilePublisher_Unordered = [ "" ];
        arrFileContributor_Unordered = [ "" ];
        arrFileCopyrights_Unordered = [ "" ];
        arrFileLicenseType_Unordered = [ "" ];
        arrFileLicenseDetails_Unordered = [ "" ];
        arrFileLanguage_Unordered = [ "" ];
        arrFileLocation_Unordered = [ "" ];
        arrFileLocationLat_Unordered = [ "" ];
        arrFileLocationLong_Unordered = [ "" ];
        arrFileReferences_Unordered = [ "" ];
        arrFileRelatesTo_Unordered = [ "" ];
        arrFileFormat_Unordered = [ "" ];
        arrFileDevice_Unordered = [ "" ];
        arrFileDateCreated_Unordered = [ "" ];
        arrFileSource_Unordered = [ "" ];
		


		var strUploadUserNameLink = '<a href="turkishserialislam" target="_blank" >Turkishserialislam</a>';
		var strUploadUserNameHref = 'turkishserialislam';

		var strUploadUserID = '6fe6233';
		var strUploadUserLastProfileEditTimestamp = '2147483647';
		var strUploadHash = '5xdjhkcbh';

        var bolIsAnonymousUpload = false        
        var arrIDs = ["1445750615"];
		var arrHttpCacheKeys = [""];
		var arrFileTypes = ["video"];
	    var arrHashes = ["5vwfkz7eg"];
	    var arrExtensions = ["mp4"];
	    var arrStatuses = [""];
	    var arrReports = ["0"];
	    var arrNames = ["Mendirman+Jaloliddin+Episode+1.mp4"];
	    var arrDisplayNames = ["MJ1_720p.mp4"];
	    var arrWidths = [0];
	    var arrHeights = [0];
	    var arrIsVideo = [true];
	    var arrHasVoted = [false];
	    var arrVoteCounts = ["1"];
	    var arrOrderIndex = [0];
	    var arrModDate = ["2021-02-19 04:51:28"];
	    var arrThumbnails = ["https://fv2-4.failiem.lv/thumb.php?i=5vwfkz7eg&n=Mendirman+Jaloliddin+Episode+1.mp4"];
        var arrIconClass = ["fal fa-file-video-o"];
        var arrIconSvg = ["mp4.svg?v=2"];
		var arrIsPreloaded = [false];
		var arrFeeDownloadPrice = [null];
		var arrSizes = ["823&nbsp;MB"];
		var arrSizesInBytes = [863064170];
		var arrDates = ["2021-02-19"];
		var arrDatesCreated = ["2021-11-08 10:08:23"];
		var arrDatesModified = ["2021-02-19 04:51:28"];
		var arrDatesDelete = [""];
		var arrViews = [532];
		var arrDownloads = [272];
		var arrDescriptions = [""];
		var arrTags = [""];
        var arrAllowDownload = [true];
        var arrHideDownloadButtons = [false];
        var arrAllowPublicDownload = [true];
		var arrAccessType = ["LINK"];
		var arrUploadPassword = [""];
		var arrFileHost = ["fv2-4.failiem.lv"];
        var arrCommentCounts = ["0"];
        var arrForbidDirectDownload = [1];
        var arrForbidDirectDownload_Authenticated = [0];
        var arrFileAttributes = [{"hasCustomThumb":1,"hasPreviewVideo":0,"isForSale":0,"canDownload":1,"readOnly":0,"hasVideoThumb":1}];
        var arrFileIsLockedByOtherUser = [0];
        var arrFileDeleteKeys = [""];
        var arrFileAccessTypes = [""];
		var arrFileHasProductSelling = ["0"];
        var arrFileTitle = [ "" ];
        var arrFileSubject = [ "" ];
        var arrFileContentType = [ "" ];
        var arrFileCategory = [ "" ];
        var arrFileCategories = [ "" ];
        var arrFileKeywords = [ "" ];
        var arrFileCreator = [ "" ];
        var arrFilePublisher = [ "" ];
        var arrFileContributor = [ "" ];
        var arrFileCopyrights = [ "" ];
        var arrFileLicenseType = [ "" ];
        var arrFileLicenseDetails = [ "" ];
        var arrFileLanguage = [ "" ];
        var arrFileLocation = [ "" ];
        var arrFileLocationLat = [ "" ];
        var arrFileLocationLong = [ "" ];
        var arrFileReferences = [ "" ];
        var arrFileRelatesTo = [ "" ];
        var arrFileFormat = [ "" ];
        var arrFileDevice = [ "" ];
        var arrFileDateCreated = [ "" ];
        var arrFileSource = [ "" ];

        $( function() {

        	showGalleryItem( arrHashes[ 0 ] );


                        modalGalleryDownloadFileP2PBtn( 0 );
                    } )
	</script>
	
		
		<script type="text/javascript">
			// Show gallery if url contine link to file gallery 
			galleryCheckHashtag();

			strViewClass = 'horizontal_view';
			/*** Old links ***/
		    if (window.location.hash.slice(1,4) == '/G/')
		    {
                clearHashFromURL();
		        strViewClass = 'grid_view';
		    }
		    else if (window.location.hash.slice(1,4) == '/L/')
		    {
    			window.location.hash = '/list/';
		        strViewClass = 'list_view';
		    }
		    else if (window.location.hash.slice(1,4) == '/P/')
		    {
    			window.location.hash = '/player/';
		        strViewClass = 'list_view';
		        $('#right .item:not(.audio-item)').css({'display':'none'});
			}
			/*** New links ***/
		    else if (window.location.hash.slice(1,7) == '/list/')
		    {
		        strViewClass = 'list_view';
		    }
		    else if (window.location.hash.slice(1,7) == '/grid/')
		    {
		        strViewClass = 'grid_view';
		    }
		    else if (window.location.hash.slice(1,11) == '/vertical/')
		    {
		        strViewClass = 'vertical_view';
		    }
		    else if (window.location.hash.slice(1,9) == '/player/')
		    {
		        strViewClass = 'list_view';
		        $('#right .item:not(.audio-item)').css({'display':'none'});
		    }
		    $('#right').removeClass('grid_view').removeClass('list_view').removeClass('vertical_view').removeClass('horizontal_view').addClass(strViewClass).removeClass('item-list-loading');
		</script>
		
	
		<style type="text/css">
			.item-list-loading {
				display: block;	
			}
		</style>
		
		
		
		
	
	</div>
	





<div class="clear"></div>

<script type="text/javascript">

		
	var strHTML = '<div class="item-name">';
	strHTML += '<img src="/images/folder_types/folder-shared.svg"/>';
	strHTML += '<span>MENDIRMAN JALOLIDDIN</span>';
	strHTML += '</div>';

    $( "#head_menu__dropdown__content_buttons" ).html(strHTML);
    $( ".list-view_upload-info-buttons" ).clone().appendTo( "#head_menu__dropdown__content_buttons" );
    $( "#head_menu__dropdown__content_buttons .list-view_upload-info-buttons" ).each(function() {
        if($.trim($( this ).text()) == "")
        {
            $( this ).remove();
        }
    });
	if ( $( "#head_menu__dropdown__content_buttons .list-view_upload-info-buttons a" ).length < 1 ) 
	{
		$( "#head_menu__button" ).hide();
		$( "#head__all-files-actions" ).css("gap", "0");
		$( "#seperator" ).hide();
	}
	else
	{
		$( "#head_menu__button" ).css("display", "inline-flex");
		$( "#head__all-files-actions" ).css("gap", "");
		$( "#seperator" ).css("display", "inline-block");
		
	}



	function voteForFile(strHash, fnCallback) {
        if( typeof fnCallback === "undefined" )
        {
            fnCallback = function(){}
        }
		
    	var intFileIndex = null;
    	for (idx in arrIDs)
    	{
    		if (arrHashes[idx] == strHash)
    		{
    		 	intFileIndex = idx;
    		 	break;	
			}
		}
		
		$.ajax({
			type: "POST",
			dataType: "json",
			url: "./ajax/vote_for_file.php?i=PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
			data: {
				'vote' : true ,
				'h' : strHash
			},
			success: function(data) {
				if (data['status'] == 'ok') {
					
					var bol = null;
					if (data['action'] == 'vote') {
												
						$('#vote_' + strHash).addClass('has_voted').attr('my_title', 'Pārdomāju');
						bol = true;
					}
					else {
						
						$('#vote_' + strHash).removeClass('has_voted').attr('my_title', 'Patīk');
						bol = false;
					}
					
					if ( intFileIndex )
					{
						arrHasVoted[intFileIndex] = bol;
						arrVoteCounts[intFileIndex] = parseInt(arrVoteCounts[intFileIndex]) + ( bol ? 1 : -1);
						
						if ( typeof(bolGalleryIsVisible) !='undefined' && bolGalleryIsVisible && typeof(galleryUpdateVoteCount) == 'function')
						{
							galleryUpdateVoteCount();	
						}
					}
                    
                    document.dispatchEvent( new CustomEvent('fileVoteStateChange', { detail: {hash: strHash, state: bol} }) );
                    fnCallback(bol);
				}
			}
		});
	}
	

	function deleteFile(strKey, strUploadH, strFileH, strFileName)
	{
		fConfirm( 'Vai tiešām vēlaties dzēst šo failu?</br><b>"' + strFileName + '"</b>', 'Dzēst šo failu', 'Jā, dzēst!', 'Atcelt', function(r){
			if( r == true )
			{
				$.ajax({
					type: "POST",
					dataType: "json",
					url: "./ajax/delete_file.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8",
					data: {
						'delete_file': true,
						'k'			 : strKey,
						'u'			 : strUploadH,
						'f'			 : strFileH ,
						'source'	 : 'list'
					},
					success: function( data ){
						if( data['status'] == 'ok' )
						{
							$( '#item_' + strFileH ).remove();
							fSuccess( "Fails <b>"+ strFileName +"</b> ir izdzēsts!", "Info" );
						}
						else
						{
						    if( typeof data[ 'file_read_only' ] !== 'undefined' && data[ 'file_read_only' ] ) 
                            {
                                fError( "Falu nevar izdzēst, jo tas ir koplietots!", "Info" );
                            }
						    else if ( typeof data[ 'file_is_locked' ] !== 'undefined' && data[ 'file_is_locked' ] ) 
                            {
                                fError( "Šo failu nav atļauts dzēst, jo tas ir nobloķēts.", "Info" );
                            }
                            else
                            {
                                fError( "Notikusi kļūda, fails netika izdzēsts!", "Info" );
                            }
						}
					}
				});
			}
		});
		return false;
	}

	
</script>

<script type="text/javascript">
	$('body').click(function(){
		if ((new Date()).getTime() - intPrevAdRefreshTST > 60000) {
			intPrevAdRefreshTST = (new Date()).getTime();
		}
	});
</script>

</div>

    </div>
    
    

    <link rel="stylesheet" type="text/css" media="all" href="/css/footer.css?v=13"/>
    
</div>

<div id="info_tooltip_global"></div>



<script>
    function CloseSuggestion(id) {
        
        if (id == 'suggest_lang') {
            $.get("includes/suggest_language.php", {sLang: 1});
        }
        else if (id == 'suggest_register'){
            $.get("includes/suggest_language.php", {sReg: 1});
        }
        
        document.getElementById(id).style.display='none';
    }
</script>

    <script>
        
        $(window).bind("load", function() {
            $( "#register_from_ico" ).val( 0 );
            if	(window.location.hash == '#sign_up') {
                
                showCreateAccount();
            }
            else if	(window.location.hash == '#log_in') {
                
                showSignIn();
            }
            else if	(window.location.hash == '#forgot_password') {
                
                showForgotPassword();
            }
        });
    
    </script>
    

<div id="files_970x90_sticky_anchorad_responsive">
    <script>
        if (typeof googletag !== 'undefined') {
            googletag.cmd.push(function() { googletag.display('files_970x90_sticky_anchorad_responsive'); });
        }
    </script>
</div>


<script>
    window.addEventListener("stpdRendered", function (e) {
        var adName =  e.detail.name;
        var adWinner = e.detail.winner;
        var cleanEventName = adName.split('/')[2];

        if ( ( (cleanEventName == "files_970x90_sticky_anchorad_desktop") || (cleanEventName == "files_320x100_sticky_anchorad_mobile") ) && (adWinner != "passback")  ) {
            setTimeout(function () {
                var anchorParent = top.document.querySelector("#files_970x90_sticky_anchorad_responsive");
                var anchorIframe = top.document.querySelector("#files_970x90_sticky_anchorad_responsive > div > iframe");
                var anchorClose = top.document.querySelector("#stpd_close");
                if(window.innerWidth > 1000) {
                    anchorParent.style.cssText += "width: " + (anchorIframe.clientWidth + 100) + "px";
                    anchorClose.style.cssText += "width: 40px; height: 35px; padding-top: 5px; border-top: unset; border-left: unset; border: 5px solid red; border-radius: 50%; background: rgb(255 255 255);";
                } else {
                    anchorClose.style.cssText += "width: 30px; height: 30px; border-top: unset; border-left: unset; border: 5px solid red; border-radius: 50%; background: rgb(255 255 255); top: -40px;";
                }
            }, 50);
        }
    });
</script>


<div id="failiem_970x90_sticky_anchorad_responsive">
    <script>
        if (typeof googletag !== 'undefined') {
            googletag.cmd.push(function() { googletag.display('failiem_970x90_sticky_anchorad_responsive'); });
        }
    </script>
</div>


<script>
    window.addEventListener("stpdRendered", function (e) {
        var adName =  e.detail.name;
        var adWinner = e.detail.winner;
        var cleanEventName = adName.split('/')[2];

        if ( ( (cleanEventName == "failiem_970x90_sticky_anchorad_desktop") || (cleanEventName == "failiem_320x100_sticky_anchorad_mobile") ) && (adWinner != "passback")  ) {
            setTimeout(function () {
                var anchorParent = top.document.querySelector("#failiem_970x90_sticky_anchorad_responsive");
                var anchorIframe = top.document.querySelector("#failiem_970x90_sticky_anchorad_responsive > div > iframe");
                var anchorClose = top.document.querySelector("#stpd_close");
                if(window.innerWidth > 1000) {
                    anchorParent.style.cssText += "width: " + (anchorIframe.clientWidth + 100) + "px";
                    anchorClose.style.cssText += "width: 40px; height: 35px; padding-top: 5px; border-top: unset; border-left: unset; border: 5px solid red; border-radius: 50%; background: rgb(255 255 255);";
                } else {
                    anchorClose.style.cssText += "width: 30px; height: 30px; border-top: unset; border-left: unset; border: 5px solid red; border-radius: 50%; background: rgb(255 255 255); top: -40px;";
                }
            }, 50);
        }
    });
</script>


                    
<!--                 
<div id="files_970x90_sticky_anchorad_top_responsive">
    <script>
        if (typeof googletag !== 'undefined') {
            googletag.cmd.push(function() { googletag.display('files_970x90_sticky_anchorad_top_responsive'); });
        }
    </script>
</div>

<div id="failiem_970x90_sticky_anchorad_top_responsive">
    <script>
        if (typeof googletag !== 'undefined') {
            googletag.cmd.push(function() { googletag.display('failiem_970x90_sticky_anchorad_top_responsive'); });
        }
    </script>
</div>
-->

                    
                 




 
    <div id="footer_bottom_floating_line" class="footer_bottom_floating_line__listphp  cookies_msg_active ">
        
        
				
		
    </div>
<link rel="stylesheet" type="text/css" media="all" href="/css/share_popup.css?v=1677241514" /><link rel="stylesheet" type="text/css" media="all" href="/css/bootstrap-tagsinput.css?v=1560771844" />
                <script src="/js/bootstrap-tagsinput.js?v=1560771844"></script><link rel="stylesheet" type="text/css" media="all" href="/css/elements/upload_access_switch.css?v=112" />

<script type="text/javascript">

	var bolUploadAccessSwitch_closeAllSelect_Binded = false;
	var bolSessionUser_IsStorageSubscriber = false;
	var bolSessionUser_HasLifetimeStorage = false;

	function UploadAccessSwitch( objParentElement, objUploadAccessSwitchSettings )
	{
		this.objParentElement = objParentElement;
		this.bolAccessTypeChanged = false;


		this.strItemType = 'upload';

		if ( typeof objUploadAccessSwitchSettings.item_type != 'undefined' && objUploadAccessSwitchSettings.item_type == 'file' )
		{
			this.strItemType = objUploadAccessSwitchSettings.item_type;
		}
		
		
		this.strUploadHash = objUploadAccessSwitchSettings.upload_hash;
		this.strFileHash = objUploadAccessSwitchSettings.file_hash;
		this.strParentAccessType = objUploadAccessSwitchSettings.parent_access_type;

		
		this.bolOwnerLoggedIn;

		if ( typeof objUploadAccessSwitchSettings.owner_logged_in == 'undefined' )
		{
			this.bolOwnerLoggedIn = 1;
		}
		else
		{
			this.bolOwnerLoggedIn = objUploadAccessSwitchSettings.owner_logged_in;
		}

		this.strAccessType;
		this.strUploadPassword = '';

		if ( objUploadAccessSwitchSettings.access_type == 'PRIVATE' )
		{
			this.strAccessType = 'private';
		}
		else if ( this.strItemType == 'upload' && objUploadAccessSwitchSettings.password != null && objUploadAccessSwitchSettings.password != '' )
		{
			this.strAccessType = 'password';
			this.strUploadPassword = objUploadAccessSwitchSettings.password;
		}
		else if ( this.strItemType == 'upload' && objUploadAccessSwitchSettings.is_public == 1 )
		{
			this.strAccessType = 'public';
		}
		else
		{
			this.strAccessType = 'link';
		}

		
		if ( objUploadAccessSwitchSettings.access_type != 'PRIVATE' && typeof objUploadAccessSwitchSettings.from_eparaksts != 'undefined' && objUploadAccessSwitchSettings.from_eparaksts )
		{
			this.strAccessType = 'link-can-edit';
		}

		if ( objUploadAccessSwitchSettings.access_type == 'link-can-upload' )
		{
			this.strAccessType = 'link-can-upload';
		}

		this.strUploadAccessSwitchType = 'default';

		if ( typeof objUploadAccessSwitchSettings.upload_access_switch_type != 'undefined' )
		{
			this.strUploadAccessSwitchType = objUploadAccessSwitchSettings.upload_access_switch_type;
		}

		this.strEmbedPlace = objUploadAccessSwitchSettings.embed_place;

		
		
		var _this = this;
		
		
		this.init = function()
		{
			var objTypeCopyWrap = $( '#copy_button_drawer_popup' );
			objTypeCopyWrap.html('');
			$( '.copy_button_wrapper_popup' ).removeClass('copy_input_value_to_clipboard_no_tooltip');
			
			var strHtml = '';

			var objTypeSelectWrap = $( '<div></div>' ).attr( {
        						'class' : 'styled-select upload-access-switch-select' ,
        					} )
			var objTypeSelect = $( '<select></select>' ).attr( {
                    				'class' : 'upload-access-switch_type-select' ,
                    				'disabled' : ( this.strUploadAccessSwitchType == 'default' && ! this.bolOwnerLoggedIn ? true : false )
                    			} );

			objTypeSelect.append(
				$( '<option></option>' ).text( '&nbsp;' )
			);
			if ( this.bolOwnerLoggedIn )
			{
				objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'private' ,
    						'desc' : 'Varat piekļūt tikai jūs vai noteikti lietotāji, kas ielūgti ar epastu.' ,
    						'selected' : ( this.strAccessType == 'private' ? true : false )
    					} )
    					.text( 'Tikai ar privātu atļauju' )
    				);
			}
			
			if ( this.strUploadAccessSwitchType == 'default' )
			{ 
    			objTypeSelect.append(
						$( '<option></option>' ).attr( {
							'value' : 'link' ,
							'desc' : 'Var apskatīt un lejupielādēt.' ,
							'selected' : ( this.strAccessType == 'link' ? true : false )
						} )
						.text( 'Jebkuram, kurš zina saiti' )
					);

				strHtml = 	'<div id="drawer_copy_button_view" class="share-input copy_input_value_to_clipboard_no_tooltip checked" onclick="updateSharePopupLink(1)">' +
								'<span>Kopēt skatīšanās saiti</span>' +
								'<span class="desc_popup">Var apskatīt un lejupielādēt</span>' +
							'</div>';
			}
			else if ( this.strUploadAccessSwitchType == 'sharing_form' )
			{
    			objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'link-can-view' ,
    						'desc' : 'Var apskatīt un lejuplādēt' ,
    						'selected' : ( this.strAccessType == 'link' ? true : false ) ,
    						'class' : 'upload-access-switch_type-select_option_link-can-view'
    					} )
    					.text( 'Atverot šo saiti, var piekļūt' )
    				);
					
					strHtml = 	'<div id="drawer_copy_button_view" class="share-input copy_input_value_to_clipboard_no_tooltip checked" onclick="updateSharePopupLink(1)">' +
								'<span>Kopēt skatīšanās saiti</span>' +
								'<span class="desc_popup">Var apskatīt un lejupielādēt</span>' +
							'</div>';
							objTypeCopyWrap.append(strHtml);

    			objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'link-can-edit' ,
    						'desc' : 'Var pievienot, rediģēt saturu, e-parakstīt un dzēst.' ,
    						'selected' : ( this.strAccessType == 'link-can-edit' ? true : false ) ,
    					} )
    					.text( 'Saņem saiti rediģēšanai' )
    				);

					strHtml = 	'<div id="drawer_copy_button_edit" class="share-input copy_input_value_to_clipboard_no_tooltip" onclick="updateSharePopupLink(2)">' +
									'<span>Kopēt rediģēšanas saiti</span>' +
									'<span class="desc_popup">Var pievienot, rediģēt saturu,  e-parakstīt un dzēst</span>' +
								'</div>';
								objTypeCopyWrap.append(strHtml);

    			if ( this.strItemType == 'upload' )
    			{
        			objTypeSelect.append(
        					$( '<option></option>' ).attr( {
        						'value' : 'link-can-upload' ,
        						'desc' : 'Var pievienot klāt failus, bet nevar dzēst vai rediģēt esošos.' ,
        						'selected' : ( this.strAccessType == 'link-can-upload' ? true : false ) ,
        					} )
        					.text( 'Saņem saiti failu pievienošanai' )
        				);

					strHtml = 	'<div id="drawer_copy_button_upload" class="share-input copy_input_value_to_clipboard_no_tooltip" onclick="updateSharePopupLink(3)">' +
									'<span>Kopēt pievienošanas saiti</span>' +
									'<span class="desc_popup">Var pievienot klāt failus, bet ne dzēst vai rediģēt esošos</span>' +
								'</div>';
								objTypeCopyWrap.append(strHtml);
    			}
			}
			else if ( this.strUploadAccessSwitchType == 'modal_gallery' )
			{
    			objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'link-can-view' ,
    						'desc' : 'Var apskatīt un lejuplādēt' ,
    						'selected' : ( this.strAccessType == 'link' ? true : false ) ,
    						'class' : 'upload-access-switch_type-select_option_link-can-view'
    					} )
    					.text( 'Atverot šo saiti, var piekļūt' )
    				);

    			objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'link-can-edit' ,
    						'desc' : 'Var pievienot, rediģēt saturu, e-parakstīt un dzēst.' ,
    						'selected' : ( this.strAccessType == 'link-can-edit' ? true : false ) ,
    					} )
    					.text( 'Saņem saiti rediģēšanai' )
    				);

    			if ( this.strItemType == 'upload' )
    			{
        			objTypeSelect.append(
        					$( '<option></option>' ).attr( {
        						'value' : 'link-can-upload' ,
        						'desc' : 'Var pievienot klāt failus, bet nevar dzēst vai rediģēt esošos.' ,
        						'selected' : ( this.strAccessType == 'link-can-upload' ? true : false ) ,
        					} )
        					.text( 'Saņem saiti failu pievienošanai' )
        				);
    			}
			}

			if ( this.strItemType == 'upload' && this.bolOwnerLoggedIn )
			{
				objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'password' ,
    						'desc' : 'Apmeklētājiem ir jāievada parole' ,
    						'selected' : ( this.strAccessType == 'password' ? true : false )
    					} )
    					.text( 'Uzstādīt paroli' )
    				);
			
				objTypeSelect.append(
    					$( '<option></option>' ).attr( {
    						'value' : 'public' ,
    						'desc' : 'Publiski redzams ikvienam jūsu profilā un atrodams meklētājā.' ,
    						'selected' : ( this.strAccessType == 'public' ? true : false )
    					} )
    					.text( 'Publicēts manā profila lapā' )
    				);
			}

			objTypeSelectWrap.append( objTypeSelect );

			$('.url_wrapper ').removeClass('switch');
			
			if ( this.strUploadAccessSwitchType == 'sharing_form' )
			{
				strHtml = 	'<div id="upload-access-switch_type-toggle_wrapper">'+
							'<input type="checkbox" class="upload-access-switch_type-toggle"'+
							( this.strAccessType == 'private' ? ' ' : 'checked ' )+
							//'disabled="'+( this.strUploadAccessSwitchType == 'default' && ! this.bolOwnerLoggedIn ? true : false )+'"'+
							'id="upload-access-switch_type-toggle">'+
							'<label for="upload-access-switch_type-toggle"></label>'+
							'<div>Privāti</div>'+
							'<div>Saite</div>'+
							'</div>';


				if (this.strItemType == 'upload' )
				{
					$('.url_wrapper ').addClass('switch');
					strHtml += '<div id="upload-access-switch-password-download-wrap">'+
									'<div class="upload-access-switch_password-wrapper ' + (this.strAccessType == 'password' ? 'has_password' : '') + '">'+
										'<label onclick="$(this).parent().addClass(\'open\'); $(this).parent().find(\'input\').focus()"> ' + (this.strAccessType == 'password' ? 'Parole:' : 'Uzstādīt paroli') + '</label>'+
										'<input onclick="$(this).parent().addClass(\'open\')" type="text" class="upload-access-switch_password" value="'+this.strUploadPassword+'"></input>'+
										'<input onclick="$(this).parent().addClass(\'open\')" type="password" class="upload-access-switch_password_placeholder" value="111111"></input>'+
										'<div class="upload-access-switch_password-save-btn">Saglabāt</div>'+
									'</div>';
					
					if (typeof objUploadAccessSwitchSettings.hide_download_buttons !== 'undefined' && ! (! bolSessionUser_IsStorageSubscriber && ! bolSessionUser_HasLifetimeStorage) )
					{
						strHtml +=	'<div class="upload-access-switch-hide-download">' +
										'<label for="upload-access-switch_hide-download-toggle">Atslēgt lejupielādes:</label>' +
										'<input type="checkbox" class="upload-access-switch_hide-download-toggle" '+ (objUploadAccessSwitchSettings.hide_download_buttons == '1' ? 'checked' : '') +' id="upload-access-switch_hide-download-toggle">' +
										'<label for="upload-access-switch_hide-download-toggle"></label>' +
										'<label>'+(objUploadAccessSwitchSettings.hide_download_buttons == '1' ? 'Jā' : 'Nē')+'</label>'+
									'</div>';	
					}
					
					strHtml += '</div>';
				}

				$( this.objParentElement ).html(

					$( '<div></div>' ).attr( {
						'class' : 'upload-access-switch ' + (typeof objUploadAccessSwitchSettings.propagate_settings !== 'undefined' && objUploadAccessSwitchSettings.propagate_settings == 2 ? 'disabled' : '') ,
						'data-selected-access-type' : this.strAccessType 
					} )
					.append(
						$( '<div></div>' ).attr( {
							'class' : 'upload-access-switch_type-wrapper' 
						} )
						.append(
							$( '<label></label>' ).text( ( this.strUploadAccessSwitchType == 'sharing_form' ? 'Piekļuves tiesības:' : 'Piekļuve:' ) )
						)
						.append(
							$( '<label></label>' ).attr( {
							'class' : 'upload-access-switch_type-wrapper-desc' 
							} ).text(( this.strAccessType == 'private' ? 'Tikai ar privātu atļauju' : 'Jebkuram, kurš zina saiti' ))
						)
					)
					.append( strHtml )

					
					
				);
			}
			else
			{
				$( this.objParentElement ).html(

					$( '<div></div>' ).attr( {
						'class' : 'upload-access-switch' ,
						'data-selected-access-type' : this.strAccessType 
					} )
					.append(
						$( '<div></div>' ).attr( {
							'class' : 'upload-access-switch_type-wrapper' 
						} )
						.append(
							$( '<label></label>' ).text( ( this.strUploadAccessSwitchType == 'sharing_form' ? 'Saites un piekļuves tiesības:' : 'Piekļuve:' ) )
						)
						.append( objTypeSelectWrap )
					)
					.append(
						$( '<div></div>' ).attr( {
							'class' : 'upload-access-switch_password-wrapper'
						} )
						.append(
							$( '<label></label>' ).text( 'Parole:' )
						)
						.append(
							$( '<input/>' ).attr( {
								'class' : 'upload-access-switch_password' ,
								'type' : 'text' ,
								'title' : 'Ievadi mapes paroli' ,
								'value' : this.strUploadPassword
							} )
						)
						.append(
							$( '<div></div>' ).attr( {
								'class' : 'upload-access-switch_password-save-btn'
							} ).text( 'Saglabāt' )
						)
					)
					.append(
						$( '<div></div>' ).attr( {
							'class' : 'upload-access-switch_loading-mask'
						} )
						.append(
							$( '<i></i>' ).attr( {
								'class' : 'fal fa-spinner fa-spin'
							} )
						)
					)
				);
			}
		


			checkTooltips();
			
			var x, i, j, selElmnt, a, b, c, d, e;
			/*look for any elements with the class "styled-select":*/
			x = document.getElementsByClassName("upload-access-switch-select");
			
			for (i = 0; i < x.length; i++) 
			{
				if (x[i].getElementsByClassName("select-selected").length < 1) 
				{
					selElmnt = x[i].getElementsByTagName("select")[0];
					/*for each element, create a new DIV that will act as the selected item:*/
					a = document.createElement("DIV");
					a.setAttribute("class", "select-selected");
					a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
					x[i].appendChild(a);
					/*for each element, create a new DIV that will contain the option list:*/
					b = document.createElement("DIV");
					b.setAttribute("class", "select-items select-hide");
					for (j = 1; j < selElmnt.length; j++) {
						/*for each option in the original select element,
						create a new DIV that will act as an option item:*/
						c = document.createElement("DIV");
						d = document.createElement("DIV");
						if(selElmnt.options[j].value == selElmnt.value)
						{
							c.setAttribute("class", "checked");
						}
						e = document.createElement("DIV");
						e.setAttribute("class", "value");
						d.setAttribute("class", "desc");
						//c.innerHTML = selElmnt.options[j].innerHTML;
						e.innerHTML = selElmnt.options[j].innerHTML;
						d.innerHTML = selElmnt.options[j].getAttribute('desc');
						c.appendChild(e);
						c.appendChild(d);
						if ( !!selElmnt.id && !!selElmnt.options[j].value )
						{
							c.setAttribute( 'id', selElmnt.id + '_' + selElmnt.options[j].value );
						}
						c.addEventListener("click", function(e) {
							/*when an item is clicked, update the original select box,
							and the selected item:*/
							var y, i, k, s, sjq, h, clicked;
							clicked = this;
							s = this.parentNode.parentNode.getElementsByTagName("select")[0];
							sjq = $(s);
							$(clicked).parents().children().removeClass('checked');
							$(clicked).addClass('checked');

									
							h = this.parentNode.previousSibling;
							for (i = 0; i < s.length; i++) {
								if (s.options[i].innerHTML == this.getElementsByClassName("value")[0].innerHTML) {
									s.selectedIndex = i;
									h.innerHTML = this.getElementsByClassName("value")[0].innerHTML;
									y = this.parentNode.getElementsByClassName("same-as-selected");
									for (k = 0; k < y.length; k++) {
										y[k].removeAttribute("class");
									}
									this.setAttribute("class", "same-as-selected checked");
									sjq.trigger("change");
									break;
								}
							}
							h.click();
						});
						b.appendChild(c);
					}
					x[i].appendChild(b);
					a.addEventListener("click", function(e) {
						/*when the select box is clicked, close any other select boxes,
						and open/close the current select box:*/
						e.stopPropagation();
						closeAllSelect(this);
						this.nextSibling.classList.toggle("select-hide");
						this.classList.toggle("select-arrow-active");
						this.parentElement.classList.toggle("blue-border");
						if (this.parentElement.previousElementSibling)
						{
							this.parentElement.previousElementSibling.classList.toggle("blue-span");
						}
						
					});
				}
			}
			function closeAllSelect(elmnt) {
				/*a function that will close all select boxes in the document,
				except the current select box:*/
				var x, y, i, arrNo = [];
				x = document.getElementsByClassName("select-items");
				y = document.getElementsByClassName("select-selected");
				for (i = 0; i < y.length; i++) {
					if (elmnt == y[i]) {
						arrNo.push(i)
					} else {
						y[i].classList.remove("select-arrow-active");
					}
				}
				for (i = 0; i < x.length; i++) {
					if (arrNo.indexOf(i)) {
						x[i].classList.add("select-hide");
						x[i].parentElement.classList.remove("blue-border");
						if (x[i].parentElement.previousElementSibling)
						{
							x[i].parentElement.previousElementSibling.classList.remove("blue-span");
						}
					}
				}
			}
			/*if the user clicks anywhere outside the select box,
			then close all select boxes:*/
			if ( ! bolUploadAccessSwitch_closeAllSelect_Binded )
			{
				document.addEventListener("click", closeAllSelect);
				bolUploadAccessSwitch_closeAllSelect_Binded = true;
			}

			if ( ! this.bolOwnerLoggedIn )
			{
				if ( this.strUploadAccessSwitchType == 'sharing_form' )
				{
					// do nothing
				}
				else
				{
        			$( this.objParentElement ).on( 'click', function( event )
        			{
        				showCreateAccount();
        			} );
				}
			}
			else
			{
    			$( this.objParentElement ).find( '.upload-access-switch_type-select' ).on( 'change', function()
    			{
    				_this.changeAccessType( $( this ).val() );
    			} );
    
				$( this.objParentElement ).find( '.upload-access-switch_password' ).on( 'blur', function()
    			{
					if($( this ).val().trim() != '' ) {
						$(this).parent().delay(500).queue(function(next) {
							$(this).removeClass('open');
							$( '.upload-access-switch_password-save-btn' ).html('Saglabāt');
							$( '.upload-access-switch_password-save-btn' ).removeClass("green");
							next();
						});
					}
					else
					{
						$( this ).parent().removeClass('has_password').removeClass('open');
						$( '.upload-access-switch_password-save-btn' ).html('Saglabāt');
						$( '.upload-access-switch_password-save-btn' ).removeClass("green");
					}
				} );

    			$( this.objParentElement ).find( '.upload-access-switch_password' ).on( 'change', function()
    			{
					$(this).parent().addClass('has_password');
    				_this.changeAccessType( 'password' );
    			} );

				$( this.objParentElement ).find( '#upload-access-switch_type-toggle' ).on( 'change', function()
    			{
					if ($(this).is(':checked'))
					{
						_this.changeAccessType( 'link' );
					}
					else
					{
						_this.changeAccessType( 'private' );
					}
    				
    			} );

				$( this.objParentElement ).find( '.upload-access-switch_hide-download-toggle' ).on( 'change', function()
    			{

					if ($(this).is(':checked'))
					{
						_this.changeHideDownloadButtons( 1 );
						$(this).next().next().html('Jā');
					}
					else
					{
						_this.changeHideDownloadButtons( 0 );
						$(this).next().next().html('Nē');
					}
    			} );
				

				$( this.objParentElement ).find( '.upload-access-switch_password' ).on( 'input', function()
    			{
					$( '.upload-access-switch_password-save-btn' ).html('Saglabāt');
            		$( '.upload-access-switch_password-save-btn' ).removeClass("green");
    			} );
			}
		}

		this.init();

		this.changeHideDownloadButtons = function( intHideDownloadButtons )
		{
			this.showLoadingMask();

			var strAjax_Url = '';
            var objAjax_Data = null;

            if ( this.strItemType == 'upload' )
            {
            	strAjax_Url = '/ajax/upload_info.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8';
            	
            	objAjax_Data = {
                    'set_upload_hide_download_buttons': true ,
					'upload_hash' : this.strUploadHash ,
					'hide_download_buttons' : intHideDownloadButtons
                };
            }
            
            			
            $.ajax(
            {
                type: "POST",
                dataType: "json",
                url: strAjax_Url ,
                data: objAjax_Data ,
                success: function( data )
                {
                    if ( data['status'] == 'ok' )
                    {
                    	if ( _this.strItemType == 'upload' && ( _this.strEmbedPlace == 'filebrowser' || _this.strEmbedPlace == 'list' ) )
            			{
                        	location.reload();
            			}

            			_this.hideLoadingMask();
                    }
                    else
                    {
                        _this.afterErrorOn_changeAcceccType();
                    }
                } ,
                error: function()
                {
                    _this.afterErrorOn_changeAcceccType();
                }
            } );
		}
		

		this.changeAccessType = function( strNewAccessType )
		{
			$( this.objParentElement ).find( '.upload-access-switch' ).attr( 'data-selected-access-type', strNewAccessType );

			
			if ( strNewAccessType == 'password' && $( this.objParentElement ).find( '.upload-access-switch_password' ).val().trim() == '' )
			{
				if ( this.strUploadAccessSwitchType == 'sharing_form' )
				{
					this.changeAccessType( 'link' );
					$( this.objParentElement ).find( '.upload-access-switch_password' ).parent().removeClass('has_password').removeClass('open');
					$( '.upload-access-switch_password-save-btn' ).html('Saglabāt');
					$( '.upload-access-switch_password-save-btn' ).removeClass("green");
				}
				return;
			}

			if (
					strNewAccessType == 'link-can-view'
					|| strNewAccessType == 'link-can-edit'
					|| strNewAccessType == 'link-can-upload'
				)
			{
				strNewAccessType = 'link';
			}


			if ( this.strItemType == 'file' )
			{
				if ( this.strParentAccessType == 'LINK' && strNewAccessType == 'private' )
				{
                    this.afterErrorOn_changeAcceccType( 'Privāta piekļuve šim failam nestrādās, jo augšējās mapes piekļuve nav privāta. Vispirms pārslēdziet piekļuves uzstādījumus mapei.' );
					return;
				}
			}

			
			this.showLoadingMask();


			var strAjax_Url = '';
            var objAjax_Data = null;

            if ( this.strItemType == 'upload' )
            {
            	strAjax_Url = '/ajax/upload_info.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8';
            	
            	objAjax_Data = {
                    'set_upload_access_type' : true ,
					'upload_hash' : this.strUploadHash ,
					'upload_access_type' : strNewAccessType ,
					'upload_password' : $( this.objParentElement ).find( '.upload-access-switch_password' ).val()
                };
            }
            else if ( this.strItemType == 'file' )
            {
            	strAjax_Url = '/ajax/file_info.php?PHPSESSID=a141ea7b6d9c68b3a30cc1d40f5f16025958d2b8';
            	
            	objAjax_Data = {
                    'set_file_access_type' : true ,
					'file_hash' : this.strFileHash ,
					'file_access_type' : strNewAccessType 
                };
            }
            
            			
            $.ajax(
            {
                type: "POST",
                dataType: "json",
                url: strAjax_Url ,
                data: objAjax_Data ,
                success: function( data )
                {
                    if ( data['status'] == 'ok' )
                    {
                    	_this.strAccessType = strNewAccessType;
                    	_this.bolAccessTypeChanged = true;

                    	if ( _this.strItemType == 'upload' )
                    	{
                			if ( strNewAccessType != 'password' )
                			{
                				$( _this.objParentElement ).find( '.upload-access-switch_password' ).val( '' );
								$( _this.objParentElement ).find( '.upload-access-switch_password-wrapper' ).find('label').eq(0).html('Uzstādīt paroli');
								$( _this.objParentElement ).find( '.upload-access-switch_password' ).parent().removeClass('has_password').removeClass('open');
                			}
							else 
							{
								$( '.upload-access-switch_password-save-btn' ).html('Saglabāts!');
            					$( '.upload-access-switch_password-save-btn' ).addClass("green");
								$( _this.objParentElement ).find( '.upload-access-switch_password-wrapper' ).find('label').eq(0).html('Parole:');
							}
    
                			if ( strNewAccessType == 'link' )
                			{
                    			$( '#upload_button__publish' ).show();
                    			$( '#upload_button__unpublish' ).hide();
                			}
                			else if ( strNewAccessType == 'public' )
                			{
                    			$( '#upload_button__publish' ).hide();
                    			$( '#upload_button__unpublish' ).show();
                			}
                			else 
                			{
                    			$( '#upload_button__publish' ).hide();
                    			$( '#upload_button__unpublish' ).hide();
                			}
    
                			if ( _this.strEmbedPlace == 'filebrowser' )
                			{
    							gaev( 'filebrowser-folder-info', 'access', strNewAccessType );
                			}
                    	}

                    	if ( _this.strItemType == 'upload' && ( _this.strEmbedPlace == 'filebrowser' || _this.strEmbedPlace == 'list' ) )
            			{
                        	location.reload();
            			}

            			_this.hideLoadingMask();
            			
                    }
                    else
                    {
                        _this.afterErrorOn_changeAcceccType();
                    }
                } ,
                error: function()
                {
                    _this.afterErrorOn_changeAcceccType();
                }
            } );
		}

		this.afterErrorOn_changeAcceccType = function( strErrorMsg )
		{
			if ( this.strAccessType == 'link' && this.strUploadAccessSwitchType == 'sharing_form' )
			{
				this.strAccessType = 'link-can-view';
			}
    					
			$( this.objParentElement ).find( '.upload-access-switch' ).attr( 'data-selected-access-type', this.strAccessType );
			$( this.objParentElement ).find( '.upload-access-switch_type-select option[value="' + this.strAccessType + '"]' ).attr( 'selected', 'selected' );

			$( this.objParentElement ).find( '.upload-access-switch_type-select' ).trigger( 'change' );

			if ( typeof strErrorMsg == 'undefined' )
			{
				strErrorMsg = 'Notika kļūda. Mēģiniet vēlreiz!';
			}
			
			fError( strErrorMsg );

			this.hideLoadingMask();
		}

		this.showLoadingMask = function()
		{
			$( this.objParentElement ).find( '.upload-access-switch_loading-mask' ).show();
		}

		this.hideLoadingMask = function()
		{
			$( this.objParentElement ).find( '.upload-access-switch_loading-mask' ).hide();
		}
	}

</script>
<section id="share_popup" class="modal-container">
    <div class="modal-inner">
        <div class="inner">
            <div class="head clearfix">
                <div class="content">
                    
                <div id="shared-icon"></div>
                    <h5>
                    	<span class="head-label">Dalies ar saiti:</span>
                    	<span class="item-name"></span>
                	</h5>
                    
                </div>
            </div>
            
            <div id="share-popup_all-files-sharing-info">
            	<i class="fa fa-exclamation-triangle"></i>
            	Tiks koplietoti            	<b>visi            	<span id="share-popup_all-files-sharing-info_file-count"></span>
            	faili            	</b>
            	no mapes            	<b><span class="item-name"></span></b>
            </div>
    
            <div class="content">
            
                                <div>
                    <div id="share-popup_upload-access-switch"></div>
                </div>
                                
                
                <div class="share-popup_inner-content">
                
                        
		                        <div class="url_wrapper url_wrapper__sher-link">

                    <div id="url_wrapper__sher-link-icon"></div>

                	<input id="share_popup_url" class="copy_input_value_to_clipboard_no_tooltip" type="text" value="" readonly />

                        <div class="copy_button_wrapper_popup" onmouseover="$(this).addClass('open_popup');" onmouseleave="$(this).removeClass('open_popup');">
                            <div id="copy_button_popup" class="copy_button_popup">
                                <div class="copy_text_popup">
                                    <div class="hover_popup">Kopēt</div>
                                    <div class="copied">Nokopēts!</div>
                                </div>
                            </div>
                            <div id="copy_button_drawer_popup"></div>
                        </div>

                        <span id="share_popup_ext_link_cont">
                            <a target="_blank" id="share_popup_ext_link" href=""></a>
                        </span>
                   
                </div>
                
        
                <div class="social_wrapper clearfix">
                    <div class="social_inner">
                        <span class="social_button messenger"></span>
                        <span class="social_button facebook"></span>
                        <span class="social_button whatsapp"></span>
                        <span class="social_button twitter"></span>
                        <span class="social_button telegram"></span>
                        <span class="social_button linkedin"></span>
                                            </div>
                </div>

                <div class="link-can-upload">
                    <div id="seperator-or"><span>Vai</span></div>
                </div>
                
                <div class="link-can-upload">
                
                <div class="email_container share_type_container" style="display: block; margin-left: 0;">
                    <div class="email_wrapper">
                        <label for="share_em">Piešķirt un sūtīt privātu piekļuvi uz e-pastu:</label>
                        <div class="email_input_wrapper">
                            <input id="email_input" type="text" placeholder="Ievadi e-pastus, kam piešķirt privātu piekļuvi" />
                            <input class="" type="text" name="e" id="share_em" value="" placeholder="Ievadi e-pastus, kam piešķirt privātu piekļuvi" />
                            <!--
                            <button id="email_send_button">
                                Sūtīt                            </button>
                            -->
                        </div>
                    </div>
                </div>
                
                
                <div class="share_access_rights__wrapper">
                	<div class="share_access_rights__label">ar tiesībām:</div>
                    <input type="checkbox" class="share_access_rights styled_radioblue_btn small" checked="checked" id="share_access_rights__allow_view" /><label for="share_access_rights__allow_view">skatīt</label>
                    <input type="checkbox" class="share_access_rights styled_radioblue_btn small" checked="checked" id="share_access_rights__allow_download" /><label for="share_access_rights__allow_download">lejuplādēt</label>
                    <input type="checkbox" class="share_access_rights styled_radioblue_btn small" id="share_access_rights__allow_write" /><label for="share_access_rights__allow_write">rediģēt</label>
                    <input type="checkbox" class="share_access_rights styled_radioblue_btn small" id="share_access_rights__allow_delete" /><label for="share_access_rights__allow_delete">dzēst</label>
    				                </div>

                <div class="active_date_input enterprise_feature">
                    <div class="active_date__label">
                        uz periodu:                    </div>
                    <div class="active_date_input__radio_item">
                        <input type="radio" name="share_popup__active_date_input_active_radio" id="active_date_input_active_radio_off" checked="checked" value="0" class="styled_radioblue_btn small">
                        <label for="active_date_input_active_radio_off">neierobežotu</label>
                    </div>
                    <div class="active_date_input__radio_item">
                        <input type="radio" name="share_popup__active_date_input_active_radio" id="active_date_input_active_radio_on" value="1" class="styled_radioblue_btn small">
                        <label for="active_date_input_active_radio_on">ierobežotu</label>
                    </div>
                    <div class="active_date_input__input_item" style="display: none">
                        <label for="active_date_input_from">no:</label><input type="text" id="active_date_input_from" value="2023-04-13 00:00" />
                        <label for="active_date_input_to">līdz:</label><input type="text" id="active_date_input_to" value="2023-05-13 00:00" />
                    </div>
                </div>
                
                <div class="enterprise_feature share_email__send_share_email_element">
                	<input type="checkbox" class="styled_radioblue_btn small" id="share_email__send_share_email" checked="checked"/>
                    <label for="share_email__send_share_email">Sūtīt paziņojuma e-pastu par koplietošanu</label>
                </div>
                
                <div class="email_description_input_wrapper share_email__send_share_email_element">
                    <textarea id="description_input" placeholder="Ierakstiet ziņu"></textarea>
                </div>
                
                <div class="clearfix email_send_wrapper">
                                        <button id="share_popup__cancel_button" class="cancel_button">
                        Atcelt                    </button>
                    <button id="share_popup__send_button" class="send_button">
                        Nosūtīt pieeju                    </button>
                </div>
                <div class="shared_with_container">
                
                </div>
                
                </div>
                
                </div>
                
            </div>
        </div>
    </div>
    <div id="share_popup__close" class="modal-close" data-dismiss="modal" data-close="Aizvērt" onclick="hideSharePopup()"></div>
</section>

<script type="text/javascript">

    var arrSharePopupAllowEmbedPlayer_Extensions = ["mp4","webm","ogg","mp3","wav","jpeg","jpg","png","gif","svg","pdf"];

    var jqSharePopupContainer = $('#share_popup');

    var objSharePopupUploadAccessSwitch = null;
    
    var strErrorMsgNoExternalGroup = 'Jūsu kontā šobrīd nav pievienotas ārējo lietotāju grupas. Izveido ārējo lietotāju grupu vari <a href="/manage_users/external_user_group_list.php" target="_blank">šeit</a>.';
    
	$( function(){
	    $( '#share_popup #share_popup_url' ).on( 'keydown', function(){
// 	        return false;
	    });
        
        $(document).on('click', '#share_popup .copy_input_value_to_clipboard_no_tooltip, #share_popup #url_wrapper__sher-link-icon, #share_popup #copy_button_popup', function (e)
        {
            var el = document.createElement( 'textarea' );
            el.value = $( "#share_popup_url" ).val();
            document.body.appendChild( el );
            el.select();
            document.execCommand( 'copy' );
            document.body.removeChild( el );

            $('#share_popup #copy_button_popup').addClass('copied').delay(4000).queue(function(next) {
                $(this).removeClass('copied');
                next();
            });
            if($( this ).attr('id') != 'copy_button_popup')
            {
                $('#share_popup .copy_button_wrapper_popup').removeClass('open_popup');
            }
            else
            {
                $('#share_popup .copy_button_wrapper_popup').addClass('open_popup');
            }
        } );

		$(document).on('click', '#share_popup .social_button.facebook', function() {

			shareOnFacebook(
				arrSharePopupParametres[ strSharePopupType ][ 'facebook' ][ 'name' ],
				arrSharePopupParametres[ strSharePopupType ][ 'facebook' ][ 'picture_url' ],
				arrSharePopupParametres[ strSharePopupType ][ 'facebook' ][ 'description' ],
				arrSharePopupParametres[ strSharePopupType ][ 'facebook' ][ 'link' ],
                arrSharePopupParametres[ strSharePopupType ][ 'facebook' ][ 'return_link' ]
			);
		});
        
        $(document).on('click', '#share_popup .social_button.twitter', function() {
            
            shareOnTwitter(
                arrSharePopupParametres[ strSharePopupType ][ 'twitter' ][ 'text' ] ,
                arrSharePopupParametres[ strSharePopupType ][ 'twitter' ][ 'link' ]
            );
        });
        $(document).on('click', '#share_popup .social_button.telegram', function() {
    
            shareOnTelegram(
                arrSharePopupParametres[ strSharePopupType ][ 'twitter' ][ 'text' ] ,
                arrSharePopupParametres[ strSharePopupType ][ 'twitter' ][ 'link' ]
            );
        });
        
        $(document).on('click', '#share_popup .social_button.whatsapp', function() {
            window.open( "https://api.whatsapp.com/send?text=" + encodeURIComponent( $( "#share_popup_url" ).val() ), "_blank" );
        });

                
        $( 'input[type=radio][name=share_popup__share_type_radio]', jqSharePopupContainer ).change( function ()
        {
            $( '.share_type_container', jqSharePopupContainer ).hide();
            
            if ( this.value === 'email' )
            {
                $( '.email_container', jqSharePopupContainer ).show();
            }
            else if ( this.value === 'business_account_user' )
            {
                $( '.business_account_user_container', jqSharePopupContainer ).show();
            }
            else if ( this.value === 'business_account_user_group' )
            {
                $( '.business_account_user_group_container', jqSharePopupContainer ).show();
            }
            else if ( this.value === 'business_account_external_user' )
            {
                $( '.business_account_external_user_container', jqSharePopupContainer ).show();
            }
            else if ( this.value === 'business_account_external_user_group' )
            {
                $( '.business_account_external_user_group_container', jqSharePopupContainer ).show();
            }
            else if ( this.value === 'project_internal_user' )
            {
                $( '.project_internal_user_container', jqSharePopupContainer ).show();
            }
            else if ( this.value === 'project_external_user' )
            {
                $( '.project_external_user_container', jqSharePopupContainer ).show();
            }
        } );


        $( document ).on( 'change', '#share_email__send_share_email', function()
		{
    		if ( $( this ).prop('checked') )
    		{
                $( '.email_description_input_wrapper', jqSharePopupContainer ).show();
                $( 'label[for="share_email_send_notification"]', jqSharePopupContainer ).show();
                $( '#share_popup__send_button', jqSharePopupContainer ).text( 'Nosūtīt pieeju' );
    		}
    		else
    		{
                $( '.email_description_input_wrapper', jqSharePopupContainer ).hide();
                $( 'label[for="share_email_send_notification"]', jqSharePopupContainer ).hide();
                $( '#share_popup__send_button', jqSharePopupContainer ).text( 'Saglabāt' );
    		}
		} );


        $( document ).on( 'change', '.share_access_rights', function()
		{
    		var strAccessRightVal = $( this ).attr( 'id' ).replace( "share_access_rights__allow_", "" );

    		var bolIsChecked = $( this ).is(":checked");

    		if ( bolIsChecked )
    		{
				if ( strAccessRightVal == 'delete' )
				{
					$( '#share_access_rights__allow_write' ).prop( 'checked', true );
					$( '#share_access_rights__allow_download' ).prop( 'checked', true );
					$( '#share_access_rights__allow_view' ).prop( 'checked', true );
				}
				else if ( strAccessRightVal == 'write' )
				{
					$( '#share_access_rights__allow_download' ).prop( 'checked', true );
					$( '#share_access_rights__allow_view' ).prop( 'checked', true );
				}
				else if ( strAccessRightVal == 'download' )
				{
					$( '#share_access_rights__allow_view' ).prop( 'checked', true );
				}
    		}
    		else
    		{
				if ( strAccessRightVal == 'view' )
				{
					$( '#share_access_rights__allow_download' ).prop( 'checked', false );
					$( '#share_access_rights__allow_write' ).prop( 'checked', false );
					$( '#share_access_rights__allow_delete' ).prop( 'checked', false );
				}
				else if ( strAccessRightVal == 'download' )
				{
					$( '#share_access_rights__allow_write' ).prop( 'checked', false );
					$( '#share_access_rights__allow_delete' ).prop( 'checked', false );
				}
				else if ( strAccessRightVal == 'write' )
				{
					$( '#share_access_rights__allow_delete' ).prop( 'checked', false );
				}
    		}
    		
		} );

        $( document ).on( 'change', '#share-popup_upload-access-switch .upload-access-switch_type-select', function()
		{
    		var strAccessSwitchType = $( this ).val();
            if (bolSharePopupReceiveFolder)
            {
                $('.link-can-upload').show();
            }
            
    		if ( strAccessSwitchType == 'private' )
    		{
        		//$( '#share_popup .url_wrapper__sher-link' ).hide();
        		$( '#share_popup .social_wrapper' ).hide();
                //$( '#seperator-or' ).hide();
                $( '#share_popup  #url_wrapper__sher-link-icon' ).addClass('locked');
                $( '#share_popup  .upload-access-switch_password-wrapper' ).hide();
                $( '#share_popup .upload-access-switch_type-wrapper-desc' ).html('Tikai ar privātu atļauju');
    		}
    		else 
    		{
        		$( '#share_popup .url_wrapper__sher-link' ).show();
        		$( '#share_popup .social_wrapper' ).show();
                $( '#seperator-or' ).show();
                $( '#share_popup  #url_wrapper__sher-link-icon' ).removeClass('locked');
                $( '#share_popup  .upload-access-switch_password-wrapper' ).show();
                $( '#share_popup .upload-access-switch_type-wrapper-desc' ).html('Jebkuram, kurš zina saiti');
    		}
    		
    		if ( strAccessSwitchType == 'link-can-view' )
    		{
    			updateSharePopupLink( 1 );
    		}
    		else if ( strAccessSwitchType == 'link-can-edit' )
    		{
    			updateSharePopupLink( 2 );
    		}
    		else if ( strAccessSwitchType == 'link-can-upload' )
    		{
    			updateSharePopupLink( 3 );
                if (bolSharePopupReceiveFolder)
                {
                    $('.link-can-upload').hide();
                }
    		}
		} )
        
        $( document ).on( 'change', '#share-popup_upload-access-switch #upload-access-switch_type-toggle', function()
		{
            if ($(this).is(':checked'))
            {
                var strAccessSwitchType = 'link';
            }
            else
            {
                var strAccessSwitchType = 'private';
            }

            if (bolSharePopupReceiveFolder)
            {
                $('.link-can-upload').show();
            }
            
    		if ( strAccessSwitchType == 'private' )
    		{
        		//$( '#share_popup .url_wrapper__sher-link' ).hide();
        		$( '#share_popup .social_wrapper' ).hide();
        		$( '#share_popup  #url_wrapper__sher-link-icon' ).addClass('locked');
                $( '#share_popup  .upload-access-switch_password-wrapper' ).hide();
                //$( '#seperator-or' ).hide();
                $( '#share_popup .upload-access-switch_type-wrapper-desc' ).html('Tikai ar privātu atļauju');
    		}
    		else 
    		{
                $( '#share_popup  #url_wrapper__sher-link-icon' ).removeClass('locked');
                $( '#share_popup  .upload-access-switch_password-wrapper' ).show();
        		$( '#share_popup .url_wrapper__sher-link' ).show();
        		$( '#share_popup .social_wrapper' ).show();
                $( '#seperator-or' ).show();
                $( '#share_popup .upload-access-switch_type-wrapper-desc' ).html('Jebkuram, kurš zina saiti');
    		}
		} );
    });


    var arrSharePopupParametres = {};
    var strSharePopupType = '';
    var bolSharePopupReceiveFolder = false;

    function showSharePopup( event, arrParametres, bolReceiveFolder )
    {
    	arrSharePopupParametres = arrParametres;
        bolSharePopupReceiveFolder = bolReceiveFolder;
    
        if ( window.location.href.indexOf( "filebrowser" ) !== -1 )
        {
            if ( typeof arrParametres[ 'one_file' ] !== "undefined" && typeof arrParametres[ 'one_file' ][ 'facebook' ] !== "undefined" )
            {
                arrParametres[ 'one_file' ][ 'facebook' ][ 'return_link' ] = window.location.href;
            }
        
            if ( typeof arrParametres[ 'all_files' ] !== "undefined" && typeof arrParametres[ 'all_files' ][ 'facebook' ] !== "undefined" )
            {
                arrParametres[ 'all_files' ][ 'facebook' ][ 'return_link' ] = window.location.href;
            }
        }

        // Hide inputs if not allowed to share.
        if ( ! arrSharePopupParametres['can_share'] )
        {
            $( '#share_popup .active_date_input' ).hide();
            $( '#share_popup .share_type_radio' ).hide();
            $( '#share_popup .share_type_container' ).hide();
            $( '#share_popup .email_container' )
                .addClass('cannot_share')
                .show();
        }
        else
        {
            //$( '#share_popup.is_enterprise .active_date_input' ).show();
            $( '#share_popup.is_business_account .share_type_radio' ).show();
            $( '#share_popup .email_container' )
                .removeClass('cannot_share');
        }
        
        if ( arrSharePopupParametres[ 'show_type_select' ] )
        {
            $( '#share_popup .share_popup__type__select_item' ).show();
        }
        else
        {
        	$( '#share_popup .share_popup__type__select_item' ).hide();
        }

        
        if ( typeof arrSharePopupParametres[ 'show_soc_sharing' ] == 'undefined' || arrSharePopupParametres[ 'show_soc_sharing' ] )
        {
			$( '#share_popup .social_wrapper' ).show();
        }
        else 
        {
			$( '#share_popup .social_wrapper' ).hide();
        }

        
    	event.preventDefault();

        changeSharePopupType( arrSharePopupParametres[ 'type' ], bolSharePopupReceiveFolder );

        hideSharePopup();
    
        sharePopupInputSetup();
        
        // don't show two popups at once
        if ( typeof window.FileEmbedPopup !== 'undefined' )
        {
            window.FileEmbedPopup.hidePopup();
        }
        
        if ( typeof ( arrSharePopupParametres[ 'disable_email' ] ) !== "undefined" && arrSharePopupParametres[ 'disable_email' ] === true )
        {
            $( "#share_popup .email_container" ).hide();
            $( "#share_popup .email_description_input_wrapper" ).hide();
            $( "#share_popup #share_popup__send_button" ).hide();
            $( "#share_popup #share_popup__cancel_button" ).hide();
            $( '#share_popup .email_send_wrapper').hide();
            $( "#share_popup.is_enterprise label[for='share_email_send_notification']" ).hide();
            $("#share_popup.is_enterprise .share_access_rights__wrapper").hide();
            $("#share_popup.is_enterprise .enterprise_feature").hide();
        }
        else if ( ! arrSharePopupParametres['can_share'] || $( 'input[type=radio][name=share_popup__share_type_radio]:checked' ).val() === 'email' )
        {
            $( "#share_popup .email_container" ).show();
            $( "#share_popup .email_description_input_wrapper" ).hide(); //show only when email is provided
            $( "#share_popup.is_enterprise .email_description_input_wrapper" ).show();
            $( "#share_popup #share_popup__send_button" ).show();
            $( "#share_popup #share_popup__cancel_button" ).hide(); //show only when email is provided
            $( "#share_popup.is_enterprise label[for='share_email_send_notification']" ).css('display', 'block');
            
            if ( arrSharePopupParametres[ 'type' ] != 'dvs_document' )
            {
	            $( "#share_popup.is_enterprise .share_access_rights__wrapper" ).show();
            }
            
            $( "#share_popup.is_enterprise .enterprise_feature" ).show();
            $( '#share_popup__send_button' ).addClass( 'active' );
        }
    
        if ( typeof ( arrSharePopupParametres[ 'disable_link_types' ] ) !== "undefined" && arrSharePopupParametres[ 'disable_link_types' ] === true )
        {
            $( ".dropdown_wrapper" ).hide();
        }
        else
        {
            $( ".dropdown_wrapper" ).show();
        }

        var strUploadHash;
        var strFileViewHash;
        var intDvsDocumentId;
        
        if ( strSharePopupType == 'dvs_document' )
        {
        	intDvsDocumentId = arrSharePopupParametres[ 'dvs_document_id' ];
        }
        else if( typeof arrSharePopupParametres[ strSharePopupType ][ 'share_email' ] !== 'undefined' )
        {
            strUploadHash = arrSharePopupParametres[ strSharePopupType ][ 'share_email' ][ 'upload_hash' ];
            strFileViewHash = arrSharePopupParametres[ strSharePopupType ][ 'share_email' ][ 'file_view_hash' ];
        }
        else if ( typeof arrSharePopupParametres[ strSharePopupType ][ 'item_info' ] !== 'undefined' )
        {
            strUploadHash = arrSharePopupParametres[ strSharePopupType ][ 'item_info' ][ 'upload_hash' ];
            strFileViewHash = arrSharePopupParametres[ strSharePopupType ][ 'item_info' ][ 'file_view_hash' ];
        }
        
        if ( ! strUploadHash && ! strFileViewHash && ! intDvsDocumentId )
        {
            $('#share_popup .email_container').hide();
        }
        

        
        
        if ( typeof arrSharePopupParametres[ 'from_eparaksts' ] != 'undefined' && arrSharePopupParametres[ 'from_eparaksts' ] )
        {
			$( '#share-popup_all-files-sharing-info_file-count' ).text( arrSharePopupParametres[ 'file_count_for_share' ] );			

			if ( arrSharePopupParametres.type == 'all_files' && arrSharePopupParametres.file_count_for_share > 1 )
			{
				$( '#share-popup_all-files-sharing-info' ).show();
			}
			else 
			{
				$( '#share-popup_all-files-sharing-info' ).hide();
			}
            
			$( '#share_popup .email_input_wrapper' ).css( 'border', '1px solid #008ddf' );
			$( '#share_access_rights__allow_write' ).attr( 'checked', true );

			updateSharePopupLink( 2 );
        }
        else 
        {
			$( '#share-popup_all-files-sharing-info' ).hide();
			
			$( '#share_popup .email_input_wrapper' ).css( 'border', '' );
			$( '#share_popup #description_input' ).text( '' );
			$( '#share_access_rights__allow_write' ).attr( 'checked', false );
        }

        if ( typeof arrSharePopupParametres[ 'from_bf_individual_catalog_settings' ] != 'undefined' && arrSharePopupParametres[ 'from_bf_individual_catalog_settings' ] )
        {
            $( '#share-popup_upload-access-switch .upload-access-switch_type-select option[value="link-can-edit"]' ).hide();
            $( '#share-popup_upload-access-switch .upload-access-switch_type-select option[value="link-can-upload"]' ).hide();
            $( '#share-popup_upload-access-switch .upload-access-switch_type-select option[value="public"]' ).hide();

			$( '#share_popup .email_input_wrapper' ).css( 'border', '1px solid #008ddf' );
			$( '#share_popup #description_input' ).text( ' Tev atsūtīja pieeju foto katalogam. Atver saiti, apskati un pasūti foto.' );

			$( '#share_popup .share_access_rights' ).attr( 'checked', false );
			$( '#share_access_rights__allow_view' ).attr( 'checked', true );

			$( '#share_email_send_notification' ).attr( 'checked', false );
			$( '#share_popup label[for="share_email_send_notification"]' ).hide();
        }
        
        
        showModal('share_popup');
        $('#share_popup .modal-inner').show();
        return false;
    }

    function sharePopupLoadSharedWithTable ( bolShowOpen )
    {
        var strUploadHash;
        var strFileViewHash;
        var intDvsDocumentId;
        
        if ( strSharePopupType == 'dvs_document' )
        {
        	intDvsDocumentId = arrSharePopupParametres[ 'dvs_document_id' ];
        }
        else if( typeof arrSharePopupParametres[ strSharePopupType ][ 'share_email' ] !== 'undefined' )
        {
            strUploadHash = arrSharePopupParametres[ strSharePopupType ][ 'share_email' ][ 'upload_hash' ];
            strFileViewHash = arrSharePopupParametres[ strSharePopupType ][ 'share_email' ][ 'file_view_hash' ];
        }
        else if ( typeof arrSharePopupParametres[ strSharePopupType ][ 'item_info' ] !== 'undefined' )
        {
            strUploadHash = arrSharePopupParametres[ strSharePopupType ][ 'item_info' ][ 'upload_hash' ];
            strFileViewHash = arrSharePopupParametres[ strSharePopupType ][ 'item_info' ][ 'file_view_hash' ];
        }
    
        var jqSharedWithContainer = $('#share_popup .shared_with_container');
    
        jqSharedWithContainer.html( '' ).css({'visibility': 'hidden'});
        $.ajax( {
            type: "GET",
            dataType: "json",
            url: "/api/sharing.php",
            data: {
                "Action": "GetSharingTable",
                "UploadHash": strFileViewHash ? null : strUploadHash ,
                "FileHash": strFileViewHash ? strFileViewHash : null ,
                "DvsDocumentId": intDvsDocumentId ? intDvsDocumentId : null ,
            },
            success: function ( data )
            {
                $( '#share_type__group_container__project_team' ).hide();
                
                var html = '';
                if ( data.Success )
                {
                    html = data.HTML;
                    if ( data.ItemNameHTML && data.ItemNameHTML != '' )
                    {
                        $('#share_popup .head .item-name').html( '"' + data.ItemNameHTML + '"' );
                        
                        if ( strSharePopupType != 'dvs_document' )
                        {
                        	$( '#seperator-or' ).show();
                        }
                    }
                    else 
                    {
                        $( '#seperator-or' ).hide();
                    }

                    if ( data.ProjectTeamInfo.ShowTeamInfo )
                    {
                    	$( '#share_type__group_container__project_team' ).show();

                    	$( '#share_popup .project_internal_user_container' ).html( '' );
                    	$.each( data.ProjectTeamInfo.TeamInfo.InternalUsers , function( key, objUser )
                    	{
                    		$( '#share_popup .project_internal_user_container' ).append(
                        		'<div>' +
                        			'<input type="checkbox" name="share_popup__project_internal_user_select" value="' + objUser.ID + '" id="share_popup__project_internal_user_select__' + objUser.ID + '" class="styled_radioblue_btn small">' +
	    							'<label for="share_popup__project_internal_user_select__' + objUser.ID + '">' + objUser.User + '</label>' +
    							'</div>' 
                    		);
                		} );

                    	$( '#share_popup .project_external_user_container' ).html( '' );
                    	$.each( data.ProjectTeamInfo.TeamInfo.ExternalUsers , function( key, objUser )
                    	{
                    		$( '#share_popup .project_external_user_container' ).append(
                        		'<div>' +
                        			'<input type="checkbox" name="share_popup__project_external_user_select" value="' + objUser.ID + '" id="share_popup__project_external_user_select__' + objUser.ID + '" class="styled_radioblue_btn small">' +
	    							'<label for="share_popup__project_external_user_select__' + objUser.ID + '">' + objUser.User + '</label>' +
    							'</div>' 
                    		);
                		} );
                    }
                }
    
                jqSharedWithContainer.html( html );
                
                setTimeout(function (){
                    jqSharedWithContainer.show().css({'visibility': 'visible'});
    
                    if ( bolShowOpen )
                    {
                        $('#upload_sharing_form__table').show();
                        $('#show_upload_sharing_form__table_link').hide();
                    }
                }, 100);
            }
        } );

    }
    
    var jqSharePopupTagsInput = $('#email_input');
    
    var bolShare_ErrorModal_PopupOpen = false;
    function sharePopup_CheckAlerts ()
    {
        if ( bolShare_ErrorModal_PopupOpen )
            return;
    
        bolShare_ErrorModal_PopupOpen = true;
        
        var arrItems = jqSharePopupTagsInput.tagsinput( 'items' );
        var objItem_ToAlert = null;
        for ( var i = 0; i < arrItems.length; i++ )
        {
            if ( ( ! arrItems[ i ].can_email || ! arrItems[ i ].is_valid_email || (arrItems[ i ].may_be_wrong_email ) ) && ! arrItems[ i ].wrong_email__is_accepted )
            {
                objItem_ToAlert = arrItems[ i ];
            }
        }
        
        if ( objItem_ToAlert )
        {
            var fncCallback = function ( bolChange )
            {
                if ( bolChange )
                {
                    if ( objItem_ToAlert.may_be_wrong_email_suggest )
                    {
                        objItem_ToAlert.value = objItem_ToAlert.may_be_wrong_email_suggest;
                    }
                    else
                    {
                        jqSharePopupTagsInput.tagsinput( 'remove', objItem_ToAlert );
                    }
                }
    
                objItem_ToAlert.wrong_email__is_accepted = true;
                
                jqSharePopupTagsInput.tagsinput( 'refresh' );
    
                bolShare_ErrorModal_PopupOpen = false;
    
                setTimeout(function (){
                    $( "#share_em" ).focus();
                    sharePopup_CheckAlerts();
                }, 50);
            };
            
            var strTitle = 'Nepareiza e-pasta adrese';
            
            if ( ! objItem_ToAlert.is_valid_email )
            {
                var strMessage = 'Ievadītā [[INCORRECT_EMAIL]] e-pasta adrese ir nepareiza! ';
                strMessage = strMessage.replace('[[INCORRECT_EMAIL]]', objItem_ToAlert.value);
                fConfirm( strMessage, strTitle, 'Izņemt', 'Atcelt', fncCallback );
                return;
            }
    
    
            if (objItem_ToAlert.may_be_wrong_email && ! objItem_ToAlert.wrong_email__is_accepted)
            {
                if ( objItem_ToAlert.may_be_wrong_email_suggest )
                {
                    var strMessage = 'Ievadītā [[INCORRECT_EMAIL]] e-pasta adrese iespējams ir nepareiza, vai izlabot uz: [[CORRECT_EMAIL]] ';
                    strMessage = strMessage.replace('[[INCORRECT_EMAIL]]', objItem_ToAlert.value);
                    strMessage = strMessage.replace('[[CORRECT_EMAIL]]', objItem_ToAlert.may_be_wrong_email_suggest);
                    fConfirm( strMessage, strTitle, 'Izlabot', 'Atcelt', fncCallback );
                    return;
                }
                else
                {
                    var strMessage = 'Ievadītā [[INCORRECT_EMAIL]] e-pasta adrese iespējams ir nepareiza! ';
                    strMessage = strMessage.replace('[[INCORRECT_EMAIL]]', objItem_ToAlert.value);
                    fConfirm( strMessage, strTitle, 'Izņemt', 'Atcelt', fncCallback );
                    return;
                }
            }
    
            if ( ! objItem_ToAlert.can_email )
            {
                var strMessage = '[[EMAIL]] e-pasta adreses īpašnieks ir atteicies no epastu saņemšanas! ';
                strMessage = strMessage.replace('[[EMAIL]]', objItem_ToAlert.value);
                fConfirm( strMessage, strTitle, 'Izņemt', 'Atcelt', fncCallback );
                return;
            }
            
        }
        else
        {
            bolShare_ErrorModal_PopupOpen = false;
        }
    }

    var intSharePopup_ValidationActiveCount = 0;
    var resSharePopupSubmitEmailsTimeout = null;
    function sharePopup_SubmitEmails()
    {
        if ( resSharePopupSubmitEmailsTimeout )
            clearTimeout( resSharePopupSubmitEmailsTimeout );
    
        // Wait for validation to complete.
        if ( intSharePopup_ValidationActiveCount > 0 )
        {
            resSharePopupSubmitEmailsTimeout = setTimeout( sharePopup_SubmitEmails, 50 );
            return;
        }
        
        var arrItems = jqSharePopupTagsInput.tagsinput( 'items' );
    
        var bolAllOk = true;
        for ( var i = 0; i < arrItems.length; i++ )
        {
            if ( ( ! arrItems[ i ].is_valid_email || arrItems[ i ].may_be_wrong_email ) && ! arrItems[ i ].wrong_email__is_accepted  )
                bolAllOk = false;
        }
    
        if ( arrItems.length === 0 || ! bolAllOk )
        {
            $( '#share_popup__send_button' ).text( 'Nosūtīt pieeju' );
            return;
        }

      

        if ( $( '#share_type_select__external_user_group' ).length > 0 )
        {
    		if ( $( '#share_type_select__external_user_group' ).val() == 0 )
    		{
    			$( '#share_type_select__external_user_group' ).addClass( 'has_error' );
    			fError( 'Norādi ārējo lietotāju grupu' )
    			return;
    		}
    		else
    		{
    			$( '#share_type_select__external_user_group' ).removeClass( 'has_error' );
    		}
        }
        
        var strUploadHash;
        var strFileViewHash;
        var intDvsDocumentId;
        
        if ( strSharePopupType == 'dvs_document' )
        {
        	intDvsDocumentId = arrSharePopupParametres[ 'dvs_document_id' ];
        }
        else if( typeof arrSharePopupParametres[ strSharePopupType ][ 'share_email' ] !== 'undefined' )
        {
            strUploadHash = arrSharePopupParametres[ strSharePopupType ][ 'share_email' ][ 'upload_hash' ];
            strFileViewHash = arrSharePopupParametres[ strSharePopupType ][ 'share_email' ][ 'file_view_hash' ];
        }
        else if ( typeof arrSharePopupParametres[ strSharePopupType ][ 'item_info' ] !== 'undefined' )
        {
            strUploadHash = arrSharePopupParametres[ strSharePopupType ][ 'item_info' ][ 'upload_hash' ];
            strFileViewHash = arrSharePopupParametres[ strSharePopupType ][ 'item_info' ][ 'file_view_hash' ];
        }
        
        if ( arrItems.length>0 && bolAllOk )
        {
            if ( strUploadHash || strFileViewHash || intDvsDocumentId )
            {
                var arrTmpItems = [];
                for ( var i = 0; i < arrItems.length; i++ )
                {
                    var obj = arrItems[i];
                    obj.item_type = 'email';
                    arrTmpItems.push( obj );
                }
                
                var objRights = {
                    view: 1,
                    download: 1,
                    write: 0,
                    delete: 0,
                    share: 0
                };

                objRights.view = $('#share_access_rights__allow_view').prop('checked') ? 1 : 0;
                objRights.download = $('#share_access_rights__allow_download').prop('checked') ? 1 : 0;
                objRights.write = $('#share_access_rights__allow_write').prop('checked') ? 1 : 0;
                objRights.delete = $('#share_access_rights__allow_delete').prop('checked') ? 1 : 0;
                objRights.share = $('#share_access_rights__allow_share').prop('checked') ? 1 : 0;

                var intExternalUserGroup = 0;

                if ( $( '#share_type_select__external_user_group' ).length > 0 )
                {
                	intExternalUserGroup = $( '#share_type_select__external_user_group' ).val();
                }

                
                $.post( '/ajax/share.php', {
                    items: arrTmpItems ,
                    upload_hash: strFileViewHash ? null : strUploadHash ,
                    file_view_hash: strFileViewHash ? strFileViewHash : null ,
                    dvs_document_id : intDvsDocumentId ? intDvsDocumentId : null ,
                    description: $('#description_input').val(),
                    send_share_email: ( $('#share_email__send_share_email').prop('checked') ? '1' : '0' ),
                    send_notification_once_open: ( $('#share_email_send_notification').prop('checked') ? '1' : '0' ),
                    date_active_enabled: $( 'input[type=radio][name=share_popup__active_date_input_active_radio]:checked' ).val(),
                    date_active_from: $( '#active_date_input_from' ).val(),
                    date_active_to: $( '#active_date_input_to' ).val(),
                    rights: objRights ,
                    submit: 1 ,
                    external_user_group : intExternalUserGroup ,
                    from_bf_individual_catalog_settings : ( typeof arrSharePopupParametres[ 'from_bf_individual_catalog_settings' ] != 'undefined' && arrSharePopupParametres[ 'from_bf_individual_catalog_settings' ] ? 1 : 0 ) ,
                    from_eparaksts : ( typeof arrSharePopupParametres[ 'from_eparaksts' ] != 'undefined' && arrSharePopupParametres[ 'from_eparaksts' ] ? 1 : 0 )
                }, function ( strResponse )
                {
                    var data = JSON.parse( strResponse );
                    $( '#share_popup__send_button', jqSharePopupContainer ).text( 'Nosūtīt pieeju' );
                    if (data['status'] === 'ok')
                    {
                        $('#email_input').val('');
                        jqSharePopupTagsInput.tagsinput('removeAll');
                        sharePopupLoadSharedWithTable (true);
                        
                        var strClass = 'f_dialog_success';
                        if ( data['sent_emails'].length === 0 )
                        {
                            strClass = 'f_dialog_error';
                        }
                        else if ( data['unsubscribed_emails'].length > 0 )
                        {
                            strClass = 'f_dialog_warning';
                        }
                        
                        var strMessage = '';
                        if ( data['sent_emails'].length > 0 )
                        {
                            strMessage += "E-pasti ir nosūtīti uz: <span style='color:green;'>" + data['sent_emails'] + "</span>";
                        }
                        else
                        {
                            strMessage += "E-pastus neizdevās nosūtīt!";
                        }
    
                        strMessage += '<br>';
                        
                        if ( data['unsubscribed_emails'].length > 0 )
                        {
                            strMessage += "E-pasti nav nosūtīti uz: <span style='color:orange'>" + data['unsubscribed_emails'] + "</span><br>" +
                                "<span style='font-size: 13px;line-height: 16px;display:block;padding-top:6px;'>Visus e-pastus neizdevās nosūtīt, jo adrešu īpašnieki ir atteikušies no Failiem.lv koplietošanas e-pastu saņemšanas. Lai koplietotu failus uz šīm adresēm, lūdzu, informējiet to īpašniekus, lai nomaina atteikšanās uzstādījumus savā kontā.</span>";
                        }
    
                        if ( data['invalid_emails'].length > 0 )
                        {
                            strMessage += '<br>';
                            strMessage += "E-pasti nav nosūtīti, nepareizs adresāts: <span style='color:orange'>" + data['invalid_emails'] + "</span>";
                        }
                        
                        fModal(
                            strClass,
                            strMessage,
                            "",
                            'OK',
                            null
                        );
                    }
                    else if (typeof data['message'] !== 'undefined' && data['message'] === 'free_emails_exhausted')
                    {
                        var strMsg = 'Failu koplietošanas e-pastu skaita ierobežojums ir sasniegts. Lai nosūtītu vairāk par 5 failu koplietošanas e-pastiem, kā arī izmantotu citas papildus iespējas, abonē PRO vai Biznesa kontu. Vairāk par abonēšanas pakalpojumiem lasi <a target="_blank" href="https://failiem.lv/storage-plans">šeit</a>';
        
                        if (typeof data.logged_in === 'undefined')
                        {
                            // something went wrong
                            fError(strMsg);
                            return;
                        }
        
                        var errorTable = $(
                            '<table id="free_emails_exhausted_alert" class="alert_container alert_container_danger"' +
                            '    <tr>' +
                            '        <td>' +
                            '            <i class="fa fa-exclamation-circle"></i>' +
                            '        </td>' +
                            '        <td>' +
                            '            <div class="alert_main_text">'
                            + strMsg +
                            '            </div>' +
                            '        </td>' +
                            '    </tr>' +
                            '</table>'
                        ).css('display', 'table');
        
                        hideSharePopup();
        
                        // if logged in show account creation form
                        if (!data.logged_in)
                        {
                            showCreateAccount();
                        }
                        else
                        {
                            // it not logged in show subscription form
                            var objSubscriptionForm = new SubscriptionForm();
                            objSubscriptionForm.showForm( 'share_popup__email_limit' );
                            if ($('#free_emails_exhausted_alert').length)
                            {
                                $('#free_emails_exhausted_alert').remove();
                            }
                            $("#subscription-form_global-alert").append(
                                $("<div/>").append(errorTable)
                            )
                        }
                    }
                    else if ( typeof data[ 'message' ] !== 'undefined' && data[ 'message' ] === 'marked_as_spam' )
                    {
                        fError( 'E-pasts netika nosūtīts, jo ir izsūtīti pārāk daudzi līdzīgi e-pasti!' );
                    }
                    else if ( typeof data[ 'message' ] !== 'undefined' && data[ 'message' ] === 'already_shared' )
                    {
                        fError( 'Jau ir koplietots ar šo lietotāju.' );
                    }
                    else if ( typeof data['error'] !== 'undefined' )
                    {
                        fError(data['error']);
                    }
                    else
                    {
                        fError( 'E-pasta sūtīšanas laikā notika kļūda. Lūdzu, mēģiniet vēlreiz vai sazinieties ar support@failiem.lv!<br/>Vienā reizē nav atļauts nosūtīt vairāk par 200 e-pastiem.' );
                    }
                } );
            }
        }
    }
    
    function sharePopupInputSetup () {
    
        jqSharePopupTagsInput.tagsinput({
            itemText: function(item) {
                return item.value;
            },
            tagClass: function(item) {
                switch (item.is_valid_email) {
                    case null: return 'processing';
                    case true: {
                        if ( item.may_be_wrong_email && ! item.wrong_email__is_accepted )
                        {
                            return 'processing'
                        }
                        else
                        {
                            return '';
                        }
                    }
                    case false: return 'error';
                }
            },
            confirmKeys: [13, 32, 44, 59],
            maxChars: 1024,
            trimValue: true,
            freeInput: true
        });
    
        //jqSharePopupTagsInput.tagsinput( 'removeAll' );
        $( ".bootstrap-tagsinput input" ).hide();
        
        
        jqSharePopupTagsInput.on('beforeItemAdd', function ( event )
        {
            if ( typeof( event.item ) === 'string' )
            {
                var arrItems = jqSharePopupTagsInput.tagsinput( 'items' );
                for(var i=0; i<arrItems.length; i++)
                {
                    if (arrItems[i].value === event.item )
                    {
                        event.cancel = true;
                        return;
                    }
                }
                
                event.item = {
                    value: event.item,
                    is_valid_email: null,
                    may_be_wrong_email: null,
                    may_be_wrong_email_suggest: null,
                    user_id: null
                };
    
                intSharePopup_ValidationActiveCount++;
                $.post('/ajax/share.php', {
                    items: [ event.item ],
                    validate: 1
                }, function (strResponse){
                    var objResponse = JSON.parse(strResponse);
                    
                    if ( objResponse.status='ok' )
                    {
                        if ( objResponse.items[ event.item.value ] )
                        {
                            event.item.value = objResponse.items[ event.item.value ].value;
                            event.item.is_valid_email = objResponse.items[ event.item.value ].is_valid_email;
                            event.item.may_be_wrong_email = objResponse.items[ event.item.value ].may_be_wrong_email;
                            event.item.may_be_wrong_email_suggest = objResponse.items[ event.item.value ].may_be_wrong_email_suggest;
                            event.item.wrong_email__is_accepted = null;
                            event.item.can_email = objResponse.items[ event.item.value ].can_email;
                            event.item.user_id = objResponse.items[ event.item.value ].user_id;
                        }
                    }
    
                    jqSharePopupTagsInput.tagsinput('refresh');
    
                    setTimeout(sharePopup_CheckAlerts, 50);
                })
                .always(function() {
                    intSharePopup_ValidationActiveCount--;
                });
            }
        });
        
        
        $('#share_popup__send_button').off('click').on('click', function ()
        {
            switch ( $( 'input[type=radio][name=share_popup__share_type_radio]:checked' ).val() )
            {
                default:
                case 'email':
                    $('#share_popup__send_button').text( 'Tiek sūtīts..' );
                    sharePopup_SubmitEmails();
                    break;
                case 'business_account_user':
                case 'business_account_user_group':
                case 'business_account_external_user_group':
                case 'business_account_external_user':
                case 'project_internal_user':
                case 'project_external_user':
                    sharePopup_RequestOrgUserOrGroupShare ()
                    break;
            }
            //
        })
        
        $('.email_input_wrapper').off('click').on('click', function (){
            $(this).css({'min-height': '72px'});
            $( "#share_em" ).focus();
        })
    }

    function keyCombinationInList(keyPressEvent, lookupList) {
        var found = false;
        $.each(lookupList, function (index, keyCombination) {
            if (typeof (keyCombination) === 'number' && keyPressEvent.which === keyCombination) {
                found = true;
                return false;
            }

            if (keyPressEvent.which === keyCombination.which) {
                var alt = !keyCombination.hasOwnProperty('altKey') || keyPressEvent.altKey === keyCombination.altKey,
                    shift = !keyCombination.hasOwnProperty('shiftKey') || keyPressEvent.shiftKey === keyCombination.shiftKey,
                    ctrl = !keyCombination.hasOwnProperty('ctrlKey') || keyPressEvent.ctrlKey === keyCombination.ctrlKey;
                if (alt && shift && ctrl) {
                    found = true;
                    return false;
                }
            }
        });
        return found;
    }
    function split( val ) {
		return val.split( /,\s*/ );
	}
	function extractLast( term ) {
		return split( term ).pop();
	}
	$(function (){
		jQuery( "#share_em" )
            .bind( 'keypress', 'input', function( event ) {
                if(keyCombinationInList(event, [13, 32, 44, 59]) || event.keyCode === jQuery.ui.keyCode.TAB ) {
                    event.preventDefault();
					$(".bootstrap-tagsinput input").val(this.value);
                    $(".bootstrap-tagsinput input").trigger( "focusout" );
                    $(this).val("");
                }
                toggleSendButton();
			})
            .focusout(function(){
                $(".bootstrap-tagsinput input").val(this.value);
                $(".bootstrap-tagsinput input").trigger( "focusout" );
                $(this).val("");
                setTimeout(toggleSendButton, 100);
            })
			.autocomplete({
				source: function( request, response ) {
					jQuery.getJSON( "/ajax/get_user_sent_email_addresses.php", {
						term: extractLast( request.term )
					}, response );
				},
				search: function() {
					// custom minLength
					var term = extractLast( this.value );
					if ( term.length < 2 ) {
						return false;
					}
				},
				focus: function() {
					// prevent value inserted on focus
					return false;
				},
				select: function( event, ui ) {
					$(".bootstrap-tagsinput input").val(ui.item.value );
                    $(".bootstrap-tagsinput input").trigger( "focusout" );
                    $(this).val("");
                    toggleSendButton();
					return false;
				}
			});

            function toggleSendButton( ) {
                if($('.bootstrap-tagsinput').find('span.tag').length === 0)
                {
                    $("#share_popup__send_button").removeClass( "active" );
                    $("#share_popup__cancel_button").hide();
                    $(".email_description_input_wrapper").hide();
                    $( "#share_popup.is_enterprise .email_description_input_wrapper" ).show();
                    $( "label[for='share_email_send_notification']").hide();
                    $( "#share_popup.is_enterprise label[for='share_email_send_notification']" ).css('display', 'block');
                }
                else
                {
                    $("#share_popup__send_button").addClass( "active" );
                    $("#share_popup__cancel_button").show();
                    $(".email_description_input_wrapper").show();
                    $("label[for='share_email_send_notification']").css('display', 'block');
                    
                }
	        }

            $("#share_popup__cancel_button").click(function() {
                $('#email_input').tagsinput( 'removeAll' );

                $("#share_popup__send_button").removeClass( "active" );
                $("#share_popup__cancel_button").hide();
                $(".email_description_input_wrapper").hide();
                $( "#share_popup.is_enterprise .email_description_input_wrapper" ).show();
                $( "label[for='share_email_send_notification']" ).hide();
                $( "#share_popup.is_enterprise label[for='share_email_send_notification']" ).css('display', 'block');
            });
            
	});

    function changeSharePopupType( strType, bolSharePopupReceiveFolder )
    {
        if (bolSharePopupReceiveFolder)
        {
            $('.link-can-upload').show();
        }

        if ( strType != 'all_files' && strType != 'one_file' && strType != 'dvs_document' )
        {
            strType = 'all_files';
        }
    
        strSharePopupType = strType;
    
    
        $( '#shared-icon' ).removeClass();
        if ( strSharePopupType == 'one_file' )
        {
            $( '#share_popup__type__all_files' ).attr( 'checked', false );
            $( '#share_popup__type__only_this_file' ).attr( 'checked', true );
            $( '#shared-icon' ).addClass( 'one_file' );
        }
        else
        {
            $( '#share_popup__type__all_files' ).attr( 'checked', true );
            $( '#share_popup .dropdown' ).val( 1 ).trigger( 'change' );
            $( '#shared-icon' ).addClass( 'all_files' );
        }
    
    
        if ( strType == "one_file" || ( arrSharePopupParametres[ strSharePopupType ][ 'edit_url' ] == '' && arrSharePopupParametres[ strSharePopupType ][ 'upload_url' ] == '' ) )
        {
            $( '#share_popup .dropdown' ).hide();
            $( '#share_popup .dropdown_only_text' ).show();
        }
        else
        {
            $( '#share_popup .dropdown' ).show();
            $( '#share_popup .dropdown_only_text' ).hide();
        }

        if ( 
            0 
            || ! arrSharePopupParametres[ strSharePopupType ][ 'embed_player' ] 
            || ! arrSharePopupParametres[ strSharePopupType ][ 'embed_player' ][ 'file_view_hash' ] 
            || arrSharePopupAllowEmbedPlayer_Extensions.indexOf(arrSharePopupParametres[strSharePopupType]['embed_player']['file_extension']) === -1 )
        {
            $( '#p2p_embed_select' ).removeClass( "first" ).hide();
            $( "#simple_down_link" ).addClass( "first" );
        }
        else
        {
            $( '#p2p_embed_select' )
                .addClass( "first" )
                .show();
            $( "#simple_down_link" ).removeClass( "first" );
        }
        
        if( arrSharePopupParametres[ strSharePopupType ][ 'edit_url' ] == '' || strType == "one_file" )
        {
            $( '#share_popup .dropdown > option:nth-child(2)' ).hide();
        }
        else
        {
            $( '#share_popup .dropdown > option:nth-child(2)' ).show();
        }

        if( arrSharePopupParametres[ strSharePopupType ][ 'upload_url' ] == '' || strType == "one_file" )
        {
            $( '#share_popup .dropdown > option:nth-child(3)' ).hide();
        }
        else
        {
            $( '#share_popup .dropdown > option:nth-child(3)' ).show();
        }


        if ( typeof arrSharePopupParametres[ strSharePopupType ][ 'item_info' ] != 'undefined' && arrSharePopupParametres[ strSharePopupType ][ 'item_info' ] != '' )
        {
	        $( '#share_popup .item-name' ).text('"' + arrSharePopupParametres[ strSharePopupType ][ 'item_info' ][ 'item_name' ] + '"' );
            $( '#seperator-or' ).show();
        }
        else 
        {
            $( '#seperator-or' ).hide();
        }
            
        
        $( '.copy_input_value_to_clipboard_no_tooltip' ).removeClass( 'checked' );
        
        $( '#share_popup_url' ).val( arrSharePopupParametres[ strSharePopupType ][ 'view_url' ] );
        $( '#share_popup_url' ).attr( 'data-clipboard-text', arrSharePopupParametres[ strSharePopupType ][ 'view_url' ] );
        $( '#share_popup_copy_url' ).attr( 'data-clipboard-text', arrSharePopupParametres[ strSharePopupType ][ 'view_url' ] );

        if (bolSharePopupReceiveFolder)
        {
            var strHtml = 	'<div id="drawer_copy_button_view" class="share-input copy_input_value_to_clipboard_no_tooltip checked" onclick="updateSharePopupLink(1)">' +
								'<span>Kopēt skatīšanās saiti</span>' +
								'<span class="desc_popup">Var apskatīt un lejupielādēt</span>' +
							'</div>';

            strHtml += 	'<div id="drawer_copy_button_upload" class="share-input copy_input_value_to_clipboard_no_tooltip" onclick="updateSharePopupLink(3)">' +
                                '<span>Kopēt pievienošanas saiti</span>' +
                                '<span class="desc_popup">Var pievienot klāt failus, bet ne dzēst vai rediģēt esošos</span>' +
                            '</div>';

            
		    $( '#copy_button_drawer_popup' ).append(strHtml);
		    $( '.copy_button_wrapper_popup' ).removeClass('copy_input_value_to_clipboard_no_tooltip');
        }
        else
        {
            $( '.copy_button_wrapper_popup' ).addClass('copy_input_value_to_clipboard_no_tooltip');
        }

        if (bolSharePopupReceiveFolder)
        {
            $( '#drawer_copy_button_upload' ).addClass( 'checked' );
        }
        else
        {
            $( '#drawer_copy_button_view' ).addClass( 'checked' );
        }
            
    
        $( "#share_popup_ext_link" ).attr( 'href', arrSharePopupParametres[ strSharePopupType ][ 'view_url' ] );
    
    
        sharePopupLoadSharedWithTable ();
        
        $( '#share_popup .inner .content' ).prop('scrollTop', 0);


		$( '#share-popup_upload-access-switch' ).hide();
		
		if ( strType == 'all_files' && typeof arrSharePopupParametres.upload_info != 'undefined' && typeof arrSharePopupParametres.can_share != 'undefined' && arrSharePopupParametres.can_share )
		{
			var objUploadAccessSwitchSettings = arrSharePopupParametres.upload_info;
			objUploadAccessSwitchSettings.upload_access_switch_type = 'sharing_form';

	        if ( typeof arrSharePopupParametres[ 'from_eparaksts' ] != 'undefined' && arrSharePopupParametres[ 'from_eparaksts' ] )
	        {
	        	objUploadAccessSwitchSettings.from_eparaksts = true;
	        }
	        else 
	        {
	        	objUploadAccessSwitchSettings.from_eparaksts = false;
	        }
	        
        	objSharePopupUploadAccessSwitch = new UploadAccessSwitch(
        		$( '#share-popup_upload-access-switch' ) ,
        		arrSharePopupParametres.upload_info
        	);
        	
        	$( '#share-popup_upload-access-switch' ).show();

        	if ( arrSharePopupParametres.upload_info.access_type == 'PRIVATE' )
        	{
        		//$( '#share_popup .url_wrapper__sher-link' ).hide();
        		$( '#share_popup .social_wrapper' ).hide();
        		//$( '#seperator-or' ).hide();
                $( '#share_popup  #url_wrapper__sher-link-icon' ).addClass('locked');
                $( '#share_popup  .upload-access-switch_password-wrapper' ).hide();
                $( '#share_popup .upload-access-switch_type-wrapper-desc' ).html('Tikai ar privātu atļauju');
        	}
        	else 
        	{
        		$( '#share_popup .url_wrapper__sher-link' ).show();
        		$( '#share_popup .social_wrapper' ).show();
                $( '#seperator-or' ).show();
                $( '#share_popup  #url_wrapper__sher-link-icon' ).removeClass('locked');
                $( '#share_popup  .upload-access-switch_password-wrapper' ).show();
                $( '#share_popup .upload-access-switch_type-wrapper-desc' ).html('Jebkuram, kurš zina saiti');
        	}
		}
		else if ( strType == 'one_file' && typeof arrSharePopupParametres[ 'one_file' ][ 'item_info' ] != 'undefined' && typeof arrSharePopupParametres.can_share != 'undefined' && arrSharePopupParametres.can_share )
		{
			var objFileInfo = arrSharePopupParametres[ 'one_file' ][ 'item_info' ];

			if ( objFileInfo.access_type == '' || objFileInfo.access_type == null )
			{
				objFileInfo.access_type = objFileInfo.parent_access_type;
			}

			if ( objFileInfo.access_type == 'PRIVATE' && objFileInfo.parent_access_type == 'LINK' )
			{
				objFileInfo.access_type = 'LINK';
			}
	        
        	objSharePopupUploadAccessSwitch = new UploadAccessSwitch(
        		$( '#share-popup_upload-access-switch' ) ,
        		{
            		item_type : 'file' ,
            		file_hash : objFileInfo.file_view_hash ,
        			owner_logged_in : objFileInfo.owner_logged_in ,
        			access_type : objFileInfo.access_type,
        			parent_access_type : objFileInfo.parent_access_type,
        			upload_access_switch_type : 'sharing_form' ,
        			from_eparaksts : ( typeof arrSharePopupParametres[ 'from_eparaksts' ] != 'undefined' && arrSharePopupParametres[ 'from_eparaksts' ] ? true : false )
        		}
        	);
        	
        	$( '#share-popup_upload-access-switch' ).show();

        	if ( objFileInfo.access_type == 'PRIVATE' )
        	{
        		//$( '#share_popup .url_wrapper__sher-link' ).hide();
        		$( '#share_popup .social_wrapper' ).hide();
                //$( '#seperator-or' ).hide();
                $( '#share_popup  #url_wrapper__sher-link-icon' ).addClass('locked');
                $( '#share_popup  .upload-access-switch_password-wrapper' ).hide();
                $( '#share_popup .upload-access-switch_type-wrapper-desc' ).html('Tikai ar privātu atļauju');
        	}
        	else 
        	{
        		$( '#share_popup .url_wrapper__sher-link' ).show();
        		$( '#share_popup .social_wrapper' ).show();
                $( '#seperator-or' ).show();
                $( '#share_popup  #url_wrapper__sher-link-icon' ).removeClass('locked');
                $( '#share_popup  .upload-access-switch_password-wrapper' ).show();
                $( '#share_popup .upload-access-switch_type-wrapper-desc' ).html('Jebkuram, kurš zina saiti');
        	}
		}

        if (strType == 'all_files' && ((typeof arrSharePopupParametres.upload_info != 'undefined' && arrSharePopupParametres.upload_info.access_type =='link-can-upload') || arrSharePopupParametres.all_files.upload_url )) 
        {
            updateSharePopupLink( 1 );
            if (bolSharePopupReceiveFolder)
            {
                updateSharePopupLink( 3 );
                $('.link-can-upload').hide();
            }
        }
        
        if ( strType == 'dvs_document' )
        {
        	$( '#share_popup .url_wrapper' ).hide();
        	$( '#share_popup .social_wrapper' ).hide();
        	$( '#share_popup #seperator-or' ).hide();
        	
        	$( '#share_popup #share_type__group_container__project_team' ).hide();
        	$( '#share_popup #share_type__group_container__company_users' ).hide();
        	$( '#share_popup .share_access_rights__wrapper' ).hide();
        	$( '#share_popup .active_date_input' ).hide();
        	$( '#share_popup .active_date_input' ).removeClass( 'enterprise_feature' );
        	$( '#share_popup #share_email_send_notification_wrapper' ).hide();;
        }
    }

    function hideSharePopup()
    {
        if ( ! $('#share_popup .modal-inner').is(":visible") )
        {
            return;
        }
        
        $( 'html' ).css( 'overflow', '' );
        

        if( window.location.hash.indexOf( ';/share_popup' ) !== -1)
        {
	        window.location.hash = window.location.hash.replace(';/share_popup', '');
        }
        
        $('#share_popup .modal-inner').hide();
        hideModal('share_popup');

        if ( objSharePopupUploadAccessSwitch != null && objSharePopupUploadAccessSwitch.bolAccessTypeChanged )
        {
        	location.reload();
        }
    }

    function updateSharePopupLink(intSelected)
    {
        $( '#share_access_rights__allow_view' ).attr( 'checked', true );
        $( '#share_access_rights__allow_download' ).attr( 'checked', true );
        
		if ( intSelected == 2 && arrSharePopupParametres[ strSharePopupType ][ 'edit_url' ] != '' )
		{
            $( '.copy_input_value_to_clipboard_no_tooltip' ).removeClass( 'checked' );
            $( '#drawer_copy_button_edit' ).addClass( 'checked' );
			$( '#share_popup_url' ).val( arrSharePopupParametres[ strSharePopupType ][ 'edit_url' ] );
	        $( '#share_popup_url' ).attr( 'data-clipboard-text', arrSharePopupParametres[ strSharePopupType ][ 'edit_url' ] );
	        $( '#share_popup_copy_url' ).attr( 'data-clipboard-text', arrSharePopupParametres[ strSharePopupType ][ 'edit_url' ] );
            $( "#share_popup_ext_link" ).attr( 'href', arrSharePopupParametres[ strSharePopupType ][ 'edit_url' ] );

            $( '#share_access_rights__allow_write' ).attr( 'checked', true );
            $( '#share_access_rights__allow_delete' ).attr( 'checked', true );
		}
		else if( intSelected == 3 && arrSharePopupParametres[ strSharePopupType ][ 'upload_url' ] )
		{
            $( '.copy_input_value_to_clipboard_no_tooltip' ).removeClass( 'checked' );
            $( '#drawer_copy_button_upload' ).addClass( 'checked' );
            $( '#share_popup_url' ).val( arrSharePopupParametres[ strSharePopupType ][ 'upload_url' ] );
            $( '#share_popup_url' ).attr( 'data-clipboard-text', arrSharePopupParametres[ strSharePopupType ][ 'upload_url' ] );
            $( '#share_popup_copy_url' ).attr( 'data-clipboard-text', arrSharePopupParametres[ strSharePopupType ][ 'upload_url' ] );
            $( "#share_popup_ext_link" ).attr( 'href', arrSharePopupParametres[ strSharePopupType ][ 'upload_url' ] );

            $( '#share_access_rights__allow_write' ).attr( 'checked', true );
            $( '#share_access_rights__allow_delete' ).attr( 'checked', false );
        }
        else
		{
            $( '.copy_input_value_to_clipboard_no_tooltip' ).removeClass( 'checked' );
            $( '#drawer_copy_button_view' ).addClass( 'checked' );
			$( '#share_popup_url' ).val( arrSharePopupParametres[ strSharePopupType ][ 'view_url' ] );
	        $( '#share_popup_url' ).attr( 'data-clipboard-text', arrSharePopupParametres[ strSharePopupType ][ 'view_url' ] );
	        $( '#share_popup_copy_url' ).attr( 'data-clipboard-text', arrSharePopupParametres[ strSharePopupType ][ 'view_url' ] );
            $( "#share_popup_ext_link" ).attr( 'href', arrSharePopupParametres[ strSharePopupType ][ 'view_url' ] );

            $( '#share_access_rights__allow_write' ).attr( 'checked', false );
            $( '#share_access_rights__allow_delete' ).attr( 'checked', false );
		}
    }

    var bolSharePopUpDeclineSuggest = false;


    function shareOnFacebook(strFileName, strPictureURL, strDescription, strFbLink, strReturnLink)
    {
    	window.open(
    	        'http://www.facebook.com/dialog/feed?app_id='+ FB_APP_ID +
    	        '&name=' + encodeURIComponent(strFileName) +
    	        '&picture=' + encodeURIComponent(strPictureURL) +
    	        '&description=' + encodeURIComponent(strDescription) +
    	        '&link=' + encodeURIComponent(strFbLink) +
    	        '&redirect_uri=' + encodeURIComponent(strReturnLink)
    	        ,
    	        '_parent'
    	        );
    }


    function shareOnTwitter( strText, strLink )
    {
        window.open(
            'http://twitter.com/intent/tweet?source=webclient&text=' +
            encodeURIComponent( strText ) +
            '&url=' +
            encodeURIComponent( strLink ) ,
            '',
            'location=1,status=1,scrollbars=0,resizable=0,width=640,height=480'
        );
    
        return false;
    }

    function shareOnTelegram( strText, strLink )
    {
        window.open(
            'https://telegram.me/share/?url=' +
            encodeURIComponent( strLink ) +
            '&text=' +
            encodeURIComponent( strText ),
            '',
            'location=1,status=1,scrollbars=0,resizable=0,width=640,height=480'
        );
    
        return false;
    }
</script>
<div id="file_embed_popup" class="more_options_popup" style="display:none">
    <div id="file_embed_popup_inner" class="more_options_popup_inner">
        <div id="file_embed_popup_close" class="more_options_popup_close" onclick="window.FileEmbedPopup.hidePopup();">
            <i class="fa fa-times"></i>
        </div>
        
        <form>
                            
                <section class="file_embed_section" id="file_embed_section_image">
                    <div class="file_embed_section_title">
                        Attēla iegulšanas kodi weblapās (help: support@failiem.lv)                    </div>
                                            <div class="file_embed_item" id="file_embed_item_image_html">
                            <div class="more_options_popup_header more_options_popup_header_clear clearfix">
                                <span class="more_options_popup_dropdown_wrapper">
                                    Weblapām (HTML)                                                                    </span>
                            </div>
                            <div class="more_options_popup_url_wrapper">
                                <input id="file_embed_image_html"
                                       class="file_embed_select copy_input_value_to_clipboard"
                                       type="text" readonly
                                       onclick="window.FileEmbedPopup.onClickItem(event, 'image', 'html')"/>
                            </div>
                        </div>
                                            <div class="file_embed_item" id="file_embed_item_image_bbcode">
                            <div class="more_options_popup_header more_options_popup_header_clear clearfix">
                                <span class="more_options_popup_dropdown_wrapper">
                                    Forumiem: BBCode                                                                    </span>
                            </div>
                            <div class="more_options_popup_url_wrapper">
                                <input id="file_embed_image_bbcode"
                                       class="file_embed_select copy_input_value_to_clipboard"
                                       type="text" readonly
                                       onclick="window.FileEmbedPopup.onClickItem(event, 'image', 'bbcode')"/>
                            </div>
                        </div>
                                            <div class="file_embed_item" id="file_embed_item_image_thumb_small">
                            <div class="more_options_popup_header more_options_popup_header_clear clearfix">
                                <span class="more_options_popup_dropdown_wrapper">
                                    Mazais bildes sīktēls                                                                    </span>
                            </div>
                            <div class="more_options_popup_url_wrapper">
                                <input id="file_embed_image_thumb_small"
                                       class="file_embed_select copy_input_value_to_clipboard"
                                       type="text" readonly
                                       onclick="window.FileEmbedPopup.onClickItem(event, 'image', 'thumb_small')"/>
                            </div>
                        </div>
                                            <div class="file_embed_item" id="file_embed_item_image_full">
                            <div class="more_options_popup_header more_options_popup_header_clear clearfix">
                                <span class="more_options_popup_dropdown_wrapper">
                                    Normāla izmēra attēls                                                                    </span>
                            </div>
                            <div class="more_options_popup_url_wrapper">
                                <input id="file_embed_image_full"
                                       class="file_embed_select copy_input_value_to_clipboard"
                                       type="text" readonly
                                       onclick="window.FileEmbedPopup.onClickItem(event, 'image', 'full')"/>
                            </div>
                        </div>
                                    </section>
            
                            
                <section class="file_embed_section" id="file_embed_section_default">
                    <div class="file_embed_section_title">
                        Faila saites                    </div>
                                            <div class="file_embed_item" id="file_embed_item_default_web_link_to_file">
                            <div class="more_options_popup_header more_options_popup_header_clear clearfix">
                                <span class="more_options_popup_dropdown_wrapper">
                                    <b>Tiešā saite uz failu pārlūkā</b>                                                                    </span>
                            </div>
                            <div class="more_options_popup_url_wrapper">
                                <input id="file_embed_default_web_link_to_file"
                                       class="file_embed_select copy_input_value_to_clipboard"
                                       type="text" readonly
                                       onclick="window.FileEmbedPopup.onClickItem(event, 'default', 'web_link_to_file')"/>
                            </div>
                        </div>
                                            <div class="file_embed_item" id="file_embed_item_default_P2P">
                            <div class="more_options_popup_header more_options_popup_header_clear clearfix">
                                <span class="more_options_popup_dropdown_wrapper">
                                    Iekļaušanai weblapās  (P2P Player unlimited)                                                                            <a onmouseleave="hideTooltip(this)"
                                           onmouseenter='showTooltip(this, "Iekopējiet šo kodu savā weblapā. Sazinieties support@files.fm, ja vajadzīga palīdzība. Šis ir pareizais veids, kā iegult saturu ar bezlimita trafiku. Iespējami papildus atribūti: <br /> <b>w</b> - faila platums (css vērtība);<br /> <b>h</b> - faila augstums (css vērtība);<br /> <b>autoload</b> - ielādēt failu uzreiz pēc iekļaušanas; <br /> <b>autoplay</b> - sākt atspēlēt video/audio uzreiz pēc ielādes; <br /> <b>poster_src</b> - priekšskatījuma bildes saite;")'>
                                            <i class="fa fa-info-circle"></i>
                                        </a>
                                                                    </span>
                            </div>
                            <div class="more_options_popup_url_wrapper">
                                <input id="file_embed_default_P2P"
                                       class="file_embed_select copy_input_value_to_clipboard"
                                       type="text" readonly
                                       onclick="window.FileEmbedPopup.onClickItem(event, 'default', 'P2P')"/>
                            </div>
                        </div>
                                            <div class="file_embed_item" id="file_embed_item_default_direct_simple">
                            <div class="more_options_popup_header more_options_popup_header_clear clearfix">
                                <span class="more_options_popup_dropdown_wrapper">
                                    Tiešā saite                                                                    </span>
                            </div>
                            <div class="more_options_popup_url_wrapper">
                                <input id="file_embed_default_direct_simple"
                                       class="file_embed_select copy_input_value_to_clipboard"
                                       type="text" readonly
                                       onclick="window.FileEmbedPopup.onClickItem(event, 'default', 'direct_simple')"/>
                            </div>
                        </div>
                                            <div class="file_embed_item" id="file_embed_item_default_direct_path">
                            <div class="more_options_popup_header more_options_popup_header_clear clearfix">
                                <span class="more_options_popup_dropdown_wrapper">
                                    Tiešā saite ar pilnu ceļu                                                                    </span>
                            </div>
                            <div class="more_options_popup_url_wrapper">
                                <input id="file_embed_default_direct_path"
                                       class="file_embed_select copy_input_value_to_clipboard"
                                       type="text" readonly
                                       onclick="window.FileEmbedPopup.onClickItem(event, 'default', 'direct_path')"/>
                            </div>
                        </div>
                                    </section>
            
                    </form>
    </div>
</div>

<script type="text/javascript" src="/js/popups/more_options_popup.js?v=102"></script>
<script type="text/javascript">
    function EmbedPopup( strPopupID )
    {
        ListButtonPopup.call( this, strPopupID );
    }
    
    EmbedPopup.prototype = Object.create( ListButtonPopup.prototype );
    EmbedPopup.prototype.constructor = ListButtonPopup;
    
    EmbedPopup.prototype.onBeforeShowed = function ()
    {
        this.populateSections();
    
        if ( $( '#share_popup' ).is( ":visible" ) )
        {
            hideSharePopup();
        }
    };
    
    EmbedPopup.prototype.populateSections = function ()
    {
        var arrSections = JSON.parse( "{\"image\":[\"html\",\"bbcode\",\"thumb_small\",\"full\"],\"default\":[\"web_link_to_file\",\"P2P\",\"direct_simple\",\"direct_path\"]}" );
        var objInfo = this.getFileInfo();
        this.sections = {
            'image': new ImageSection(),
            'default': new DefaultSection()
        };
        
        for ( var strSectionKey in arrSections )
        {
            if ( !arrSections.hasOwnProperty( strSectionKey ) ) continue;
            
            // verify that the section can be showed
            if ( !this.sections[ strSectionKey ].canShow( objInfo ) )
            {
                $( "#file_embed_section_" + strSectionKey ).hide();
                continue;
            }
            else
            {
                $( "#file_embed_section_" + strSectionKey ).show();
            }
            
            var arrItems = arrSections[ strSectionKey ];
            
            for ( var i in arrItems )
            {
                if ( !arrItems.hasOwnProperty( i ) ) continue;
                
                var strItemKey = arrItems[ i ];
                
                if ( this.sections[ strSectionKey ].canShowItem( strItemKey, objInfo ) )
                {
                    $( "#file_embed_" + strSectionKey + "_" + strItemKey ).val(
                        this.sections[ strSectionKey ].getItemValue( strItemKey, objInfo )
                    );
                    
                    $("#file_embed_item_" + strSectionKey + "_" + strItemKey).show();
                }
                else
                {
                    $("#file_embed_item_" + strSectionKey + "_" + strItemKey).hide();
                }
            }
        }
    };
    
    EmbedPopup.prototype.getFileInfo = function ()
    {
        var params = window.arrSharePopupParametres;
        var type = params.type;
    
        var embed_player,
            file_hash,
            upload_hash,
            is_image,
            file_name,
            logged_in_user_is_owner;
    
        if ( typeof params[ type ] !== "undefined" )
        {
            embed_player = params[ type ][ 'embed_player' ];
        }
        
        file_hash = params[ 'one_file' ][ 'item_info' ][ 'file_view_hash' ];
        upload_hash = params[ 'one_file' ][ 'item_info' ][ 'upload_hash' ];
        logged_in_user_is_owner = typeof params[ 'all_files' ][ 'logged_in_user_is_owner' ] !== "undefined" ? params[ 'all_files' ][ 'logged_in_user_is_owner' ] : undefined;
        is_image = $.inArray( params[ 'one_file' ][ 'item_info' ][ 'extension' ], [ 'jpeg', 'jpg', 'png', 'gif' ] ) !== -1;
        file_name = params[ 'one_file' ][ 'item_info' ][ 'file_name' ];

        return {
            'file_hash': file_hash,
            'upload_hash': upload_hash,
            'file_name': file_name,
            'embed_player': embed_player,
            'domain': "https://failiem.lv",
            'is_img': is_image,
            'logged_in_user_is_owner': logged_in_user_is_owner,
            'file_extension' : params[ 'one_file' ][ 'item_info' ][ 'extension' ]
        };
    };
    
    EmbedPopup.prototype.onClickItem = function ( event, strSectionKey, strItemKey )
    {
        var objInfo = this.getFileInfo();
        
        // deselecct all other input fields
        $( ".file_embed_select" ).blur();
        
        // select event target field
        if ( this.sections[ strSectionKey ].canCopyItem( strItemKey, objInfo ) )
        {
            $( event.target ).select();
        }

        gaev('file_embed_popup', strSectionKey, strItemKey );
    };
    
    window.FileEmbedPopup = new EmbedPopup( "file_embed_popup" );
    
    function EmbedPopupSection()
    {
    }
    
    EmbedPopupSection.prototype = {
        canShow: function ( objInfo )
        {
        },
        canShowItem: function ( strItemKey, objInfo )
        {
        },
        canCopyItem: function ( strItemKey, objInfo )
        {
        },
        getItemValue: function ( strItemKey, objInfo )
        {
        }
    };
    
    function ImageSection()
    {
        EmbedPopupSection.call( this );
    }
    
    ImageSection.prototype = Object.create( EmbedPopupSection.prototype );
    ImageSection.prototype.constructor = EmbedPopupSection;
    
    ImageSection.prototype.canShow = function ( objInfo )
    {
        return objInfo.is_img;
    };
    
    ImageSection.prototype.getItemValue = function ( strItemKey, objInfo )
    {
        var strUploadListViewURL = objInfo.domain + "/u/" + objInfo.upload_hash + "#/view/" + encodeURI( objInfo.file_name );
        var strFileListViewURL = objInfo.domain + "/f/" + objInfo.file_hash;
        var strFileThumbShowURL = objInfo.domain + "/thumb_show.php?i=" + objInfo.file_hash;
        var strFileThumbURL = objInfo.domain + "/thumb.php?i=" + objInfo.file_hash;
    
        var isListViewForSpecificFile = 1;
        
        switch ( strItemKey )
        {
            case 'html' :
                return "<a href=\"" + (isListViewForSpecificFile ? strFileListViewURL : strUploadListViewURL) + "\">" +
                    "<img src=\"" + strFileThumbShowURL + "\">" +
                    "</a>";
            case 'bbcode':
                return "[URL=" + (isListViewForSpecificFile ? strFileListViewURL : strUploadListViewURL) + "][IMG]" + strFileThumbShowURL + "[/IMG][/URL]";
            case 'thumb_small':
                return strFileThumbURL;
            case 'full':
                return strFileThumbShowURL;
        }
    };
    
    ImageSection.prototype.canShowItem = function ( strItemKey, objInfo )
    {
        // image embed urls are available to all users
        return true;
    };
    
    ImageSection.prototype.canCopyItem = function ( strItemKey, objInfo )
    {
        return true;
    };
    
    function DefaultSection()
    {
        EmbedPopupSection.call( this );
    }

    DefaultSection.pathUrlCache = [];
    
    DefaultSection.prototype = Object.create( EmbedPopupSection.prototype );
    DefaultSection.prototype.constructor = EmbedPopupSection;
    
    DefaultSection.prototype.getItemValue = function ( strItemKey, objInfo )
    {
        switch ( strItemKey )
        {
            case 'P2P':
                if ( ( [ 'mp4', 'ogg', 'webm' ] ).indexOf( objInfo.embed_player.file_extension ) !== -1 )
                {
                    return '<script type="text/javascript" src="' + objInfo.domain
                        + '/embed/playerv2?hash=' + objInfo.embed_player.file_view_hash
                        + '&autoplay=off&autoload=off&w=100%&h=auto&poster_src=' + objInfo.domain
                        + '/thumb_video_picture.php?i=' + objInfo.embed_player.file_view_hash
                        + '" id="filesfm_embed_js__' + objInfo.embed_player.file_view_hash + '"><' + '/script>';
                }
                else
                {
                    return '<script type="text/javascript" src="' + objInfo.domain + '/embed/player?hash='
                        + objInfo.embed_player.file_view_hash + '&w=100%&h=auto" '
                        + 'id="filesfm_embed_js__' + objInfo.embed_player.file_view_hash + '"><' + '/script>';
                }
			case 'web_link_to_file':
                return objInfo.domain + "/f/" + objInfo.file_hash;
            case 'direct_simple':
                return objInfo.domain + "/down.php?i=" + objInfo.file_hash;
            case 'direct_path':
                if( typeof this.constructor.pathURLCache === "undefined" )
                {
                    this.constructor.pathURLCache = [];   
                }
                
                // cache the paths
                if ( typeof this.constructor.pathURLCache[ objInfo.file_hash ] !== "undefined" )
                {
                    return this.constructor.pathURLCache[ objInfo.file_hash ];
                }
                
                var _this = this;
                
                // don't have path cached -> request it from api
                $.ajax( {
                    type: "GET",
                    url: "/api/embed_urls.php",
                    data: {
                        'i': objInfo.file_hash
                    },
                    success: function ( data )
                    {
                        data = JSON.parse( data );
                        if ( data[ 'path_access_url' ] )
                        {
                            // add url to local cache
                            _this.constructor.pathURLCache[ objInfo.file_hash ] = data[ 'path_access_url' ];
                            
                            $( "#file_embed_default_direct_path" ).val( data[ 'path_access_url' ] );
                        }
                        else
                        {
                            $( '#file_embed_item_default_direct_path' ).hide();
                        }
                    }
                } );
                return "";
        }
    };
    
    DefaultSection.prototype.canShow = function ( objInfo )
    {
        return true;
    };
    
    DefaultSection.prototype.canShowItem = function ( strItemKey, objInfo )
    {
        var isLoggedIn = !! 0;
        
        switch ( strItemKey )
        {
            case 'P2P':
                return typeof objInfo.embed_player !== "undefined"
                    && typeof objInfo.embed_player.file_view_hash !== "undefined"
                    && objInfo.embed_player.file_view_hash !== null
                    && $.inArray( objInfo.embed_player.file_extension, [ 'mp4', 'webm', 'jpeg', 'jpg', 'png', 'gif', 'mp3' ] ) >= 0;
            case 'direct_path':
                return isLoggedIn && (typeof objInfo.logged_in_user_is_owner === "undefined" || objInfo.logged_in_user_is_owner === true);
            case 'direct_simple':
                if (
                        (
                            (
                                typeof(bolHideDownloadButtons) === 'undefined' 
                                || ! bolHideDownloadButtons 
                            ) 
                            || bolIsOwner 
                        )
                        && objInfo.file_extension != 'filesfm_url'
                	)
                {
                    return true;
                }
                else
                {
                    return false
                }
            default:
                return true;
        }
    };
    
    DefaultSection.prototype.canCopyItem = function ( strItemKey, objInfo )
    {
        var isSubscriber = !!0;
        var isLoggedIn = !! 0;
        
        switch ( strItemKey )
        {
            case 'P2P':
                return true;
            case 'direct_path':
            case 'direct_simple':
                if ( !isSubscriber )
                {
                    if ( isLoggedIn )
                    {
                        objSubscriptionForm.showForm( 'direct_access_share_link' );
                    }
                    else
                    {
                        showSignIn();
                    }
                    window.FileEmbedPopup.hidePopup();
                }
                return isSubscriber;
            default:
                return true;
        }
    };
</script>

<link rel="stylesheet" type="text/css" href="/new/css/popups/more_options_popup.css?v=101">
<link rel="stylesheet" type="text/css" href="/new/css/popups/file_embed_popup.css?v=101">
                <script src="/js/inputs.js?v=1646219091"></script>
                <script src="/ts/chat/dist/index.js?v=1657793616"></script>
</body>
</html>
<!--[if IE 7]>
<style type="text/css">
	#content #right {
		text-align: center;
	}
	#content #right DIV.item {
		float: left;
	}
</style>
-->
